namespace("sap.galilei.ui.editor");
namespace("sap.galilei.ui.editor.tracker");
(function(){namespace("sap.galilei.ui.editor.command");sap.galilei.ui.editor.command.Command=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.Command",parent:sap.galilei.ui.common.command.Command,properties:{isReadOnly:true,editor:undefined,viewer:{get:function(){if(this.editor){return this.editor.viewer}return undefined}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},resource:{get:function(){if(this.diagram){return this.diagram.resource}}},source:undefined,object:undefined,symbol:undefined},methods:{getParameters:function(oParam,bSave){if(oParam){if(!oParam.object){if(oParam.symbol&&oParam.symbol.object){oParam.object=oParam.symbol.object}}if(bSave){this.source=oParam.source;if(oParam.editor){this.editor=oParam.editor}this.symbol=oParam.symbol;this.object=oParam.object}}}}})}());
(function(){sap.galilei.ui.editor.command.SelectValueCommand=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.SelectValueCommand",parent:sap.galilei.ui.editor.command.Command,properties:{values:{get:function(){if(typeof(this._values)==="function"){return this._values.call(this)}return this._values},set:function(aValues){this._values=aValues}},currentValue:undefined,selectedValue:undefined,isValueChanged:false,internalValues:{field:"_internalValues",get:function(){return this._internalValues}},labels:{field:"_labels",get:function(){return this._labels}},icons:{field:"_icons",get:function(){return this._icons}},tooltips:{field:"_tooltips",get:function(){return this._tooltips}}},methods:{getValues:function(){var aInitialValues=this.values,index,vValue,vInternalValue,sLabel,sIcon,sTooltip;this._internalValues=[];this._labels=[];this._icons=[];this._tooltips=[];if(aInitialValues){for(index=0;index<aInitialValues.length;index++){vValue=aInitialValues[index];if(typeof vValue==="object"){vInternalValue=vValue.value;sLabel=vValue.label;if(!sLabel){sLabel=vValue}sIcon=vValue.icon;sTooltip=vValue.tooltip}else{vInternalValue=vValue;sLabel=vValue}if(!sLabel){sLabel="<None>"}if(vInternalValue!=this.currentValue&&this.onVerifyValue(vValue)){this._internalValues.push(vInternalValue);this._labels.push(sLabel);this._icons.push(sIcon);this._tooltips.push(sTooltip)}}}return this._internalValues},onVerifyValue:function(vValue){return true},getButtonDefinitions:function(){var index,oButtons=[],vInternalValue,sLabel,sIcon,sTooltip,sCommand,oCommand;function executeSelectValue(oParam){if(this.parameters&&this.parameters.length>0&&this._parentCommand){var vValue=this.parameters[0];if(vValue!==this._parentCommand.currentValue){this._parentCommand.selectedValue=vValue;this._parentCommand.isValueChanged=true;if(this._parentCommand.onValueChanged){this._parentCommand.onValueChanged()}}}}this.getValues();if(this.internalValues){for(index=0;index<this.internalValues.length;index++){vInternalValue=this.internalValues[index];sLabel=this.labels[index];sIcon=this.icons[index];sTooltip=this.tooltips[index];sCommand=this.name+"-to-"+vInternalValue;oCommand=new sap.galilei.ui.editor.command.Command({editor:this.editor,name:sCommand,displayName:sLabel,tooltip:sTooltip,parameters:[vInternalValue,sLabel],smallIcon:sIcon,execute:executeSelectValue});oCommand._parentCommand=this;sap.galilei.ui.common.command.addCommand(sCommand,oCommand);oButtons.push({commandName:sCommand})}}return oButtons},getValueIndex:function(){return sap.galilei.ui.editor.command.SelectValueCommand.getValueIndex(this.values,this.selectedValue)},createValuePicker:function(oParam){if(oParam){var oContextButton=oParam.source,aButtons;if(oContextButton){aButtons=this.getButtonDefinitions();if(aButtons){if(oContextButton.popupContextButtonPad){oContextButton.popupContextButtonPad.dispose()}if(oContextButton.contextButtonPad){oContextButton.contextButtonPad.removePopupButtonPad()}oContextButton.popupContextButtonPad=new sap.galilei.ui.editor.widget.ContextButtonPad({editor:this.editor,offsetX:0,offsetY:0,buttonsDefinition:aButtons})}}}},execute:function(oParam){if(oParam){var oContextButton;oContextButton=this.source;if(oContextButton){this.createValuePicker(oParam)}}},onValueChanged:function(){},defaultDispose:function(){this.internalValues=undefined;this.labels=undefined;this.icons=undefined},dispose:function(){this.defaultDispose()}},statics:{getValueIndex:function(aValues,sValue){var index;if(aValues){for(index=0;index<aValues.length;index++){if(aValues[index].value===sValue){return index}}}return -1}}});sap.galilei.ui.common.command.addCommand("SelectValueCommand",sap.galilei.ui.editor.command.SelectValueCommand)}());
(function(){sap.galilei.ui.editor.command.ChangePropertyCommand=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.ChangePropertyCommand",parent:sap.galilei.ui.editor.command.SelectValueCommand,properties:{isReadOnly:{value:false,writable:false,configurable:false},attribute:undefined},methods:{execute:function(oParam){if(oParam){var oContextButton;oContextButton=this.source;if(oContextButton){if(this.object&&this.attribute&&sap.galilei.core.hasQualifiedProperty(this.object,this.attribute)){this.currentValue=sap.galilei.core.getValueFromQualifiedPath(this.object,this.attribute)}this.createValuePicker(oParam)}}},onValueChanged:function(){this.changeObjectProperty()},changeObjectProperty:function(){var self=this;function changeObjectProperty(){self.object[self.attribute]=self.selectedValue}if(this.object&&this.attribute&&sap.galilei.core.hasQualifiedProperty(this.object,this.attribute)){this.resource.applyUndoableAction(changeObjectProperty,"Change Object Property")}},onVerifyValue:function(vValue){if(this.editor&&this.object){var oParam={};oParam[this.attribute]=vValue.value;if(!this.editor.canSetObjectProperties(this.object,oParam)){return false}}return true},dispose:function(){this.defaultDispose();this.object=undefined}}});sap.galilei.ui.common.command.addCommand("ChangePropertyCommand",sap.galilei.ui.editor.command.ChangePropertyCommand)}());
(function(){namespace("sap.galilei.ui.editor.tool");sap.galilei.ui.editor.tool.Tool=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tool.Tool",parent:sap.galilei.ui.editor.command.Command,initialize:function(options){if(options){this.set(options)}this.onInitialize()},properties:{cursor:undefined,cursorWidth:32,cursorHeight:32,isSelected:false},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},onSelected:function(){},onUnselected:function(){},dispose:function(){}}});sap.galilei.ui.editor.tool.defineTool=function(oToolDef){var sToolName,sToolType,ToolClass,oProperties;if(oToolDef){if(!oToolDef.parent){oToolDef.parent=sap.galilei.ui.editor.tool.Tool}oProperties=oToolDef.properties||{};sToolName=oToolDef.toolName;if(sToolName){oProperties.name=sToolName;delete oToolDef.toolName}sToolType=oToolDef.toolType;if(sToolType){oProperties.type=sToolType;delete oToolDef.toolType}oToolDef.properties=oProperties;ToolClass=sap.galilei.core.defineClass(oToolDef)}return ToolClass};sap.galilei.ui.editor.tool.Types={tool:"Tool",pointerTool:"PointerTool",lassoTool:"LassoTool",createNodeSymbolTool:"CreateNodeSymbolTool",createLinkSymbolTool:"CreateLinkSymbolTool",compoundCreateNodeSymbolTool:"CompoundCreateNodeSymbolTool"};sap.galilei.ui.editor.tool.getTool=function(sToolName){var oTool;if(sToolName&&sap.galilei.ui.editor.tool.ToolRegistry){oTool=sap.galilei.ui.editor.tool.ToolRegistry.get(sToolName)}return oTool};sap.galilei.ui.editor.tool.addTool=function(sToolName,oTool){if(sToolName&&oTool&&sap.galilei.ui.editor.tool.ToolRegistry){sap.galilei.ui.editor.tool.ToolRegistry.add(sToolName,oTool)}};sap.galilei.ui.editor.tool.removeTool=function(sToolName){if(sToolName&&sap.galilei.ui.editor.tool.ToolRegistry){sap.galilei.ui.editor.tool.ToolRegistry.remove(sToolName)}};sap.galilei.ui.editor.tool.ToolRegistry=new sap.galilei.core.DefaultLookupClass()}());
"use strict";namespace("sap.galilei.ui.editor.anchor");sap.galilei.ui.editor.anchor.Anchor=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.anchor.Anchor",initialize:function(options){if(options){this.set(options)}this.onInitialize()},properties:{symbol:undefined,boundaryShape:{field:"_boundaryShape",get:function(){if(!this._boundaryShape){if(this.symbol){return this.symbol.isLinkSymbol?this.symbol.getLinkShape():this.symbol.getBoundaryShape()}}return this._boundaryShape},set:function(oShape){this._boundaryShape=oShape}},anchorCenter:{field:"_anchorCenter",get:function(){if(this.symbol&&this.boundaryShape){var oRect,oParentBBox;oRect=this.boundaryShape.getBBox();oParentBBox=this.isRelativeCoordinate?this.symbol.getBBox():undefined;if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}return oRect.getCenter()}return this._anchorCenter},set:function(aCenter){this._anchorCenter=aCenter}},isRelativeCoordinate:true,isAttachToCenter:false,isSupportSource:true,isSupportTarget:true},methods:{onInitialize:function(){if(!this.symbol){throw"The symbol of anchor must be defined."}},isPointInAnchor:function(aPoint){if(this.symbol&&this.boundaryShape&&aPoint){return this.boundaryShape.isPointInShape(aPoint,this.isRelativeCoordinate?this.symbol.getBBox():undefined)}return false},getAnchorPoint:function(aPoint){if(this.symbol&&this.boundaryShape&&aPoint){var aNewPoint,bAttachToCenter=this.isAttachToCenter;if(!bAttachToCenter){if(!this.isPointInAnchor(aPoint)){bAttachToCenter=true}else{aNewPoint=[aPoint[0],aPoint[1]]}}if(bAttachToCenter){aNewPoint=this.anchorCenter}return aNewPoint}return aPoint}},statics:{getDefaultAnchor:function(oAnchorParam){return new sap.galilei.ui.editor.anchor.Anchor(oAnchorParam)}}});
(function(){namespace("sap.galilei.ui.editor.widget");sap.galilei.ui.editor.widget.Widget=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.Widget",widgetName:"EditorWidget",properties:{editor:undefined,viewer:{field:"_viewer",get:function(){if(this._viewer){return this._viewer}if(this.editor){return this.editor.viewer}return undefined},set:function(oViewer){this._viewer=oViewer}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},symbol:{field:"_symbol",get:function(){return this._symbol},set:function(oSymbol){var oBBox;this._symbol=oSymbol;this.updateAttachTo()}},isHideOnUnselect:false},methods:{updateAttachTo:function(){if(this._symbol){if(this._symbol.isLinkSymbol){this.attachTo=this._symbol.getCenter();switch(this.alignPosition){case sap.galilei.ui.common.DockPosition.topLeft:case sap.galilei.ui.common.DockPosition.topRight:this.alignPosition=sap.galilei.ui.common.DockPosition.top;break;case sap.galilei.ui.common.DockPosition.bottomLeft:case sap.galilei.ui.common.DockPosition.bottomRight:this.alignPosition=sap.galilei.ui.common.DockPosition.bottom;break}}else{this.attachTo=this._symbol.getBBox()}}},addEventHandlers:function(){this.addWidgetEventHandlers();if(this.isHideOnUnselect){sap.galilei.core.Event.subscribe("symbol.selected",this.onSelectSymbol,this);sap.galilei.core.Event.subscribe("symbol.unselected",this.onUnselectSymbol,this);sap.galilei.core.Event.subscribe("symbols.selection.changed",this.onSelectionChanged,this)}sap.galilei.core.Event.subscribe("move.symbol.dragstart",this.onHideWidget,this);sap.galilei.core.Event.subscribe("move.symbol.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onShowWidget,this);sap.galilei.core.Event.subscribe("move.symbols.dragstart",this.onHideWidget,this);sap.galilei.core.Event.subscribe("move.symbols.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("move.symbols.after",this.onShowWidget,this);sap.galilei.core.Event.subscribe("delete.symbol",this.onRemoveWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.handle.dragstart",this.onHideWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onShowWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.pinch",this.onHideWidget,this);sap.galilei.core.Event.subscribe("linksymbol.handle.dragstart",this.onHideWidget,this);sap.galilei.core.Event.subscribe("layout.linksymbol.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("layout.linksymbol.after",this.onShowWidget,this)},removeEventHandlers:function(){this.removeWidgetEventHandlers();if(this.isHideOnUnselect){sap.galilei.core.Event.unSubscribeScope("symbol.unselected",this);sap.galilei.core.Event.unSubscribeScope("symbols.selection.changed",this)}sap.galilei.core.Event.unSubscribeScope("move.symbol.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.after",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.pinch",this);sap.galilei.core.Event.unSubscribeScope("linksymbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("layout.linksymbol.before",this);sap.galilei.core.Event.unSubscribeScope("layout.linksymbol.after",this)},onSelectSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){}},onUnselectSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.removeWidget()}},onSelectionChanged:function(oEvent){if(oEvent&&this.symbol&&oEvent.selectedSymbols&&oEvent.selectedSymbols.length>1){this.removeWidget()}},onShowWidget:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.showWidget()}},onHideWidget:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.hideWidget()}},onRemoveWidget:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.dispose()}},dispose:function(){this.disposeWidget()}}})}());
namespace("sap.galilei.ui.editor.util");
"use strict";sap.galilei.ui.editor.util.twinDiagramEditor=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.twinDiagramEditor",initialize:function(oEditor1,oEditor2){if(oEditor1&&oEditor2){this.editor1=oEditor1;this.editor2=oEditor2;this.synchronize()}else{if(oEditor1){this.set(oEditor1);this.synchronize()}}},fields:{_isSynchronized:false,_disableZoomPan1:true,_disableZoomPan2:true},properties:{editor1:undefined,editor2:undefined,viewer1:{get:function(){return this.editor1&&this.editor1.viewer}},viewer2:{get:function(){return this.editor2&&this.editor2.viewer}}},methods:{defaultSynchronize:function(){var self=this;function showGlobalViewHelper(){self.showGlobalView()}if(!this._isSynchronized&&this.editor1&&this.editor2){this.viewer1.showGlobalView=showGlobalViewHelper;this.viewer2.showGlobalView=showGlobalViewHelper;sap.galilei.core.Event.subscribe("viewer.zoompan.before",function(oEvent){if(oEvent&&this===self){if(oEvent.source===this.viewer1){if(!self._disableZoomPan1&&(this.viewer2.zoomScale!==oEvent.scale||this.viewer2.zoomTranslate[0]!==oEvent.translate[0]||this.viewer2.zoomTranslate[1]!==oEvent.translate[1])){self.disableZoomPan1=true;this.viewer2.zoomTo(oEvent.scale,oEvent.translate,oEvent.useAnimation);self._disableZoomPan1=false}}else{if(oEvent.source===this.viewer2){if(!self._disableZoomPan2&&(this.viewer1.zoomScale!==oEvent.scale||this.viewer1.zoomTranslate[0]!==oEvent.translate[0]||this.viewer1.zoomTranslate[1]!==oEvent.translate[1])){self.disableZoomPan2=true;this.viewer1.zoomTo(oEvent.scale,oEvent.translate,oEvent.useAnimation);self._disableZoomPan2=false}}}}},this);this._isSynchronized=true;this._disableZoomPan1=false;this._disableZoomPan2=false}},synchronize:function(){this.defaultSynchronize()},showGlobalView:function(){var oRect1,oRect2,oRect;if(this.viewer1&&this.viewer2){oRect1=this.viewer1.getGlobalViewRect();oRect2=this.viewer2.getGlobalViewRect();if(oRect1){oRect=oRect1}if(oRect2){if(oRect){oRect.unionRect(oRect2)}else{oRect=oRect2}}if(oRect){this.viewer1.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height);if(!this._isSynchronized){this.viewer2.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height)}}}},bringSymbolsToView:function(oSymbol1,oSymbol2,bPreserveZoomScale,bCenterInView){var bInView1,bInView2,oRect1,oRect2,oRect,aDelta;if(this.viewer1&&this.viewer2){bInView1=(oSymbol1!==undefined)&&this.editor1.isSymbolInView(oSymbol1);bInView2=(oSymbol2!==undefined)&&this.editor2.isSymbolInView(oSymbol2);if((oSymbol1&&!oSymbol2&&bInView1)||(!oSymbol1&&oSymbol2&&bInView2)||(bInView1&&bInView2)){return}if(bPreserveZoomScale===undefined){bPreserveZoomScale=true}if(oSymbol1){oRect1=oSymbol1.getBBox()}if(oSymbol2){oRect2=oSymbol2.getBBox()}if(oRect1){oRect=oRect1}if(oRect2){if(oRect){oRect.unionRect(oRect2)}else{oRect=oRect2}}if(oRect1&&oRect2){aDelta=this.viewer1.pageDeltaToViewDelta([40,40]);oRect.inflate(aDelta[0],aDelta[1])}if(oRect){this.viewer1.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,bPreserveZoomScale,bCenterInView);if(!this._isSynchronized){this.viewer2.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,bPreserveZoomScale,bCenterInView)}}}}}});
(function(){sap.galilei.ui.editor.tracker.SymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.SymbolHighlighter",initialize:function(oParam){if(oParam.editor){this._editor=oParam.editor;delete oParam.editor}if(!this._editor){throw"Diagram editor must be specified."}this.set(oParam);if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}},fields:{_highlightShape:undefined},properties:{editor:{get:function(){return this._editor}},viewer:{get:function(){if(this._editor){return this._editor.viewer}return undefined}},highlighted:{get:function(){return this._highlighted}},strokeWidth:5,highlightColor:sap.galilei.ui.common.style.Color.orange,highlightDiagram:true,radius:1,isShowHighlight:true,transitionDefinition:undefined},methods:{defaultHighlight:function(x,y,oParams,fnSkipPickingByPoint,fnCanHighlight){var oSymbol,aSymbols;aSymbols=this.editor.getSymbolsByPoint(x,y,undefined,true,+this.radius,fnSkipPickingByPoint);if(aSymbols&&aSymbols.length>0){if(!fnCanHighlight||fnCanHighlight.call(this.editor,aSymbols[aSymbols.length-1])){oSymbol=aSymbols[aSymbols.length-1]}}if(this.highlightDiagram&&(!aSymbols||aSymbols.length===0)){if(!fnCanHighlight||fnCanHighlight.call(this.editor,this.editor.diagram)){this._highlighted=this.editor.diagram;if(this.isShowHighlight){this.hideSymbolHighlight()}return true}}else{if(oSymbol){this.onSymbolHighlight(x,y,oSymbol);if(this.isShowHighlight){this.showSymbolHighlight(oSymbol)}this._highlighted=oSymbol;return true}}this.dispose();return false},highlight:function(x,y,oParams,fnSkipPickingByPoint,fnCanHighlight){return this.defaultHighlight(x,y,oParams,fnSkipPickingByPoint,fnCanHighlight)},onSymbolHighlight:function(x,y,oSymbol){},defaultShowSymbolHighlight:function(oSymbol,oOptions){var oShape,oParam={};if(oSymbol&&(this._highlighted!==oSymbol||!this._highlightShape)){this.hideSymbolHighlight();if(!oSymbol.isLinkSymbol){oShape=oSymbol.getBoundaryShape()}else{oShape=oSymbol.getLinkShape()}if(oShape){oParam={fill:"none",stroke:this.highlightColor,strokeWidth:this.strokeWidth,isVisible:true,opacity:0.8,strokeDashArray:"",domClass:undefined};if(!oSymbol.isLinkSymbol){oParam.x=oSymbol.x;oParam.y=oSymbol.y}else{oParam.points=oShape.points.clone()}if(sap.galilei.core.isInstanceOf(oShape,"sap.galilei.ui.common.shape.Image")){oParam.width=oShape.width;oParam.height=oShape.height;this._highlightShape=new sap.galilei.ui.common.shape.Rectangle(oParam)}else{this._highlightShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(oShape);this._highlightShape.set(oParam)}this._highlightShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}}},showSymbolHighlight:function(oSymbol,oOptions){this.defaultShowSymbolHighlight(oSymbol,oOptions)},defaultHideSymbolHighlight:function(bUseTransition){var self=this;if(this._highlightShape&&this._highlightShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){this._highlightShape.hide(this.viewer,this.transitionDefinition);setTimeout(function(){self._highlightShape.dispose();self._highlightShape=undefined},this.transitionDefinition.duration)}else{this._highlightShape.dispose();this._highlightShape=undefined}}},hideSymbolHighlight:function(bUseTransition){this.defaultHideSymbolHighlight(bUseTransition)},defaultDispose:function(){this._highlighted=undefined;this.hideSymbolHighlight()},dispose:function(){this.defaultDispose()}}})}());
"use strict";sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter",parent:sap.galilei.ui.editor.tracker.SymbolHighlighter,fields:{_index:undefined,_highlighted:undefined},properties:{symbolIndex:{get:function(){return this._index}}},methods:{showSymbolHighlight:function(oSymbol,oOptions){var x,y,width,height,oRect=oOptions&&oOptions.rect,nIndex=oOptions&&oOptions.index;if(this.editor.isSwimlaneDetachable){return this.defaultShowSymbolHighlight(oSymbol,oOptions)}if(this._highlighted!==oSymbol||this._index!==nIndex){if(oOptions.isVertical){if(oOptions.minorSide){x=oOptions.insertAsChild?oRect.left:oRect.left-3;y=oRect.top}else{x=oOptions.insertAsChild?oRect.left:oRect.right-3;y=oRect.top}width=oOptions.insertAsChild?oRect.width:6;height=oRect.height}else{if(oOptions.minorSide){x=oRect.left;y=oOptions.insertAsChild?oRect.top:oRect.top-3}else{x=oRect.left;y=oOptions.insertAsChild?oRect.top:oRect.bottom-3}width=oRect.width;height=oOptions.insertAsChild?oRect.height:6}if(x!==undefined&&y!==undefined&&width!==undefined&&height!==undefined){this.hideSymbolHighlight();this._highlightShape=new sap.galilei.ui.common.shape.Rectangle();this._highlightShape.set({x:x,y:y,width:width,height:height,isVisible:true,stroke:oOptions.insertAsChild?this.highlightColor:"none",strokeWidth:oOptions.insertAsChild?6:0,fill:oOptions.insertAsChild?"none":this.highlightColor,opacity:0.8});this._highlightShape.draw(this._editor.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}}},highlight:function(x,y,oParams,fnSkipPickingByPoint,fnCanHighlight){var aSymbols,oSymbol,oHighlightedSymbol,oHeaderBBox,i,oBBox,oSubSymbol,aViewPoint,bInsertAsChild=false;if(this.editor.isSwimlaneDetachable){return this.defaultHighlight(x,y,oParams,fnSkipPickingByPoint,fnCanHighlight)}aSymbols=this.editor.getSymbolsByPoint(x,y,this._editor.viewer.mainShapeLayer.d3Layer,true,1,fnSkipPickingByPoint);aViewPoint=this.editor.viewer.clientPointToViewPoint([x,y]);x=aViewPoint[0];y=aViewPoint[1];if(aSymbols&&aSymbols.length>0){oSymbol=aSymbols[aSymbols.length-1]}if(!aSymbols||aSymbols.length===0){if(!fnCanHighlight||fnCanHighlight.call(this._editor,this._editor.diagram)){this._highlighted=this._editor.diagram;this.hideSymbolHighlight();return true}}else{if(oSymbol&&oSymbol.isSwimlaneSymbol){oHeaderBBox=oSymbol.getHeaderAreaBBox();if(oSymbol.symbols.length===0&&!oHeaderBBox.isPointInRect([x,y])&&(!fnCanHighlight||fnCanHighlight.call(this._editor,oSymbol))){bInsertAsChild=true;oHighlightedSymbol=oSymbol}else{if(oSymbol.parentSymbol&&oSymbol.parentSymbol.isSwimlaneSymbol&&(!fnCanHighlight||fnCanHighlight.call(this._editor,oSymbol.parentSymbol))){oHighlightedSymbol=oSymbol.parentSymbol}}if(oHighlightedSymbol&&oHighlightedSymbol.isSwimlaneSymbol){if(oHighlightedSymbol.symbols.length>0){for(i=0;i<oHighlightedSymbol.symbols.length;i++){oSubSymbol=oHighlightedSymbol.symbols.get(i);oBBox=oSubSymbol.getBBox();if(oSubSymbol.isVertical){if(x>oBBox.left&&x<=oBBox.right){if(x>(oBBox.left+oBBox.width/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:false,index:i+1});this._index=i+1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:true,index:i});this._index=i}}}else{if(y>oBBox.top&&y<=oBBox.bottom){if(y>(oBBox.top+oBBox.height/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:false,index:i+1});this._index=i+1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:true,index:i});this._index=i}}}}}else{oBBox=oHighlightedSymbol.getBBox();if(oHighlightedSymbol.isVertical){if(bInsertAsChild){oHeaderBBox=oHighlightedSymbol.getHeaderAreaBBox();oBBox.top+=oHeaderBBox.height;oBBox.height-=oHeaderBBox.height}if(x>(oBBox.left+oBBox.width/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:false,insertAsChild:bInsertAsChild,index:1});this._index=1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:true,insertAsChild:bInsertAsChild,index:0});this._index=0}}else{if(bInsertAsChild){oHeaderBBox=oHighlightedSymbol.getHeaderAreaBBox();oBBox.left+=oHeaderBBox.width;oBBox.width-=oHeaderBBox.width}if(y>(oBBox.top+oBBox.height/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:false,insertAsChild:bInsertAsChild,index:1});this._index=1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:true,insertAsChild:bInsertAsChild,index:0});this._index=0}}}this._highlighted=oHighlightedSymbol;return true}}}this.dispose();return false},dispose:function(){this._index=undefined;this.defaultDispose()}}});
(function(){sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter",parent:sap.galilei.ui.editor.tracker.SymbolHighlighter,fields:{_attachPoints:undefined,_isFixedPoints:false,_highlightedAttachPoint:undefined,_attachPointShapes:undefined,_highlightedAttachPointShape:undefined},properties:{isSource:false,isTarget:false,highlightedAttachPoint:{get:function(){return this._highlightedAttachPoint}},snapDistance:5,forceHighlightAttachPoints:false},methods:{onSymbolHighlight:function(x,y,oSymbol){var aViewPoint,oPoints,i,aPoint,aOldPoint,nDistance,nShortedDistance;if(oSymbol){aOldPoint=this._highlightedAttachPoint;this._highlightedAttachPoint=undefined;if(this.forceHighlightAttachPoints||oSymbol.hasLinkSymbol()){if(this._highlighted!==oSymbol){oPoints=oSymbol.getAttachPoints(this.isSource);if(oPoints){this._attachPoints=oPoints.points;this._isFixedPoints=oPoints.isFixedPoints}else{this._attachPoints=undefined;this._isFixedPoints=false}}if(this._attachPoints){aViewPoint=this.viewer.clientPointToViewPoint([x,y]);if(!this._isFixedPoints){for(i=0;i<this._attachPoints.length;i++){aPoint=this._attachPoints[i];if(Math.abs(aPoint[0]-aViewPoint[0])<=+this.snapDistance&&Math.abs(aPoint[1]-aViewPoint[1])<=+this.snapDistance){this._highlightedAttachPoint=aPoint;break}}}else{for(i=0;i<this._attachPoints.length;i++){aPoint=this._attachPoints[i];nDistance=sap.galilei.ui.common.Point.getDistance(aPoint,aViewPoint);if(i===0){nShortedDistance=sap.galilei.ui.common.Point.getDistance(aPoint,aViewPoint);this._highlightedAttachPoint=aPoint}else{if(nDistance<nShortedDistance){nShortedDistance=nDistance;this._highlightedAttachPoint=aPoint}}}}}}else{this._highlightedAttachPoint=oSymbol.getCenter()}if(!this._highlightedAttachPoint||(aOldPoint&&this._highlightedAttachPoint&&(aOldPoint[0]!==this._highlightedAttachPoint[0]||(aOldPoint[1]!==this._highlightedAttachPoint[1])))){this.hideHighlightedAttachPoint()}}},showSymbolHighlight:function(oSymbol,oOptions){var oShape,i,aAttachPoint,oAttachShape;if(oSymbol){if(this._highlighted!==oSymbol){this.hideSymbolHighlight();oShape=oSymbol.getBoundaryShape();if(oShape){this._highlightShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(oShape);this._highlightShape.set({x:oSymbol.x,y:oSymbol.y,stroke:this.highlightColor,strokeWidth:this.strokeWidth,isVisible:true,opacity:0.7,domClass:undefined});if(sap.galilei.core.isInstanceOf(this._highlightShape,"sap.galilei.ui.common.shape.Path")){this._highlightShape.isEnableTranslate=false}this._highlightShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition);if(this._attachPoints){this._attachPointShapes=[];for(i=0;i<this._attachPoints.length;i++){aAttachPoint=this._attachPoints[i];oAttachShape=new sap.galilei.ui.common.shape.Circle({domClass:"sapGalileiAttachPoint",cx:aAttachPoint[0],cy:aAttachPoint[1],r:3.5,stroke:"none",fill:"#A9A9A9"});oAttachShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition);this._attachPointShapes.push(oAttachShape)}}}}if(this._highlightedAttachPoint&&this._attachPointShapes&&this._attachPointShapes.length>0){if(!this._highlightedAttachPointShape){this._highlightedAttachPointShape=new sap.galilei.ui.common.shape.Circle({cx:this._highlightedAttachPoint[0],cy:this._highlightedAttachPoint[1],r:5+this.strokeWidth/2,stroke:this.highlightColor,strokeWidth:this.strokeWidth,fill:"none"});this._highlightedAttachPointShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}else{this._highlightedAttachPointShape.cx=this._highlightedAttachPoint[0];this._highlightedAttachPointShape.cy=this._highlightedAttachPoint[1];this._highlightedAttachPointShape.updateDrawing(this.viewer,this.transitionDefinition)}}}},hideSymbolHighlight:function(bUseTransition){var i,oAttachShape,self=this;function delayedDispose(oShape,duration){setTimeout(function(){oShape.dispose()},duration)}if(this._highlightShape&&this._highlightShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){this._highlightShape.hide(this.viewer,this.transitionDefinition);setTimeout(function(){self._highlightShape.dispose()},this.transitionDefinition.duration)}else{this._highlightShape.dispose();this._highlightShape=undefined}}if(this._attachPointShapes){for(i=0;i<this._attachPointShapes.length;i++){oAttachShape=this._attachPointShapes[i];if(oAttachShape&&oAttachShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){oAttachShape.hide(this.viewer,this.transitionDefinition);delayedDispose(oAttachShape,this.transitionDefinition.duration)}else{oAttachShape.dispose()}}}if(bUseTransition!==true){this._attachPointShapes=undefined}}this.hideHighlightedAttachPoint(bUseTransition)},hideHighlightedAttachPoint:function(bUseTransition){var self=this;if(this._highlightedAttachPointShape&&this._highlightedAttachPointShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){this._highlightedAttachPointShape.hide(this.viewer,this.transitionDefinition);setTimeout(function(){self._highlightedAttachPointShape.dispose()},this.transitionDefinition.duration)}else{this._highlightedAttachPointShape.dispose();this._highlightedAttachPointShape=undefined}}},dispose:function(){this._highlighted=undefined;this._attachPoints=undefined;this._isFixedPoints=false;this._highlightedAttachPoint=undefined;this.hideSymbolHighlight()}}})}());
(function(){sap.galilei.ui.editor.tracker.RectangularSymbolTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.RectangularSymbolTracker",trackerName:"RectangularSymbolTracker",parent:sap.galilei.ui.common.tracker.ResizeTracker,fields:{_parentHighlighter:undefined},properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},resource:{get:function(){return this.diagram.resource}},symbol:undefined,parentHighlighter:{field:"_parentHighlighter",get:function(){return this._parentHighlighter}}},methods:{onInitialize:function(){var oHighlighter;if(!this.editor){throw"The editor must be defined."}this.isReadOnly=this.editor.isReadOnly;this.snapToGrid=this.editor.snapToGrid;this.gridSize=this.editor.gridSize;this.snapToShapes=this.editor.snapToShapes;this.snapToShapesCenter=this.editor.snapToShapesCenter;this.snapToShapesBorder=this.editor.snapToShapesBorder;if(this.symbol){this.initialBBox=this.symbol.getBBox();this.mainShape=this.symbol.getOrCreateShape();oHighlighter=this.getOrCreateParentHighlighter();if(oHighlighter!==undefined&&oHighlighter.snapToShapes===false){this.snapToShapes=false}if(this.snapToShapes){this.snapToShapesHandler=new sap.galilei.ui.editor.tracker.SnapToSymbols({editor:this.editor,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),snapToShapesCenter:this.snapToShapesCenter,snapToShapesBorder:this.snapToShapesBorder})}}else{throw"The symbol must be defined."}},addEventHandlers:function(){this.defaultAddEventHandlers();sap.galilei.core.Event.subscribe("move.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("delete.symbol",this.onDeleteSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("symbol.unselected",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("symbols.selection.changed",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("move.symbol.dragstart",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("move.symbols.dragstart",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("move.symbols.before",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("move.symbols.after",this.onShowWidgets,this);sap.galilei.core.Event.subscribe("resize.symbol.handle.dragstart",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("resize.symbol.pinch",this.onHideWidgets,this);sap.galilei.core.Event.subscribe("viewer.zoompan.before",this.onBeforeZoomPan,this);sap.galilei.core.Event.subscribe("viewer.zoompan.after",this.onAfterZoomPan,this)},removeEventHandlers:function(){this.defaultRemoveEventHandlers();sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("symbol.unselected",this);sap.galilei.core.Event.unSubscribeScope("symbols.selection.changed",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.pinch",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.before",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.after",this)},onBeforeMoveResizeSymbol:function(oEvent){this.onHideWidgets(oEvent);if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){var oldTransition;this.resizedBBox=this.symbol.getBBox();this.movedBBox=this.resizedBBox.clone();this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone();if(oEvent.transitionDefinition){oldTransition=this.endTransitionDefinition;this.endTransitionDefinition=oEvent.transitionDefinition;this.updateHandles(true);this.endTransitionDefinition=oldTransition}else{this.updateHandles(true)}}},onAfterMoveResizeSymbol:function(oEvent){this.onShowWidgets(oEvent)},onDeleteSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.onBeforeMoveResizeSymbol(oEvent);this.dispose()}},onShowWidgets:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){sap.galilei.core.Event.publish("symbol.showwidgets",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onHideWidgets:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){sap.galilei.core.Event.publish("symbol.hidewidgets",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onBeforeZoomPan:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){sap.galilei.core.Event.publish("symbol.hidewidgets",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onAfterZoomPan:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){sap.galilei.core.Event.publish("symbol.showwidgets",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=this.editor.getParentHighlighter(this.symbol.classDefinition.qualifiedName)}return this._parentHighlighter},onDragStartHandle:function(oEvent,oHandle){if(this.snapToShapes&&this.snapToShapesHandler!==undefined){this.snapToShapesHandler.initializeSymbolSnapLines()}this.defaultOnDragStartHandle(oEvent,oHandle)},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&!this.isKeepSize){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentBBox=oResizedRect;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.handle.dragstart",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.handle.drag",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},onPinchStartShape:function(oEvent){if(this.snapToShapes&&this.snapToShapesHandler!==undefined){this.snapToShapesHandler.initializeSymbolSnapLines()}},defaultCanResizeShape:function(oEvent,oHandle){if(oEvent){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;this.editor.addEventProperties(oEvent,this.symbol);if(oHandle){oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.symbol.handle.dragend",this.editor,this.editor,oEvent)}else{oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.symbol.pinchend",this.editor,this.editor,oEvent)}return !oEvent.cancel}return false},canPinchShape:function(oEvent){if(oEvent){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.currentBBox=oResizedRect;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.pinch",this,undefined,oEvent);return !oEvent.cancel}return false},canDragStartShape:function(oEvent){if(oEvent&&!this.isKeepPosition){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentBBox=this.movedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},onDragStartShape:function(oEvent){if(this.snapToShapes&&this.snapToShapesHandler!==undefined){this.snapToShapesHandler.initializeSymbolSnapLines()}this.defaultOnDragStartShape(oEvent)},canDragShape:function(oEvent){if(oEvent&&this.isDraggingShape&&this.symbol&&!this.symbol.isKeepPosition){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],oBoundaryBBox;oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.drag",this,undefined,oEvent);if(!oEvent.cancel){if(this.symbol.isBoundarySymbol&&this.symbol.parentSymbol){oBoundaryBBox=this.symbol.parentSymbol.computeBoundarySymbolBBox(this.symbol,this.movedBBox);this.movedBBox.set(oBoundaryBBox)}}return !oEvent.cancel}return false},onDragShape:function(oEvent){var aClientPoint,aViewPoint,aDelta,self=this,oHighlighter;if(this.isDraggingShape&&!this.symbol.isKeepPosition){this.defaultOnDragShape(oEvent)}if(this.isDraggingShape&&!this.symbol.isKeepPosition&&!this.symbol.isBoundarySymbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY];oHighlighter=this.getOrCreateParentHighlighter();oHighlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tracker:this},function(oSymbol){var oParentSymbol=oSymbol;while(oParentSymbol){if(oParentSymbol===self.symbol){return true}oParentSymbol=oParentSymbol.parentSymbol}return false},function(oSymbol){return(!oSymbol.isLinkSymbol&&self.editor.canAttachSymbol(oSymbol,self.symbol,{point:aViewPoint,delta:aDelta})||(oSymbol.isLinkSymbol&&self.canInsertSymbol(oEvent,aViewPoint,oSymbol)))})}},canResizeShape:function(oEvent,oHandle){return this.defaultCanResizeShape(oEvent,oHandle)},defaultResizeShape:function(oEvent){var self=this,resizeEdgeType=sap.galilei.ui.symbol.EdgeType.NONE,oBBox=this.symbol.getBBox(),oPublishEvent={};this.resizedBBox=this.resizedBBox.normalize(true);if(oBBox.left!==this.resizedBBox.left){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT}if(oBBox.right!==this.resizedBBox.right){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT}if(oBBox.top!==this.resizedBBox.top){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP}if(oBBox.bottom!==this.resizedBBox.bottom){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM}this.editor.addEventProperties(oPublishEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.before",this,undefined,oPublishEvent);function resizeSymbolAction(){var oOldBBox=self.symbol.getBBox(),oLayouter=self.editor.getOrCreateSymbolLayouter(self.symbol),bUseLayouter;if(oLayouter&&oLayouter.beforeResizeSymbol){oLayouter.beforeResizeSymbol(self.symbol,self,oEvent,self.endTransitionDefinition)}bUseLayouter=(oLayouter&&oLayouter.postResizeSymbol!==undefined);self.symbol.setBBox(self.resizedBBox,{moveSubSymbols:false,moveLinkSymbols:false},self.viewer,bUseLayouter?undefined:self.endTransitionDefinition);self.symbol.extendToContent({extendParent:true,updateBoundarySymbols:false},resizeEdgeType,self.viewer,bUseLayouter?undefined:self.endTransitionDefinition);if(bUseLayouter){oLayouter.postResizeSymbol(self.symbol,self,oEvent,self.endTransitionDefinition);resizeEdgeType=sap.galilei.ui.symbol.EdgeType.ALL}if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},resizeEdgeType,self.viewer,self.endTransitionDefinition)}self.symbol.updateBoundarySymbols(oOldBBox,self.symbol.getBBox(),true,self.viewer,self.endTransitionDefinition);self.symbol.updateLinkSymbolRoutings(oOldBBox,self.symbol.getBBox(),true,false,self.viewer,self.endTransitionDefinition)}this.resource.applyUndoableAction(resizeSymbolAction,"Resize Symbol");self.resizedBBox=self.symbol.getBBox();self.initialBBox=self.resizedBBox.clone();self.movedBBox=self.resizedBBox.clone();self.updateHandles(true);setTimeout(function(){sap.galilei.core.Event.publish("resize.symbol.after",self,undefined,oPublishEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)},resizeShape:function(oEvent){this.defaultResizeShape(oEvent)},defaultCanMoveShape:function(oEvent){if(oEvent){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],oBoundaryBBox;oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.dragend",this,undefined,oEvent);if(!oEvent.cancel){if(this.symbol.isBoundarySymbol&&this.symbol.parentSymbol){oBoundaryBBox=this.symbol.parentSymbol.computeBoundarySymbolBBox(this.symbol,this.movedBBox);this.movedBBox.set(oBoundaryBBox)}}return !oEvent.cancel}return true},defaultMoveShape:function(oEvent){var self=this,aClientPoint,aViewPoint,oPublishEvent={},bUpdateOrder;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);this.editor.addEventProperties(oPublishEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.before",this,undefined,oPublishEvent);function moveSymbolAction(){var oSymbol=self.symbol,oOldSymbolOwner=oSymbol.container,oNewSymbolOwner,oLinkSymbol,oOldOwners={},oHighlighter=self._parentHighlighter,oLayouter=self.editor.getOrCreateSymbolLayouter(oSymbol),bUseLayouter,aMovedSymbols;oOldOwners[oSymbol.objectId]=oOldSymbolOwner;if(self._parentHighlighter){oNewSymbolOwner=self._parentHighlighter.highlighted}bUseLayouter=(oLayouter&&oLayouter.postMoveSymbol!==undefined);if(bUseLayouter&&!oLayouter.canChangeSymbolOwner(oSymbol,oOldSymbolOwner,oNewSymbolOwner)){if(self._parentHighlighter){self._parentHighlighter.dispose();self._parentHighlighter=undefined}return}if(oHighlighter&&oLayouter){oLayouter.oldIndex=oHighlighter.oldIndex;oLayouter.newIndex=oHighlighter.newIndex;oLayouter.object=oSymbol.object}if(oLayouter&&oLayouter.beforeMoveSymbol){oLayouter.beforeMoveSymbol(oSymbol,self,oEvent,self.endTransitionDefinition)}if(!oSymbol.isInternal){self.editor.moveSymbolsBy(oSymbol,self.movedBBox.x-oSymbol.x,self.movedBBox.y-oSymbol.y,self.viewer,bUseLayouter?undefined:self.endTransitionDefinition)}if(oNewSymbolOwner){if(oNewSymbolOwner.isLinkSymbol){oLinkSymbol=oNewSymbolOwner;oNewSymbolOwner=oLinkSymbol.container;if(oNewSymbolOwner.isDiagram){oNewSymbolOwner=undefined}if(oLinkSymbol){if(self.canInsertSymbol({},aViewPoint,oLinkSymbol)){self.insertSymbolOnLinkSymbol(oLinkSymbol,aViewPoint[0],aViewPoint[1])}}}if(oNewSymbolOwner&&oOldSymbolOwner!==oNewSymbolOwner){self._parentHighlighter=undefined;if(!oSymbol.isInternal&&!oOldSymbolOwner.isInternal&&!oNewSymbolOwner.isInternal){bUpdateOrder=self.editor.changeSymbolOwner(oSymbol,oNewSymbolOwner)}self._parentHighlighter=oHighlighter}}if(bUseLayouter){aMovedSymbols=oLayouter.postMoveSymbol(oSymbol,self,oEvent,self.endTransitionDefinition);if(!aMovedSymbols||aMovedSymbols.length===0){if(!oSymbol.isInternal){oSymbol.drawSymbol(self.viewer,self.endTransitionDefinition)}}}if(!oSymbol.isInternal&&oSymbol.parentSymbol&&oSymbol.parentSymbol.extendToContent){oSymbol.parentSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}self.editor.postMoveSymbols([oSymbol],oOldOwners);if(self._parentHighlighter){self._parentHighlighter.dispose();self._parentHighlighter=undefined}}this.resource.applyUndoableAction(moveSymbolAction,"Move Symbol");self.movedBBox=self.symbol.getBBox();self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}if(self.symbol.isAlive&&!self.symbol.isInternal){setTimeout(function(){sap.galilei.core.Event.publish("move.symbol.after",self,undefined,oPublishEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)}},moveShape:function(oEvent){this.defaultMoveShape(oEvent)},canInsertSymbol:function(oEvent,aPoint,oLinkSymbol){var oParam,sSymbolClass=this.symbolClass||(this.symbol&&this.symbol.classDefinition.qualifiedName);oParam={point:aPoint,linkSymbol:oLinkSymbol,symbol:this.symbol};return this.editor.canInsertSymbolOnLinkSymbol(sSymbolClass,oParam)},insertSymbolOnLinkSymbol:function(oLinkSymbol,x,y){var self=this,oNodeSymbol,oEditorExt,oSourceSymbol,oTargetSymbol,oLinkSymbol2;function insertSymbolAction(){oNodeSymbol=self.symbol;if(oNodeSymbol){oSourceSymbol=oLinkSymbol.sourceSymbol;oTargetSymbol=oLinkSymbol.targetSymbol;oEditorExt=self.editor.extension;if(oLinkSymbol.object){oLinkSymbol.object[self.editor.getLinkObjectTargetReferenceName(oLinkSymbol.object.classDefinition.qualifiedName)]=oNodeSymbol.object}oLinkSymbol.targetSymbol=oNodeSymbol;oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(false);oLinkSymbol2=self.editor.createLinkSymbolAndObject(oNodeSymbol,oTargetSymbol,oLinkSymbol.classDefinition.qualifiedName,undefined,oLinkSymbol.getOwner(),undefined,self.editor.cloneLinkObjectParams(oLinkSymbol.object),oLinkSymbol.object?oLinkSymbol.object.container:undefined);if(oLinkSymbol2){oLinkSymbol2.isAutomaticRouting=true;oLinkSymbol2.updateLinkRouting(false);oNodeSymbol.drawSymbol(self.viewer);oLinkSymbol.drawSymbol(self.viewer,self.transitionDefinition);oLinkSymbol2.drawSymbol(self.viewer,self.transitionDefinition)}}}if(oLinkSymbol){this.resource.applyUndoableAction(insertSymbolAction,"Insert Symbol")}return oNodeSymbol},onShapeTap:function(oEvent){if(oEvent){sap.galilei.core.Event.publish("symbol.tap",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onShapeDoubleTap:function(oEvent){if(oEvent){sap.galilei.core.Event.publish("symbol.doubletap",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onShapeContextMenu:function(oEvent){if(oEvent){this.editor.hideContextButtonPad(this.symbol);sap.galilei.core.Event.publish("symbol.contextmenu",this,undefined,this.editor.addEventProperties(oEvent,this.symbol));console.log("contextmenu symbol")}},onShapeHold:function(oEvent){if(oEvent){this.editor.hideContextButtonPad(this.symbol);sap.galilei.core.Event.publish("symbol.hold",this,undefined,this.editor.addEventProperties(oEvent,this.symbol));if(this.symbol&&!this.symbol.triggerEvent(sap.galilei.ui.common.DOMEvents.contextmenu,oEvent)){sap.galilei.core.Event.publish("symbol.contextmenu",this,undefined,this.editor.addEventProperties(oEvent,this.symbol));console.log("contextmenu symbol (hold)")}}},cancel:function(){this.defaultCancel();if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}},dispose:function(){this.onHideWidgets({sourceSymbol:this.symbol});this.defaultDispose();if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}if(this.symbol){delete this.symbol._tracker}}}})}());
"use strict";sap.galilei.ui.editor.tracker.SwimlaneSymbolTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.SwimlaneSymbolTracker",trackerName:"SwimlaneSymbolTracker",parent:sap.galilei.ui.editor.tracker.RectangularSymbolTracker,methods:{onDragEndHandle:function(oEvent,oHandle){var self=this,nHandleEdgeType=sap.galilei.ui.symbol.EdgeType.NONE,sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,oRootSymbol,oOldRootSymbolBBox,nOffset,aSwimlanes,oSymbol,oChildSymbol,oSubBBox,oContentBBox,nAvailable,j;function resizeSwimlaneAction(){var oResizedBBox=self.resizedBBox.clone(),sEdges;if(self.symbol.isVertical){if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.LEFT)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis;self.setSwimlaneSize(self.symbol,sLayoutDirection,oResizedBBox.left-self.symbol.x,oResizedBBox.width-self.symbol.width,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.axis;self.setSwimlaneSize(self.symbol,sLayoutDirection,0,oResizedBBox.width-self.symbol.width,self.viewer,self.endTransitionDefinition)}}if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.LEFT)!==0||(nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0){sEdges=sap.galilei.ui.symbol.EdgeType.TOP|sap.galilei.ui.symbol.EdgeType.BOTTOM;if(!self.symbol.isRootSwimlaneSymbol){self.symbol.extendToContent({extendParent:true,updateLinkSymbols:true},sEdges,self.viewer,self.endTransitionDefinition)}}oRootSymbol=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);oOldRootSymbolBBox=oRootSymbol.getBBox();if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.TOP)!==0){nOffset=oResizedBBox.top-self.symbol.y;if(nOffset>0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.top-oContentBBox.top;if(nAvailable<nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,nOffset,-nOffset,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0){nOffset=oResizedBBox.bottom-(self.symbol.y+self.symbol.height);if(nOffset<0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.bottom-oContentBBox.bottom;if(nAvailable>nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,0,nOffset,self.viewer,self.endTransitionDefinition)}}if(self.symbol.isRootSwimlaneSymbol&&self.symbol.symbols.length===1){oRootSymbol.layoutSwimlanes(sLayoutDirection);oChildSymbol=self.symbol.symbols.get(0);oChildSymbol.extendToContent({extendParent:true,updateLinkSymbols:true},sEdges,self.viewer,self.endTransitionDefinition)}else{oRootSymbol.layoutSwimlanes(sLayoutDirection,self.viewer,self.endTransitionDefinition)}}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.TOP)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis;self.setSwimlaneSize(self.symbol,sLayoutDirection,oResizedBBox.top-self.symbol.y,oResizedBBox.height-self.symbol.height,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.axis;self.setSwimlaneSize(self.symbol,sLayoutDirection,0,oResizedBBox.height-self.symbol.height,self.viewer,self.endTransitionDefinition)}}if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.TOP)!==0||(nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0){sEdges=sap.galilei.ui.symbol.EdgeType.LEFT|sap.galilei.ui.symbol.EdgeType.RIGHT;if(!self.symbol.isRootSwimlaneSymbol){self.symbol.extendToContent({extendParent:true,updateLinkSymbols:true},sEdges,self.viewer,self.endTransitionDefinition)}}oRootSymbol=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);oOldRootSymbolBBox=oRootSymbol.getBBox();if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.LEFT)!==0){nOffset=oResizedBBox.left-self.symbol.x;if(nOffset>0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.left-oContentBBox.left;if(nAvailable<nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,nOffset,-nOffset,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0){nOffset=oResizedBBox.right-(self.symbol.x+self.symbol.width);if(nOffset<0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.right-oContentBBox.right;if(nAvailable>nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,0,nOffset,self.viewer,self.endTransitionDefinition)}}if(self.symbol.isRootSwimlaneSymbol&&self.symbol.symbols.length===1){oRootSymbol.layoutSwimlanes(sLayoutDirection);oChildSymbol=self.symbol.symbols.get(0);oChildSymbol.extendToContent({extendParent:true,updateLinkSymbols:true},sEdges,self.viewer,self.endTransitionDefinition)}else{oRootSymbol.layoutSwimlanes(sLayoutDirection,self.viewer,self.endTransitionDefinition)}}if(oOldRootSymbolBBox){oRootSymbol.updateLinkSymbolRoutings(oOldRootSymbolBBox,oRootSymbol.getBBox(),true,false,self.viewer,self.endTransitionDefinition)}}if(oEvent&&oHandle&&self.isDraggingHandle){this.isDraggingHandle=false;this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canResizeShape(oEvent,oHandle)){if(this.symbol.isSwimlaneSymbol){switch(oEvent.handlePosition){case sap.galilei.ui.common.DockPosition.top:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP;break;case sap.galilei.ui.common.DockPosition.topLeft:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT;break;case sap.galilei.ui.common.DockPosition.topRight:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT;break;case sap.galilei.ui.common.DockPosition.left:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT;break;case sap.galilei.ui.common.DockPosition.right:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT;break;case sap.galilei.ui.common.DockPosition.bottom:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM;break;case sap.galilei.ui.common.DockPosition.bottomLeft:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM;break;case sap.galilei.ui.common.DockPosition.bottomRight:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT;break}this.resource.applyUndoableAction(resizeSwimlaneAction,"Resize Swimlane");this.resizedBBox=this.symbol.getBBox();this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone();this.updateHandles(true)}else{this.resizeShape()}}else{this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},setSwimlaneSize:function(oSymbol,sLayoutDirection,nOffset,nDeltaSize,oViewer,oTransitionDef){var oSubSymbol;if(!sLayoutDirection){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT}if(oSymbol&&oSymbol.isSwimlaneSymbol){if(oSymbol.isVertical){oSymbol.moveBy(nOffset,0,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width+nDeltaSize,oSymbol.height,{updateLinkSymbols:true},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){oSubSymbol=oSymbol.symbols.get((sLayoutDirection===sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis)?0:oSymbol.symbols.length-1);this.setSwimlaneSize(oSubSymbol,sLayoutDirection,nOffset,nDeltaSize,oViewer,oTransitionDef)}oSymbol.extendToContent({extendParent:false,updateLinkSymbols:true},sap.galilei.ui.symbol.EdgeType.LEFT|sap.galilei.ui.symbol.EdgeType.RIGHT,oViewer,oTransitionDef)}else{oSymbol.moveBy(0,nOffset,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width,oSymbol.height+nDeltaSize,{updateLinkSymbols:true},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){oSubSymbol=oSymbol.symbols.get((sLayoutDirection===sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis)?0:oSymbol.symbols.length-1);this.setSwimlaneSize(oSubSymbol,sLayoutDirection,nOffset,nDeltaSize,oViewer,oTransitionDef)}oSymbol.extendToContent({extendParent:false,updateLinkSymbols:true},sap.galilei.ui.symbol.EdgeType.TOP|sap.galilei.ui.symbol.EdgeType.BOTTOM,oViewer,oTransitionDef)}}},setSwimlaneLength:function(oSymbol,nOffset,nDeltaLength,oViewer,oTransitionDef){var oSubSymbol,i;if(oSymbol&&oSymbol.isSwimlaneSymbol){if(oSymbol.isVertical){oSymbol.moveBy(0,nOffset,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width,oSymbol.height+nDeltaLength,{updateLinkSymbols:true},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){for(i=0;i<oSymbol.symbols.length;i++){oSubSymbol=oSymbol.symbols.get(i);this.setSwimlaneLength(oSubSymbol,nOffset,nDeltaLength,oViewer,oTransitionDef)}}}else{oSymbol.moveBy(nOffset,0,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width+nDeltaLength,oSymbol.height,{updateLinkSymbols:true},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){for(i=0;i<oSymbol.symbols.length;i++){oSubSymbol=oSymbol.symbols.get(i);this.setSwimlaneLength(oSubSymbol,nOffset,nDeltaLength,oViewer,oTransitionDef)}}}}},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter({editor:this.editor})}return this._parentHighlighter},onDragShape:function(oEvent){var aClientPoint,aViewPoint,oThis=this,highlighter;this.defaultOnDragShape(oEvent);if(this.isDraggingShape){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tracker:this},function(oSymbol){var oParentSymbol=oSymbol;if(oSymbol.isLinkSymbol){return true}while(oParentSymbol){if(oParentSymbol===oThis.symbol){return true}oParentSymbol=oParentSymbol.parentSymbol}return false},function(oSymbol){return oThis.editor.canAttachSymbol(oSymbol,oThis.symbol,{point:aViewPoint})})}},canMoveShape:function(oEvent){if(!this.defaultCanMoveShape(oEvent)){return false}if(this._parentHighlighter&&!this._parentHighlighter.highlighted){if(this.symbol.isSwimlaneSymbol&&!this.symbol.isRootSwimlaneSymbol){return true}oEvent.cancel=true;return false}return true},moveShape:function(oEvent){var self=this,oNewParent,oOldParent,nNewIndex,nOldIndex,oRootSwimlane,oOldRootSwimlane,oHighlighted,bUpdateOrder;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.before",this.editor,this.editor,oEvent);function moveSymbolAction(){var oBBox,oOldOwner=self.symbol.getOwner(),oOldOwners={};oOldOwners[self.symbol.objectId]=oOldOwner;if(self._parentHighlighter){oHighlighted=self._parentHighlighter.highlighted;if(oHighlighted&&oHighlighted.isSwimlaneSymbol){oNewParent=oHighlighted;nNewIndex=self._parentHighlighter.symbolIndex;oOldParent=self.symbol.parentSymbol;if(oOldParent){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);nOldIndex=oOldParent.symbols.indexOf(self.symbol);if(oOldParent&&oNewParent===oOldParent&&nNewIndex>nOldIndex){nNewIndex--}oOldParent.symbols.removeAt(nOldIndex)}else{nOldIndex=self.symbol.diagram.symbols.indexOf(self.symbol);self.symbol.diagram.symbols.removeAt(nOldIndex)}if(oNewParent.symbols.length===0){oNewParent.symbols.push(self.symbol)}else{oNewParent.symbols.insert(nNewIndex,self.symbol)}oBBox=oNewParent.getContentAreaBBox();self.symbol.moveTo(oNewParent.isVertical?self.movedBBox.x:oBBox.x,oNewParent.isVertical?oBBox.y:self.movedBBox.y,undefined,self.viewer,self.endTransitionDefinition);if(oOldOwner!==oHighlighted){bUpdateOrder=true}if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}}else{if(oHighlighted&&sap.galilei.model.isInstanceOf(oHighlighted,"sap.galilei.ui.diagram.Diagram")){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);self.symbol.owner=oHighlighted;oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);self.editor.moveSymbolsBy(self.symbol,self.movedBBox.x-self.symbol.x,self.movedBBox.y-self.symbol.y,self.viewer,self.endTransitionDefinition);if(oOldOwner!==oHighlighted){bUpdateOrder=true}if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}}else{if(!self.symbol.isRootSwimlaneSymbol||!oHighlighted){oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);self.editor.moveSymbolsBy(oRootSwimlane,self.movedBBox.x-self.symbol.x,self.movedBBox.y-self.symbol.y,self.viewer,self.endTransitionDefinition)}}}if(oOldRootSwimlane&&oOldRootSwimlane!==oRootSwimlane){oOldRootSwimlane.layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.endTransitionDefinition)}self._parentHighlighter.dispose();self._parentHighlighter=undefined;self.editor.postMoveSymbols([self.symbol],oOldOwners)}}this.resource.applyUndoableAction(moveSymbolAction,"Move Symbol");self.movedBBox=self.symbol.getBBox();self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}setTimeout(function(){sap.galilei.core.Event.publish("move.symbol.after",self.editor,self.editor,oEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)}}});
(function(){sap.galilei.ui.editor.tracker.MultiSelectionTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.MultiSelectionTracker",trackerName:"MultiSelectionTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},resource:{get:function(){return this.diagram.resource}},snapToGrid:false,gridSize:sap.galilei.ui.common.svg.Viewer.GRID_SIZE,snapToShapes:true,snapToShapesCenter:true,snapToShapesBorder:true,isReadOnly:false,frameShape:undefined,frameBBox:undefined,selectionShape:undefined,selectionBBox:{get:function(){var oRect,oSelectionBBox,index,oSymbol;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];oRect=oSymbol.getBBox();if(index===0){oSelectionBBox=oRect}else{oSelectionBBox.unionRect(oRect)}}return oSelectionBBox}},selectedSymbols:{get:function(){return this.editor.selectedSymbols}},initialBBox:undefined,movedBBox:undefined,isDraggingSymbols:false,snapToShapesHandler:undefined},methods:{onInitialize:function(){var oSelectionBBox=this.selectionBBox,oHighlighter;if(!this.editor){throw"The editor must be defined."}this.isReadOnly=this.editor.isReadOnly;this.snapToGrid=this.editor.snapToGrid;this.gridSize=this.editor.gridSize;this.snapToShapes=this.editor.snapToShapes;this.snapToShapesCenter=this.editor.snapToShapesCenter;this.snapToShapesBorder=this.editor.snapToShapesBorder;if(oSelectionBBox){this.initialBBox=oSelectionBBox.clone()}else{this.initialBBox=new sap.galilei.ui.common.Rect()}this.movedBBox=this.initialBBox.clone();oHighlighter=this.getOrCreateParentHighlighter();if(oHighlighter!==undefined&&oHighlighter.snapToShapes===false){this.snapToShapes=false}if(this.snapToShapes){this.snapToShapesHandler=new sap.galilei.ui.editor.tracker.SnapToSymbols({editor:this.editor,transitionDefinition:this.transitionDefinition,snapToShapesCenter:this.snapToShapesCenter,snapToShapesBorder:this.snapToShapesBorder})}},onPointerDownDiagramBackground:function(oEvent){console.log("pointerdown multi-select");oEvent.preventDefault();oEvent.stopPropagation()},onPointerUpDiagramBackground:function(oEvent){console.log("pointerup multi-select")},onDragStartDiagramBackground:function(oEvent){this.viewer.normalizePointerEvent(oEvent);var aStartPt=[oEvent.startClientViewX,oEvent.startClientViewY];this.frameBBox=new sap.galilei.ui.common.Rect(aStartPt[0],aStartPt[1],1,1);if(!this.frameShape){this.frameShape=new sap.galilei.ui.common.shape.Rectangle({domClass:"sapGalileiLassoFrame",x:aStartPt[0],y:aStartPt[1],width:1,height:1,fill:"#C9E0ED",stroke:"#6EB1FA",fillOpacity:"0.4"});this.frameShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}},onDragDiagramBackground:function(oEvent){var aEndPt=this.viewer.normalizePointerEvent(oEvent);this.frameBBox.width=aEndPt[0]-this.frameBBox.x;this.frameBBox.height=aEndPt[1]-this.frameBBox.y;this.frameShape.setBBox(this.frameBBox.normalize(true));this.frameShape.updateDrawing(this.viewer);if(this.diagram){this.updateSymbolSelection(this.frameBBox.normalize(true),this.diagram.symbols)}},onDragEndDiagramBackground:function(oEvent){if(this.frameShape){this.frameShape.dispose();this.frameShape=undefined}if(this.selectedSymbols.length>1){this.getOrCreateSelectionFrame()}else{if(this.selectedSymbols.length===1){var oSymbol=this.selectedSymbols[0];this.unselectSymbol(oSymbol);this.editor.selectSymbol(oSymbol,true,this.transitionDefinition)}}},getOrCreateSelectionFrame:function(){if(!this.selectionShape){var oRect=this.selectionBBox;oRect.inflate(2,2);this.selectionShape=new sap.galilei.ui.common.shape.Rectangle({domClass:"sapGalileiSelectionFrame",x:oRect.x,y:oRect.y,width:oRect.width,height:oRect.height,fill:"none",stroke:sap.galilei.ui.common.style.Color.orange,strokeWidth:2,strokeDashArray:"3,3"});this.selectionShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}return this.selectionShape},updateSelectionFrame:function(){var oShape=this.getOrCreateSelectionFrame(),oRect=this.selectionBBox;oRect.inflate(2,2);if(oShape){oShape.setBBox(oRect);oShape.updateDrawing(this.viewer,this.transitionDefinition)}},addEventHandlers:function(){sap.galilei.core.Event.subscribe("move.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onAfterMoveResizeSymbol,this)},removeEventHandlers:function(oSymbol){sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this)},onBeforeMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&this.selectedSymbols.contains(oEvent.sourceSymbol)){var oldTransition;this.movedBBox=this.selectionBBox;this.resizedBBox=this.movedBBox.clone();this.initialBBox=this.movedBBox.clone();if(oEvent.transitionDefinition){oldTransition=this.transitionDefinition;this.transitionDefinition=oEvent.transitionDefinition;this.updateHandles(true);this.transitionDefinition=oldTransition}else{this.updateHandles(true)}}},onAfterMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&this.selectedSymbols.contains(oEvent.sourceSymbol)){}},updateSymbolSelection:function(oRect,oSymbols){var index,oSymbol;if(this.editor.enableSelectSymbol&&oRect&&oSymbols){for(index=0;index<oSymbols.length;++index){oSymbol=oSymbols.get(index);if(!oSymbol.isHidden){if(oRect.isRectInRect(oSymbol.getBBox())){this.selectSymbol(oSymbol)}else{this.unselectSymbol(oSymbol)}if(oSymbol.isComposite){this.updateSymbolSelection(oRect,oSymbol.symbols)}}}}},selectSymbol:function(oSymbol){if(this.editor.enableSelectSymbol&&oSymbol){if(!this.selectedSymbols.contains(oSymbol)){oSymbol.isSelected=true;this.selectedSymbols.add(oSymbol);this.showSelection(oSymbol)}}},unselectSymbol:function(oSymbol){if(this.editor.enableSelectSymbol&&oSymbol){if(this.selectedSymbols.contains(oSymbol)){oSymbol.isSelected=false;this.selectedSymbols.remove(oSymbol);this.hideSelection(oSymbol)}}},unselectAllSymbols:function(){if(this.editor.enableSelectSymbol){this.hideAllSelection();var index;for(index=this.selectedSymbols.length-1;index>=0;index--){this.selectedSymbols[index].isSelected=false}this.selectedSymbols.clear()}},showSelection:function(oSymbol){if(oSymbol){var oShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oLinkShape=oSymbol.isLinkSymbol?oSymbol.getLinkShape():undefined;if(oShape){if(oShape.filter){oShape._oldFilter=oShape.filter}oShape.filter="url(#filterSelectionGlow)";oShape.updateDrawing(this.viewer,this.transitionDefinition,["filter"]);if(oLinkShape){oShape=oLinkShape}if(oShape.strokeWidth===undefined&&oShape.stroke!=="none"){oShape.strokeWidth=1}if(oShape.strokeWidth!==undefined){oShape.strokeWidth+=2}oShape.updateDrawing(this.viewer,this.transitionDefinition,["strokeWidth"])}}},hideSelection:function(oSymbol){if(oSymbol){var oShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oLinkShape=oSymbol.isLinkSymbol?oSymbol.getLinkShape():undefined;if(oShape){if(oShape.filter){oShape.filter=oShape._oldFilter;delete oShape._oldFilter}else{oShape.filter=null}oShape.updateDrawing(this.viewer,this.transitionDefinition,["filter"]);if(oLinkShape){oShape=oLinkShape}if(oShape.strokeWidth!==undefined){oShape.strokeWidth-=2}oShape.updateDrawing(this.viewer,this.transitionDefinition,["strokeWidth"])}}},showAllSelection:function(){var index,oSymbol;for(index=this.selectedSymbols.length-1;index>=0;index--){oSymbol=this.selectedSymbols[index];if(oSymbol._tracker){oSymbol._tracker.dispose();oSymbol._tracker=undefined}this.showSelection(oSymbol)}this.updateSelectionFrame()},hideAllSelection:function(){var index;for(index=this.selectedSymbols.length-1;index>=0;index--){this.hideSelection(this.selectedSymbols[index])}if(this.selectionShape){this.selectionShape.dispose();this.selectionShape=undefined}if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}},updateHandles:function(bUseAnimation){var oMovedRect=this.movedBBox.clone();if(this.snapToGrid){oMovedRect.snapToGrid(this.gridSize)}if(this.cloneMainShape){this.cloneMainShape.x=oMovedRect.x;this.cloneMainShape.y=oMovedRect.y;this.cloneMainShape.updateDrawing(this.viewer,bUseAnimation?this.transitionDefinition:undefined)}if(this.selectionShape){oMovedRect.inflate(2,2);this.selectionShape.setBBox(oMovedRect);this.selectionShape.updateDrawing(this.viewer,bUseAnimation?this.transitionDefinition:undefined)}},canDragStartSymbols:function(oEvent){var index,oSymbol;if(oEvent&&!this.isReadOnly){for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols.get(index);if(oSymbol.isKeepPosition){return false}}this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartSymbols:function(oEvent){if(oEvent&&!this.isReadOnly){if(this.canDragStartSymbols(oEvent)){this.isDraggingSymbols=true;var index,oSymbol,oShape;this.initialBBox=this.selectionBBox.clone();this.movedBBox=this.selectionBBox.clone();if(!this.cloneMainShape){this.cloneMainShape=new sap.galilei.ui.common.shape.Group();this.cloneMainShape.isEnableTransform=true;this.cloneMainShape.x=this.initialBBox.x;this.cloneMainShape.y=this.initialBBox.y;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];oShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(oSymbol.getOrCreateShape());oShape.x=oSymbol.x-this.initialBBox.x;oShape.y=oSymbol.y-this.initialBBox.y;oShape.filter=undefined;oShape.opacity=0.6;oShape.transform=undefined;if(sap.galilei.core.isInstanceOf(oShape,"sap.galilei.ui.common.shape.Group")){oShape.isEnableTransform=true;oShape.width=undefined;oShape.height=undefined}this.cloneMainShape.shapes.add(oShape)}this.cloneMainShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}if(this.snapToShapesHandler){this.snapToShapesHandler.initializeSymbolSnapLines()}}}},onDragStartSymbols:function(oEvent){this.defaultOnDragStartSymbols(oEvent)},canDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.drag",this,undefined,oEvent);return !oEvent.cancel}return false},getOrCreateParentHighlighter:function(){var index,oSymbol,oSymbolClass,bSameClass=true;if(!this._parentHighlighter){if(this.selectedSymbols.length>0){for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];if(index===0){oSymbolClass=oSymbol.classDefinition}else{if(oSymbol.classDefinition!==oSymbolClass){bSameClass=false;break}}}}this._parentHighlighter=this.editor.getParentHighlighter(bSameClass&&oSymbolClass&&oSymbolClass.qualifiedName)}return this._parentHighlighter},defaultOnDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],oOldBBox=this.movedBBox.clone(),aClientPoint,highlighter,self=this,aSelected=[],j,oSymbol;this.movedBBox.x=this.initialBBox.x+aDelta[0];this.movedBBox.y=this.initialBBox.y+aDelta[1];if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.movedBBox,true)}if(this.snapToGrid){this.movedBBox.snapToGrid(this.gridSize)}if(this.canDragSymbols(oEvent)){this.updateHandles();aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);if(this.selectedSymbols){for(j=0;j<this.selectedSymbols.length;j++){oSymbol=this.selectedSymbols[j];if(!oSymbol.parentSymbol||!this.isParentSymbolSelected(oSymbol.parentSymbol)){aSelected.push(oSymbol)}}}highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tracker:this},function(oSymbol){var oParentSymbol,oSelfSymbol,i;for(i=0;i<aSelected.length;i++){oParentSymbol=oSymbol;oSelfSymbol=aSelected[i];while(oParentSymbol){if(oParentSymbol===oSelfSymbol){return true}oParentSymbol=oParentSymbol.parentSymbol}}return false},function(oSymbol){var oSelfSymbol,i;for(i=0;i<aSelected.length;i++){oSelfSymbol=aSelected[i];if(!self.editor.canAttachSymbol(oSymbol,oSelfSymbol,{point:aClientPoint,delta:aDelta})){return false}}return true})}else{this.movedBBox=oOldBBox}}},onDragSymbols:function(oEvent){this.defaultOnDragSymbols(oEvent)},canMoveSymbols:function(oEvent){if(oEvent){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],index,oSymbol;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols.get(index);if(oSymbol.isKeepPosition){return false}}oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.dragend",this,undefined,oEvent);return !oEvent.cancel}return false},isParentSymbolSelected:function(oParentSymbol){return this.editor.isParentSymbolSelected(oParentSymbol)},defaultMoveSymbols:function(oEvent){var self=this,index,oSymbol,oSelectedSymbols=[],oPublishEvent={},bUpdateOrder=false;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols.get(index);if(oSymbol.isKeepPosition){return false}}oPublishEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("move.symbols.before",this,undefined,oPublishEvent);function moveSymbolsAction(){var oParentSymbols={},sParent,oOldOwner,oNewOwner,oOldOwners={},oSelectedNonInternalSymbols=[],oHighlighter=self._parentHighlighter,oLayouter,bUseLayouter,oCurrentLayouter,aLayoutSymbols=[],aUpdatedSymbols;for(index=0;index<self.selectedSymbols.length;index++){oSymbol=self.selectedSymbols[index];oOldOwner=oSymbol.container;oOldOwners[oSymbol.objectId]=oOldOwner;if(oSymbol.parentSymbol&&self.isParentSymbolSelected(oSymbol.parentSymbol)){continue}oSelectedSymbols.push(oSymbol);if(!oSymbol.isInternal){oSelectedNonInternalSymbols.push(oSymbol)}}oPublishEvent.selectedSymbols=oSelectedNonInternalSymbols;for(index=0;index<oSelectedSymbols.length;index++){oSymbol=oSelectedSymbols[index];oLayouter=self.editor.getOrCreateSymbolLayouter(oSymbol);if(oLayouter){if(!oCurrentLayouter){oCurrentLayouter=oLayouter}else{if(oLayouter.__fullClassName!==oCurrentLayouter.__fullClassName){continue}}aLayoutSymbols.push(oSymbol)}}if(oHighlighter&&oLayouter){oLayouter.oldIndex=oHighlighter.oldIndex;oLayouter.newIndex=oHighlighter.newIndex}bUseLayouter=(oLayouter&&oLayouter.postMoveSymbols!==undefined);if(oCurrentLayouter&&oCurrentLayouter.beforeMoveSymbols){oLayouter.beforeMoveSymbols(aLayoutSymbols,self,oEvent,self.endTransitionDefinition)}oNewOwner=oHighlighter&&oHighlighter.highlighted;for(index=0;index<oSelectedSymbols.length;index++){oSymbol=oSelectedSymbols[index];if(!oSymbol.isInternal){if(oNewOwner){self._parentHighlighter=undefined;bUpdateOrder|=self.editor.changeSymbolOwner(oSymbol,oNewOwner);self._parentHighlighter=oHighlighter}if(oSymbol.parentSymbol&&!oParentSymbols[oSymbol.parentSymbol.objectId]){oParentSymbols[oSymbol.parentSymbol.objectId]=oSymbol.parentSymbol}}}self.editor.moveSymbolsBy(oSelectedNonInternalSymbols,self.movedBBox.x-self.initialBBox.x,self.movedBBox.y-self.initialBBox.y,bUseLayouter?undefined:self.viewer,bUseLayouter?undefined:self.endTransitionDefinition);if(bUseLayouter){oLayouter.isDisableDraw=true;aUpdatedSymbols=oLayouter.postMoveSymbols(aLayoutSymbols,self,oEvent);oLayouter.isDisableDraw=false;oLayouter.drawSymbols(aUpdatedSymbols,self.endTransitionDefinition)}for(sParent in oParentSymbols){if(oParentSymbols[sParent].extendToContent){oParentSymbols[sParent].extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}}self.editor.postMoveSymbols(self.selectedSymbols,oOldOwners);if(self._parentHighlighter){self._parentHighlighter.dispose();self._parentHighlighter=undefined}if(oLayouter&&aUpdatedSymbols&&aUpdatedSymbols.length>0&&self.endTransitionDefinition){setTimeout(function(){oLayouter.drawSymbols(aUpdatedSymbols)},self.endTransitionDefinition.duration)}}this.resource.applyUndoableAction(moveSymbolsAction,"Move Symbols");if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}if(self.selectionBBox){self.movedBBox=self.selectionBBox}self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(oPublishEvent.selectedSymbols!==undefined&&oPublishEvent.selectedSymbols.length>0){setTimeout(function(){sap.galilei.core.Event.publish("move.symbols.after",self,undefined,oPublishEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)}},moveSymbols:function(oEvent){this.defaultMoveSymbols(oEvent)},defaultOnDragEndSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){this.isDraggingSymbols=false;if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canMoveSymbols(oEvent)){this.moveSymbols(oEvent)}else{this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onDragEndSymbols:function(oEvent){this.defaultOnDragEndSymbols(oEvent)},cancel:function(){this.isDraggingSymbols=false;this.movedBBox=this.initialBBox.clone();this.updateHandles();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}},dispose:function(){this.isDraggingSymbols=false;this.hideAllSelection();this.removeEventHandlers();if(this.snapToShapesHandler){this.snapToShapesHandler.dispose();this.snapToShapesHandler=undefined}if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}}}})}());
"use strict";sap.galilei.ui.editor.tracker.SwimlaneMultiSelectionTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.SwimlaneMultiSelectionTracker",trackerName:"SwimlaneMultiSelectionTracker",parent:sap.galilei.ui.editor.tracker.MultiSelectionTracker,methods:{getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter({editor:this.editor})}return this._parentHighlighter},canDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],aSelected=[],oSymbol,j,oOwner;oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.drag",this.editor,this.editor,oEvent);if(!oEvent.cancel){if(this.selectedSymbols){for(j=0;j<this.selectedSymbols.length;j++){oSymbol=this.selectedSymbols[j];if(!oSymbol.parentSymbol||!this.isParentSymbolSelected(oSymbol.parentSymbol)){aSelected.push(oSymbol)}}}for(j=0;j<aSelected.length;j++){oSymbol=aSelected[j];if(!oOwner){oOwner=oSymbol.getOwner()}else{if(oOwner!==oSymbol.getOwner()){oEvent.cancel=true;break}}}}return !oEvent.cancel}return false},onDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],oOldBBox=this.movedBBox.clone(),aClientPoint,aViewPoint,highlighter,self=this,aSelected=[],j,oSymbol;this.movedBBox.x=this.initialBBox.x+aDelta[0];this.movedBBox.y=this.initialBBox.y+aDelta[1];if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.movedBBox,true)}if(this.snapToGrid){this.movedBBox.snapToGrid(this.gridSize)}if(this.canDragSymbols(oEvent)){this.updateHandles();aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);if(this.selectedSymbols){for(j=0;j<this.selectedSymbols.length;j++){oSymbol=this.selectedSymbols[j];if(!oSymbol.parentSymbol||!this.isParentSymbolSelected(oSymbol.parentSymbol)){aSelected.push(oSymbol)}}}highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tracker:this},function(oSymbol){var oParentSymbol,oSelfSymbol,i;if(oSymbol.isLinkSymbol){return true}for(i=0;i<aSelected.length;i++){oParentSymbol=oSymbol;oSelfSymbol=aSelected[i];while(oParentSymbol){if(oParentSymbol===oSelfSymbol){return true}oParentSymbol=oParentSymbol.parentSymbol}}return false},function(oSymbol){var oSelfSymbol,i;for(i=0;i<aSelected.length;i++){oSelfSymbol=aSelected[i];if(!self.editor.canAttachSymbol(oSymbol,oSelfSymbol,{point:aViewPoint})){return false}}return true})}else{this.movedBBox=oOldBBox}}},moveSymbols:function(){var self=this,oEvent={},bUpdateOrder;oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("move.symbols.before",this.editor,this.editor,oEvent);function moveSymbolsAction(){var aSelectedSymbols=[],index,oSymbol,oNewParent,oOldParent,nNewIndex,nOldIndex,oOldRootSwimlane,oOldRootSwimlanes={},oRootSwimlane,sOldRoot,oOldOwner;for(index=0;index<self.selectedSymbols.length;index++){oSymbol=self.selectedSymbols[index];if(oSymbol.parentSymbol&&self.isParentSymbolSelected(oSymbol.parentSymbol)){continue}if(oSymbol.isLinkSymbol&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){if((oSymbol.sourceSymbol.isSelected||self.isParentSymbolSelected(oSymbol.sourceSymbol))&&(oSymbol.targetSymbol.isSelected||self.isParentSymbolSelected(oSymbol.targetSymbol))){continue}}aSelectedSymbols.push(oSymbol)}for(index=0;index<aSelectedSymbols.length;index++){oSymbol=aSelectedSymbols[index];oOldOwner=oSymbol.getOwner();if(self._parentHighlighter){if(self._parentHighlighter.highlighted&&self._parentHighlighter.highlighted.isSwimlaneSymbol){oNewParent=self._parentHighlighter.highlighted;nNewIndex=self._parentHighlighter.symbolIndex;oOldParent=oSymbol.parentSymbol;if(oOldParent){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oSymbol);if(oOldRootSwimlane&&!oOldRootSwimlanes[oOldRootSwimlane.objectId]){oOldRootSwimlanes[oOldRootSwimlane.objectId]=oOldRootSwimlane}nOldIndex=oOldParent.symbols.indexOf(oSymbol);if(oOldParent&&oNewParent===oOldParent&&nNewIndex>nOldIndex){nNewIndex--}oOldParent.symbols.removeAt(nOldIndex)}else{nOldIndex=oSymbol.diagram.symbols.indexOf(oSymbol);oSymbol.diagram.symbols.removeAt(nOldIndex)}if(oNewParent.symbols.length===0){oNewParent.symbols.push(oSymbol)}else{oNewParent.symbols.insert(nNewIndex,oSymbol)}oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oNewParent);if(oOldOwner!==self._parentHighlighter.highlighted){bUpdateOrder=true}}else{if(self._parentHighlighter.highlighted&&sap.galilei.model.isInstanceOf(self._parentHighlighter.highlighted,"sap.galilei.ui.diagram.Diagram")){oOldParent=oSymbol.parentSymbol;if(oOldParent){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oSymbol);if(oOldRootSwimlane&&!oOldRootSwimlanes[oOldRootSwimlane.objectId]){oOldRootSwimlanes[oOldRootSwimlane.objectId]=oOldRootSwimlane}nOldIndex=oOldParent.symbols.indexOf(oSymbol);oOldParent.symbols.removeAt(nOldIndex)}self._parentHighlighter.highlighted.symbols.push(oSymbol);oSymbol.moveBy(self.movedBBox.x-self.initialBBox.x,self.movedBBox.y-self.initialBBox.y,undefined,self.viewer,self.endTransitionDefinition);if(oOldOwner!==self._parentHighlighter.highlighted){bUpdateOrder=true}}}}}if(oRootSwimlane){oRootSwimlane.layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.endTransitionDefinition)}if(oOldRootSwimlanes){for(sOldRoot in oOldRootSwimlanes){if(oOldRootSwimlanes[sOldRoot]&&oOldRootSwimlanes[sOldRoot]!==oRootSwimlane){oOldRootSwimlanes[sOldRoot].layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.endTransitionDefinition)}}}self._parentHighlighter.dispose();self._parentHighlighter=undefined}this.resource.applyUndoableAction(moveSymbolsAction,"Move Symbols");self.movedBBox=self.selectionBBox;self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}setTimeout(function(){sap.galilei.core.Event.publish("move.symbols.after",self,undefined,oEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)},cancel:function(){this.isDraggingSymbols=false;this.movedBBox=this.initialBBox.clone();this.updateHandles();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}}}});
(function(){sap.galilei.ui.editor.tracker.DiagramPointerTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.DiagramPointerTracker",trackerName:"DiagramPointerTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},diagramBackgroundPanelShape:{get:function(){return this.viewer.backgroundPointerPanelShape}},multiSelectionTracker:{get:function(){return this.editor.multiSelectionTracker}},isLassoTool:{get:function(){if(this.editor.tool&&this.editor.tool.name===sap.galilei.ui.editor.tool.LassoTool.NAME){return true}return false}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},onPointerDownDiagramBackground:function(oEvent){this.viewer.gotFocus();if(this.editor._isDraggingLink){return}console.log("pointerdown diagram");this.editor.unselectAllSymbols();if(oEvent&&(this.isLassoTool||oEvent.shiftKey)){oEvent.preventDefault();oEvent.stopPropagation();if(!this.multiSelectionTracker){this.editor.getOrCreateMultiSelectionTracker()}else{this.multiSelectionTracker.unselectAllSymbols()}}this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("diagram.tap",this.editor,this.editor,oEvent)},onPointerUpDiagramBackground:function(oEvent){console.log("pointerup diagram")},onDragStartDiagramBackground:function(oEvent){var bShiftKey=false;if(oEvent&&oEvent.gesture&&oEvent.gesture.startEvent&&oEvent.gesture.startEvent.srcEvent){bShiftKey=oEvent.gesture.startEvent.srcEvent.shiftKey}if((this.isLassoTool||bShiftKey)&&this.multiSelectionTracker){this.multiSelectionTracker.onDragStartDiagramBackground(oEvent)}},onDragDiagramBackground:function(oEvent){var bShiftKey=false;if(oEvent&&oEvent.gesture&&oEvent.gesture.startEvent&&oEvent.gesture.startEvent.srcEvent){bShiftKey=oEvent.gesture.startEvent.srcEvent.shiftKey}if((this.isLassoTool||bShiftKey)&&this.multiSelectionTracker){this.multiSelectionTracker.onDragDiagramBackground(oEvent)}},onDragEndDiagramBackground:function(oEvent){var bShiftKey=false;if(oEvent&&oEvent.gesture&&oEvent.gesture.startEvent&&oEvent.gesture.startEvent.srcEvent){bShiftKey=oEvent.gesture.startEvent.srcEvent.shiftKey}if((this.isLassoTool||bShiftKey)&&this.multiSelectionTracker){this.multiSelectionTracker.onDragEndDiagramBackground(oEvent)}},onDiagramContextMenu:function(oEvent){oEvent.stopImmediatePropagation();oEvent.preventDefault()},addEventHandlers:function(){this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.DOMEvents.contextmenu,this.onDiagramContextMenu,this)},removeEventHandlers:function(){this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.DOMEvents.contextmenu,this.onDiagramContextMenu,this)},dispose:function(){this.removeEventHandlers()}}})}());
(function(){sap.galilei.ui.editor.tracker.LinkSymbolPointerTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.LinkSymbolPointerTracker",trackerName:"LinkSymbolPointerTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagramBackgroundPanelShape:{get:function(){return this.viewer.backgroundPointerPanelShape}},isLassoTool:{get:function(){if(this.editor.tool&&this.editor.tool.name===sap.galilei.ui.editor.tool.LassoTool.NAME){return true}return false}}},methods:{addEventHandlers:function(oSymbol){if(oSymbol){oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);if(oSymbol.isLinkSymbol&&!oSymbol.findEventHandler(sap.galilei.ui.common.DOMEvents.contextmenu)){oSymbol.on(sap.galilei.ui.common.DOMEvents.contextmenu,this.onSymbolContextMenu,this)}}else{this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.DOMEvents.contextmenu,this.onSymbolContextMenu,this)}},removeEventHandlers:function(oSymbol){if(oSymbol){oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);oSymbol.off(sap.galilei.ui.common.DOMEvents.contextmenu,this.onSymbolContextMenu,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this)}else{this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.DOMEvents.contextmenu,this.onSymbolContextMenu,this)}},isSameDiagram:function(oEvent){if(oEvent!==undefined&&oEvent.sourceSymbol!==undefined&&oEvent.sourceSymbol.isLinkSymbol&&this.editor!==undefined&&oEvent.sourceSymbol.diagram!==this.editor.diagram){return false}return true},onSymbolPointerDown:function(oEvent){var aClientPoint,oLinkSymbol,bSelected;this.viewer.gotFocus();if(!this.isSameDiagram(oEvent)){return}if(this.isLassoTool){oEvent.preventDefault();oEvent.stopPropagation();return}if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol.isLinkSymbol){oLinkSymbol=oEvent.sourceSymbol}else{aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oLinkSymbol=this.editor.getLinkSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true,5)}if(oLinkSymbol&&this.editor.enableSelectSymbol){console.log("pointerdown link symbol.");oEvent.preventDefault();oEvent.stopPropagation();bSelected=oLinkSymbol.isSelected;if(oEvent.shiftKey){bSelected=!bSelected}else{if(!bSelected){bSelected=true}}if(!(bSelected&&oLinkSymbol.isSelected&&this.editor.selectedSymbols.length>1)){oLinkSymbol.isSelected=bSelected;if(oLinkSymbol.isSelected){if(!oEvent.shiftKey){this.editor.unselectAllSymbols(true,undefined,oLinkSymbol)}this.editor.selectSymbol(oLinkSymbol,true)}else{this.editor.unselectSymbol(oLinkSymbol,true)}}if(oLinkSymbol._tracker&&oLinkSymbol._tracker.onPointerDownShape){oLinkSymbol._tracker.onPointerDownShape(oEvent)}this._draggedSymbol=oLinkSymbol;this.editor._isDraggingLink=true}},onSymbolPointerUp:function(oEvent){if(!this.isSameDiagram(oEvent)){return}this.editor._isDraggingLink=false},onSymbolDragStart:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(this._draggedSymbol){var oSymbol=this._draggedSymbol;oEvent.preventDefault();oEvent.stopPropagation();if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragStartShape){oSymbol._tracker.onDragStartShape(oEvent)}}}},onSymbolDrag:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(this._draggedSymbol){var oSymbol=this._draggedSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragShape){oSymbol._tracker.onDragShape(oEvent)}}}},onSymbolDragEnd:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(this._draggedSymbol){var oSymbol=this._draggedSymbol;if(this.editor.selectedSymbols.length===1){console.log("link points tracker dragend.");if(oSymbol._tracker&&oSymbol._tracker.onDragEndShape){oSymbol._tracker.onDragEndShape(oEvent);this._draggedSymbol=undefined}}}},onSymbolHold:function(oEvent){if(!this.isSameDiagram(oEvent)){return}var oLinkSymbol=oEvent&&oEvent.sourceSymbol,aClientPoint;if(oEvent&&!oLinkSymbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oLinkSymbol=this.editor.getLinkSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true,5)}if(oEvent&&oLinkSymbol&&oLinkSymbol.isLinkSymbol){if(oLinkSymbol._tracker&&oLinkSymbol._tracker.onShapeHold){oLinkSymbol._tracker.onShapeHold(oEvent)}}},onSymbolContextMenu:function(oEvent){if(!this.isSameDiagram(oEvent)){return}var oLinkSymbol=oEvent&&oEvent.sourceSymbol,aClientPoint;if(oEvent&&!oLinkSymbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oLinkSymbol=this.editor.getLinkSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true,5)}if(oEvent&&oLinkSymbol&&oLinkSymbol.isLinkSymbol){oEvent.stopImmediatePropagation();oEvent.preventDefault()}},dispose:function(){this.removeEventHandlers();this._draggedSymbol=undefined}}})}());
(function(){sap.galilei.ui.editor.tracker.LinkSymbolTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.LinkSymbolTracker",trackerName:"LinkSymbolTracker",parent:sap.galilei.ui.common.tracker.PointsTracker,fields:{_extremityHighlighter:undefined},properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},resource:{get:function(){return this.diagram.resource}},symbol:undefined,isSource:false,isTarget:false},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}this.isReadOnly=this.editor.isReadOnly||!this.editor.enableLinkRedirection;if(this.symbol&&this.symbol.isLinkSymbol){if(this.symbol.isKeepPosition){this.isReadOnly=true}this.pointsShape=this.symbol.getLinkShape();this.initialPoints=this.symbol.points&&this.symbol.points.clone()}else{throw"The link symbol must be specified."}this.isSource=false;this.isTarget=false},addEventHandlers:function(){this.defaultAddEventHandlers();sap.galilei.core.Event.subscribe("modify.linksymbol.before",this.onBeforeModifyLinkSymbol,this);sap.galilei.core.Event.subscribe("modify.linksymbol.after",this.onAfterModifyLinkSymbol,this)},removeEventHandlers:function(){this.defaultRemoveEventHandlers();sap.galilei.core.Event.unSubscribeScope("modify.linksymbol.before",this);sap.galilei.core.Event.unSubscribeScope("modify.linksymbol.after",this)},onBeforeModifyLinkSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.initialPoints=undefined;this.updateHandles()}},onAfterModifyLinkSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.initialPoints=this.symbol.points.clone();this.updateHandles();this.drawHandles()}},onPointerUpShape:function(oEvent,oShape){this.editor._isDraggingLink=false},isPointEditable:function(index){if(this.initialPoints){return(index===0||index===this.initialPoints.length-1)}return true},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle){oEvent.cancel=!this.isPointEditable(oHandle._index);oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("linksymbol.handle.dragstart",this,undefined,oEvent);if(!oEvent.cancel){this.isSource=(oHandle._index===0);this.isTarget=this.symbol.points&&(oHandle._index===this.symbol.points.length-1)}return !oEvent.cancel}return false},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this._isDraggingHandle){oEvent.cancel=!this.isPointEditable(oHandle._index);oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("linksymbol.handle.drag",this,undefined,oEvent);if(!oEvent.cancel){this.isSource=(oHandle._index===0);this.isTarget=this.symbol.points&&(oHandle._index===this.symbol.points.length-1)}return !oEvent.cancel}return false},getOrCreateExtremityHighlighter:function(){if(!this._extremityHighlighter){this._extremityHighlighter=new sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter({isSource:this.isSource,isTarget:this.isTarget,editor:this.editor,highlightDiagram:false,forceHighlightAttachPoints:true,radius:10,strokeWidth:4})}return this._extremityHighlighter},snapToAttachPoint:function(oEvent,oHandle,aPoint){var oExtremity,aClientPoint,oHighlighter,aNewPoint=aPoint,self=this,sLinkSymbolClass,sLinkObjectClass;if(oHandle&&this.symbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oHighlighter=this.getOrCreateExtremityHighlighter();if(oHighlighter){sLinkSymbolClass=this.symbol.classDefinition.qualifiedName;sLinkObjectClass=this.symbol.object&&this.symbol.object.classDefinition&&this.symbol.object.classDefinition.qualifiedName;oHighlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tracker:this},function(oSymbol){if(!oSymbol.isLinkSymbol){var oLinkToolDef={linkSymbolClass:sLinkSymbolClass,linkObjectClass:sLinkObjectClass},oSourceSymbol,oTargetSymbol,bAttachPoint=false;if(self.isSource){oLinkToolDef.sourceSymbol=oSymbol.classDefinition.qualifiedName;oLinkToolDef.targetSymbol=self.symbol.targetSymbol.classDefinition.qualifiedName;oSourceSymbol=oSymbol;oTargetSymbol=self.symbol.targetSymbol;bAttachPoint=true}else{if(self.isTarget){oLinkToolDef.sourceSymbol=self.symbol.sourceSymbol.classDefinition.qualifiedName;oLinkToolDef.targetSymbol=oSymbol.classDefinition.qualifiedName;oSourceSymbol=self.symbol.sourceSymbol;oTargetSymbol=oSymbol;bAttachPoint=true}}if(bAttachPoint){return !self.editor.canCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkToolDef)}}return true});oExtremity=oHighlighter.highlighted}if(!oExtremity){if(this.isSource){oExtremity=this.symbol.sourceSymbol}else{if(this.isTarget){oExtremity=this.symbol.targetSymbol}}}if(oExtremity){if(oHighlighter&&oHighlighter.highlightedAttachPoint){aNewPoint[0]=oHighlighter.highlightedAttachPoint[0];aNewPoint[1]=oHighlighter.highlightedAttachPoint[1]}}}return aNewPoint},canDragSegments:function(){switch(this.symbol.lineStyle){case sap.galilei.ui.common.LineStyle.streight:case sap.galilei.ui.common.LineStyle.horzDiagonalBezier:case sap.galilei.ui.common.LineStyle.vertDiagonalBezier:case sap.galilei.ui.common.LineStyle.horzDiagonal:case sap.galilei.ui.common.LineStyle.vertDiagonal:return false}return true},modifyPointsShape:function(bReroute,handleIndex){var i,length,oSourceSymbol,oTargetSymbol,oSourceBoundaryShape,oTargetBoundaryShape,oSourceRect,oTargetRect,nSourceIndex,nTargetIndex,oExtremity,aSymbolPoints,self=this;function modifyLinkAction(){var oldSourceDirection,oldTargetDirection,sourceDirection,targetDirection,oPublishEvent={};if(!bReroute&&self.symbol.points.length>=2){length=self.symbol.points.length;oldSourceDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(self.symbol.points[0],self.symbol.points[1]);oldTargetDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(self.symbol.points[length-1],self.symbol.points[length-2])}if(self._extremityHighlighter&&self._extremityHighlighter.highlighted){oExtremity=self._extremityHighlighter.highlighted;if(self.isSource&&self.symbol.sourceSymbol!==oExtremity){if(self.symbol.object){self.symbol.object[self.editor.getLinkObjectSourceReferenceName(self.symbol.object.classDefinition.qualifiedName)]=oExtremity.object}self.symbol.sourceSymbol=oExtremity}else{if(self.isTarget&&self.symbol.targetSymbol!==oExtremity){if(self.symbol.object){self.symbol.object[self.editor.getLinkObjectTargetReferenceName(self.symbol.object.classDefinition.qualifiedName)]=oExtremity.object}self.symbol.targetSymbol=oExtremity}}}aSymbolPoints=self.modifiedPoints.clone();oSourceSymbol=self.symbol.sourceSymbol;oTargetSymbol=self.symbol.targetSymbol;if(oSourceSymbol&&oTargetSymbol){oSourceBoundaryShape=oSourceSymbol.getBoundaryShape();oTargetBoundaryShape=oTargetSymbol.getBoundaryShape();oSourceRect=oSourceSymbol.getBBox();oTargetRect=oTargetSymbol.getBBox();length=aSymbolPoints.length;if(oSourceBoundaryShape&&oTargetBoundaryShape){for(i=1;i<length;i++){if(!oSourceBoundaryShape.isPointInShape(aSymbolPoints[i],oSourceRect)){nSourceIndex=i;break}}for(i=length-2;i>=0;i--){if(!oTargetBoundaryShape.isPointInShape(aSymbolPoints[i],oTargetRect)){nTargetIndex=i;break}}if(nSourceIndex!==undefined&&nTargetIndex!==undefined&&nSourceIndex>=1&&nTargetIndex<=length-2&&nTargetIndex-nSourceIndex>=-2){aSymbolPoints.set(aSymbolPoints.slice(nSourceIndex-1,nTargetIndex+2))}if(!oSourceBoundaryShape.isPointInShape(aSymbolPoints[0],oSourceRect)||!oTargetBoundaryShape.isPointInShape(aSymbolPoints[aSymbolPoints.length-1],oTargetRect)){return}}}self.symbol.points=aSymbolPoints;self.symbol.isAutomaticRouting=bReroute;if(!bReroute){if(aSymbolPoints.length>=2){length=aSymbolPoints.length;sourceDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aSymbolPoints[0],aSymbolPoints[1]);targetDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aSymbolPoints[length-1],aSymbolPoints[length-2]);if(sourceDirection!==oldSourceDirection){self.symbol.sourceDirection=sourceDirection}if(targetDirection!==oldTargetDirection){self.symbol.targetDirection=targetDirection}}}else{if(self.isSource){self.symbol.sourceDirection=undefined}if(self.isTarget){self.symbol.targetDirection=undefined}}oPublishEvent.sourceSymbol=self.symbol;sap.galilei.core.Event.publish("layout.linksymbol.before",self,undefined,oPublishEvent);self.symbol.updateLinkRouting(true);self.symbol.drawSymbol(self.viewer,self.transitionDefinition);if(!self.transitionDefinition){sap.galilei.core.Event.publish("layout.linksymbol.after",self,undefined,oPublishEvent)}else{setTimeout(function(){sap.galilei.core.Event.publish("layout.linksymbol.after",self,undefined,oPublishEvent)},self.transitionDefinition.duration)}}if(this.symbol&&this.symbol.isLinkSymbol&&this.modifiedPoints){this.resource.applyUndoableAction(modifyLinkAction,"Modify Link Symbol");this.initialPoints=this.symbol.points.clone()}if(this._extremityHighlighter){this._extremityHighlighter.dispose();this._extremityHighlighter=undefined}},onShapeDoubleTap:function(oEvent){var oLinkSymbol=this.symbol,aClientPoint;if(oEvent&&!oLinkSymbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oLinkSymbol=this.editor.getLinkSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true,5)}if(oEvent&&oLinkSymbol&&oLinkSymbol.isLinkSymbol){sap.galilei.core.Event.publish("symbol.doubletap",this,undefined,this.editor.addEventProperties(oEvent,oLinkSymbol));console.log("doubletap symbol")}},onShapeContextMenu:function(oEvent){if(oEvent){oEvent.stopImmediatePropagation();oEvent.preventDefault();if(this.symbol){this.editor.hideContextButtonPad(this.symbol);if(this.symbol&&!this.symbol.triggerEvent(sap.galilei.ui.common.DOMEvents.contextmenu,oEvent)){sap.galilei.core.Event.publish("symbol.contextmenu",this,undefined,this.editor.addEventProperties(oEvent,this.symbol));console.log("contextmenu link symbol")}}}},onShapeHold:function(oEvent){if(oEvent){this.editor.hideContextButtonPad(this.symbol);sap.galilei.core.Event.publish("symbol.hold",this,undefined,this.editor.addEventProperties(oEvent,this.symbol));if(this.symbol&&!this.symbol.triggerEvent(sap.galilei.ui.common.DOMEvents.contextmenu,oEvent)){sap.galilei.core.Event.publish("symbol.contextmenu",this,undefined,this.editor.addEventProperties(oEvent,this.symbol));console.log("contextmenu link symbol (hold)")}}},cancel:function(){this.defaultCancel();this.editor._isDraggingLink=false;if(this._extremityHighlighter){this._extremityHighlighter.dispose();this._extremityHighlighter=undefined}},dispose:function(){this.defaultDispose();if(this.editor){this.editor._isDraggingLink=false;this.editor=undefined}if(this._extremityHighlighter){this._extremityHighlighter.dispose();this._extremityHighlighter=undefined}if(this.symbol){delete this.symbol._tracker;this.symbol=undefined}this.isSource=false;this.isTarget=false}}})}());
(function(){sap.galilei.ui.editor.tracker.MouseHoverHandler=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.MouseHoverHandler",parent:sap.galilei.ui.common.tracker.MouseHoverHandler,properties:{editor:undefined},methods:{notifyMouseOver:function(oEvent){var oSymbol=oEvent&&oEvent.sourceSymbol,aClientPoint;if(oSymbol){oSymbol.addClass("sapGalileiHover");if(typeof oSymbol.onMouseOver==="function"){oSymbol.onMouseOver.call(oSymbol,oEvent,oSymbol,this.editor&&this.editor.extension)}}},notifyMouseOut:function(oEvent){var oSymbol=oEvent&&oEvent.sourceSymbol;if(oSymbol){oSymbol.removeClass("sapGalileiHover");if(typeof oSymbol.onMouseOut==="function"){oSymbol.onMouseOver.call(oSymbol,oEvent,oSymbol,this.editor&&this.editor.extension)}}}}})}());
(function(){sap.galilei.ui.editor.tracker.SnapToSymbols=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.SnapToSymbols",parent:sap.galilei.ui.common.tracker.SnapToShapes,initialize:function(options){if(options){this.set(options)}this.onInitialize()},properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},initializeSymbolSnapLines:function(bExcludeSelected){if(bExcludeSelected===undefined){bExcludeSelected=true}this.clearShapeIndexes();this.addSymbolsCoordinates(this.diagram.symbols,bExcludeSelected);this.createSnapLines()},addSymbolsCoordinates:function(oSymbols,bExcludeSelected){var self=this;function addSymbol(oSymbol){if(!oSymbol.isHidden&&!oSymbol.isLinkSymbol&&self.editor.isSymbolVisible(oSymbol)&&(!bExcludeSelected||(bExcludeSelected&&!self.editor.selectedSymbols.contains(oSymbol)))){self.addShapeBBox(oSymbol.getBBox());if(oSymbol.isComposite){self.addSymbolsCoordinates(oSymbol.symbols,bExcludeSelected)}}}if(oSymbols){oSymbols.forEach(addSymbol)}}}})}());
(function(){sap.galilei.ui.editor.tracker.StackSymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.StackSymbolHighlighter",parent:sap.galilei.ui.editor.tracker.SymbolHighlighter,fields:{_hasInsertion:undefined,_layouter:undefined},properties:{orientation:sap.galilei.ui.common.Orientation.horizontal,symbolClass:undefined,offsetX:undefined,offsetY:undefined,snapToShapes:undefined,oldIndex:undefined,newIndex:undefined},methods:{getHighlightRect:function(oSymbol,bBefore){var oRect=new sap.galilei.ui.common.Rect(),nDefaultSize=5,nOffsetX=(this.offsetX!==undefined)?this.offsetX:nDefaultSize,nOffsetY=(this.offsetY!==undefined)?this.offsetY:nDefaultSize;if(oSymbol&&this.orientation!==undefined){if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){if(typeof nOffsetX==="function"){nOffsetX=nOffsetX()}if(nOffsetX===0){nOffsetX=nDefaultSize}if(bBefore){oRect.x=oSymbol.x-nOffsetX}else{oRect.x=oSymbol.x+oSymbol.width}oRect.y=oSymbol.y;oRect.width=nOffsetX;oRect.height=oSymbol.height}else{if(typeof nOffsetY==="function"){nOffsetY=nOffsetY()}if(nOffsetY===0){nOffsetY=nDefaultSize}if(bBefore){oRect.y=oSymbol.y-nOffsetY}else{oRect.y=oSymbol.y+oSymbol.height}oRect.x=oSymbol.x;oRect.width=oSymbol.width;oRect.height=nOffsetY}}return oRect},createHighlightShape:function(oSymbol,bBefore){var oRect;if(oSymbol&&!this._highlightShape){oRect=this.getHighlightRect(oSymbol,bBefore);if(oRect){this._highlightShape=new sap.galilei.ui.common.shape.Rectangle({x:oRect.x,y:oRect.y,width:oRect.width,height:oRect.height,stroke:this.highlightColor,fill:this.highlightColor,opacity:0.8});this._highlightShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}}},updateHighlightShape:function(oSymbol,bBefore){var oRect;if(oSymbol&&this._highlightShape){oRect=this.getHighlightRect(oSymbol,bBefore);if(oRect&&(this._highlightShape.x!==oRect.x||this._highlightShape.y!==oRect.y)){this._highlightShape.set({x:oRect.x,y:oRect.y});this._highlightShape.updateDrawing(this.viewer,undefined,["x","y"])}}},highlight:function(x,y,oParams,fnSkipPickingByPoint,fnCanHighlight){var self=this,x0=x,y0=y,aViewPoint,oSymbolRect,width,height,oParentSymbol,oCurrentSymbol,aSelectedSymbols,index,oSymbol,oBBox,aSymbols,oGroupRectInfo,oOldSymbolRect,nOldIndex=-1,nNewIndex=-1,oReferenceSymbol,bBefore=false,oSymbolClipRect,aAllSymbols,bAddSubSymbol=false;aViewPoint=this.viewer.clientPointToViewPoint([x0,y0]);x=aViewPoint[0];y=aViewPoint[1];if(oParams){if(oParams.tracker){if(oParams.tracker.symbol){oSymbolRect=oParams.tracker.movedBBox;oCurrentSymbol=oParams.tracker.symbol}else{if(oParams.tracker.selectedSymbols&&oParams.tracker.selectedSymbols.length>0){oSymbolRect=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(oParams.tracker.selectedSymbols);oSymbolRect.setCenter(x,y);aSelectedSymbols=oParams.tracker.selectedSymbols}}}else{if(oParams.tool){width=oParams.tool.cursorWidth;height=oParams.tool.cursorHeight;oSymbolRect=new sap.galilei.ui.common.Rect(x-width/2,y-height/2,width,height)}}}if(!oSymbolRect){width=10;height=10;oSymbolRect=new sap.galilei.ui.common.Rect(x-width/2,y-height/2,width,height)}this.defaultHighlight(x0,y0,oParams,fnSkipPickingByPoint,fnCanHighlight);oParentSymbol=this.highlighted;if(oParentSymbol===undefined){aAllSymbols=this.editor.getAllSymbols();if(aAllSymbols){for(index=0;index<aAllSymbols.length;index++){oSymbol=aAllSymbols[index];if(oParams.tracker&&oParams.tracker.symbol===oSymbol){continue}if(sap.galilei.model.isInstanceOf(oSymbol,this.symbolClass)&&oSymbolRect.isRectIntersectRect(oSymbol.getBBox())){this._highlighted=oParentSymbol=oSymbol.parentSymbol;if(!this._highlighted&&oParams&&oParams.tracker){this._highlighted=this.editor.diagram}break}}}}if(this._layouter===undefined){this._layouter=new sap.galilei.ui.editor.layout.StackLayout({editor:this.editor,orientation:this.orientation,symbolClass:this.symbolClass,offsetX:this.offsetX,offsetY:this.offsetY})}aSymbols=this._layouter.getGroupSymbols(undefined,oSymbolRect,undefined,true,oParentSymbol||(oCurrentSymbol&&oCurrentSymbol.parentSymbol));oGroupRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(aSymbols);sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(aSymbols,this._layouter.orientation);if(aSymbols!==undefined&&aSymbols.length>0){if(this.oldIndex===undefined){if(oParams.tracker){if(oParams.tracker.symbol){oOldSymbolRect=oParams.tracker.symbol.getBBox()}else{if(oParams.tracker.selectedSymbols){oOldSymbolRect=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(oParams.tracker.selectedSymbols)}}}if((this._layouter.orientation==="horizontal"&&oOldSymbolRect&&oOldSymbolRect.x<oGroupRectInfo.x)||(this._layouter.orientation==="vertical"&&oOldSymbolRect.y<oGroupRectInfo.y)){nOldIndex=0}else{if((this._layouter.orientation==="horizontal"&&oOldSymbolRect&&oOldSymbolRect.right>oGroupRectInfo.right)&&(this._layouter.orientation==="vertical"&&oOldSymbolRect.bottom>oGroupRectInfo.bottom)){nOldIndex=aSymbols.length}else{for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];oBBox=oSymbol.getBBox();if(oParams.tracker&&oSymbol===oParams.tracker.symbol){nOldIndex=index;break}else{if(oOldSymbolRect&&oOldSymbolRect.isRectIntersectRect(oBBox)){if((this._layouter.orientation==="horizontal"&&oOldSymbolRect&&oOldSymbolRect.x<oBBox.x)||(this._layouter.orientation==="vertical"&&oOldSymbolRect&&oOldSymbolRect.y<oBBox.y)){nOldIndex=index}else{nOldIndex=index+1}break}}}}}if(nOldIndex!==-1){this.oldIndex=nOldIndex}}if((this._layouter.orientation==="horizontal"&&oSymbolRect.x<oGroupRectInfo.x)||(this._layouter.orientation==="vertical"&&oSymbolRect.y<oGroupRectInfo.y)){nNewIndex=0;bBefore=true}else{if((this._layouter.orientation==="horizontal"&&oSymbolRect.right>oGroupRectInfo.right)&&(this._layouter.orientation==="vertical"&&oSymbolRect.bottom>oGroupRectInfo.bottom)){nNewIndex=aSymbols.length}else{for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];oBBox=oSymbol.getBBox();if(oSymbolRect.isRectIntersectRect(oBBox)){if((this._layouter.orientation==="horizontal"&&oSymbolRect.x<oBBox.x)||(this._layouter.orientation==="vertical"&&oSymbolRect.y<oBBox.y)){nNewIndex=index}else{nNewIndex=index+1}break}}}}if(nNewIndex!==-1){this.newIndex=nNewIndex;if(nNewIndex===0){oReferenceSymbol=aSymbols[0];bBefore=true}else{oReferenceSymbol=aSymbols[nNewIndex-1]}if(oReferenceSymbol&&oReferenceSymbol!==oCurrentSymbol){oSymbolClipRect=oSymbolRect.clone();oSymbolClipRect.inflate(8,8);if(oReferenceSymbol.getBBox().isRectInRect(oSymbolClipRect)){bAddSubSymbol=this.defaultHighlight(x0,y0,oParams,fnSkipPickingByPoint,fnCanHighlight)}if(!bAddSubSymbol){if(!this._hasInsertion&&this._highlightShape){this.hideSymbolHighlight()}if(!this._highlightShape){this.createHighlightShape(oReferenceSymbol,bBefore)}else{this.updateHighlightShape(oReferenceSymbol,bBefore)}this._hasInsertion=true;return true}}}}if(this._hasInsertion){this.hideSymbolHighlight();this._hasInsertion=false}return this.defaultHighlight(x0,y0,oParams,fnSkipPickingByPoint,fnCanHighlight)}}})}());
(function(){sap.galilei.ui.editor.tracker.SymbolPointerTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.SymbolPointerTracker",trackerName:"SymbolPointerTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},isLassoTool:{get:function(){if(this.editor.tool&&this.editor.tool.name===sap.galilei.ui.editor.tool.LassoTool.NAME){return true}return false}},symbolSelectionEvent:undefined},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},addEventHandlers:function(oSymbol){if(oSymbol){oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.pinch,this.onSymbolPinch,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.tap,this.onSymbolTap,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.doubletap,this.onSymbolDoubleTap,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);if(!oSymbol.findEventHandler(sap.galilei.ui.common.DOMEvents.contextmenu)){oSymbol.on(sap.galilei.ui.common.DOMEvents.contextmenu,this.onSymbolContextMenu,this)}oSymbol.on(sap.galilei.ui.common.GestureEvents.release,this.onSymbolRelease,this)}},removeEventHandlers:function(oSymbol){if(oSymbol){oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.pinch,this.onSymbolPinch,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.tap,this.onSymbolTap,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.doubletap,this.onSymbolDoubleTap,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);oSymbol.off(sap.galilei.ui.common.DOMEvents.contextmenu,this.onSymbolContextMenu,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.release,this.onSymbolRelease,this)}},_hasSelectedRowSymbol:function(oTableSymbol){var index,max,oRowSymbol;if(oTableSymbol&&sap.galilei.model.isInstanceOf(oTableSymbol,"sap.galilei.ui.diagram.TableSymbol")){for(index=0,max=oTableSymbol.symbols.length;index<max;index++){oRowSymbol=oTableSymbol.symbols.get(index);if(sap.galilei.model.isInstanceOf(oRowSymbol,"sap.galilei.ui.diagram.RowSymbol")&&oRowSymbol.isSelected){return true}}}return false},isSameDiagram:function(oEvent){if(oEvent!==undefined&&oEvent.sourceSymbol!==undefined&&this.editor!==undefined&&oEvent.sourceSymbol.diagram!==this.editor.diagram){return false}return true},onSymbolPointerDown:function(oEvent){this.viewer.gotFocus();if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol,bSelected=oSymbol.isSelected,bNewSelected=bSelected,aViewPoint,bCanSelect,bStopPropagation=true,bShowContextButtonPad=(oEvent.button!==2);this._isPointerMoved=false;this._isReselectSymbol=false;if(oEvent.shiftKey){bNewSelected=!bSelected}else{if(!bSelected){bNewSelected=true}}if(this.editor._isDraggingLink){if(bNewSelected&&oSymbol.isSelected){if(this.editor.selectedSymbols.length===1){this._isReselectSymbol=true}}return}if(this.isLassoTool){oEvent.preventDefault();oEvent.stopPropagation();return}if(!this.editor.enableSelectSymbol){oEvent.preventDefault();oEvent.stopPropagation();return}console.log("pointerdown symbol");oEvent.preventDefault();if(bNewSelected&&oSymbol.isSelected){if(this.editor.selectedSymbols.length===1){this._isReselectSymbol=true}}else{aViewPoint=this.viewer.normalizePointerEvent(oEvent);bCanSelect=this.editor.canSelectSymbolByPoint(oSymbol,aViewPoint);bStopPropagation=bCanSelect;if(bNewSelected){if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")&&this.editor.selectTableSymbolFirst&&!bSelected){if(oSymbol.parentSymbol&&!oSymbol.parentSymbol.isSelected&&!this._hasSelectedRowSymbol(oSymbol.parentSymbol)){oSymbol=oSymbol.parentSymbol}}if(!oEvent.shiftKey){this.editor.unselectAllSymbols(true,undefined,oSymbol,false)}if(bCanSelect){this.editor.selectSymbol(oSymbol,true,undefined,false,undefined,bShowContextButtonPad,false);this.symbolSelectionEvent={isSelect:true,symbol:oSymbol}}else{this.editor.unselectSymbol(oSymbol,true,undefined,false);this.symbolSelectionEvent={isSelect:false,symbol:oSymbol}}}else{this.editor.unselectSymbol(oSymbol,true,undefined,false);this.symbolSelectionEvent={isSelect:false,symbol:oSymbol}}}if(bStopPropagation){oEvent.stopPropagation()}}},onSymbolPointerUp:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol,aClientPoint;this.notifySymbolSelectionChange();if(!this._isPointerMoved&&this._isReselectSymbol&&oSymbol.isSelected&&this.editor.selectedSymbols.length===1&&(oEvent.button==undefined||oEvent.button===0)){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);this.editor.enterInPlaceEditing(oSymbol,aClientPoint)}}},notifySymbolSelectionChange:function(){if(this.editor.enableSelectSymbol&&this.symbolSelectionEvent){if(this.symbolSelectionEvent.isSelect){this.editor.notifySymbolSelection(this.symbolSelectionEvent.symbol)}else{this.editor.notifySymbolUnselection(this.symbolSelectionEvent.symbol)}}this.symbolSelectionEvent=undefined},onSymbolDragStart:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;oEvent.preventDefault();oEvent.stopPropagation();this._isPointerMoved=true;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragStartShape){oSymbol._tracker.onDragStartShape(oEvent)}}else{if(this.editor.selectedSymbols.length>1){if(this.editor.multiSelectionTracker){this.editor.multiSelectionTracker.onDragStartSymbols(oEvent)}}}}},onSymbolDrag:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.gesture&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragShape){oSymbol._tracker.onDragShape(oEvent)}}else{if(this.editor.selectedSymbols.length>1){if(this.editor.multiSelectionTracker){this.editor.multiSelectionTracker.onDragSymbols(oEvent)}}}}},onSymbolDragEnd:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragEndShape){sap.galilei.model.unmonitorChanges=true;oSymbol._tracker.onDragEndShape(oEvent);sap.galilei.model.unmonitorChanges=false}}else{if(this.editor.selectedSymbols.length>1){if(this.editor.multiSelectionTracker){this.editor.multiSelectionTracker.onDragEndSymbols(oEvent)}}}this.notifySymbolSelectionChange()}},onSymbolPinch:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onPinchShape){oSymbol._tracker.onPinchShape(oEvent)}}}},onSymbolTap:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeTap){oSymbol._tracker.onShapeTap(oEvent)}}},onSymbolDoubleTap:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeDoubleTap){oSymbol._tracker.onShapeDoubleTap(oEvent);console.log("doubletap symbol")}}},onSymbolHold:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeHold){oSymbol._tracker.onShapeHold(oEvent)}}},onSymbolContextMenu:function(oEvent){var oSymbol;if(!this.isSameDiagram(oEvent)){return}if(oEvent){oEvent.stopImmediatePropagation();oEvent.preventDefault();if(oEvent.sourceSymbol){oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeContextMenu){oSymbol._tracker.onShapeContextMenu(oEvent)}}}},onSymbolRelease:function(oEvent){if(!this.isSameDiagram(oEvent)){return}if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onReleaseShape){oSymbol._tracker.onReleaseShape(oEvent)}}}}}})}());
(function(){sap.galilei.ui.editor.command.ChangeObjectTypeCommand=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.ChangeObjectTypeCommand",parent:sap.galilei.ui.editor.command.ChangePropertyCommand,properties:{preserveDirectReferences:true},methods:{onValueChanged:function(){this.changeObjectType()},onVerifyValue:function(vValue){var oParam={},sClassName,oSourceObject,oTargetObject,bIsLinkObject;if(this.editor&&this.object&&vValue){if(vValue.isChangeObject){sClassName=vValue.value;if(this.symbol&&this.symbol.isLinkSymbol){oSourceObject=this.symbol.sourceSymbol.object;oTargetObject=this.symbol.targetSymbol.object;bIsLinkObject=true}else{if(this.object.isLinkObject){oSourceObject=this.editor.getLinkObjectSource(this.object);oTargetObject=this.editor.getLinkObjectTarget(this.object);bIsLinkObject=true}}if(bIsLinkObject){if(oSourceObject&&oTargetObject){return this.editor.canCreateLinkObject(oSourceObject,oTargetObject,sClassName,vValue.objectParams)}}else{return this.editor.canCreateObject(sClassName,vValue.objectParams)}}else{oParam[this.attribute]=vValue.value;if(!this.editor.canSetObjectProperties(this.object,oParam)){return false}}return true}return false},changeObjectType:function(){var self=this,aInitialValues=this.values,oSymbol,oObject,index,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions;function changeObjectType(){oOptions={};oOptions.preserveDirectReferences=self.preserveDirectReferences;self.editor.replaceObjectAndSymbol(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions)}if(this.symbol&&aInitialValues&&this.editor){oSymbol=this.symbol;oObject=oSymbol.object;sObjectClass=this.selectedValue;index=this.getValueIndex();if(index>=0){oObjectParams=aInitialValues[index].objectParams;sSymbolClass=aInitialValues[index].symbolClass;oSymbolParams=aInitialValues[index].symbolParams;this.resource.applyUndoableAction(changeObjectType,"Change Object Type")}}}}});sap.galilei.ui.common.command.addCommand("ChangeObjectTypeCommand",sap.galilei.ui.editor.command.ChangeObjectTypeCommand)}());
(function(){sap.galilei.ui.editor.command.InsertRow=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.InsertRow",parent:sap.galilei.ui.editor.command.Command,properties:{tableClassName:{field:"_tableClassName",get:function(){return this._tableClassName},set:function(sTableClassName){this._tableClassName=sTableClassName}},rowClassName:{field:"_rowClassName",get:function(){return this._rowClassName},set:function(sRowClassName){this._rowClassName=sRowClassName}},rowsReferenceName:{field:"_rowsReferenceName",get:function(){return this._rowsReferenceName},set:function(sRowsReferenceName){this._rowsReferenceName=sRowsReferenceName}},isBelow:false,index:undefined,selectSymbol:true},methods:{getRows:function(oTable){if(oTable&&this.rowsReferenceName){return oTable[this.rowsReferenceName]}return undefined},execute:function(oParam){var self=this,oObject=oParam.object||this.object,oEditor=oParam.editor||this.editor,isBelow=oParam.isBelow!==undefined?oParam.isBelow:this.isBelow,index=oParam.index!==undefined?oParam.index:this.index,oRows,oTable,oRow,oRowSymbol,bFoundSymbol=false,idTimer,nTotalTime=0;function insertRow(){if(oTable&&oEditor){if(index===undefined){index=-1}oRow=oEditor.createObject(self.rowClassName,oParam);if(oRow){if(index>=0&&index<oRows.length){oRows.insert(index,oRow)}else{oRows.push(oRow)}if(self.selectSymbol){idTimer=setInterval(function(){if(oRow.relatedSymbols.length>0){oRowSymbol=oRow.relatedSymbols.get(0);if(bFoundSymbol){oRowSymbol.addClass("sapGalileiSelected");clearInterval(idTimer);return}else{if(oRowSymbol.isDrawn){oEditor.unselectAllSymbols(true,undefined,undefined,false);oEditor.selectSymbol(oRowSymbol,true,undefined,true,false,true);if(oEditor.enableInPlaceEditingAfterCreate){oEditor.enterInPlaceEditing(oRowSymbol)}bFoundSymbol=true}}}nTotalTime+=100;if(nTotalTime>1000){clearInterval(idTimer)}},100)}}}}if(oObject&&oObject.isUIEditable!==false&&oEditor){if(sap.galilei.model.isInstanceOf(oObject,this.rowClassName)){oTable=oObject.container;if(index===undefined&&oTable){oRows=this.getRows(oTable);if(oRows){index=oRows.indexOf(oObject);if(!isNaN(index)&&isBelow){index++}}}}else{if(sap.galilei.model.isInstanceOf(oObject,this.tableClassName)){oTable=oObject}}if(oTable){oRows=this.getRows(oTable);if(oRows){oParam._creationContext=oParam._creationContext||{};oParam._creationContext.container=oParam._creationContext.container||oTable;oTable.resource.applyUndoableAction(insertRow,"Insert row")}}}return oRow}},statics:{createNewInstance:function(oParam){return new sap.galilei.ui.editor.command.InsertRow(oParam)},execute:function(oParam){return this.createNewInstance(oParam).execute(oParam)}}})}());
(function(){sap.galilei.ui.editor.command.MoveRow=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.MoveRow",parent:sap.galilei.ui.editor.command.Command,properties:{rowClassName:{field:"_rowClassName",get:function(){return this._rowClassName},set:function(sRowClassName){this._rowClassName=sRowClassName}},rowsReferenceName:{field:"_rowsReferenceName",get:function(){return this._rowsReferenceName},set:function(sRowsReferenceName){this._rowsReferenceName=sRowsReferenceName}},direction:undefined},methods:{getRows:function(oTable){if(oTable&&this.rowsReferenceName){return oTable[this.rowsReferenceName]}return undefined},execute:function(oParam){var oObject=this.object,oEditor=this.editor,oRows,oTable,oRow,oRowSymbol,oldIndex,newIndex,max;function moveRow(){if(oRows&&oRow){oRows.removeAt(oldIndex);oRows.insert(newIndex,oRow);oRowSymbol=oRow.relatedSymbols.get(0);if(oRowSymbol){setTimeout(function(){oEditor.unselectAllSymbols(true,undefined,undefined,false);oEditor.selectSymbol(oRowSymbol,true,undefined,false,false,true)},300)}}}if(oObject&&oObject.isUIEditable!==false&&oEditor&&this.direction){if(sap.galilei.model.isInstanceOf(oObject,this.rowClassName)){oTable=oObject.container;oRow=oObject;if(oTable){oRows=this.getRows(oTable);if(oRows){oldIndex=newIndex=oRows.indexOf(oObject);max=oRows.length;switch(this.direction){case"up":if(oldIndex>0){newIndex--}break;case"down":if(oldIndex<max-1){newIndex=oldIndex+1}break;case"top":if(oldIndex>0){newIndex=0}break;case"bottom":if(oldIndex<max-1){newIndex=max-1}break}if(newIndex!==oldIndex){oTable.resource.applyUndoableAction(moveRow,"Move row")}}}}}},canExecute:function(oParam){var oObject=oParam&&oParam.object,oEditor=oParam&&oParam.editor,oRows,oTable,index,max;if(oObject&&oEditor&&this.direction){if(sap.galilei.model.isInstanceOf(oObject,this.rowClassName)){oTable=oObject.container;if(oTable){oRows=this.getRows(oTable);if(oRows){index=oRows.indexOf(oObject);max=oRows.length;switch(this.direction){case"up":case"top":if(index>0){return true}break;case"down":case"bottom":if(index<max-1){return true}break}}}}}return false}},statics:{createNewInstance:function(oParam){return new sap.galilei.ui.editor.command.MoveRow(oParam)},execute:function(oParam){this.createNewInstance(oParam).execute(oParam)}}})}());
(function(){sap.galilei.ui.editor.tool.CreateNodeSymbolTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.CreateNodeSymbolTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.createNodeSymbolTool},toolName:sap.galilei.ui.editor.tool.Types.createNodeSymbolTool,toolType:sap.galilei.ui.editor.tool.Types.createNodeSymbolTool,fields:{_isInitialized:false,_parentHighlighter:undefined},properties:{isReadOnly:{value:false,writable:false,configurable:false},isCreateNodeSymbol:{value:true,writable:false,configurable:false},symbolClass:undefined,symbolParam:undefined,symbolParent:undefined,symbolIndex:undefined,symbolClassDefinition:undefined,objectClass:undefined,objectParam:undefined,objectParent:undefined,objectReference:undefined,objectIndex:undefined,objectClassDefinition:undefined,dropBBox:undefined,dropPoint:undefined,overlayPanelShape:undefined,cursorShape:undefined,transitionDefinition:{get:function(){if(this.editor!==undefined&&!this.editor.enableAnimation){return false}if(!this._transitionDefinition){this._transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}return this._transitionDefinition},set:function(oTransitionDef){this._transitionDefinition=oTransitionDef}},snapToShapesHandler:undefined,isContextButton:{value:false},parentHighlighter:{field:"_parentHighlighter",get:function(){return this._parentHighlighter}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}if(!this.symbolClass){throw"The symbol class must be defined."}},onDelayedInitialize:function(){if(!this._isInitialized){if(this.symbolClass){this.symbolClassDefinition=sap.galilei.model.getClass(this.symbolClass);if(!this.symbolClassDefinition){console.log("The symbol class "+this.symbolClass+" cannot be found.")}if(!this.objectClass){this.objectClass=this.editor.getObjectClassOfSymbolClass(this.symbolClass);if(this.objectClass){this.objectClassDefinition=this.editor.getObjectClass(this.objectClass);if(!this.objectClassDefinition){console.log("The object class "+this.objectClass+" cannot be found.")}}}}this._isInitialized=true}},onSelected:function(){if(!this.editor.isReadOnly){this._isContextButton=false;this.onDelayedInitialize();this.createOverlayPanel();this.addEventHandlers();if(this.editor.snapToShapes){this.snapToShapesHandler=new sap.galilei.ui.editor.tracker.SnapToSymbols({editor:this.editor,transitionDefinition:this.transitionDefinition,snapToShapesCenter:this.editor.snapToShapesCenter,snapToShapesBorder:this.editor.snapToShapesBorder});this.snapToShapesHandler.initializeSymbolSnapLines(false)}}},onUnselected:function(){this.removeEventHandlers();if(this.overlayPanelShape){this.overlayPanelShape.dispose();this.overlayPanelShape=undefined}if(this.cursorShape){this.cursorShape.dispose();this.cursorShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.dispose();this.snapToShapesHandler=undefined}if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}},createOverlayPanel:function(){var oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER);if(!this.overlayPanelShape){this.overlayPanelShape=new sap.galilei.ui.common.shape.Rectangle({width:this.viewer.viewWidth,height:this.viewer.viewHeight,opacity:0.01,fill:"white"});this.overlayPanelShape.draw(this.viewer,oLayer.d3Layer)}},createCursor:function(x,y){var oSymbolLayout,oShape,sOrientation,nWidth,nHeight,index,oSubShape;if(this.cursor){this.cursorShape=new sap.galilei.ui.common.shape.Image({x:x-this.cursorWidth/2,y:y-this.cursorHeight/2,width:this.cursorWidth,height:this.cursorHeight,href:this.cursor})}else{oSymbolLayout=sap.galilei.ui.diagram.Symbol.getOrCreateSymbolLayout(this.symbolClassDefinition,0);sOrientation=this.symbolClassDefinition.runtimeClass.defaultOrientation;if(oSymbolLayout){oShape=oSymbolLayout.createShape();if(oShape){if(oShape.mainShape){this.cursorShape=oShape.mainShape;if(sOrientation&&sOrientation!==this.editor.orientation){nWidth=oShape.mainShape.height;nHeight=oShape.mainShape.width;oShape.mainShape.width=nWidth;oShape.mainShape.height=nHeight;if(oShape.mainShape.isGroup){for(index=0;index<oShape.mainShape.shapes.length;index++){oSubShape=oShape.mainShape.shapes[index];oSubShape.width=nWidth;oSubShape.height=nHeight}}}this.cursorWidth=oShape.mainShape.width;this.cursorHeight=oShape.mainShape.height}else{this.cursorShape=oShape;if(sOrientation&&sOrientation!==this.editor.orientation){nWidth=oShape.height;nHeight=oShape.width;oShape.width=nWidth;oShape.height=nHeight;if(oShape.isGroup){for(index=0;index<oShape.shapes.length;index++){oSubShape=oShape.shapes[index];oSubShape.width=nWidth;oSubShape.height=nHeight}}}this.cursorWidth=oShape.width;this.cursorHeight=oShape.height}if(oShape.mainShape.isGroup){this.cursorShape.x=-this.cursorWidth/2;this.cursorShape.y=-this.cursorHeight/2}this.cursorShape.strokeOpacity=0.8;this.cursorShape.fillOpacity=0.6;this.cursorShape.transform="translate("+x+","+y+")"}}}if(this.cursorShape){this.cursorShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}},updateCursor:function(oEvent){if(oEvent){var aViewPoint=this.viewer.normalizePointerEvent(oEvent,true),oRect,aPoint;if(!this.cursorShape){this.createCursor(aViewPoint[0],aViewPoint[1])}else{oRect=new sap.galilei.ui.common.Rect(aViewPoint[0]-this.cursorWidth/2,aViewPoint[1]-this.cursorHeight/2,this.cursorWidth,this.cursorHeight);if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(oRect,true,undefined,false,this.cursor!==undefined)}this.dropBBox=oRect;this.dropPoint=this.dropBBox.getCenter();if(this.editor.snapToGrid){this.dropPoint=sap.galilei.ui.common.Point.snapToGrid(this.dropPoint,this.editor.gridSize)}aPoint=[oRect.x,oRect.y];if(this.cursor){this.cursorShape.x=aPoint[0];this.cursorShape.y=aPoint[1];this.cursorShape.updateDrawing(this.viewer,undefined,["x","y"])}else{this.cursorShape.transform="translate("+aPoint[0]+","+aPoint[1]+")";this.cursorShape.updateDrawing(this.viewer,undefined,["transform"])}}}},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=this.editor.getParentHighlighter(this.symbolClass,{highlightColor:sap.galilei.ui.common.style.Color.lightgreen})}return this._parentHighlighter},canCreateSymbol:function(oEvent,aPoint,oParentSymbol){var bCanCreate,oParam;oParam={point:aPoint,parentSymbol:oParentSymbol};this.symbolParent=undefined;this.symbolIndex=undefined;this.objectParent=undefined;this.objectIndex=undefined;bCanCreate=this.editor.canCreateSymbol(this.symbolClass,oParam);this.symbolParent=oParam.parentSymbol;if(bCanCreate){this.objectClass=this.objectClass||this.editor.getObjectClassOfSymbolClass(this.symbolClass);this.objectParent=this.editor.getParentObjectByParentSymbol(this.symbolParent,this.objectClass);if(this.objectClass){bCanCreate=this.editor.canCreateObject(this.objectClass,this.objectParent,this.objectParam)}else{bCanCreate=true}}return bCanCreate},canInsertSymbol:function(oEvent,aPoint,oLinkSymbol){var oParam;oParam={point:aPoint,linkSymbol:oLinkSymbol};return this.editor.canInsertSymbolOnLinkSymbol(this.symbolClass,oParam)},onPointerDown:function(oEvent){if(!this.isContextButton){oEvent.preventDefault();oEvent.stopPropagation()}},onPointerUp:function(oEvent){if(!this.isContextButton){oEvent.preventDefault();oEvent.stopPropagation();this.onDrop(oEvent)}},onPointerMove:function(oEvent){if(oEvent&&!this.editor.isReadOnly){var self=this,aClientPoint,aViewPoint,highlighter;this.updateCursor(oEvent);aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tool:this},function(oSymbol){var oParentSymbol=oSymbol;while(oParentSymbol){if(oParentSymbol===self.symbol){return true}oParentSymbol=oParentSymbol.parentSymbol}return false},function(oSymbol){return(!oSymbol.isLinkSymbol&&self.canCreateSymbol(oEvent,aViewPoint,oSymbol))||(oSymbol.isLinkSymbol&&self.canInsertSymbol(oEvent,aViewPoint,oSymbol))})}},onDragOver:function(oEvent){if(oEvent&&!this.editor.isReadOnly){return false}},onDrop:function(oEvent,oSourceSymbol){var aClientPoint,oParentSymbol,nSymbolIndex,aViewPoint,aViewLinkPoint,aPoint,oSymbol,oLinkSymbol;if(oEvent&&!this.editor.isReadOnly&&this.dropPoint){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);if(this._parentHighlighter){if(this._parentHighlighter.highlighted){oParentSymbol=this._parentHighlighter.highlighted;if(oParentSymbol.isSwimlaneSymbol&&!oParentSymbol.isDetachable){nSymbolIndex=this._parentHighlighter.symbolIndex}}this._parentHighlighter.dispose();this._parentHighlighter=undefined}else{oParentSymbol=this.editor.getSymbolByPoint(aClientPoint[0],aClientPoint[1],this.viewer.mainShapeLayer.d3Layer,true)}aPoint=this.dropPoint;if(oParentSymbol&&oParentSymbol.isLinkSymbol){oLinkSymbol=oParentSymbol;oParentSymbol=oLinkSymbol.container;if(oParentSymbol.isDiagram){oParentSymbol=undefined}if(oLinkSymbol){if(!this.canInsertSymbol({},aViewPoint,oLinkSymbol)){oLinkSymbol=undefined}}}if((this.canCreateSymbol(oEvent,aPoint,oParentSymbol)&&(!oParentSymbol||!oLinkSymbol))||(oLinkSymbol&&this.canInsertSymbol(oEvent,aPoint,oLinkSymbol))){if(oLinkSymbol){oSymbol=this.insertSymbolOnLinkSymbol(oLinkSymbol,aPoint[0],aPoint[1])}else{if(nSymbolIndex!==undefined){this.symbolIndex=nSymbolIndex}oSymbol=this.createSymbol(aPoint[0],aPoint[1])}}if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.transitionDefinition)}this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);if(oSymbol){this.editor.unselectAllSymbols();if(this.editor.selectSymbolAfterCreate){this.editor.selectSymbol(oSymbol)}if(this.editor.enableInPlaceEditingAfterCreate){this.editor.enterInPlaceEditing(oSymbol)}}}return oSymbol},createSymbol:function(x,y,width,height,bUseUndoAction){var self=this,oSymbolParams=this.symbolParam||{},oSymbol,oBBox,dx,dy;sap.galilei.core.copyProperties(oSymbolParams,{x:x-this.cursorWidth/2,y:y-this.cursorHeight/2});if(width){oSymbolParams.width=width}if(height){oSymbolParams.height=height}bUseUndoAction=bUseUndoAction===undefined?true:bUseUndoAction;function createSymbolAction(){var oLayouter,oOldSymbol;oSymbol=self.editor.createSymbolAndObject(self.symbolClass,oSymbolParams,self.symbolParent,self.symbolIndex,self.objectClass,self.objectParam,self.objectParent,self.objectReference,self.objectIndex);if(oSymbol){oBBox=oSymbol.getBBox();dx=(self.cursorWidth-oBBox.width)/2;dy=(self.cursorHeight-oBBox.height)/2;if(dx!==0||dy!==0){oSymbol.moveBy(dx,dy)}if(oSymbol.isBoundarySymbol&&self.symbolParent){self.symbolParent.updateBoundarySymbol(oSymbol,undefined,undefined,false)}oOldSymbol=oSymbol;oSymbol=self.editor.postCreateSymbol(oSymbol);if(!oSymbol){oSymbol=oOldSymbol}self.editor.drawSymbol(oSymbol);oLayouter=self.editor.getOrCreateSymbolLayouter(oSymbol);if(oLayouter&&oLayouter.postCreateSymbol){oLayouter.postCreateSymbol(oSymbol,self,self.transitionDefinition)}if(self.symbolParent&&self.symbolParent.extendToContent){self.symbolParent.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.transitionDefinition)}}}if(bUseUndoAction){this.resource.applyUndoableAction(createSymbolAction,"Create Symbol")}else{createSymbolAction()}if(oSymbol&&oSymbol.parentSymbol&&oSymbol.parentSymbol.symbols.length>0){this.editor.updateSymbolDrawingOrder(this.transitionDefinition)}return oSymbol},insertSymbolOnLinkSymbol:function(oLinkSymbol,x,y){var self=this,oNodeSymbol,oEditorExt,oSourceSymbol,oTargetSymbol,oLinkSymbol2;function insertSymbolAction(){oNodeSymbol=self.createSymbol(x,y,undefined,undefined,false);if(oNodeSymbol){oSourceSymbol=oLinkSymbol.sourceSymbol;oTargetSymbol=oLinkSymbol.targetSymbol;oEditorExt=self.editor.extension;if(oLinkSymbol.object){oLinkSymbol.object[self.editor.getLinkObjectTargetReferenceName(oLinkSymbol.object.classDefinition.qualifiedName)]=oNodeSymbol.object}oLinkSymbol.targetSymbol=oNodeSymbol;oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(false);oLinkSymbol2=self.editor.createLinkSymbolAndObject(oNodeSymbol,oTargetSymbol,oLinkSymbol.classDefinition.qualifiedName,undefined,oLinkSymbol.getOwner(),undefined,self.editor.cloneLinkObjectParams(oLinkSymbol.object),oLinkSymbol.object?oLinkSymbol.object.container:undefined);if(oLinkSymbol2){oLinkSymbol2.isAutomaticRouting=true;oLinkSymbol2.updateLinkRouting(false);oNodeSymbol.drawSymbol(self.viewer);oLinkSymbol.drawSymbol(self.viewer,self.transitionDefinition);oLinkSymbol2.drawSymbol(self.viewer,self.transitionDefinition)}}}if(oLinkSymbol){this.resource.applyUndoableAction(insertSymbolAction,"Insert Symbol");return oNodeSymbol}},addEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove,this);this.overlayPanelShape.on(sap.galilei.ui.common.DragDropEvents.dragover,this.onDragOver,this);this.overlayPanelShape.on(sap.galilei.ui.common.DragDropEvents.drop,this.onDrop,this)}},removeEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove);this.overlayPanelShape.off(sap.galilei.ui.common.DragDropEvents.dragover,this.onDragOver);this.overlayPanelShape.off(sap.galilei.ui.common.DragDropEvents.drop,this.onDrop)}},changeEventHandlers:function(){if(this.overlayPanelShape){if(this.isContextButton){this.removeEventHandlers()}else{this.addEventHandlers()}}}}})}());
(function(){sap.galilei.ui.editor.tool.CompoundCreateNodeSymbolTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.CompoundCreateNodeSymbolTool",parent:sap.galilei.ui.editor.tool.CreateNodeSymbolTool,statics:{NAME:sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool},toolName:sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool,toolType:sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool,fields:{_tools:undefined,_activeTool:undefined},properties:{toolNames:undefined},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}if(!this.toolNames){throw"Concrete tools must be defined."}},onDelayedInitialize:function(){var i,oTool;if(!this._isInitialized){this._tools=[];if(this.toolNames){for(i=0;i<this.toolNames.length;i++){oTool=sap.galilei.ui.editor.tool.getTool(this.toolNames[i]);if(oTool){oTool.onDelayedInitialize();this._tools.push(oTool)}}}if(this._tools&&this._tools[0]){this.activateTool(this._tools[0])}this._isInitialized=true}},activateTool:function(oTool){var i,aParams=["symbolClass","symbolParam","symbolParent","symbolIndex","symbolClassDefinition","objectClass","objectParam","objectParent","objectReference","objectIndex","objectClassDefinition"];for(i=0;i<aParams.length;i++){this[aParams[i]]=oTool[aParams[i]]}this._activeTool=oTool},canCreateSymbol:function(oEvent,aPoint,oParentSymbol){var i,oTool;if(this._tools){for(i=0;i<this._tools.length;i++){oTool=this._tools[i];if(oTool.canCreateSymbol(oEvent,aPoint,oParentSymbol)){this.activateTool(oTool);return true}}}return false}}})}());
(function(){sap.galilei.ui.editor.tool.CreateLinkSymbolTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.CreateLinkSymbolTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.createLinkSymbolTool},toolName:sap.galilei.ui.editor.tool.Types.createLinkSymbolTool,toolType:sap.galilei.ui.editor.tool.Types.createLinkSymbolTool,fields:{_sourceExtremityHighlighter:undefined,_targetExtremityHighlighter:undefined},properties:{isReadOnly:{value:false,writable:false,configurable:false},isCreateLinkSymbol:{value:true,writable:false,configurable:false},linksDefinition:{onChange:function(){this.updateLinkToolsDefinition()}},sourceSymbolClasses:undefined,targetSymbolClasses:undefined,sourceSymbol:undefined,sourcePoint:undefined,currentSymbol:undefined,currentPoint:undefined,targetSymbol:undefined,targetPoint:undefined,linkObjectClass:undefined,linkObjectReference:undefined,linkObjectParam:undefined,linkObjectParent:undefined,linkSymbolClass:undefined,linkSymbolParam:undefined,linkSymbolParent:undefined,isCanDrag:false,isDragging:false,dragLineShape:undefined,transitionDefinition:{get:function(){if(this.editor!==undefined&&!this.editor.enableAnimation){return false}if(!this._transitionDefinition){this._transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}return this._transitionDefinition},set:function(oTransitionDef){this._transitionDefinition=oTransitionDef}},cursor:undefined,overlayPanelShape:undefined,isContextButton:false,cursorShape:undefined},methods:{onSelected:function(){if(!this.editor.isReadOnly){this.isContextButton=false;this.createOverlayPanel();this.addEventHandlers()}},onUnselected:function(){this.removeEventHandlers();if(this.overlayPanelShape){this.overlayPanelShape.dispose();this.overlayPanelShape=undefined}if(this.cursorShape){this.cursorShape.dispose();this.cursorShape=undefined}this.isDragging=false;if(this.cursor&&this.cursor.dispose){this.cursor.dispose();this.cursor=undefined}if(this.dragLineShape){this.dragLineShape.dispose();this.dragLineShape=undefined}if(this._sourceExtremityHighlighter){this._sourceExtremityHighlighter.dispose();this._sourceExtremityHighlighter=undefined}if(this._targetExtremityHighlighter){this._targetExtremityHighlighter.dispose();this._targetExtremityHighlighter=undefined}},createCursor:function(x,y){if(this.cursor){this.cursorShape=new sap.galilei.ui.common.shape.Image({x:x-this.cursorWidth/2,y:y-this.cursorHeight/2,width:this.cursorWidth,height:this.cursorHeight,href:this.cursor})}else{if(this.symbolClassDefinition){var oSymbolLayout=sap.galilei.ui.diagram.Symbol.getOrCreateSymbolLayout(this.symbolClassDefinition,0),oShape,sOrientation=this.symbolClassDefinition.runtimeClass.defaultOrientation,nSize;if(oSymbolLayout){oShape=oSymbolLayout.createShape();if(oShape){if(oShape.mainShape){this.cursorShape=oShape.mainShape;if(!oShape.mainShape.isGroup){oShape.mainShape.width-=8;oShape.mainShape.height-=8}if(sOrientation&&sOrientation!==this.editor.orientation){nSize=oShape.mainShape.width;oShape.mainShape.width=oShape.mainShape.height;oShape.mainShape.height=nSize}this.cursorWidth=oShape.mainShape.width;this.cursorHeight=oShape.mainShape.height}else{this.cursorShape=oShape;if(sOrientation&&sOrientation!==this.editor.orientation){nSize=oShape.width;oShape.width=oShape.height;oShape.height=nSize}this.cursorWidth=oShape.width;this.cursorHeight=oShape.height}if(oShape.mainShape.isGroup){this.cursorShape.x=-this.cursorWidth/2;this.cursorShape.y=-this.cursorHeight/2}this.cursorShape.opacity=0.6;this.cursorShape.transform="translate("+x+","+y+")"}}}}if(this.cursorShape){this.cursorShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}},updateCursor:function(oEvent){if(oEvent){var aViewPoint=this.viewer.normalizePointerEvent(oEvent,true),oRect,aPoint;if(!this.cursorShape){this.createCursor(aViewPoint[0],aViewPoint[1])}else{oRect=new sap.galilei.ui.common.Rect(aViewPoint[0]-this.cursorWidth/2,aViewPoint[1]-this.cursorHeight/2,this.cursorWidth,this.cursorHeight);if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(oRect,true,undefined,false,this.cursor!==undefined)}this.dropBBox=oRect;this.dropPoint=this.dropBBox.getCenter();if(this.editor.snapToGrid){this.dropPoint=sap.galilei.ui.common.Point.snapToGrid(this.dropPoint,this.editor.gridSize)}aPoint=[oRect.x,oRect.y];if(this.cursor){this.cursorShape.x=aPoint[0];this.cursorShape.y=aPoint[1];this.cursorShape.updateDrawing(this.viewer,undefined,["x","y"])}else{this.cursorShape.transform="translate("+aPoint[0]+","+aPoint[1]+")";this.cursorShape.updateDrawing(this.viewer,undefined,["transform"])}}}},updateLinkToolsDefinition:function(){this.sourceSymbolClasses=[];this.targetSymbolClasses=[];if(this.linksDefinition){var index,oLinkToolDef;for(index=0;index<this.linksDefinition.length;index++){oLinkToolDef=this.linksDefinition[index];if(this.sourceSymbolClasses.indexOf(oLinkToolDef.sourceSymbol)===-1){this.sourceSymbolClasses.push(oLinkToolDef.sourceSymbol)}if(this.targetSymbolClasses.indexOf(oLinkToolDef.targetSymbol)===-1){this.targetSymbolClasses.push(oLinkToolDef.targetSymbol)}}}},createOverlayPanel:function(){if(!this.overlayPanelShape){var oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER);this.overlayPanelShape=new sap.galilei.ui.common.shape.Rectangle({width:this.viewer.viewWidth,height:this.viewer.viewHeight,opacity:0,fill:"white"});this.overlayPanelShape.draw(this.viewer,oLayer.d3Layer)}if(this.cursor){this.setCursor(this.cursor)}},setCursor:function(sCursor){if(this.overlayPanelShape&&this.overlayPanelShape.isDrawn&&sCursor){this.overlayPanelShape.d3Node.node().style.cursor=sCursor}},canSupportSourceSymbol:function(oSourceSymbol){var sQualifiedName,index;if(oSourceSymbol&&!this.editor.isReadOnly){sQualifiedName=oSourceSymbol.classDefinition.qualifiedName;if(this.sourceSymbolClasses){for(index=0;index<this.sourceSymbolClasses.length;index++){if(sQualifiedName===this.sourceSymbolClasses[index]){return true}}for(index=0;index<this.sourceSymbolClasses.length;index++){if(sap.galilei.model.isTypeOf(sQualifiedName,this.sourceSymbolClasses[index])){return true}}}}return false},canSupportTargetSymbol:function(oTargetSymbol){var sQualifiedName,index;if(oTargetSymbol&&!this.editor.isReadOnly){sQualifiedName=oTargetSymbol.classDefinition.qualifiedName;if(this.targetSymbolClasses){for(index=0;index<this.targetSymbolClasses.length;index++){if(sQualifiedName===this.targetSymbolClasses[index]){return true}}for(index=0;index<this.targetSymbolClasses.length;index++){if(sap.galilei.model.isTypeOf(sQualifiedName,this.targetSymbolClasses[index])){return true}}}}return false},canConnectSourceSymbol:function(oSourceSymbol,aPoint){if(oSourceSymbol&&aPoint){if(!this.canSupportSourceSymbol(oSourceSymbol)){return false}this.sourceSymbol=oSourceSymbol;this.sourcePoint=aPoint;return true}return false},canConnectTargetSymbol:function(oTargetSymbol,aPoint){if(oTargetSymbol&&aPoint){if(!this.canSupportTargetSymbol(oTargetSymbol)){return false}if(!this.canCreateLinkSymbol(this.sourceSymbol,oTargetSymbol)){return false}this.targetSymbol=oTargetSymbol;this.targetPoint=aPoint;return true}return false},getLinkSymbolDefinitions:function(oSourceSymbol,oTargetSymbol){return this.editor.getLinkSymbolDefinitions(this.linksDefinition,oSourceSymbol,oTargetSymbol)},selectLinkSymbolDefinition:function(oSourceSymbol,oTargetSymbol){var aLinkTools,index,oLinkTool,aValidLinkTools;aLinkTools=this.getLinkSymbolDefinitions(oSourceSymbol,oTargetSymbol);if(aLinkTools){for(index=0;index<aLinkTools.length;index++){oLinkTool=aLinkTools[index];if(this.editor.canCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkTool)){if(aValidLinkTools===undefined){aValidLinkTools=[]}aValidLinkTools.push(oLinkTool)}}if(aValidLinkTools&&aValidLinkTools.length>0){return aValidLinkTools[0]}}return undefined},canCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol){var oLinkTool;oLinkTool=this.selectLinkSymbolDefinition(oSourceSymbol,oTargetSymbol);if(oLinkTool){this.linkSymbolClass=oLinkTool.linkSymbolClass;this.linkSymbolParam=oLinkTool.linkSymbolParam;this.linkSymbolParent=sap.galilei.ui.diagram.LinkSymbol.getLinkSymbolOwner(oSourceSymbol,oTargetSymbol);this.linkObjectClass=oLinkTool.linkObjectClass;this.linkObjectParam=oLinkTool.linkObjectParam;this.linkObjectReference=oLinkTool.linkObjectReference;this.linkObjectParent=this.editor.getParentObjectByParentSymbol(this.linkSymbolParent,this.linkObjectClass);return true}return false},getOrCreateSourceExtremityHighlighter:function(){if(!this._sourceExtremityHighlighter){this._sourceExtremityHighlighter=new sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter({isSource:true,editor:this.editor,highlightDiagram:false,forceHighlightAttachPoints:true,radius:10,highlightColor:sap.galilei.ui.common.style.Color.lightgreen,strokeWidth:4})}return this._sourceExtremityHighlighter},getOrCreateTargetExtremityHighlighter:function(){if(!this._targetExtremityHighlighter){this._targetExtremityHighlighter=new sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter({isTarget:true,editor:this.editor,highlightDiagram:false,forceHighlightAttachPoints:true,radius:10,highlightColor:sap.galilei.ui.common.style.Color.lightgreen,strokeWidth:4})}return this._targetExtremityHighlighter},onPointerDown:function(oEvent){if(oEvent&&!this.editor.isReadOnly){oEvent.preventDefault();oEvent.stopPropagation();var aClientPoint,aViewPoint,oHighlighter,oSourceSymbol,self=this;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);oHighlighter=this._sourceExtremityHighlighter;if(oHighlighter){if(oHighlighter.highlighted){oSourceSymbol=oHighlighter.highlighted;if(oSourceSymbol){this.isCanDrag=true;this.sourcePoint=oHighlighter.highlightedAttachPoint||aViewPoint;if(this.cursorShape){this.cursorShape.hide(this.viewer,this.transitionDefinition)}}this._sourceExtremityHighlighter.dispose();this._sourceExtremityHighlighter=undefined}}else{if(this.isContextButton&&oEvent.contextButtonSymbol){oSourceSymbol=oEvent.contextButtonSymbol}else{oSourceSymbol=this.editor.getSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true)}if(oSourceSymbol){oHighlighter=this.getOrCreateSourceExtremityHighlighter();if(oHighlighter){oHighlighter.isShowHighlight=false;oHighlighter.highlight(aClientPoint[0]+1,aClientPoint[1]+1,{event:oEvent,tool:this},function(oSymbol){return oSymbol.isLinkSymbol||!self.canConnectSourceSymbol(oSymbol,[aViewPoint[0],aViewPoint[1]])});aViewPoint=oHighlighter.highlightedAttachPoint||aViewPoint;this._sourceExtremityHighlighter.dispose();this._sourceExtremityHighlighter=undefined}if(this.canConnectSourceSymbol(oSourceSymbol,aViewPoint)){this.isCanDrag=true;this.sourcePoint=aViewPoint;if(this.cursorShape){this.cursorShape.hide(this.viewer,this.transitionDefinition)}}}}}},onPointerMove:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&!this.isCanDrag){var self=this,aClientPoint,oHighlighter,aViewPoint;this.updateCursor(oEvent);aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);oHighlighter=this.getOrCreateSourceExtremityHighlighter();oHighlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tool:this},function(oSymbol){return oSymbol.isLinkSymbol||!self.canConnectSourceSymbol(oSymbol,aViewPoint)})}},onPointerUp:function(oEvent){if(oEvent&&!this.editor.isReadOnly){if(this.isCanDrag&&!this.isDragging){this.onRelease(oEvent)}}},onDragStart:function(oEvent){var aPoint=[0,0];if(oEvent&&!this.editor.isReadOnly&&this.isCanDrag){this.isDragging=true;if(this.sourcePoint){aPoint=this.sourcePoint}if(!this.dragLineShape){this.dragLineShape=new sap.galilei.ui.common.shape.Line({domClass:"sapGalileiCreationPath",x1:aPoint[0],y1:aPoint[1],x2:aPoint[0],y2:aPoint[1],stroke:sap.galilei.ui.common.style.Color.orange,strokeDashArray:"3,3",strokeWidth:2});this.dragLineShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}}},onDrag:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&this.isDragging){var aClientPoint,aViewPoint,oTargetSymbol,oHighlighter,self=this;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);oHighlighter=this.getOrCreateTargetExtremityHighlighter();if(oHighlighter){oHighlighter.highlight(aClientPoint[0],aClientPoint[1],{event:oEvent,tool:this},function(oSymbol){return oSymbol.isLinkSymbol||!self.canConnectTargetSymbol(oSymbol,aViewPoint)});oTargetSymbol=oHighlighter.highlighted;if(oTargetSymbol){this.currentSymbol=this.targetSymbol;this.currentPoint=this.targetPoint;this.targetSymbol=undefined;this.targetPoint=undefined;if(oHighlighter.highlightedAttachPoint){aViewPoint=oHighlighter.highlightedAttachPoint}}else{if(this.currentSymbol){this.currentSymbol=undefined;this.currentPoint=undefined}}}this.dragLineShape.x2=Math.abs(aViewPoint[0]-this.dragLineShape.x1)<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE?this.dragLineShape.x1:aViewPoint[0];this.dragLineShape.y2=Math.abs(aViewPoint[1]-this.dragLineShape.y1)<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE?this.dragLineShape.y1:aViewPoint[1];this.dragLineShape.updateDrawing(this.viewer,undefined,["x2","y2"])}},onDragEnd:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&this.isDragging){var aClientPoint,aViewPoint,oTargetSymbol,oLinkSymbol;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);if(this._targetExtremityHighlighter){oTargetSymbol=this._targetExtremityHighlighter.highlighted;if(oTargetSymbol){this.targetSymbol=oTargetSymbol;this.targetPoint=this._targetExtremityHighlighter.highlightedAttachPoint||((this.dragLineShape&&this.dragLineShape.x2!==undefined&&this.dragLineShape.y2!==undefined)?[this.dragLineShape.x2,this.dragLineShape.y2]:aViewPoint);oLinkSymbol=this.createLinkSymbol()}this._targetExtremityHighlighter.dispose();this._targetExtremityHighlighter=undefined}this.onRelease(oEvent);this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false)}},onRelease:function(oEvent){this.isCanDrag=false;this.isDragging=false;if(this.dragLineShape){this.dragLineShape.dispose();this.dragLineShape=undefined}this.sourceSymbol=undefined;this.targetSymbol=undefined;this.currentSymbol=undefined;this.sourcePoint=undefined;this.targetPoint=undefined},createLinkSymbol:function(){var self=this,oLinkSymbolParam=this.linkSymbolParam||{},aPoints=new sap.galilei.ui.common.Points(),oLinkSymbol;aPoints.add(this.sourcePoint);aPoints.add(this.targetPoint);oLinkSymbolParam.points=aPoints;function createLinkSymbolAction(){oLinkSymbol=self.editor.createLinkSymbolAndObject(self.sourceSymbol,self.targetSymbol,self.linkSymbolClass,oLinkSymbolParam,self.linkSymbolParent,self.linkObjectClass,self.linkObjectParam,self.linkObjectParent,self.linkObjectReference);if(oLinkSymbol){oLinkSymbol.updateOwner();oLinkSymbol.updateLinkRouting(true);self.editor.postCreateLinkSymbol(oLinkSymbol.sourceSymbol,oLinkSymbol.targetSymbol,oLinkSymbol);self.editor.drawSymbol(oLinkSymbol)}}this.resource.applyUndoableAction(createLinkSymbolAction,"Create Link Symbol");if(oLinkSymbol&&oLinkSymbol.parentSymbol&&oLinkSymbol.parentSymbol.symbols.length===1){this.editor.updateSymbolDrawingOrder(this.transitionDefinition)}return oLinkSymbol},addEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp,this);this.overlayPanelShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStart,this);this.overlayPanelShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDrag,this);this.overlayPanelShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEnd,this)}},removeEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown,this);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove,this);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp,this);this.overlayPanelShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStart,this);this.overlayPanelShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDrag,this);this.overlayPanelShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEnd,this)}}}})}());
(function(){sap.galilei.ui.editor.tool.LassoTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.LassoTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.lassoTool},toolName:sap.galilei.ui.editor.tool.Types.lassoTool,toolType:sap.galilei.ui.editor.tool.Types.tool})}());
(function(){sap.galilei.ui.editor.tool.PointerTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.PointerTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.pointerTool},toolName:sap.galilei.ui.editor.tool.Types.pointerTool,toolType:sap.galilei.ui.editor.tool.Types.tool})}());
(function(){sap.galilei.ui.editor.widget.ContextButton=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.ContextButton",parent:sap.galilei.ui.common.widget.Button,widgetName:"ContextButton",properties:{purpose:"ContextButton",contextButtonPad:undefined,popupContextButtonPad:undefined,editor:{field:"_editor",get:function(){if(this.contextButtonPad){return this.contextButtonPad.editor}else{return this._editor}},set:function(oEditor){this._editor=oEditor}},viewer:{get:function(){if(this.editor){return this.editor.viewer}return undefined}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},resource:{get:function(){if(this.diagram){return this.diagram.resource}return undefined}},commandName:undefined,toolName:undefined,isCreateNodeSymbol:false,isCreateLinkSymbol:false,isDragging:false,isDragged:false},methods:{onPointerDown:function(oEvent,oSourceSymbol){this.viewer.gotFocus();if(oEvent&&!this.editor.isReadOnly){if(oEvent.preventDefault){oEvent.preventDefault()}if(oEvent.stopPropagation){oEvent.stopPropagation()}if(!isNaN(oEvent.button)&&oEvent.button!==0){return}var oTool,oCommand,oCommandParam,oBBox;if(this.toolName){oTool=sap.galilei.ui.editor.tool.getTool(this.toolName)}else{if(this.commandName){oCommand=sap.galilei.ui.common.command.getCommand(this.commandName)}}if(oCommand&&oCommand.execute){oCommandParam={source:this,editor:this.editor,diagram:this.diagram,symbol:oSourceSymbol};oCommand.getParameters(oCommandParam,true);oCommand.executeCommand(oCommandParam);if(this.contextButtonPad&&!this.popupContextButtonPad){this.contextButtonPad.hideWidget()}}else{if(oTool&&!oSourceSymbol){if(this.contextButtonPad){this.contextButtonPad.hideWidget()}this.editor.selectTool(this.toolName,false)}else{if(oTool&&oSourceSymbol){this.isDragging=true;this.isDragged=false}}}if(this.popupContextButtonPad){if(!this.popupContextButtonPad.isDrawn){if(this.contextButtonPad){this.contextButtonPad.removePopupButtonPad()}oBBox=this.getSvgBBox(true);this.popupContextButtonPad.attachToBBox=oBBox;this.popupContextButtonPad.offsetX=0;this.popupContextButtonPad.offsetY=0;this.popupContextButtonPad.createContextButtonPad();this.popupContextButtonPad.removeEventHandlers();oBBox=this.popupContextButtonPad.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0){oBBox=this.viewer.clientBBoxToViewBBox(oBBox,false,true);this.viewer.zoomToRect(oBBox.x,oBBox.y,oBBox.width,oBBox.height,true,false)}}else{if(this.popupContextButtonPad.isHidden){this.popupContextButtonPad.showWidget()}else{this.popupContextButtonPad.removeContextButtonPad()}}}}},onPointerUp:function(oEvent,oSourceSymbol){var oTool,oSymbolBBox,oClientBBox,aViewPoint,aClientPoint,oHighlighter,oLinks,index,oLinkSymbol,oCreateParams,sEventType;if(oEvent&&!this.editor.isReadOnly){if(this.isDragging){if(!this.isDragged&&this.toolName&&this.isCreateNodeSymbol){oTool=sap.galilei.ui.editor.tool.getTool(this.toolName);if(oTool){oTool.onDelayedInitialize();if(!oTool.cursorShape){if(oEvent._clientX!==undefined&&oEvent._clientY!==undefined){oTool.createCursor(oEvent._clientX,oEvent._clientY)}else{oTool.createCursor(oEvent.clientX,oEvent.clientY)}}oLinks=oSourceSymbol.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){if(oLinks[index].sourceSymbol===oSourceSymbol){if(oLinkSymbol){oLinkSymbol=undefined;break}oLinkSymbol=oLinks[index]}}}if(oLinkSymbol){aViewPoint=oLinkSymbol.getCenter();oCreateParams={point:aViewPoint,linkSymbol:oLinkSymbol,defaultPosition:true};if(!this.editor.canInsertSymbolOnLinkSymbol(oTool.symbolClass,oCreateParams)){oLinkSymbol=undefined}}if(oLinkSymbol){oSymbolBBox=new sap.galilei.ui.common.Rect(0,0,oTool.cursorWidth,oTool.cursorHeight);oSymbolBBox.setCenter(aViewPoint[0],aViewPoint[1]);oHighlighter=oTool.getOrCreateParentHighlighter();if(oHighlighter){oHighlighter._highlighted=oLinkSymbol}}else{oSymbolBBox=oSourceSymbol.getBBox().clone();oHighlighter=oTool.getOrCreateParentHighlighter();if(this.editor.orientation==="vertical"){oSymbolBBox.moveBy(0,oSymbolBBox.height/2)}else{oSymbolBBox.moveBy(oSymbolBBox.width/2,0)}if(!sap.galilei.core.isInstanceOf(oHighlighter,"sap.galilei.ui.editor.tracker.StackSymbolHighlighter")){if(this.editor.orientation==="vertical"){oSymbolBBox.moveBy(0,oTool.cursorHeight/2+50)}else{oSymbolBBox.moveBy(oTool.cursorWidth/2+50,0)}}aViewPoint=oSymbolBBox.getCenter();if(oSourceSymbol.parentSymbol){if(oHighlighter){oHighlighter._highlighted=oSourceSymbol.isBoundarySymbol?oSourceSymbol.parentSymbol.parentSymbol:oSourceSymbol.parentSymbol}}}oTool.dropBBox=oSymbolBBox;oTool.dropPoint=aViewPoint;oClientBBox=this.viewer.viewBBoxToClientBBox(oSymbolBBox);aClientPoint=oClientBBox.getCenter();sEventType=oEvent._type||oEvent.type;if(sap.galilei.ui.common.isMouseEvent(sEventType)){aClientPoint=this.viewer.clientPointToPagePoint(aClientPoint,true)}oEvent._clientX=aClientPoint[0];oEvent._clientY=aClientPoint[1];this.onDragStart(oEvent,oSourceSymbol);this.onDrag(oEvent,oSourceSymbol);this.onDragEnd(oEvent,oSourceSymbol)}}this.isDragging=false;this.isDragged=false}}},onDragStart:function(oEvent,oSourceSymbol){var aViewPoint,aClientPoint;if(oEvent&&!this.editor.isReadOnly&&this.isDragging&&this.contextButtonPad&&this.toolName&&oSourceSymbol){this.contextButtonPad.hideWidget();this.editor.selectTool(this.toolName,false);if(this.editor.tool){this.isDragged=true;if(this.isCreateNodeSymbol){this.editor.tool.isContextButton=true}else{if(this.isCreateLinkSymbol&&this.editor.tool.onPointerDown&&this.editor.tool.onDragStart){aViewPoint=oSourceSymbol.getBBox().getCenter();aClientPoint=this.viewer.viewPointToClientPoint(aViewPoint);oEvent.clientViewX=aViewPoint[0];oEvent.clientViewY=aViewPoint[1];oEvent._clientX=aClientPoint[0];oEvent._clientY=aClientPoint[1];oEvent._type="drag";this.editor.tool.isContextButton=true;oEvent.contextButtonSymbol=oSourceSymbol;this.editor.tool.onPointerDown(oEvent);this.editor.tool.onDragStart(oEvent)}}}}},onDrag:function(oEvent,oSourceSymbol){if(oEvent&&!this.editor.isReadOnly&&this.toolName&&this.isDragging&&this.contextButtonPad&&this.editor.tool&&oSourceSymbol){if(this.isCreateNodeSymbol){if(this.editor.tool.onDragOver){this.editor.tool.onDragOver(oEvent)}}else{if(this.isCreateLinkSymbol){if(this.editor.tool.onDrag){this.editor.tool.onDrag(oEvent)}}}}},onDragEnd:function(oEvent,oSourceSymbol){var self=this,oTargetSymbol,oLinkSymbolParams={},oLinkSymbol,oLinks,index,oLink,bCreateLink=(this.isCreateLinkSymbol!==undefined)?this.isCreateLinkSymbol:true,oLinkTool;function createNodeAndLinkSymbolAction(){var oLinkSymbolOwner;oTargetSymbol=self.editor.tool.onDrop(oEvent,oSourceSymbol);if(oTargetSymbol){oLinks=oTargetSymbol.getLinkSymbols();if(oLinks&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLink=oLinks[index];if((oLink.sourceSymbol===oSourceSymbol&&oLink.targetSymbol===oTargetSymbol)||(oLink.targetSymbol===oSourceSymbol&&oLink.sourceSymbol===oTargetSymbol)){bCreateLink=false;break}}}if(bCreateLink){oLinkTool=self.editor.selectLinkSymbolDefinition(oSourceSymbol,oTargetSymbol);if(oLinkTool){oLinkSymbolOwner=sap.galilei.ui.diagram.LinkSymbol.getLinkSymbolOwner(oSourceSymbol,oTargetSymbol);oLinkSymbol=self.editor.createLinkSymbolAndObject(oSourceSymbol,oTargetSymbol,oLinkTool.linkSymbolClass,oLinkSymbolParams,oLinkSymbolOwner,oLinkTool.linkObjectClass,oLinkTool.linkObjectParam,self.editor.getParentObjectByParentSymbol(oLinkSymbolOwner),oLinkTool.linkObjectReference);if(oLinkSymbol){oLinkSymbol.updateLinkRouting(oLinkSymbolParams.points!==undefined);self.editor.postCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkSymbol);self.editor.drawSymbol(oLinkSymbol)}}}}}if(oEvent&&!this.editor.isReadOnly&&this.toolName&&this.isDragging&&this.contextButtonPad&&this.editor.tool&&oSourceSymbol){if(this.isCreateNodeSymbol){if(this.editor.tool.onDrop){this.resource.applyUndoableAction(createNodeAndLinkSymbolAction,"Create Connected Symbol");this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);if(oTargetSymbol){this.editor.unselectSymbol(oSourceSymbol);if(this.editor.selectSymbolAfterCreate){this.editor.selectSymbol(oTargetSymbol)}}else{this.contextButtonPad.showWidget()}}}else{if(this.isCreateLinkSymbol){if(this.editor.tool.onDragEnd){this.editor.tool.onDragEnd(oEvent);this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);this.contextButtonPad.showWidget()}}}}this.isDragging=false}}})}());
(function(){sap.galilei.ui.editor.widget.ContextButtonPad=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.ContextButtonPad",widgetName:"ContextButtonPad",parent:sap.galilei.ui.common.widget.ButtonPad,fields:{_popupIndex:-1},properties:{buttonsOffset:{expression:"sap.galilei.ui.editor.widget.ContextButtonPad.BUTTONS_OFFSET"},editor:undefined,viewer:{field:"_viewer",get:function(){if(this._viewer){return this._viewer}if(this.editor){return this.editor.viewer}return undefined},set:function(oViewer){this._viewer=oViewer}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},symbol:undefined},methods:{getContextButtonPadLocation:function(){var oRect,oCenter;if(this.buttonsDefinition&&(this.symbol||this.attachToBBox)){if(this.attachToBBox){oRect=this.attachToBBox;if(oRect&&this.isBBoxViewCoordinates){oRect=this.viewer.viewBBoxToClientBBox(oRect)}}else{if(this.symbol&&!this.symbol.isLinkSymbol){oRect=this.symbol.getBBox();oRect=this.viewer.viewBBoxToClientBBox(oRect)}else{if(this.symbol&&this.symbol.isLinkSymbol){oRect=new sap.galilei.ui.common.Rect();oCenter=this.symbol.getCenter();if(oCenter){oRect.setCenter(oCenter[0]-8,oCenter[1])}oRect=this.viewer.viewBBoxToClientBBox(oRect)}}}if(oRect&&this.offsetX!==undefined&&this.offsetY!==undefined){oRect.moveBy(this.offsetX,this.offsetY)}}return oRect},createContextButtonPad:function(){if(this.buttonsDefinition&&(this.symbol||this.attachToBBox)){var oRect=this.getContextButtonPadLocation();if(oRect&&!this.editor.isReadOnly){if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}this.create(this.viewer,this.transitionDefinition,oRect,this.buttonsDefinition);this.addEventHandlers();if(this.viewer&&this.viewer.zoomScale<0.4){this.hide(this.viewer)}}}},createButton:function(oParam,oButtonParam){if(oParam&&oButtonParam&&(oButtonParam.toolName||oButtonParam.commandName||oButtonParam.items)){var oTool,oCommand,oCommandParam,sIcon,oContextButton;if(oButtonParam.toolName){oTool=oCommand=sap.galilei.ui.editor.tool.getTool(oButtonParam.toolName)}else{if(oButtonParam.commandName){oCommand=sap.galilei.ui.common.command.getCommand(oButtonParam.commandName)}}if((oCommand||oButtonParam.items)&&!(this.editor.isReadOnly&&!oCommand.isReadOnly)){oCommandParam={editor:this.editor,diagram:this.diagram,symbol:this.symbol};if(oCommand!==undefined){oCommand.getParameters(oCommandParam,false);if(oCommand.canExecute&&!oCommand.canExecute(oCommandParam)){return false}}oParam.toolName=oButtonParam.toolName;oParam.commandName=oButtonParam.commandName;if(oButtonParam.isCreateLinkSymbol!==undefined){oParam.isCreateLinkSymbol=oButtonParam.isCreateLinkSymbol}if(oTool){oParam.isCreateNodeSymbol=oTool.isCreateNodeSymbol;oParam.isCreateLinkSymbol=(oParam.isCreateLinkSymbol!==undefined)?oParam.isCreateLinkSymbol:oTool.isCreateLinkSymbol}if(oButtonParam.toolName){oParam.id=oButtonParam.toolName.replace(/\./g,"-")}else{if(oButtonParam.commandName){oParam.id=oButtonParam.commandName.replace(/\./g,"-")}}if(oParam.tooltip===undefined){if(oTool&&oTool.tooltip){oParam.tooltip=oTool.tooltip}else{if(oCommand&&oCommand.tooltip){oParam.tooltip=oCommand.tooltip}}}oParam.outerStroke=sap.galilei.ui.editor.widget.ContextButtonPad.OUTER_STROKE;oParam.outerStrokeWidth=sap.galilei.ui.editor.widget.ContextButtonPad.OUTER_STROKE_WIDTH;oParam.outerStrokeDashArray=sap.galilei.ui.editor.widget.ContextButtonPad.OUTER_STROKE_DASHARRAY;oParam.outerFill=sap.galilei.ui.editor.widget.ContextButtonPad.OUTER_FILL;oParam.innerFill=sap.galilei.ui.editor.widget.ContextButtonPad.INNER_FILL;oParam.isSupportHover=true;if(oParam.image===undefined){if(oCommand!==undefined&&oCommand.smallIcon!==undefined){sIcon=oCommand.smallIcon}else{if(oButtonParam.smallIcon!==undefined){sIcon=oButtonParam.smallIcon}}if(sIcon!==undefined&&sIcon.substring(0,11)!=="sap-icon://"){oParam.image=sIcon}}if(oParam.image!==undefined){if(oParam.imageWidth===undefined){if(oCommand!==undefined&&oCommand.smallIconWidth!==undefined){oParam.imageWidth=oCommand.smallIconWidth}else{if(oButtonParam.smallIconWidth!==undefined){oParam.imageWidth=oButtonParam.smallIconWidth}else{oParam.imageWidth=16}}}if(oParam.imageHeight===undefined){if(oCommand!==undefined&&oCommand.smallIconHeight!==undefined){oParam.imageHeight=oCommand.smallIconHeight}else{if(oButtonParam.smallIconHeight!==undefined){oParam.imageHeight=oButtonParam.smallIconHeight}else{oParam.imageHeight=16}}}}if(oParam.icon===undefined){if(oCommand!==undefined&&(oCommand.icon!==undefined||oCommand.smallIcon!==undefined)){sIcon=oCommand.icon||oCommand.smallIcon}else{if(oButtonParam.icon!==undefined||oButtonParam.smallIcon!==undefined){sIcon=oButtonParam.icon||oButtonParam.smallIcon}}if(sIcon!==undefined&&sIcon.substring(0,11)==="sap-icon://"){oParam.icon=sIcon}}if(oParam.icon!==undefined){if(oCommand!==undefined&&oCommand.iconShapeName!==undefined){oParam.iconShapeName=oCommand.iconShapeName}else{if(oButtonParam.iconShapeName!==undefined){oParam.iconShapeName=oButtonParam.iconShapeName}}if(oCommand!==undefined&&oCommand.smallIconWidth!==undefined){oParam.iconSize=oCommand.smallIconWidth}else{if(oButtonParam.smallIconWidth!==undefined){oParam.iconSize=oButtonParam.smallIconWidth}}if(oCommand!==undefined&&oCommand.iconColor){oParam.textColor=oCommand.iconColor}else{if(oButtonParam.iconColor!==undefined){oParam.textColor=oButtonParam.iconColor}else{oParam.textColor=sap.galilei.ui.editor.widget.ContextButtonPad.ICON_COLOR}}if(oCommand!==undefined&&oCommand.iconClass){oParam.iconClass=oCommand.iconClass}else{if(oButtonParam.iconClass!==undefined){oParam.iconClass=oButtonParam.iconClass}}}if(oParam.text===undefined){if(oCommand!==undefined&&oCommand.displayName){oParam.text=oCommand.displayName}else{if(oButtonParam.displayName!==undefined){oParam.text=oButtonParam.displayName}}}if(oParam.text!==undefined){if(oCommand!==undefined&&oCommand.textColor){oParam.textColor=oCommand.textColor}else{if(oButtonParam.textColor!==undefined){oParam.textColor=oButtonParam.textColor}else{oParam.textColor=sap.galilei.ui.editor.widget.ContextButtonPad.TEXT_COLOR}}if(oCommand!==undefined&&oCommand.textClass){oParam.textClass=oCommand.textClass}else{if(oButtonParam.textClass!==undefined){oParam.textClass=oButtonParam.textClass}}oParam.font=sap.galilei.ui.editor.widget.ContextButtonPad.TEXT_FONT}if(oCommand!==undefined&&oCommand.opacity!==undefined){oParam.opacityOut=oCommand.opacity}else{if(oButtonParam.opacity!==undefined){oParam.opacityOut=oButtonParam.opacity}}if(oButtonParam.items){oContextButton=new sap.galilei.ui.editor.widget.ContextButton(oParam);if(oCommand===undefined){oParam.buttonsDefinition=oParam.items}oContextButton.popupContextButtonPad=new sap.galilei.ui.editor.widget.ContextButtonPad({editor:this.editor,symbol:this.symbol,buttonsDefinition:oParam.buttonsDefinition})}else{oContextButton=new sap.galilei.ui.editor.widget.ContextButton(oParam)}oContextButton.contextButtonPad=this;oContextButton.on(sap.galilei.ui.common.PointerEvents.pointerdown,oContextButton.onPointerDown,oContextButton,this.symbol);oContextButton.on(sap.galilei.ui.common.PointerEvents.pointerup,oContextButton.onPointerUp,oContextButton,this.symbol);if(oContextButton.isCreateNodeSymbol||oContextButton.isCreateLinkSymbol){oContextButton.on(sap.galilei.ui.common.GestureEvents.dragstart,oContextButton.onDragStart,oContextButton,this.symbol);oContextButton.on(sap.galilei.ui.common.GestureEvents.drag,oContextButton.onDrag,oContextButton,this.symbol);oContextButton.on(sap.galilei.ui.common.GestureEvents.dragend,oContextButton.onDragEnd,oContextButton,this.symbol)}return oContextButton}}return undefined},getButtons:function(){var aButtons=[];if(this.shapes.length>0){aButtons=this.shapes[0].shapes}return aButtons},addEventHandlers:function(){sap.galilei.core.Event.subscribe("symbol.unselected",this.onUnselectSymbol,this);sap.galilei.core.Event.subscribe("symbols.selection.changed",this.onSelectionChanged,this);sap.galilei.core.Event.subscribe("move.symbol.dragstart",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbols.dragstart",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbols.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbols.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("delete.symbol",this.onDeleteSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.handle.dragstart",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.pinch",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("viewer.zoompan.before",this.onBeforeZoomPan,this);sap.galilei.core.Event.subscribe("viewer.zoompan.after",this.onAfterZoomPan,this);sap.galilei.core.Event.subscribe("linksymbol.handle.dragstart",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("layout.linksymbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("layout.linksymbol.after",this.onAfterMoveResizeSymbol,this)},removeEventHandlers:function(){sap.galilei.core.Event.unSubscribeScope("symbol.unselected",this);sap.galilei.core.Event.unSubscribeScope("symbols.selection.changed",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbols.after",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.pinch",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.before",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.after",this);sap.galilei.core.Event.unSubscribeScope("linksymbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("layout.linksymbol.before",this);sap.galilei.core.Event.unSubscribeScope("layout.linksymbol.after",this)},removeContextButtonPad:function(){this.removePopupButtonPad();this.disposeWidget();this._popupIndex=-1;this.opacity=1;if(this._oldOpacity){delete this._oldOpacity}},removePopupButtonPad:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad){oButton.popupContextButtonPad.removeContextButtonPad()}}},getPopupButtonPadIndex:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad&&oButton.popupContextButtonPad.isDrawn){return index}}return -1},updateContextButtonPad:function(){var nPopupIndex,oButton;nPopupIndex=this._popupIndex;this.removeContextButtonPad();this.isVisible=true;this.createContextButtonPad();if(nPopupIndex!==-1){oButton=this.getPopupContextButtonPad(nPopupIndex);if(oButton&&oButton.onPointerDown){oButton.onPointerDown({},this.symbol);this._popupIndex=nPopupIndex}}},getPopupContextButtonPad:function(nPopupIndex){var aButtons,oButton;if(nPopupIndex===undefined){nPopupIndex=this._popupIndex}if(nPopupIndex!==-1){aButtons=this.getButtons();if(nPopupIndex<aButtons.length){oButton=aButtons[nPopupIndex]}}return oButton},showWidget:function(){this.show(this.viewer,this.transitionDefinition);this.showPopupButtonPad()},hideWidget:function(){this._popupIndex=this.getPopupButtonPadIndex();this.hide(this.viewer,this.transitionDefinition);this.hidePopupButtonPad()},showButtonPad:function(){this.updateContextButtonPad()},hideButtonPad:function(){this.hideWidget()},showPopupButtonPad:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad){oButton.popupContextButtonPad.show(this.viewer,this.transitionDefinition)}}},hidePopupButtonPad:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad){oButton.popupContextButtonPad.hide(this.viewer,this.transitionDefinition)}}},onUnselectSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.dispose()}},onSelectionChanged:function(oEvent){if(oEvent&&this.symbol&&oEvent.selectedSymbols&&oEvent.selectedSymbols.length>1){this.dispose()}},onBeforeMoveResizeSymbol:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.hideButtonPad()}},onAfterMoveResizeSymbol:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.showButtonPad()}},onDeleteSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.dispose()}},onBeforeZoomPan:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.hideButtonPad()}},onAfterZoomPan:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol)||(oEvent.selectedSymbols&&oEvent.selectedSymbols.indexOf(this.symbol)!==-1))){this.showButtonPad()}},dispose:function(){this.removeContextButtonPad();if(this.symbol){delete this.symbol._contextButtonPad}}},statics:{BUTTONS_OFFSET:0,OUTER_STROKE:undefined,OUTER_STROKE_WIDTH:1,OUTER_STROKE_DASHARRAY:undefined,OUTER_FILL:"#D8D8D8",INNER_FILL:"#444444",TEXT_FONT:undefined,TEXT_COLOR:"white",ICON_COLOR:"white"}})}());
(function(){sap.galilei.ui.editor.widget.InPlaceEditControl=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.InPlaceEditControl",parent:sap.galilei.ui.editor.widget.Widget,widgetName:"InPlaceEditControl",initialize:function(oParam){if(oParam){this.set(oParam)}this.isHideOnUnselect=true;this.getTextBingings()},properties:{controlAdapterName:"sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter",controlAdapter:undefined,bindings:undefined,bindingIndex:0},methods:{getOrCreateControlAdapter:function(){var InPlaceEditControlAdapterClass;if(!this.controlAdapter){if(this.controlAdapterName){InPlaceEditControlAdapterClass=sap.galilei.core.getClass(this.controlAdapterName);if(!InPlaceEditControlAdapterClass){InPlaceEditControlAdapterClass=sap.galilei.core.getClass("sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter")}if(InPlaceEditControlAdapterClass){this.controlAdapter=new InPlaceEditControlAdapterClass({editor:this.editor,viewer:this.viewer,symbol:this.symbol,bindings:this.bindings,bindingIndex:this.bindingIndex})}}}return this.controlAdapter},getTextBingings:function(){var self=this,aBindings=[];function getBindings(oShape){var sProperty,oBinding,oInfo,oFeature,oConstraint;if(oShape&&oShape.name==="Text"&&oShape.enableInPlaceEditing&&oShape.isDrawn&&oShape.bindings){for(sProperty in oShape.bindings){if(sProperty==="text"){oBinding=oShape.bindings[sProperty];oInfo=oBinding.getObjectAndPropertyName();oInfo=self.editor.getEditablePropertyInfo(self.symbol,oInfo);if(oInfo&&oInfo.object&&oInfo.propertyName){if(oInfo.object.classDefinition){oFeature=oInfo.object.classDefinition.getFeature(oInfo.propertyName);if(oFeature&&oFeature.isUIEditable===false){continue}oConstraint=oFeature&&oFeature.constraint;if(oConstraint&&(oConstraint.isReadonly instanceof Function)&&oConstraint.isReadonly(oInfo.object)){continue}}aBindings.push(oBinding)}}}}oShape.shapes.forEach(function(oSubshape){getBindings(oSubshape)})}if(this.symbol&&this.editor){getBindings(this.symbol.shape)}this.bindings=aBindings},getFieldIndex:function(aClientPoint){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){return oControlAdapter.getFieldIndex(aClientPoint)}return -1},moveToField:function(nIndex){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){if(nIndex===undefined){nIndex=0}else{if(nIndex===-1){if(this.bindings){nIndex=this.bindings.length-1}}}return oControlAdapter.moveToField(nIndex)}},createControl:function(){return this.createControlAt()},createControlAt:function(aClientPoint){var oControlAdapter=this.getOrCreateControlAdapter(),bSuccess=false;if(oControlAdapter){bSuccess=this._createControl(oControlAdapter.createControlAt,oControlAdapter,aClientPoint)}return bSuccess},showWidget:function(){this.showWidgetAt()},showWidgetAt:function(aClientPoint){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){this._showWidget(oControlAdapter.showControlAt,oControlAdapter,aClientPoint)}},_showWidget:function(fnShow,oControlAdapter,aClientPoint){var self=this;if(!oControlAdapter){oControlAdapter=this.getOrCreateControlAdapter()}if(oControlAdapter&&this.viewer&&this.symbol){oControlAdapter.updatePosition();if(fnShow){fnShow.call(oControlAdapter,aClientPoint)}if(this._idTimer){clearTimeout(this._idTimer);this._idTimer=undefined}this._idTimer=setTimeout(function(){oControlAdapter.updatePosition();self._idTimer=undefined},200)}},hideWidget:function(){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){oControlAdapter.hideControl()}},_createControl:function(fnCreate,oControlAdapter,aClientPoint){var bSuccess=false;if(!oControlAdapter){oControlAdapter=this.getOrCreateControlAdapter()}if(this.bindings&&this.bindings.length>0&&oControlAdapter&&this.viewer&&this.symbol){if(fnCreate){bSuccess=fnCreate.call(oControlAdapter,aClientPoint)}if(bSuccess){this.removeEventHandlers();this.addEventHandlers()}}return bSuccess},removeWidget:function(){this.removeEventHandlers();this.hideWidget();var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){oControlAdapter.removeControl()}},dispose:function(){this.removeWidget()}}})}());
(function(){sap.galilei.ui.editor.widget.InPlaceEditControlAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.widget.InPlaceEditControlAdapter",properties:{editor:undefined,viewer:undefined,symbol:undefined,bindings:undefined,bindingIndex:0,isChangingField:false,control:undefined,isMultiLine:false},methods:{createControl:function(){return this.createControlAt()},createControlAt:function(aClientPoint){},updateControl:function(){},getBinding:function(){if(this.bindings&&this.bindings.length>0&&this.bindingIndex>=0&&this.bindingIndex<this.bindings.length){return this.bindings[this.bindingIndex]}return undefined},getPropertyMetadata:function(oInfo){if(oInfo&&oInfo.object&&oInfo.object.classDefinition&&oInfo.propertyName){return oInfo.object.classDefinition.getProperty(oInfo.propertyName)}return undefined},getFieldBBox:function(){var oBinding=this.getBinding(),oBBox,oTextBBox,x,y,width,height,aCenter;if(oBinding&&oBinding.shape&&this.viewer){oBBox=oBinding.shape.getBBox().clone();if(this.symbol&&this.symbol.x!==undefined&&this.symbol.y!==undefined){oBBox.moveBy(this.symbol.x,this.symbol.y)}oBBox=this.viewer.viewBBoxToPageBBox(oBBox,false,true,true,true);x=oBBox.x;y=oBBox.y;if(oBBox.width+10<oBBox.height){width=oBBox.height;height=oBBox.width}else{width=oBBox.width;height=oBBox.height}width-=4;height-=4;if(oBinding.shape.text&&width<oBinding.shape.text.length*8){width=oBinding.shape.text.length*8}if(width>400){width=400}else{if(width<100){width=100}}if(this.isMultiLine){if(height>100){height=100}else{if(height<16){height=16}}}else{height=16}oTextBBox=new sap.galilei.ui.common.Rect(x,y,width,height);aCenter=oBBox.getCenter();oTextBBox.setCenter(aCenter[0]-2,aCenter[1]-2);return oTextBBox}return oBBox},getFieldIndex:function(aClientPoint){if(this.bindings&&this.bindings.length>0){var index,oBinding,oBBox;for(index=0;index<this.bindings.length;index++){oBinding=this.bindings[index];oBBox=oBinding.shape.getBBox().clone();if(this.symbol&&this.symbol.x!==undefined&&this.symbol.y!==undefined){oBBox.moveBy(this.symbol.x,this.symbol.y)}oBBox=this.viewer.viewBBoxToClientBBox(oBBox,false,true);if(oBBox.isPointInRect(aClientPoint)){return index}}}return -1},defaultMoveToField:function(nIndex){if(nIndex===undefined){nIndex=0}else{if(nIndex===-1){if(this.bindings){nIndex=this.bindings.length-1}}}if(this.bindings&&this.bindings.length>0&&nIndex!==this.bindingIndex){this.isChangingField=true;this.savePropertyValue();this.bindingIndex=nIndex;this.updateControl();this.isChangingField=false}},moveToField:function(nIndex){this.defaultMoveToField(nIndex)},moveToNextField:function(){var nNewIndex;if(this.control&&this.bindings&&this.bindings.length>0){if(this.bindingIndex<this.bindings.length-1){nNewIndex=this.bindingIndex+1}else{if(sap.galilei.model.isInstanceOf(this.symbol,"sap.galilei.ui.diagram.RowSymbol")){this.moveToNextRowSymbol();return}else{if(sap.galilei.model.isInstanceOf(this.symbol,"sap.galilei.ui.diagram.TableSymbol")){this.moveToRowSymbol(this.symbol,0);return}}nNewIndex=0}this.moveToField(nNewIndex)}},moveToPreviousField:function(){var nNewIndex;if(this.control&&this.bindings&&this.bindings.length>0){if(this.bindingIndex>0){nNewIndex=this.bindingIndex-1}else{if(sap.galilei.model.isInstanceOf(this.symbol,"sap.galilei.ui.diagram.RowSymbol")){this.moveToPreviousRowSymbol();return}else{if(sap.galilei.model.isInstanceOf(this.symbol,"sap.galilei.ui.diagram.TableSymbol")){this.moveToRowSymbol(this.symbol,-1,-1);return}}nNewIndex=this.bindings.length-1}this.moveToField(nNewIndex)}},moveToNextRowSymbol:function(){var oParentSymbol,aRowSymbols,nCount,index;if(this.editor&&sap.galilei.model.isInstanceOf(this.symbol,"sap.galilei.ui.diagram.RowSymbol")){oParentSymbol=this.symbol.parentSymbol;aRowSymbols=oParentSymbol.symbols;nCount=aRowSymbols.length;index=aRowSymbols.indexOf(this.symbol);if(index+1<nCount){index++;this.moveToRowSymbol(oParentSymbol,index)}else{if(!this.addRowSymbol(oParentSymbol)){this.moveToSymbol(oParentSymbol)}}}},moveToPreviousRowSymbol:function(){var oParentSymbol,aRowSymbols,index;if(this.editor&&sap.galilei.model.isInstanceOf(this.symbol,"sap.galilei.ui.diagram.RowSymbol")){oParentSymbol=this.symbol.parentSymbol;aRowSymbols=oParentSymbol.symbols;index=aRowSymbols.indexOf(this.symbol);if(index>0){index--;this.moveToRowSymbol(oParentSymbol,index,-1)}else{this.moveToSymbol(oParentSymbol)}}},moveToRowSymbol:function(oTableSymbol,nSymbolIndex,nFieldIndex){var aRowSymbols,nCount,oNextSymbol;if(oTableSymbol&&!isNaN(nSymbolIndex)&&sap.galilei.model.isInstanceOf(oTableSymbol,"sap.galilei.ui.diagram.TableSymbol")){aRowSymbols=oTableSymbol.symbols;nCount=aRowSymbols.length;if(nSymbolIndex===-1){nSymbolIndex=nCount-1}if(nSymbolIndex>=0&&nSymbolIndex<nCount){oNextSymbol=aRowSymbols.get(nSymbolIndex);this.moveToSymbol(oNextSymbol,nFieldIndex)}else{if(nCount===0){this.addRowSymbol(oTableSymbol)}}}},moveToSymbol:function(oNewSymbol,nFieldIndex){var self=this;if(this.editor&&oNewSymbol&&oNewSymbol!==this.symbol){if(this.symbol){this.editor.unselectSymbol(this.symbol,true,undefined,false)}setTimeout(function(){self.editor.selectSymbol(oNewSymbol,true,undefined,true,false,true);self.editor.enterInPlaceEditing(oNewSymbol,undefined,nFieldIndex)},100)}},addRowSymbol:function(oTableSymbol){if(this.editor&&(this.editor.extension.onAddRowSymbol instanceof Function)&&oTableSymbol){this.editor.removeSymbolInPlaceEditControl(oTableSymbol);return this.editor.extension.onAddRowSymbol(oTableSymbol,true)}return false},updatePosition:function(){},addEventHandlers:function(){if(this.control){this.control.on("keydown",jQuery.proxy(this.onKeyDown,this));this.control.on("focus",jQuery.proxy(this.onFocus,this));this.control.on("focusout",jQuery.proxy(this.onFocusOut,this))}},removeEventHandlers:function(){if(this.control){this.control.off("keydown");this.control.off("focus");this.control.off("focusout")}},onFocus:function(){},onFocusOut:function(oKeyEvent){var self=this;if(this.control){this.savePropertyValue();setTimeout(function(){self.hideControl()},500)}},onKeyDown:function(oKeyEvent){var bProcessed=false,bClose=false;if(this.control&&oKeyEvent){switch(oKeyEvent.keyCode){case 13:this.savePropertyValue();bClose=true;break;case 27:bProcessed=true;bClose=true;this.control.isCancelled=true;break;case 9:if(oKeyEvent.shiftKey){this.moveToPreviousField()}else{this.moveToNextField()}bProcessed=true;break}if(bProcessed){oKeyEvent.preventDefault();oKeyEvent.stopImmediatePropagation()}if(bClose){this.removeControl()}}},setFocus:function(){if(this.control&&this.control.focus){this.control.focus()}},getEditablePropertyInfo:function(oInfo){var oEditableInfo=oInfo;if(oInfo&&this.editor){oEditableInfo=this.editor.getEditablePropertyInfo(this.symbol,oInfo)}return oEditableInfo},getPropertyValue:function(){var oBinding=this.getBinding(),oInfo,vValue;if(oBinding){oInfo=oBinding.getObjectAndPropertyName();oInfo=this.getEditablePropertyInfo(oInfo);if(oInfo&&oInfo.object&&oInfo.propertyName){if(oInfo.object.getFormattedValue){vValue=oInfo.object.getFormattedValue(oInfo.propertyName)}else{vValue=oInfo.object[oInfo.propertyName]}}else{vValue=oBinding.getObjectProperty()}}return vValue},setPropertyValue:function(vValue){var oBinding=this.getBinding(),oInfo;if(oBinding){oInfo=oBinding.getObjectAndPropertyName();oInfo=this.getEditablePropertyInfo(oInfo);if(oInfo&&oInfo.object&&oInfo.propertyName){if(oInfo.object.coerceValue){vValue=oInfo.object.coerceValue(oInfo.propertyName,vValue)}oInfo.object[oInfo.propertyName]=vValue}else{oBinding.setObjectProperty(vValue)}}},savePropertyValue:function(){},showControl:function(){},showControlAt:function(aClientPoint){},hideControl:function(){},removeControl:function(){}}});sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter",parent:sap.galilei.ui.editor.widget.InPlaceEditControlAdapter,methods:{createControlAt:function(aClientPoint){var oParentNode;if(!this.control&&this.viewer&&this.viewer.parentNode){oParentNode=document&&document.body;if(!oParentNode){oParentNode=this.viewer.parentNode}if(oParentNode){if(this.isMultiLine){jQuery(oParentNode).append('<textarea id="'+this.getEditControlId()+'" wrap="soft" spellcheck="true"/>')}else{jQuery(oParentNode).append('<input type="text" id="'+this.getEditControlId()+'" spellcheck="true"/>')}}this.control=jQuery("#"+this.getEditControlId());this.addEventHandlers()}if(this.control){this.control.isCancelled=false;this.updateControl()}return this.control!==undefined},getEditControlId:function(){if(this.isMultiLine){return"inPlaceEditControlTextArea"}else{return"inPlaceEditControlInput"}},setupControl:function(){},updateControl:function(){var oBinding=this.getBinding(),oInfo,oProperty;if(this.control){this.updatePosition();if(oBinding){oInfo=oBinding.getObjectAndPropertyName();oInfo=this.getEditablePropertyInfo(oInfo);if(oInfo){oProperty=this.getPropertyMetadata(oInfo);this.control.attr("placeholder",oProperty?oProperty.displayName:oInfo.propertyName)}this.control.val(this.getPropertyValue())}this.setFocus()}},onFocus:function(oKeyEvent){if(this.control){this.control.select()}},savePropertyValue:function(){if(this.control){this.setPropertyValue(this.control.val())}},updatePosition:function(){if(this.control&&this.viewer){var oBBox=this.getFieldBBox();if(oBBox){this.control.css("position","absolute").css("left",Math.ceil(oBBox.x)+"px").css("top",Math.ceil(oBBox.y)+"px").css("width",Math.floor(oBBox.width)+"px").css("height",Math.floor(oBBox.height)+"px").css("overflow","hidden")}}},showControl:function(){if(this.control&&this.viewer){var nScale=this.viewer.zoomScale;if(nScale>=0.5){this.control.fadeIn(200);this.control.focus()}}},hideControl:function(){if(this.control){this.control.fadeOut(100)}},removeControl:function(){if(this.control){this.removeEventHandlers();this.control.remove();this.control=undefined}}}})}());
(function(){sap.galilei.ui.editor.widget.TooltipControl=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.TooltipControl",parent:sap.galilei.ui.editor.widget.Widget,widgetName:"TooltipControl",properties:{controlAdapterName:"sap.galilei.ui.editor.widget.HtmlTooltipControlAdapter",controlAdapter:undefined,tooltip:undefined},methods:{getOrCreateControlAdapter:function(){var TooltipControlAdapterClass;if(!this.controlAdapter){if(this.controlAdapterName){TooltipControlAdapterClass=sap.galilei.core.getClass(this.controlAdapterName);if(!TooltipControlAdapterClass){TooltipControlAdapterClass=sap.galilei.core.getClass("sap.galilei.ui.editor.widget.HtmlTooltipControlAdapter")}if(TooltipControlAdapterClass){this.controlAdapter=new TooltipControlAdapterClass({editor:this.editor,viewer:this.viewer,symbol:this.symbol,tooltip:this.tooltip})}}}return this.controlAdapter},createControl:function(){return this.createControlAt()},createControlAt:function(aClientPoint){var oControlAdapter=this.getOrCreateControlAdapter(),bSuccess=false;if(oControlAdapter){bSuccess=this._createControl(oControlAdapter.createControlAt,oControlAdapter,aClientPoint)}return bSuccess},showWidget:function(){this.showWidgetAt()},showWidgetAt:function(aClientPoint){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){this._showWidget(oControlAdapter.showControlAt,oControlAdapter,aClientPoint)}},_showWidget:function(fnShow,oControlAdapter,aClientPoint){if(!oControlAdapter){oControlAdapter=this.getOrCreateControlAdapter()}if(oControlAdapter&&this.viewer&&this.symbol){oControlAdapter.updatePosition(aClientPoint);if(fnShow){fnShow.call(oControlAdapter,aClientPoint)}}},hideWidget:function(){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){oControlAdapter.hideControl()}},_createControl:function(fnCreate,oControlAdapter,aClientPoint){var bSuccess=false;if(!oControlAdapter){oControlAdapter=this.getOrCreateControlAdapter()}if(oControlAdapter&&this.viewer&&this.symbol){if(fnCreate){bSuccess=fnCreate.call(oControlAdapter,aClientPoint)}if(bSuccess){this.removeEventHandlers();this.addEventHandlers()}}return bSuccess},removeWidget:function(){this.removeEventHandlers();this.hideWidget();var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){oControlAdapter.removeControl()}},dispose:function(){this.removeWidget()}}})}());
(function(){sap.galilei.ui.editor.widget.TooltipControlAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.widget.TooltipControlAdapter",properties:{editor:undefined,viewer:undefined,symbol:undefined,tooltip:undefined,control:undefined},methods:{createControl:function(){return this.createControlAt()},createControlAt:function(aClientPoint){},updateControl:function(aClientPoint){},showControl:function(){},showControlAt:function(aClientPoint){},hideControl:function(){},removeControl:function(){}}});sap.galilei.ui.editor.widget.HtmlTooltipControlAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.widget.HtmlTooltipControlAdapter",parent:sap.galilei.ui.editor.widget.TooltipControlAdapter,methods:{createControlAt:function(aClientPoint){var oParentNode,oNode,sTooltip=this.tooltip;if(!this.control&&this.viewer&&this.viewer.parentNode&&sTooltip){oParentNode=document&&document.body;if(!oParentNode){oParentNode=this.viewer.parentNode}if(oParentNode){jQuery(oParentNode).append('<div id="'+this.getControlId()+'" class="sapGalileiTooltip"><div><span id="sapGalileiTooltipSpan">'+sTooltip+"</span><div>")}this.control=jQuery("#"+this.getControlId())}if(this.control){this.updateControl(aClientPoint)}return this.control!==undefined},getControlId:function(){return"sapGalileiTooltipControl"},getSpanId:function(){return"sapGalileiTooltipSpan"},updateControl:function(aClientPoint){var oSpan;if(this.control){this.control.css("background-color","white").css("min-width","60px").css("padding","3px").css("border","1px solid #C0C0C0").css("box-shadow","2px 2px 4px #888888").css("font-size","12px").css("font-weight","500");oSpan=oSpan=jQuery("#"+this.getSpanId());if(oSpan){oSpan.css("display","block").css("text-align","center").css("color","#3F3F3F")}this.updatePosition(aClientPoint)}},updatePosition:function(aClientPoint){if(this.control&&this.viewer&&this.symbol){var oBBox=this.symbol.getBBox(),x,y,oSize,sTooltip=this.tooltip;if(oBBox){oBBox=this.viewer.viewBBoxToPageBBox(oBBox,false,true,true,true);x=(oBBox.left+oBBox.right)/2;y=oBBox.bottom;oSize=sap.galilei.ui.common.Text.measureTextSize(sTooltip);oBBox.width=oSize.width;oBBox.height=oSize.height;if(aClientPoint){oBBox.x=aClientPoint[0]+8}else{oBBox.x=x-oBBox.width/2}oBBox.y=y+8;this.control.css("position","absolute").css("left",Math.ceil(oBBox.x)+"px").css("top",Math.ceil(oBBox.y)+"px")}}},showControl:function(){if(this.control&&this.viewer){var nScale=this.viewer.zoomScale;if(nScale>=0.5){this.control.fadeIn(200)}}},hideControl:function(){if(this.control){this.control.fadeOut(100)}},removeControl:function(){if(this.control){this.control.remove();this.control=undefined}}}})}());
(function(){sap.galilei.ui.editor.widget.WidgetGroup=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.WidgetGroup",parent:sap.galilei.ui.editor.widget.Widget,widgetName:"WidgetGroup",properties:{widgets:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.widget.Widget",writable:false},orientation:sap.galilei.ui.common.Orientation.horizontal,innerPadding:2},methods:{addWidget:function(oWidget){this.insertWidget(-1,oWidget)},insertWidget:function(index,oWidget){if(oWidget&&this.widgets.indexOf(oWidget)===-1){if(index===undefined||index<0||index>=this.widgets.length){index=-1}this.widgets.insert(index,oWidget);oWidget._parentWidget=this;oWidget.symbol=this.symbol;this.layoutWidgets()}},removeWidget:function(oWidget){var index;if(oWidget&&this.widgets.length>0){index=this.widgets.indexOf(oWidget);if(index!==-1){this.removeWidgetAt(index)}}},removeWidgetAt:function(index){var oWidget;if(index>=0&&index<this.widgets.length){oWidget=this.widgets[index];this.widgets.removeAt(index);oWidget.dispose();this.layoutWidgets()}},getWidgetById:function(sId){var index,oWidget;for(index=0;index<this.widgets.length;index++){oWidget=this.widgets[index];if(oWidget.id==sId){return oWidget}}return undefined},layoutWidgetGroup:function(){var index,oWidget,x0=0,y0=0,nInnerPadding=this.innerPadding;nInnerPadding=+nInnerPadding;if(isNaN(nInnerPadding)){nInnerPadding=0}for(index=0;index<this.widgets.length;index++){oWidget=this.widgets[index];if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){oWidget.offsetX=x0;x0+=oWidget.width+nInnerPadding}else{oWidget.offsetY=y0;y0+=oWidget.height+nInnerPadding}}},layoutWidgets:function(){this.layoutWidgetGroup()},getBBox:function(){var index,oWidget,oRect,oBBox,aPt;for(index=0;index<this.widgets.length;index++){oWidget=this.widgets[index];oRect=oWidget.getBBox();if(!oBBox){oBBox=oRect}else{oBBox.unionRect(oRect)}}if(oBBox){if(this.symbol&&!this.symbol.isLinkSymbol){oBBox.x=0;oBBox.y=0;if(this.alignPosition&&this.attachPosition){aPt=oBBox.getPoint(this.alignPosition);switch(this.alignPosition){case sap.galilei.ui.common.DockPosition.topLeft:oBBox.y-=oBBox.height;break;case sap.galilei.ui.common.DockPosition.top:oBBox.y-=oBBox.height;break;case sap.galilei.ui.common.DockPosition.topRight:oBBox.y-=oBBox.height;break;case sap.galilei.ui.common.DockPosition.bottomRight:oBBox.y-=aPt[1];break;case sap.galilei.ui.common.DockPosition.bottom:oBBox.y-=aPt[1];break;case sap.galilei.ui.common.DockPosition.bottomLeft:oBBox.y-=aPt[1];if(this.attachPosition===sap.galilei.ui.common.DockPosition.top){oBBox.x+=oBBox.width/2}break;case sap.galilei.ui.common.DockPosition.left:oBBox.y-=oBBox.height;break;case sap.galilei.ui.common.DockPosition.right:oBBox.y-=oBBox.height;break}}oBBox.x+=this.symbol.x;oBBox.y+=this.symbol.y}if(this._group&&this._group.isEnableTranslate&&!isNaN(this._group.x)&&!isNaN(this._group.y)){oBBox.x+=this._group.x;oBBox.y+=this._group.y}}return oBBox},updatePosition:function(updateDrawing){var index,oWidget;this.layoutWidgets();for(index=0;index<this.widgets.length;index++){oWidget=this.widgets[index];oWidget.updatePosition(updateDrawing)}this.defaultUpdatePosition(updateDrawing)},drawWidgetGroup:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var index,oWidget;oViewer=oViewer||this.viewer;if(!oViewer){return}this.isDisableDrawing=true;if(this._group){this.removeSubShape(this._group);this._group.dispose()}this._group=new sap.galilei.ui.common.shape.Group({id:"widgetGroup",x:0,y:0});this._group.isEnableTranslate=true;this.addSubShape(this._group);this.updatePosition(false);this.drawWidget(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector);for(index=0;index<this.widgets.length;index++){oWidget=this.widgets[index];oWidget.draw(oViewer,this._group.d3Node,oTransitionDef);oWidget.parentShape=this._group}this.isDisableDrawing=false},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){this.drawWidgetGroup(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var index,oWidget;if(this.isDisableDrawing){return}oViewer=oViewer||this.viewer;if(!oViewer){return}this.updatePosition(false);this.updateDrawingGroup(oViewer,oTransitionDef,aAttributes);for(index=0;index<this.widgets.length;index++){oWidget=this.widgets[index];if(!oWidget.isDrawn){oWidget.draw(oViewer,this._group&&this._group.d3Node,oTransitionDef)}else{oWidget.updateDrawing(oViewer,oTransitionDef,aAttributes)}}}},statics:{createDecoratorWidget:function(oEditor,oSymbol,oDecorator){var oWidgetParam,oDecoratorWidget;if(oSymbol&&oDecorator){oWidgetParam={id:oDecorator.id};if(oDecorator.shapeTemplate){oWidgetParam.shapeTemplate=oDecorator.shapeTemplate}else{if(oDecorator.shape){oWidgetParam.shape=oDecorator.shape}}oDecoratorWidget=new sap.galilei.ui.editor.widget.Widget(oWidgetParam);oDecoratorWidget.objectContext=oSymbol;if(oDecorator.events){oDecoratorWidget.onEvents(oDecorator.events,undefined,oSymbol,oEditor&&oEditor.extension)}}return oDecoratorWidget},createOrUpdateDecoratorWidgets:function(oEditor,oSymbol,oDecoratorGroupWidget,oDecoratorGroup){var index,oDecoratorDef,oDecoratorWidget;if(oSymbol&&oDecoratorGroup&&oDecoratorGroupWidget){if(oDecoratorGroup.decorators){for(index=0;index<oDecoratorGroup.decorators.length;index++){oDecoratorDef=oDecoratorGroup.decorators[index];oDecoratorWidget=oDecoratorGroupWidget.getWidgetById(oDecoratorDef.id);if(!oDecoratorWidget){oDecoratorWidget=sap.galilei.ui.editor.widget.WidgetGroup.createDecoratorWidget(oEditor,oSymbol,oDecoratorDef);if(oDecoratorWidget){oDecoratorGroupWidget.addWidget(oDecoratorWidget)}}else{}}}}},createDecoratorWidgetGroup:function(oEditor,oSymbol,sGroupId,oDecoratorGroup){var oDecoratorWidget;if(oSymbol&&sGroupId&&oDecoratorGroup){oDecoratorWidget=new sap.galilei.ui.editor.widget.WidgetGroup({symbol:oSymbol,orientation:oDecoratorGroup.orientation,attachPosition:sGroupId,alignPosition:oDecoratorGroup.alignPosition,offsetX:oDecoratorGroup.offsetX,offsetY:oDecoratorGroup.offsetY,editor:oEditor})}return oDecoratorWidget},createOrUpdateDecoratorWidgetGroups:function(oEditor,oSymbol){var oDecoratorGroup,sGroupId,oDecoratorGroupWidget,index,oDecoratorWidget;if(oSymbol&&oSymbol.decoratorGroups&&oSymbol.decoratorGroups.decoratorGroups){for(sGroupId in oSymbol.decoratorGroups.decoratorGroups){if(oSymbol.decoratorGroups.decoratorGroups.hasOwnProperty(sGroupId)){oDecoratorGroup=oSymbol.decoratorGroups.decoratorGroups[sGroupId];if(!oSymbol._decoratorWidgetGroups){oSymbol._decoratorWidgetGroups={}}else{oDecoratorGroupWidget=oSymbol._decoratorWidgetGroups[sGroupId]}if(!oDecoratorGroupWidget){oDecoratorGroupWidget=sap.galilei.ui.editor.widget.WidgetGroup.createDecoratorWidgetGroup(oEditor,oSymbol,sGroupId,oDecoratorGroup);if(oDecoratorGroupWidget){oSymbol._decoratorWidgetGroups[sGroupId]=oDecoratorGroupWidget}}if(oDecoratorGroupWidget){sap.galilei.ui.editor.widget.WidgetGroup.createOrUpdateDecoratorWidgets(oEditor,oSymbol,oDecoratorGroupWidget,oDecoratorGroup)}}}}if(oSymbol&&oSymbol._decoratorWidgetGroups){for(sGroupId in oSymbol._decoratorWidgetGroups){if(oSymbol._decoratorWidgetGroups.hasOwnProperty(sGroupId)){oDecoratorGroupWidget=oSymbol._decoratorWidgetGroups[sGroupId];for(index=oDecoratorGroupWidget.widgets.length-1;index>=0;index--){oDecoratorWidget=oDecoratorGroupWidget.widgets[index];if(!oSymbol.getDecorator(oDecoratorWidget.id)){oDecoratorGroupWidget.removeWidget(oDecoratorWidget)}}if(oDecoratorGroupWidget.widgets.length===0){}}}}},showDecorators:function(oEditor,oSymbol,oTransition){var sGroupId,oDecorarorWidgetGroup;sap.galilei.ui.editor.widget.WidgetGroup.createOrUpdateDecoratorWidgetGroups(oEditor,oSymbol);if(oSymbol&&oSymbol._decoratorWidgetGroups){for(sGroupId in oSymbol._decoratorWidgetGroups){if(oSymbol._decoratorWidgetGroups.hasOwnProperty(sGroupId)){oDecorarorWidgetGroup=oSymbol._decoratorWidgetGroups[sGroupId];if(oDecorarorWidgetGroup){if(!oDecorarorWidgetGroup.isDrawn){oDecorarorWidgetGroup.draw(oEditor&&oEditor.viewer,undefined,oTransition)}else{oDecorarorWidgetGroup.show(oEditor&&oEditor.viewer,oTransition);oDecorarorWidgetGroup.updateDrawing(oEditor&&oEditor.viewer,oTransition)}}}}}},hideDecorators:function(oEditor,oSymbol,oTransition){var sGroupId,oDecoratorGroupWidget;if(oSymbol&&oSymbol._decoratorWidgetGroups){for(sGroupId in oSymbol._decoratorWidgetGroups){if(oSymbol._decoratorWidgetGroups.hasOwnProperty(sGroupId)){oDecoratorGroupWidget=oSymbol._decoratorWidgetGroups[sGroupId];oDecoratorGroupWidget.hide(oEditor&&oEditor.viewer,oTransition)}}}},removeDecorators:function(oEditor,oSymbol,oTransition){var sGroupId,oDecoratorGroupWidget;if(oSymbol&&oSymbol._decoratorWidgetGroups){this.hideDecorators(oEditor,oSymbol,oTransition);for(sGroupId in oSymbol._decoratorWidgetGroups){if(oSymbol._decoratorWidgetGroups.hasOwnProperty(sGroupId)){oDecoratorGroupWidget=oSymbol._decoratorWidgetGroups[sGroupId];oDecoratorGroupWidget.dispose()}}delete oSymbol._decoratorWidgetGroups}}}})}());
(function(){sap.galilei.ui.editor.util.DiagramComparer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.DiagramComparer",parent:sap.galilei.ui.editor.util.twinDiagramEditor,fields:{_matchSymbolsFunction:undefined,_compareSymbolsFunction:undefined,_objectIdGenerator:undefined,_updateAction:undefined,_symbolIdGenerator:undefined,_customContext:undefined,_objectActionIndex:undefined,_symbolActionIndex:undefined,_disableSelectionNotification:false,_selectionNotificationTimerId:undefined,_disableUnselectionNotification:false,_unselectionNotificationTimerId:undefined,_compareResults:undefined,mergeMode:false},properties:{zoomPanDuration:500,transitionDuration:1000,createdColor:sap.galilei.ui.common.style.Color.lightgreen,deletedColor:sap.galilei.ui.common.style.Color.red,updatedColor:sap.galilei.ui.common.style.Color.orange},methods:{synchronize:function(){var self=this;function onSymbolSelected(oEvent){if(oEvent&&!this._disableSelectionNotification){if(this._selectionNotificationTimerId){clearTimeout(this._selectionNotificationTimerId)}this._disableSelectionNotification=true;this.selectSymbol(oEvent.editor,oEvent.sourceSymbol);this._selectionNotificationTimerId=setTimeout(function(){self._disableSelectionNotification=false;self._selectionNotificationTimerId=undefined},this.zoomPanDuration)}}function onSymbolUnselected(oEvent){if(oEvent&&!this._disableUnselectionNotification){if(this._unselectionNotificationTimerId){clearTimeout(this._unselectionNotificationTimerId)}this._disableUnselectionNotification=true;this.unselectSymbol(oEvent.editor,oEvent.sourceSymbol);setTimeout(function(){self._disableUnselectionNotification=false;self._unselectionNotificationTimerId=undefined},this.zoomPanDuration)}}if(!this._isSynchronized&&this.editor1&&this.editor2){this.defaultSynchronize();this.editor1.viewer.zoomDuration=this.editor2.viewer.zoomDuration=this.zoomPanDuration;this.editor1.viewer.panDuration=this.editor2.viewer.panDuration=this.zoomPanDuration;sap.galilei.core.Event.subscribe("symbol.selected",onSymbolSelected,this,this.editor1);sap.galilei.core.Event.subscribe("symbol.selected",onSymbolSelected,this,this.editor2);sap.galilei.core.Event.subscribe("symbol.unselected",onSymbolUnselected,this,this.editor1);sap.galilei.core.Event.subscribe("symbol.unselected",onSymbolUnselected,this,this.editor2)}},defaultGetObjectId:function(oObject){return oObject&&oObject.objectId},defaultUpdateAction:function(oAction){return oAction},getObjectId:function(oObject){var fnIdGenerator=this._objectIdGenerator||this.defaultGetObjectId;return fnIdGenerator(oObject)},getSymbolId:function(oSymbol){var fnIdGenerator=this._symbolIdGenerator||this.defaultGetObjectId;return fnIdGenerator(oSymbol)},defaultMatchSymbols:function(oSymbol1,oSymbol2){var sId1=this.getSymbolId(oSymbol1),sId2=this.getSymbolId(oSymbol2);return sId1==sId2},defaultCompareSymbols:function(oSymbol1,oSymbol2){if(oSymbol1&&oSymbol2){if(oSymbol1.isLinkSymbol){if(oSymbol1.points){if(!oSymbol1.points.equals(oSymbol2.points,0.1)){return true}}if(oSymbol1.lineStyle!=oSymbol2.lineStyle){return true}}else{if(Math.abs(oSymbol1.x-oSymbol2.x)>0.1||Math.abs(oSymbol1.y-oSymbol2.y)>0.1||Math.abs(oSymbol1.width-oSymbol2.width)>0.1||Math.abs(oSymbol1.height-oSymbol2.height)>0.1||oSymbol1.displayMode!=oSymbol2.displayMode){return true}}}return false},addAction:function(oAction){oAction=this._updateAction?this._updateAction(oAction):oAction;if(oAction){this._compareResults.push(oAction)}},defaultCompareDiagrams:function(oOptions){var aSymbols1,aSymbols2;this.resetActions();oOptions=oOptions||{};this._matchSymbolsFunction=oOptions.matchSymbolsFunction||this.defaultMatchSymbols;this._compareSymbolsFunction=oOptions.compareSymbolsFunction||this.defaultCompareSymbols;this._objectIdGenerator=oOptions.objectIdGenerator||this.defaultGetObjectId;this._symbolIdGenerator=oOptions.symbolIdGenerator||this.defaultGetObjectId;this._customContext=oOptions.context||this;this._updateAction=oOptions.updateAction||this.defaultUpdateAction;function findSymbolInNewDiagram(oSymbol1){var bFound=false,i,max,oSymbol,oAction,bMergeMode=(this.mergeMode===true);for(i=0,max=aSymbols2.length;i<max;i++){oSymbol=aSymbols2[i];if(this._matchSymbolsFunction.call(this._customContext,oSymbol1,oSymbol)){oAction={symbol1:oSymbol1,symbol2:oSymbol,isSymbolDifferences:true};if(this._compareSymbolsFunction.call(this._customContext,oSymbol1,oSymbol)){oAction.actionType="UPDATE"}else{oAction.actionType="NOCHANGE"}this.addAction(oAction);bFound=true;break}}if(!bFound){oAction={actionType:bMergeMode?"CREATE":"DELETE",symbol1:oSymbol1,isSymbolDifferences:true};this.addAction(oAction)}}function findSymbolInInitialDiagram(oSymbol2){var bFound=false,i,max,oSymbol,oAction,bMergeMode=(this.mergeMode===true);for(i=0,max=aSymbols1.length;i<max;i++){oSymbol=aSymbols1[i];if(this._matchSymbolsFunction.call(this._customContext,oSymbol,oSymbol2)){bFound=true;break}}if(!bFound){oAction={actionType:bMergeMode?"DELETE":"CREATE",symbol2:oSymbol2,isSymbolDifferences:true};this.addAction(oAction)}}if(this.editor1&&this.editor2){aSymbols1=this.editor1.getAllSymbols();aSymbols2=this.editor2.getAllSymbols();aSymbols1.forEach(findSymbolInNewDiagram,this);aSymbols2.forEach(findSymbolInInitialDiagram,this);this._compareResults.buildIndex()}},compareDiagrams:function(oOptions){this.defaultCompareDiagrams(oOptions)},resetActions:function(){var oResult=this._compareResults=new sap.galilei.ui.editor.util.DiffDiagramModel();oResult.editor1=this.editor1;oResult.editor2=this.editor2;if(this._objectIdGenerator){oResult.getObjectId=this._objectIdGenerator}if(this._symbolIdGenerator){oResult.getSymbolId=this._symbolIdGenerator}return oResult},getActionCount:function(){return this._compareResults?this._compareResults.length:0},getAction:function(nIndex){return this._compareResults?this._compareResults.getAction(nIndex):undefined},getObjectIndex:function(oObject){return this._compareResults?this._compareResults.getObjectIndex(oObject):-1},getSymbolIndex:function(oSymbol){return this._compareResults?this._compareResults.getSymbolIndex(oSymbol):-1},getObjectAction:function(oObject){return this._compareResults?this._compareResults.getObjectAction(oObject):undefined},getSymbolAction:function(oSymbol){return this._compareResults?this._compareResults.getSymbolAction(oSymbol):undefined},registerNewSymbol:function(oInitialSymbol,oNewSymbol){return this._compareResults?this._compareResults.registerNewSymbol(oInitialSymbol,oNewSymbol):undefined},isSymbolDeleted:function(oSymbol){return this._compareResults?this._compareResults.isSymbolDeleted(oSymbol):false},isSymbolCreated:function(oSymbol){return this._compareResults?this._compareResults.isSymbolCreated(oSymbol):false},isSymbolUpdated:function(oSymbol){return this._compareResults?this._compareResults.isSymbolUpdated(oSymbol):false},highlightAllSymbols:function(){this.highlightSymbols(this.editor1);this.highlightSymbols(this.editor2)},highlightSymbols:function(oEditor){var oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:2000}),aSymbols;function highlight(oSymbol){this.highlightSymbol(oEditor,oSymbol,oTransitionDefinition)}if(oEditor&&this._compareResults){aSymbols=oEditor.getAllSymbols();aSymbols.forEach(highlight,this)}},highlightSymbol:function(oEditor,oSymbol,oTransitionDefinition){var bIsInitialdiagram=oEditor===this.editor1,bFound=false,oParam,oStyleSheet,oAction,sAction,bMergeMode=this.mergeMode===true;if(oEditor&&oSymbol){if(!oTransitionDefinition){oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration})}oParam={strokeWidth:5};oAction=this.getSymbolAction(oSymbol);sAction=oAction&&oAction.actionType;if(sAction==="DELETE"){oParam.stroke=this.deletedColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.deletedColor,0.8);bFound=true}else{if(sAction==="CREATE"){oParam.stroke=this.createdColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.createdColor,0.8);bFound=true}else{if(sAction==="UPDATE"){oParam.stroke=this.updatedColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.updatedColor,0.8);bFound=true}}}if(oAction&&oAction.conflict&&!oEditor.notDashConflict){oParam.strokeDashArray="3,3"}if(bFound){oStyleSheet=new sap.galilei.ui.common.style.StyleSheet(oParam);oSymbol.highlight(oStyleSheet,undefined,oEditor.viewer,oTransitionDefinition)}else{this.grayOutSymbol(oEditor,oSymbol,oTransitionDefinition)}}},addSelectionFrame:function(oEditor,oSymbol){if(oEditor&&oSymbol){var oBoundaryShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration}),oImage;if(oSymbol.shape){oImage=oSymbol.shape.selectShape({_isUseFilter:true});if(oImage){return}}if(oBoundaryShape){oBoundaryShape.filter="url(#filterSelectionGlow)";oBoundaryShape.updateDrawing(oEditor.viewer,oTransitionDefinition,["filter"])}}},removeSelectionFrame:function(oEditor,oSymbol){if(oEditor&&oSymbol){var oBoundaryShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration}),oImage;if(oSymbol.shape){oImage=oSymbol.shape.selectShape({_isUseFilter:true});if(oImage){return}}if(oBoundaryShape){oBoundaryShape.filter=null;oBoundaryShape.updateDrawing(oEditor.viewer,oTransitionDefinition,["filter"])}}},grayOutSymbols:function(oEditor,aExcludeSymbols){var oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:2000}),aSymbols;function grayOut(oSymbol){if(!aExcludeSymbols||aExcludeSymbols.indexOf(oSymbol)===-1){this.grayOutSymbol(oEditor,oSymbol,oTransitionDefinition)}}if(oEditor){aSymbols=oEditor.getAllSymbols();aSymbols.forEach(grayOut,this)}},grayOutSymbol:function(oEditor,oSymbol,oTransitionDefinition){if(oEditor&&oSymbol){if(!oTransitionDefinition){oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration})}oSymbol.grayOut(oEditor.viewer,oTransitionDefinition)}},selectSymbol:function(oEditor,oSymbol,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView){var oAction=this.getSymbolAction(oSymbol,false),oOtherEditor,oOtherSymbol,oSymbol1,oSymbol2;if(oEditor&&oSymbol){if(!oSymbol.isSelected){oEditor.unselectAllSymbols(true,undefined);oEditor.selectSymbol(oSymbol)}this.addSelectionFrame(oEditor,oSymbol)}if(oAction){oOtherEditor=(oEditor===this.editor1)?this.editor2:this.editor1;oOtherSymbol=(oSymbol===oAction.symbol1)?oAction.symbol2:oAction.symbol1;if(oOtherEditor){oOtherEditor.unselectAllSymbols(true,undefined,oOtherSymbol);if(oOtherSymbol&&!oOtherSymbol.isSelected){oOtherEditor.selectSymbol(oOtherSymbol)}this.addSelectionFrame(oOtherEditor,oOtherSymbol)}}if(oEditor===this.editor1){oSymbol1=oSymbol;oSymbol2=oOtherSymbol}else{oSymbol1=oOtherSymbol;oSymbol2=oSymbol}if(bGrayOutOtherSymbols){this.grayOutSymbols(this.editor1,oSymbol1?[oSymbol1]:undefined);this.grayOutSymbols(this.editor2,oSymbol2?[oSymbol2]:undefined)}if(oSymbol1){this.highlightSymbol(this.editor1,oSymbol1)}if(oSymbol2){this.highlightSymbol(this.editor2,oSymbol2)}this.bringSymbolsToView(oSymbol1,oSymbol2,bPreserveZoomScale,bCenterInView)},unselectSymbol:function(oEditor,oSymbol){var oAction=this.getSymbolAction(oSymbol,false),oOtherEditor,oOtherSymbol;this.removeSelectionFrame(oEditor,oSymbol);if(oAction){oOtherEditor=(oEditor===this.editor1)?this.editor2:this.editor1;oOtherSymbol=(oSymbol===oAction.symbol1)?oAction.symbol2:oAction.symbol1;if(oOtherEditor&&oOtherSymbol&&oOtherSymbol.isSelected){this.removeSelectionFrame(oOtherEditor,oOtherSymbol);oOtherEditor.unselectSymbol(oOtherSymbol)}}},selectObject:function(oObject,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView){var oAction=this.getObjectAction(oObject);if(oAction){if(oAction.symbol1){this.selectSymbol(this.editor1,oAction.symbol1,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView)}else{if(oAction.symbol2){this.selectSymbol(this.editor2,oAction.symbol2,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView)}}}},unselectAllObjects:function(){this.editor1.unselectAllSymbols();this.editor2.unselectAllSymbols()},dispose:function(){sap.galilei.core.Event.unSubscribeAllScope(this);this.compareResults&&this.compareResults.dispose&&this.compareResults.dispose();this.compareResults=undefined;this._objectActionIndex=undefined;this._symbolActionIndex=undefined;this.editor1=undefined;this.editor2=undefined;this._isSynchronized=false}}})}());
(function(){sap.galilei.ui.editor.util.DiffAction=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.DiffAction",properties:{action:undefined,object1:undefined,object2:undefined,type:{get:function(){return this.action&&this.action.type}},subDifferences:undefined}});sap.galilei.ui.editor.util.DiffModel=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.DiffModel",fields:{_objectActionIndex:undefined,_differences:[]},properties:{model1:undefined,model2:undefined,length:{get:function(){return this._differences?this._differences.length:0}}},methods:{getAction:function(nIndex){return this._differences[nIndex]},push:function(oAction){if(oAction){this._differences.push(oAction)}},buildIndex:function(){this.defaultBuildObjectIndex()},defaultBuildObjectIndex:function(){var i,max,oAction,self=this;this._objectActionIndex={};function addObjectIndex(oObject,index){var sId=self.getObjectId(oObject);if(sId){self._objectActionIndex[sId]=index}}if(this._differences){for(i=0,max=this._differences.length;i<max;i++){oAction=this._differences[i];if(oAction.object1){addObjectIndex(oAction.object1,i)}if(oAction.object2){addObjectIndex(oAction.object2,i)}}}},getObjectId:function(oObject){return oObject&&oObject.objectId},getObjectIndex:function(oObject){if(oObject&&this._objectActionIndex){var sId=this.getObjectId(oObject),index;if(sId){index=this._objectActionIndex[sId];if(index!==undefined){return index}}}return -1},getObjectAction:function(oObject){var index=this.getObjectIndex(oObject);if(index>0&&this._differences){return this._differences[index]}return undefined},dispose:function(){this.defaultObjectDispose()},defaultObjectDispose:function(){this._objectActionIndex=undefined;this.model1=undefined;this.model2=undefined;this._differences=undefined}}})}());
(function(){sap.galilei.ui.editor.util.DiffDiagramAction=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.DiffDiagramAction",parent:sap.galilei.ui.editor.util.DiffAction,properties:{symbol1:undefined,symbol2:undefined}});sap.galilei.ui.editor.util.DiffDiagramModel=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.DiffModel",parent:sap.galilei.ui.editor.util.DiffModel,fields:{_symbolActionIndex:undefined},properties:{editor1:undefined,editor2:undefined,isShowSymbolDifferences:true},methods:{push:function(oAction){if(oAction){if(oAction.object1&&(oAction.symbol1===undefined)&&this.editor1){oAction.symbol1=this.editor1.getObjectSymbol(oAction.object1)}if(oAction.object2&&(oAction.symbol2===undefined)&&this.editor2){oAction.symbol2=this.editor2.getObjectSymbol(oAction.object2)}this._differences.push(oAction)}},buildIndex:function(){var i,max,oAction,self=this;this.defaultBuildObjectIndex();this._symbolActionIndex={};function addSymbolIndex(oSymbol,index){var sId=self.getSymbolId(oSymbol);if(sId){self._symbolActionIndex[sId]=index}}if(this._differences){for(i=0,max=this._differences.length;i<max;i++){oAction=this._differences[i];if(oAction.symbol1){addSymbolIndex(oAction.symbol1,i)}if(oAction.symbol2){addSymbolIndex(oAction.symbol2,i)}}}},registerNewSymbol:function(oInitialSymbol,oNewSymbol){var sId=this.getSymbolId(oNewSymbol),nIndex=sId?this.getSymbolIndex(oInitialSymbol):-1,oAction;if(nIndex>=0){this._symbolActionIndex[sId]=nIndex;if(this._differences){oAction=this._differences[nIndex];oAction.symbol2=oNewSymbol;oAction.object2=oNewSymbol.object}}},getSymbolId:function(oSymbol){return this.getObjectId(oSymbol)},getSymbolIndex:function(oSymbol){if(oSymbol&&this._symbolActionIndex){var sId=this.getSymbolId(oSymbol),index;if(sId){index=this._symbolActionIndex[sId];if(index!==undefined){return index}}}return -1},getSymbolAction:function(oSymbol,bCheckDisplay){var oResult,index=this.getSymbolIndex(oSymbol);if(index!==-1&&this._differences){oResult=this._differences[index];if((bCheckDisplay!==false)&&!this.isShowSymbolDifferences&&oResult&&oResult.isSymbolDifferences){oResult=undefined}}return oResult},isSymbolDeleted:function(oSymbol){var oAction=this.getSymbolAction(oSymbol,true),sAction=oAction&&oAction.actionType;return(sAction==="DELETE")},isSymbolCreated:function(oSymbol){var oAction=this.getSymbolAction(oSymbol,true),sAction=oAction&&oAction.actionType;return(sAction==="CREATE")},isSymbolUpdated:function(oSymbol){var oAction=this.getSymbolAction(oSymbol,true),sAction=oAction&&oAction.actionType;return(sAction==="UPDATE")},dispose:function(){this.defaultObjectDispose();this.editor1=undefined;this.editor2=undefined;this._symbolActionIndex=undefined}}})}());
(function(){namespace("sap.galilei.ui.editor.layout");sap.galilei.ui.editor.layout.Layout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.Layout",properties:{editor:undefined,diagram:{get:function(){return this.editor&&this.editor.diagram}},viewer:{get:function(){return this.editor&&this.editor.viewer}},transitionDefinition:{get:function(){if(this.editor!==undefined&&!this.editor.enableAnimation){return false}if(!this._transitionDefinition){this._transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}return this._transitionDefinition},set:function(oTransitionDef){this._transitionDefinition=oTransitionDef}},isDisableDraw:false,orientation:undefined,symbolClass:undefined},methods:{drawSymbols:function(aSymbols,oTransitionDefinition){var index,oSymbol;oTransitionDefinition=oTransitionDefinition||this.transitionDefinition;if(aSymbols){for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];oSymbol.drawSymbol(this.viewer,oTransitionDefinition)}}},getGroupSymbols:function(oCurrentSymbol,oOldSymbolRect,oNewSymbolRect,bIncludeCurrentSymbol,oParentSymbol){var oParentSymbolOrDiagram,sSymbolClass=this.symbolClass,sOrientation=this.orientation,oTestSymbolRect,index,oSymbol,oSymbolRect=new sap.galilei.ui.common.Rect(),aSymbols=[];oParentSymbolOrDiagram=oParentSymbol||this.editor.diagram;if(oCurrentSymbol||oOldSymbolRect||oNewSymbolRect){if(!oOldSymbolRect&&oCurrentSymbol){oOldSymbolRect=oCurrentSymbol.getBBox()}if(!oOldSymbolRect&&oNewSymbolRect){oOldSymbolRect=oNewSymbolRect}if(!oNewSymbolRect){oNewSymbolRect=oOldSymbolRect}oTestSymbolRect=oOldSymbolRect.clone();for(index=0;index<oParentSymbolOrDiagram.symbols.length;index++){oSymbol=oParentSymbolOrDiagram.symbols.get(index);if(sSymbolClass&&!sap.galilei.model.isInstanceOf(oSymbol,sSymbolClass)){continue}if(oCurrentSymbol&&!bIncludeCurrentSymbol&&oSymbol===oCurrentSymbol){continue}if(oCurrentSymbol&&oSymbol===oCurrentSymbol&&oNewSymbolRect){oSymbolRect.x=oNewSymbolRect.x;oSymbolRect.y=oNewSymbolRect.y;oSymbolRect.width=oNewSymbolRect.width;oSymbolRect.height=oNewSymbolRect.height}else{oSymbolRect.x=oSymbol.x;oSymbolRect.y=oSymbol.y;oSymbolRect.width=oSymbol.width;oSymbolRect.height=oSymbol.height}if(sOrientation===sap.galilei.ui.common.Orientation.horizontal){oSymbolRect.x=oTestSymbolRect.x}else{if(sOrientation===sap.galilei.ui.common.Orientation.vertical){oSymbolRect.y=oTestSymbolRect.y}}if(oSymbolRect.isRectIntersectRect(oTestSymbolRect)){aSymbols.push(oSymbol)}}}return aSymbols},performLayout:function(aSymbols,oOptions,oTransitionDefinition){},canChangeSymbolOwner:function(oSymbol,oOldParentSymbol,oNewParentSymbol){return true},canCangeObjectOwner:function(oObject,oOldParentObject,oNewParentObject){return true},beforeMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){},postMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){},beforeMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){},postMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){},beforeResizeSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){},postResizeSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){},postCreateSymbol:function(oSymbol,oTool,oTransitionDefinition){},beforeDeleteSymbol:function(oSymbol,oTransitionDefinition){},postDeleteSymbol:function(oTransitionDefinition){},layoutSymbols:function(aSymbols,oOptions,oTransitionDefinition){},layoutSymbol:function(oSymbol,oOptions,oTransitionDefinition){this.layoutSymbols([oSymbol],oOptions,oTransitionDefinition||this.transitionDefinition)},dispose:function(){}},statics:{cloneListSymbols:function(aSymbols){var aNewSymbols;if(aSymbols){aNewSymbols=[];aNewSymbols=aNewSymbols.concat(aSymbols)}return aNewSymbols},mergeListSymbols:function(aSymbols1,aSymbols2){var aSymbols=aSymbols1,index,oSymbol;if(aSymbols&&aSymbols2){for(index=0;index<aSymbols2.length;index++){oSymbol=aSymbols2[index];if(aSymbols.indexOf(oSymbol)===-1){aSymbols.push(oSymbol)}}}return aSymbols},excludeListSymbols:function(aSymbols,aExcludeSymbols){function filterSymbol(oSymbol){return aExcludeSymbols.indexOf(oSymbol)===-1}if(aSymbols&&aExcludeSymbols&&aExcludeSymbols.length>0){return aSymbols.filter(filterSymbol)}return aSymbols},isSameListSymbols:function(aOldSymbols,aNewSymbols,bOrdered){var index,oSymbol,oMap={};if(aOldSymbols&&aNewSymbols){if(aOldSymbols.length!==aNewSymbols.length){return false}if(bOrdered){for(index=0;index<aOldSymbols.length;index++){if(aOldSymbols[index]!==aNewSymbols[index]){return false}}}else{for(index=0;index<aOldSymbols.length;index++){oSymbol=aOldSymbols[index];oMap[oSymbol.objectId]=true}for(index=0;index<aNewSymbols.length;index++){oSymbol=aNewSymbols[index];if(!oMap[oSymbol.objectId]){return false}}}return true}return false},getSymbolsSize:function(vSymbols){var bFirst=true,index,oSymbol,oRect,oBBox,minWidth=0,minHeight=0,maxWidth=0,maxHeight=0;if(vSymbols){for(index=0;index<vSymbols.length;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}oBBox=oSymbol.getBBox();if(bFirst){oRect=oSymbol.getBBox();minWidth=oBBox.width;minHeight=oBBox.height;maxWidth=oBBox.width;maxHeight=oBBox.height;bFirst=false}else{oRect.unionRect(oBBox);minWidth=Math.min(minWidth,oBBox.width);minHeight=Math.min(minHeight,oBBox.height);maxWidth=Math.max(maxWidth,oBBox.width);maxHeight=Math.max(maxHeight,oBBox.height)}}}if(oRect){oRect.minWidth=minWidth;oRect.minHeight=minHeight;oRect.maxWidth=maxWidth;oRect.maxHeight=maxHeight}return oRect},sortSymbolsByDirection:function(aSymbols,sOrientation,oCurrentSymbol,nCurrentSymbolX,nCurrentSymbolY){var self=this;if(aSymbols&&(sOrientation===sap.galilei.ui.common.Orientation.horizontal||sOrientation===sap.galilei.ui.common.Orientation.vertical)){aSymbols.sort(function(oSymbol1,oSymbol2){var x1,x2,y1,y2;if(sOrientation===sap.galilei.ui.common.Orientation.horizontal){if(oSymbol1===oCurrentSymbol&&nCurrentSymbolX!==undefined){x1=nCurrentSymbolX}else{x1=oSymbol1.x}if(oSymbol2===oCurrentSymbol&&nCurrentSymbolX!==undefined){x2=nCurrentSymbolX}else{x2=oSymbol2.x}return x1-x2}else{if(oSymbol1===oCurrentSymbol&&nCurrentSymbolY!==undefined){y1=nCurrentSymbolY}else{y1=oSymbol1.y}if(oSymbol2===oCurrentSymbol&&nCurrentSymbolY!==undefined){y2=nCurrentSymbolY}else{y2=oSymbol2.y}return y1-y2}})}return aSymbols}}})}());
(function(){sap.galilei.ui.editor.layout.StackLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.StackLayout",parent:sap.galilei.ui.editor.layout.Layout,properties:{orientation:sap.galilei.ui.common.Orientation.horizontal,offsetX:undefined,offsetY:undefined,oldIndex:undefined,newIndex:undefined},methods:{performLayout:function(aSymbols,oOptions,oTransitionDefinition){var oClipRectInfo,index,oSymbol,x0,y0,width0,height0,nOffsetX=this.offsetX,nOffsetY=this.offsetY,bNewSymbol,bCompositeSymbol,aExistingSymbols=[],aExcludeSymbols=[],bIncludeCurrentSymbol,oRect=new sap.galilei.ui.common.Rect(),oMoveOptions={moveLinkSymbols:true},oLayouter,aMovedSymbols;if(aSymbols){oOptions=oOptions||{};bNewSymbol=oOptions.isNewSymbol;bCompositeSymbol=oOptions.symbol&&oOptions.symbol.isComposite&&oOptions.symbol.symbols.length>0&&oOptions.symbol.isExpanded;bIncludeCurrentSymbol=oOptions.isIncludeCurrentSymbol;if(bNewSymbol&&oOptions.symbol){aExcludeSymbols.push(oOptions.symbol)}if(bIncludeCurrentSymbol&&oOptions.symbol&&aSymbols.indexOf(oOptions.symbol)===-1){aSymbols.push(oOptions.symbol)}if(aExcludeSymbols.length>0){aExistingSymbols=sap.galilei.ui.editor.layout.Layout.excludeListSymbols(aSymbols,aExcludeSymbols)}else{aExistingSymbols=aSymbols}oTransitionDefinition=oTransitionDefinition||this.transitionDefinition;if(oOptions.width!==undefined||oOptions.height!==undefined){for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];if(oSymbol.isComposite&&oSymbol.symbols.length>0&&oSymbol.isExpanded){if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){oOptions.height=Math.max(oOptions.height,oSymbol.height)}else{oOptions.width=Math.max(oOptions.width,oSymbol.width)}}}}oClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(aExistingSymbols);x0=oOptions.x;y0=oOptions.y;width0=oOptions.width;height0=oOptions.height;if(x0===undefined&&oClipRectInfo){x0=oClipRectInfo.x}if(y0===undefined&&oClipRectInfo){y0=oClipRectInfo.y}if(bCompositeSymbol){if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){height0=Math.max(oOptions.symbol.height,oClipRectInfo.maxHeight)}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){width0=Math.max(oOptions.symbol.width,oClipRectInfo.maxWidth)}}}if(width0===undefined&&height0===undefined&&oClipRectInfo){if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){height0=oClipRectInfo.maxHeight}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){width0=oClipRectInfo.maxWidth}}}for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];if(!isNaN(width0)||!isNaN(height0)){oRect.x=oSymbol.x;oRect.y=oSymbol.y;oRect.width=!isNaN(width0)?width0:oSymbol.width;oRect.height=!isNaN(height0)?height0:oSymbol.height;if(oSymbol.width!==oRect.width||oSymbol.height!==oRect.height){oSymbol.setBBox(oRect,oMoveOptions,this.viewer)}}}for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];if(index===0){if(isNaN(x0)){x0=oSymbol.x}if(isNaN(y0)){y0=oSymbol.y}}if(!isNaN(x0)&&!isNaN(y0)&&(oSymbol.x!==x0||oSymbol.y!==y0)){oSymbol.moveTo(x0,y0,oMoveOptions,this.viewer,this.transitionDefinition)}oLayouter=this.editor.getOrCreateSymbolLayouter(oSymbol);if(oLayouter){nOffsetX=oLayouter.offsetX;nOffsetY=oLayouter.offsetY}if(typeof nOffsetX==="function"){nOffsetX=nOffsetX()}if(typeof nOffsetY==="function"){nOffsetY=nOffsetY()}if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){x0=oSymbol.x+oSymbol.width;if(!isNaN(nOffsetX)){x0+=nOffsetX}y0=oSymbol.y}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){x0=oSymbol.x;y0=oSymbol.y+oSymbol.height;if(!isNaN(nOffsetY)){y0+=nOffsetY}}}}if(!this.isDisableDraw){for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];oSymbol.drawSymbol(this.viewer,this.transitionDefinition)}}aMovedSymbols=aSymbols}return aMovedSymbols},beforeMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){if(oSymbol&&oTracker){this._oldParentSymbol=oSymbol.parentSymbol||this.diagram;this._oldBBox=oSymbol.getBBox();this._initialSymbols=this.getGroupSymbols(oSymbol,this._oldBBox,undefined,true,this._oldParentSymbol);this._initialClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(this._initialSymbols);this._oldSymbols=this.getGroupSymbols(oSymbol,this._oldBBox,oTracker.movedBBox,true,this._oldParentSymbol);this._oldClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(this._oldSymbols)}},defaultPostMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){var oOldParentSymbol=this._oldParentSymbol,oNewParentSymbol,aNewSymbols,oNewClipRectInfo,bSaveGroup,index,nOldIndex,nNewIndex,oNewOptions={},aMovedOldSymbols,aMovedNewSymbols,aMovedSymbols=[];if(oSymbol&&oTracker){oTransitionDefinition=oTransitionDefinition||this.transitionDefinition;oNewParentSymbol=oTracker._parentHighlighter&&oTracker._parentHighlighter.highlighted;oNewParentSymbol=oNewParentSymbol||oSymbol.parentSymbol||this.diagram;aNewSymbols=this.getGroupSymbols(oSymbol,oTracker.movedBBox,undefined,false,oNewParentSymbol);oNewClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(aNewSymbols);aNewSymbols.push(oSymbol);if(oNewParentSymbol!==oOldParentSymbol){bSaveGroup=false;index=this._oldSymbols.indexOf(oSymbol);if(index!==-1){this._oldSymbols.splice(index,1);this._oldClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(this._oldSymbols)}}else{bSaveGroup=sap.galilei.ui.editor.layout.Layout.isSameListSymbols(this._oldSymbols,aNewSymbols)}if(bSaveGroup&&aNewSymbols.length===1){return}if(bSaveGroup){sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(this._initialSymbols,this.orientation,oSymbol,this._oldBBox.x,this._oldBBox.y);nOldIndex=this._initialSymbols.indexOf(oSymbol)}sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(this._oldSymbols,this.orientation,oSymbol,oTracker.movedBBox.x,oTracker.movedBBox.y);sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(aNewSymbols,this.orientation,oSymbol,oTracker.movedBBox.x,oTracker.movedBBox.y);if(bSaveGroup){nNewIndex=aNewSymbols.indexOf(oSymbol)}if(!bSaveGroup&&this._oldSymbols.length>0){aMovedOldSymbols=this.performLayout(this._oldSymbols,{x:this._initialClipRectInfo?this._initialClipRectInfo.x:this._oldClipRectInfo.x,y:this._initialClipRectInfo?this._initialClipRectInfo.y:this._oldClipRectInfo.y,isIncludeCurrentSymbol:bSaveGroup,symbol:oSymbol},oTransitionDefinition);aMovedSymbols=sap.galilei.ui.editor.layout.Layout.mergeListSymbols(aMovedSymbols,aMovedOldSymbols)}if(this._initialClipRectInfo){if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){if(this._oldBBox.y===this._initialClipRectInfo.y&&this._oldBBox.height===this._initialClipRectInfo.maxHeight){if(bSaveGroup){oNewOptions.y=oTracker.movedBBox.y;if(this._oldBBox.x!==this._initialClipRectInfo.x){oNewOptions.x=this._initialClipRectInfo.x+(oTracker.movedBBox.x-this._oldBBox.x)}}else{if(oNewClipRectInfo){oNewOptions.height=oNewClipRectInfo.maxHeight}}}else{if(oNewClipRectInfo){oNewOptions.height=oNewClipRectInfo.maxHeight}}}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){if(this._oldBBox.x===this._initialClipRectInfo.x&&this._oldBBox.width===this._initialClipRectInfo.maxWidth){if(bSaveGroup){oNewOptions.x=oTracker.movedBBox.x;if(this._oldBBox.y!==this._initialClipRectInfo.y){oNewOptions.y=this._initialClipRectInfo.y+(oTracker.movedBBox.y-this._oldBBox.y)}}else{if(oNewClipRectInfo){oNewOptions.width=oNewClipRectInfo.maxWidth}}}else{if(oNewClipRectInfo){oNewOptions.width=oNewClipRectInfo.maxWidth}}}}}oNewOptions.symbol=oSymbol;oNewOptions.isIncludeCurrentSymbol=true;if(!bSaveGroup&&oNewClipRectInfo){oNewOptions.x=oNewClipRectInfo.x;oNewOptions.y=oNewClipRectInfo.y}else{if(bSaveGroup&&nOldIndex!==nNewIndex&&this._initialClipRectInfo){oNewOptions.x=this._initialClipRectInfo.x;oNewOptions.y=this._initialClipRectInfo.y}}aMovedNewSymbols=this.performLayout(aNewSymbols,oNewOptions,oTransitionDefinition);aMovedSymbols=sap.galilei.ui.editor.layout.Layout.mergeListSymbols(aMovedSymbols,aMovedNewSymbols)}this.dispose();return aMovedSymbols},postMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){return this.defaultPostMoveSymbol(oSymbol,oTracker,oEvent,oTransitionDefinition)},defaultDispose:function(){delete this._oldParentSymbol;delete this._oldBBox;delete this._initialSymbols;delete this._initialClipRectInfo;delete this._oldSymbols;delete this._oldClipRectInfo},dispose:function(){this.defaultDispose()},beforeMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){var oInitialBBoxInfo,dx,dy,dx2=0,dy2=0,index,oSymbol,oSymbolInfo;if(aSymbols&&oTracker){oInitialBBoxInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(aSymbols);dx=oTracker.movedBBox.x-oInitialBBoxInfo.x;dy=oTracker.movedBBox.y-oInitialBBoxInfo.y;this._moveSymbolsInfo=[];for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];oSymbolInfo={};oSymbolInfo.symbol=oSymbol;oSymbolInfo.oldParentSymbol=oSymbol.parentSymbol||this.diagram;oSymbolInfo.oldBBox=oSymbol.getBBox();oSymbolInfo.movedBBox=oSymbolInfo.oldBBox.clone();oSymbolInfo.movedBBox.moveBy(dx-(oSymbolInfo.oldBBox.x-oInitialBBoxInfo.x)+dx2,dy-(oSymbolInfo.oldBBox.y-oInitialBBoxInfo.y)+dy2);oSymbolInfo.initialSymbols=this.getGroupSymbols(oSymbol,oSymbolInfo.oldBBox,undefined,true,oSymbolInfo.oldParentSymbol);oSymbolInfo.initialClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(oSymbolInfo.initialSymbols);oSymbolInfo.oldSymbols=this.getGroupSymbols(oSymbol,oSymbolInfo.oldBBox,oSymbolInfo.movedBBox,true,oSymbolInfo.oldParentSymbol);oSymbolInfo.oldClipRectInfo=sap.galilei.ui.editor.layout.Layout.getSymbolsSize(oSymbolInfo.oldSymbols);this._moveSymbolsInfo.push(oSymbolInfo);if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){dx2+=oSymbol.width+8}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){dy2+=oSymbol.height+8}}}}},defaultPostMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){var index,oSymbol,oSymbolInfo={},aMovedSymbols=[],oMovedBBox,aUpdatedSymbols,aDrawSymbols=[];function removeMovedSymbols(aCurrentSymbols){var i,nPos;if(aCurrentSymbols){for(i=0;i<aMovedSymbols.length;i++){nPos=aCurrentSymbols.indexOf(aMovedSymbols[i]);if(nPos!==-1){aCurrentSymbols.splice(nPos,1)}}}}if(aSymbols&&oTracker&&this._moveSymbolsInfo){oMovedBBox=oTracker.movedBBox;for(index=0;index<this._moveSymbolsInfo.length;index++){oSymbolInfo=this._moveSymbolsInfo[index];oSymbol=oSymbolInfo.symbol;this._oldParentSymbol=oSymbolInfo.oldParentSymbol;this._oldBBox=oSymbolInfo.oldBBox;this._initialSymbols=oSymbolInfo.initialSymbols;this._initialClipRectInfo=oSymbolInfo.initialClipRectInfo;this._oldSymbols=oSymbolInfo.oldSymbols;this._oldClipRectInfo=oSymbolInfo.oldClipRectInfo;removeMovedSymbols(this._initialSymbols);removeMovedSymbols(this._oldSymbols);oTracker.movedBBox=oSymbolInfo.movedBBox;aUpdatedSymbols=this.postMoveSymbol(oSymbol,oTracker,oEvent,oTransitionDefinition);aMovedSymbols.push(oSymbol);aDrawSymbols=sap.galilei.ui.editor.layout.Layout.mergeListSymbols(aDrawSymbols,aUpdatedSymbols)}oTracker.movedBBox=oMovedBBox}this.dispose();delete this._moveSymbolsInfo;return aDrawSymbols},postMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){return this.defaultPostMoveSymbols(aSymbols,oTracker,oEvent,oTransitionDefinition)},beforeResizeSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){if(oSymbol&&oTracker){this._symbols=this.getGroupSymbols(oSymbol,oTracker.movedBBox,undefined,true,oSymbol.parentSymbol);this._options={};if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){this._options.y=oTracker.resizedBBox.y;this._options.height=oTracker.resizedBBox.height}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){this._options.x=oTracker.resizedBBox.x;this._options.width=oTracker.resizedBBox.width}}this._options.symbol=oSymbol;this._options.isIncludeCurrentSymbol=true;sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(this._symbols,this.orientation,oSymbol,oTracker.resizedBBox.x,oTracker.resizedBBox.y)}},postResizeSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){if(oSymbol&&oTracker){oTransitionDefinition=oTransitionDefinition||this.transitionDefinition;this.performLayout(this._symbols,this._options,oTransitionDefinition)}delete this._symbols;delete this._options},postCreateSymbol:function(oSymbol,oTool,oTransitionDefinition){if(oSymbol){this.layoutSymbol(oSymbol,{symbol:oSymbol,isNewSymbol:true},oTransitionDefinition)}},beforeDeleteSymbol:function(oSymbol,oTransitionDefinition){if(oSymbol){this._oldBBox=oSymbol.getBBox();this._parentSymbol=oSymbol.parentSymbol}},postDeleteSymbol:function(oTransitionDefinition){var aGroupSymbols,oOptions;aGroupSymbols=this.getGroupSymbols(undefined,this._oldBBox,undefined,true,this._parentSymbol);sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(aGroupSymbols,this.orientation);this.performLayout(aGroupSymbols,oOptions,oTransitionDefinition);delete this.oldBBox},layoutSymbols:function(aSymbols,oOptions,oTransitionDefinition){var index,oSymbol,aGroupSymbols;if(aSymbols){oTransitionDefinition=oTransitionDefinition||this.transitionDefinition;for(index=0;index<aSymbols.length;index++){oSymbol=aSymbols[index];aGroupSymbols=this.getGroupSymbols(oSymbol,oSymbol.getBBox(),undefined,true,oSymbol.parentSymbol);sap.galilei.ui.editor.layout.Layout.sortSymbolsByDirection(aGroupSymbols,this.orientation);this.performLayout(aGroupSymbols,oOptions,oTransitionDefinition)}}}}})}());
(function(){sap.galilei.ui.editor.layout.DiagramAutoLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.DiagramAutoLayout",parent:sap.galilei.ui.common.layout.GraphAutoLayout,properties:{graphBuilderClassName:"sap.galilei.ui.editor.layout.DiagramGraphBuilder",graphUpdaterClassName:"sap.galilei.ui.editor.layout.DiagramGraphUpdater",editor:undefined,viewer:{get:function(){return this.editor&&this.editor.viewer}},resource:{get:function(){return this.editor&&this.editor.resource}},diagramSymbols:undefined,fixedSymbols:undefined,fixedSymbol:undefined},methods:{_removeAutoLayoutOptions:function(oOptions){var aProperties=["editor"],index;if(oOptions){this._defaultRemoveAutoLayoutOptions(oOptions);for(index=0;index<aProperties.length;index++){delete oOptions[aProperties[index]]}}},checkOptions:function(){return this.defaultCheckOptions()&&this.diagramSymbols!==undefined},moveGraph:function(){var oFixedNode,aCenter,dx=0,dy=0,oBBox;if(this.graph!==undefined){if(this.fixedSymbol!==undefined){oFixedNode=this.getSymbolNode(this.fixedSymbol);if(oFixedNode){aCenter=this.fixedSymbol.getCenter();dx=aCenter[0]-oFixedNode.x;dy=aCenter[1]-oFixedNode.y;if(dx!==0||dy!==0){this.graph.moveBy(dx,dy)}}}if(this.options.isHorizontalCenter||this.options.isVerticalCenter){dx=dy=0;oBBox=this.getGraphBBox();if(oBBox!==undefined){if(this.options.isHorizontalCenter){dx=-oBBox.width/2}if(this.options.isVerticalCenter){dy=-oBBox.height/2}if(dx!==0||dy!==0){this.graph.moveBy(dx,dy)}}}}},updateSymbols:function(){var oGraphUpdater=this.graphUpdaterInstance;if(oGraphUpdater){oGraphUpdater.updateDiagram(this)}},layoutDiagram:function(oDiagramSymbols,oOptions,oDiagramEditor,fnSuccess,fnError){var self=this,oGraphBuilder,aSelectedSymbols,index,max;this.dispose();this.editor=oDiagramEditor||this.editor;oDiagramSymbols=oDiagramSymbols||(this.editor&&this.editor.diagram);if(!oDiagramSymbols){return}this.diagramSymbols=oDiagramSymbols;if(oDiagramEditor!==undefined&&oDiagramEditor.selectedSymbols.length>0){aSelectedSymbols=[];for(index=0,max=oDiagramEditor.selectedSymbols.length;index<max;index++){aSelectedSymbols.push(oDiagramEditor.selectedSymbols[index])}oDiagramEditor.unselectAllSymbols()}oOptions=oOptions||{};oOptions.diagramSymbols=this.diagramSymbols;this.options=oOptions;oGraphBuilder=this.graphBuilderInstance;if(oGraphBuilder){oGraphBuilder.autoLayout=this}function onError(sError){sError=(sError&&sError.message)||(sError&&sError.text)||sError;if(sError){console.log("Error: "+sError)}if(fnError){fnError(sError)}}try{if(this.getOrBuildGraph()){this.layoutGraph(function(oAutoLayout){self.updateSymbols();if(oDiagramEditor!==undefined&&aSelectedSymbols!==undefined){oDiagramEditor.selectSymbols(aSelectedSymbols)}if(fnSuccess){fnSuccess(self)}},onError)}else{onError("Failed to build the graph from diagram symbols.")}}catch(e){onError(e)}},getSymbolNode:function(oSymbol){var aNodes,index,max,oNode;if(oSymbol&&this.graph){aNodes=this.graph.nodes;if(aNodes){for(index=0,max=aNodes.length;index<max;index++){oNode=aNodes[index];if(oNode&&oNode.symbol&&oNode.symbol===oSymbol){return oNode}}}}return undefined},getLinkSymbolEdge:function(oLinkSymbol){var aEdges,index,max,oEdge;if(oLinkSymbol&&oLinkSymbol.isLinkSymbol&&this.graph){aEdges=this.graph.edges;if(aEdges){for(index=0,max=aEdges.length;index<max;index++){oEdge=aEdges[index];if(oEdge&&oEdge.symbol&&oEdge.symbol===oLinkSymbol){return oEdge}}}}return undefined},getGraphInitialBBox:function(){var aNodes,aEdges,index,oNode,oEdge,oGraphBBox,oBBox;if(this.graph){aNodes=this.graph.nodes;aEdges=this.graph.edges;if(aNodes){for(index=0;index<aNodes.length;index++){oNode=aNodes[index];if(oNode&&oNode.symbol){oBBox=oNode.symbol.getBBox();if(!oGraphBBox){oGraphBBox=oBBox}else{oGraphBBox.unionRect(oBBox)}}}}if(aEdges){for(index=0;index<aEdges.length;index++){oEdge=aEdges[index];if(oEdge&&oEdge.symbol){oBBox=oEdge.symbol.getBBox();if(!oGraphBBox){oGraphBBox=oBBox}else{oGraphBBox.unionRect(oBBox)}}}}}return oGraphBBox},dispose:function(){this.defaultDispose();this.diagramSymbols=undefined;this.fixedSymbols=undefined;this.fixedSymbol=undefined}}})}());
(function(){sap.galilei.ui.editor.layout.DiagramGraphBuilder=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.DiagramGraphBuilder",parent:sap.galilei.ui.common.graph.GraphBuilder,properties:{autoLayout:undefined},methods:{checkOptions:function(oGraphOptions){return(oGraphOptions&&oGraphOptions.diagramSymbols)!==undefined},setGraphNodes:function(oGraphOptions){var oDiagramSymbols,fnFilterNodeSymbol,fnSetNode,aSymbols,index,oSymbol,oNodeDef,oNode;if(this.graph&&oGraphOptions){oDiagramSymbols=oGraphOptions.diagramSymbols;fnFilterNodeSymbol=oGraphOptions.onFilterNodeSymbol;fnSetNode=oGraphOptions.onSetNode;if(oDiagramSymbols){aSymbols=oDiagramSymbols.symbols||oDiagramSymbols;for(index=0;index<aSymbols.length;index++){if(aSymbols.get){oSymbol=aSymbols.get(index)}else{oSymbol=aSymbols[index]}if(oSymbol&&!oSymbol.isLinkSymbol&&!oSymbol.isHidden&&(!fnFilterNodeSymbol||fnFilterNodeSymbol(this,oSymbol))){oNodeDef={width:oSymbol.width,height:oSymbol.height,symbol:oSymbol};if(fnSetNode){fnSetNode(this,oSymbol,oNodeDef)}oNode=this.graph.setNode(oSymbol.objectId,oNodeDef);if(oGraphOptions.fixedSymbol===oSymbol){this.graph.fixedNode=oNode}if(oGraphOptions.isDoubleTree){this.graph.isDoubleTree=true}}}}}},setGraphEdges:function(oGraphOptions){var oDiagramSymbols,bIncludeSubLinkSymbols,fnFilterLinkSymbol,fnSetEdge,aSymbols,index,oSymbol,oEdge,index2,oSubSymbol,aAllLinkSymbols=[],aLinkSymbols,oLinkSymbol,oSourceSymbol,oTargetSymbol;if(this.graph&&oGraphOptions){oDiagramSymbols=oGraphOptions.diagramSymbols;fnFilterLinkSymbol=oGraphOptions.onFilterLinkSymbol;fnSetEdge=oGraphOptions.onSetEdge;bIncludeSubLinkSymbols=oGraphOptions.isIncludeSubLinkSymbols!==undefined?oGraphOptions.isIncludeSubLinkSymbols:false;if(oDiagramSymbols){aSymbols=oDiagramSymbols.symbols||oDiagramSymbols;for(index=0;index<aSymbols.length;index++){if(aSymbols.get){oSymbol=aSymbols.get(index)}else{oSymbol=aSymbols[index]}if(oSymbol&&oSymbol.isLinkSymbol&&!oSymbol.isHidden&&(!fnFilterLinkSymbol||fnFilterLinkSymbol(this,oSymbol))){oEdge={symbol:oSymbol};if(fnSetEdge){fnSetEdge(this,oSymbol,oEdge)}this.graph.setEdge(oSymbol.objectId,oSymbol.sourceSymbol.objectId,oSymbol.targetSymbol.objectId,undefined,oEdge)}}if(bIncludeSubLinkSymbols){for(index=0;index<aSymbols.length;index++){if(aSymbols.get){oSymbol=aSymbols.get(index)}else{oSymbol=aSymbols[index]}if(oSymbol.isComposite){for(index2=0;index2<oSymbol.symbols.length;index2++){oSubSymbol=oSymbol.symbols.get(index2);aLinkSymbols=oSubSymbol.getLinkSymbols(true,true);aAllLinkSymbols=sap.galilei.ui.editor.layout.Layout.mergeListSymbols(aAllLinkSymbols,aLinkSymbols)}}}if(aAllLinkSymbols){for(index=0;index<aAllLinkSymbols.length;index++){oLinkSymbol=aAllLinkSymbols[index];oSourceSymbol=oLinkSymbol.sourceSymbol;oTargetSymbol=oLinkSymbol.targetSymbol;if(oSourceSymbol.parentSymbol&&oSourceSymbol.parentSymbol.isComposite){oSourceSymbol=oSourceSymbol.parentSymbol}if(oTargetSymbol.parentSymbol&&oTargetSymbol.parentSymbol.isComposite){oTargetSymbol=oTargetSymbol.parentSymbol}oEdge={};this.graph.setEdge(oLinkSymbol.objectId,oSourceSymbol.objectId,oTargetSymbol.objectId,undefined,oEdge)}}}}}}}})}());
(function(){sap.galilei.ui.editor.layout.DiagramGraphUpdater=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.DiagramGraphUpdater",parent:sap.galilei.ui.common.layout.GraphUpdater,properties:{editor:undefined,viewer:{get:function(){return this.editor&&this.editor.viewer}},resource:{get:function(){return this.editor&&this.editor.resource}}},methods:{updateDiagram:function(oAutoLayout){var self=this;if(!oAutoLayout){return}this.autoLayout=oAutoLayout;this.graph=oAutoLayout.graph;this.editor=oAutoLayout.editor;this.transitionDefinition=oAutoLayout.transitionDefinition;if((navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1)&&navigator.appVersion.indexOf("Windows NT 10.")===-1){this.transitionDefinition=undefined}function updateSymbolsAction(){var fnPreUpdateSymbols=oAutoLayout.options.onPreUpdateSymbols,fnPostUpdateSymbols=oAutoLayout.options.onPostUpdateSymbols;if(fnPreUpdateSymbols){fnPreUpdateSymbols(self)}self.updateNodeSymbols();self.updateLinkSymbols();if(fnPostUpdateSymbols){fnPostUpdateSymbols(self)}}if(this.editor&&this.resource){this.resource.applyUndoableAction(updateSymbolsAction,"Update Layouted Symbols")}else{updateSymbolsAction()}},_updateSymbolForNode:function(oNode,fnPostUpdateNodeSymbol){var oSymbol=oNode&&oNode.symbol;if(oSymbol){if(this.autoLayout.fixedSymbols&&this.autoLayout.fixedSymbols.indexOf(oSymbol)!==-1){return}this.updateNodeSymbol(oSymbol,oNode);if(fnPostUpdateNodeSymbol){fnPostUpdateNodeSymbol(this.autoLayout,oSymbol,oNode)}}},updateNodeSymbols:function(){var self=this,index,max,fnPostUpdateNodeSymbol;if(this.autoLayout&&this.graph&&this.graph.nodes){fnPostUpdateNodeSymbol=this.autoLayout.options.onPostUpdateNodeSymbol;for(index=0,max=this.graph.nodes.length;index<max;index++){this._updateSymbolForNode(this.graph.nodes[index],fnPostUpdateNodeSymbol)}}},_updateSymbolForEdge:function(oEdge,fnPostUpdateLinkSymbol){var oLinkSymbol=oEdge&&oEdge.symbol;if(oLinkSymbol){if(this.autoLayout.fixedSymbols&&this.autoLayout.fixedSymbols.indexOf(oLinkSymbol)!==-1){return}if(oEdge.points!==undefined){this.checkEdgePoints(oLinkSymbol,oEdge);this.updateLinkSymbol(oLinkSymbol,oEdge)}if(fnPostUpdateLinkSymbol){fnPostUpdateLinkSymbol(this.autoLayout,oLinkSymbol,oEdge)}if(this.viewer){oLinkSymbol.drawSymbol(this.viewer,this.transitionDefinition)}}},updateLinkSymbols:function(){var self=this,index,max,fnPostUpdateLinkSymbol;if(this.autoLayout&&this.graph&&this.graph.edges){fnPostUpdateLinkSymbol=this.autoLayout.options.onPostUpdateLinkSymbol;for(index=0,max=this.graph.edges.length;index<max;index++){this._updateSymbolForEdge(this.graph.edges[index],fnPostUpdateLinkSymbol)}}},updateNodeSymbol:function(oSymbol,oNode){if(oSymbol&&oNode){oSymbol.setCenter(oNode.x,oNode.y,undefined,this.viewer,this.transitionDefinition)}},updateLinkSymbol:function(oLinkSymbol,oEdge){if(oLinkSymbol&&oEdge&&oEdge.points){oLinkSymbol.points=oEdge.points}},checkEdgePoints:function(oLinkSymbol,oEdge){if(this.graph&&oLinkSymbol&&oEdge&&oEdge.points){}}}})}());
(function(){sap.galilei.ui.editor.layout.DiagramMultiAutoLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.DiagramMultiAutoLayout",properties:{options:undefined,layouterSymbols:undefined,layouterOptions:undefined,layouters:undefined,editor:undefined},methods:{multiLayoutDiagram:function(oOptions,aLayouterSymbols,aLayouterOptions,oDiagramEditor,fnSuccess,fnError){var self=this,aSelectedSymbols,index,max,oDiagramSymbols,oLayouterOptions,oAutoLayout,bError=false;oOptions=oOptions||{};if(oOptions.offsetX===undefined){oOptions.offsetX=50}if(oOptions.offsetY===undefined){oOptions.offsetY=50}this.options=oOptions;this.layouterSymbols=aLayouterSymbols;this.layouterOptions=aLayouterOptions;this.layouters=[];this.editor=oDiagramEditor;function performLayout(fnFinalSuccess,fnFinalError){if(index>=0&&index<max){oDiagramSymbols=aLayouterSymbols[index];oLayouterOptions=aLayouterOptions[index];if(self.options.isHorizontalCenter){oLayouterOptions.isVerticalCenter=true}if(self.options.isVerticalCenter){oLayouterOptions.isVerticalCenter=true}oAutoLayout=new sap.galilei.ui.editor.layout.DiagramAutoLayout();self.layouters.push(oAutoLayout);oAutoLayout.layoutDiagram(oDiagramSymbols,oLayouterOptions,undefined,function(oAutoLayout){if(index+1<max){index++;performLayout(fnFinalSuccess,fnFinalError)}else{if(fnFinalSuccess){fnFinalSuccess(self)}}},function(error){bError=true;if(fnFinalError){fnFinalError(error)}})}}function layoutAction(){performLayout(function(){self.updateSymbols();if(oDiagramEditor!==undefined&&aSelectedSymbols!==undefined){oDiagramEditor.selectSymbols(aSelectedSymbols)}if(fnSuccess){fnSuccess(self)}},function(error){if(fnError){fnError(error)}})}if(aLayouterSymbols!==undefined&&aLayouterOptions!==undefined&&aLayouterSymbols.length>0&&aLayouterSymbols.length===aLayouterOptions.length){if(oDiagramEditor!==undefined&&oDiagramEditor.selectedSymbols.length>0){aSelectedSymbols=[];for(index=0,max=oDiagramEditor.selectedSymbols.length;index<max;index++){aSelectedSymbols.push(oDiagramEditor.selectedSymbols[index])}oDiagramEditor.unselectAllSymbols()}index=0;max=aLayouterOptions.length;if(oDiagramEditor){oDiagramEditor.resource.applyUndoableAction(layoutAction,"Multi-Layout diagram")}else{layoutAction()}}else{if(fnError){fnError("Invalid parameters.")}}},moveGraphs:function(){var index,max,oLayouter,oBBox,x0,y0,width=0,height=0,x,y,dx,dy,aCenter;if(this.layouters!==undefined&&(this.options.isVerticalCenter||this.options.isHorizontalCenter)){for(index=0,max=this.layouters.length;index<max;index++){oLayouter=this.layouters[index];if(oLayouter.graph){oBBox=oLayouter.graph.getBBox();if(oBBox){if(x===undefined){x0=x=oBBox.x}if(y===undefined){y0=y=oBBox.y}dx=dy=0;if(this.options.isVerticalCenter){dy=y-oBBox.y}else{if(this.options.isHorizontalCenter){dx=x-oBBox.x}}if(dx!==0||dy!==0){oLayouter.graph.moveBy(dx,dy)}if(this.options.isVerticalCenter){y+=oBBox.height+this.options.offsetY;if(height!==0){height+=this.options.offsetY}height+=oBBox.height}else{if(this.options.isHorizontalCenter){x+=oBBox.width+this.options.offsetX;if(width!==0){width+=this.options.offsetX}width+=oBBox.width}}}}}if(this.options.isVerticalCenter){aCenter=[0,y0+height/2]}else{if(this.options.isHorizontalCenter){aCenter=[x0+width/2,0]}else{aCenter=[0,0]}}dx=-aCenter[0];dy=-aCenter[1];if(dx!==0||dy!==0){for(index=0,max=this.layouters.length;index<max;index++){oLayouter=this.layouters[index];if(oLayouter.graph){oLayouter.graph.moveBy(dx,dy)}}}}},updateSymbols:function(){var self=this,index,max,oLayouter,oTransitionDefinition;if(self.layouters!==undefined){self.moveGraphs();for(index=0,max=self.layouters.length;index<max;index++){oLayouter=self.layouters[index];oLayouter.updateSymbols()}}if(self.editor!==undefined){oTransitionDefinition=this.editor&&this.editor.transitionDefinition;if((navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1)&&navigator.appVersion.indexOf("Windows NT 10.")===-1){oTransitionDefinition=undefined}self.editor.drawAllSymbols(oTransitionDefinition)}}}})}());
(function(){sap.galilei.ui.editor.layout.OrderedStackLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.layout.OrderedStackLayout",parent:sap.galilei.ui.editor.layout.StackLayout,methods:{canChangeSymbolOwner:function(oSymbol,oOldParentSymbol,oNewParentSymbol){if(oNewParentSymbol!==undefined&&oNewParentSymbol.isDiagram){return false}return true},changeSymbolOrder:function(oSymbol,oOldParentSymbol,oNewParentSymbol,nOldIndex,nNewIndex){var oObject=(oSymbol&&oSymbol.isAlive)?oSymbol.object:this.object,bSaveGroup=(oNewParentSymbol===oOldParentSymbol),index;if(oSymbol&&oOldParentSymbol&&oNewParentSymbol&&!isNaN(nOldIndex)&&!isNaN(nNewIndex)&&(oOldParentSymbol!==oNewParentSymbol||nOldIndex!==nNewIndex)){if(!oSymbol.isInternal&&!oOldParentSymbol.isInternal&&!oNewParentSymbol.isInternal){if(bSaveGroup){oOldParentSymbol.symbols.removeAt(nOldIndex);if(nOldIndex<nNewIndex){--nNewIndex}oNewParentSymbol.symbols.insert(nNewIndex,oSymbol)}else{if(oSymbol.isAlive){index=oNewParentSymbol.symbols.indexOf(oSymbol);if(index!==-1){if(index!==nNewIndex){oNewParentSymbol.symbols.removeAt(index);oNewParentSymbol.symbols.insert(nNewIndex,oSymbol)}}else{oOldParentSymbol.symbols.removeAt(nOldIndex);oNewParentSymbol.symbols.insert(nNewIndex,oSymbol)}}}}if(oObject){this.changeObjectOrder(oObject,oOldParentSymbol.object,oNewParentSymbol.object,nOldIndex,nNewIndex)}}},changeObjectOrder:function(oObject,oOldParentObject,oNewParentObject,nOldIndex,nNewIndex){var bSaveGroup=(oNewParentObject===oOldParentObject),oOldCollectionInfo,oNewCollectionInfo,oOldCollectionDef,oNewCollectionDef,oOldCollection,oNewCollection,index;if(this.editor&&oObject&&oOldParentObject&&oNewParentObject&&!isNaN(nOldIndex)&&!isNaN(nNewIndex)&&(oOldParentObject!==oNewParentObject||nOldIndex!==nNewIndex)){oOldCollectionInfo=this.editor.getObjectClassReference(oObject.classDefinition.qualifiedName,oOldParentObject,undefined,true);if(oOldCollectionInfo!==undefined){oOldCollectionDef=oOldCollectionInfo.parentObject.classDefinition.getReference(oOldCollectionInfo.referenceName)}if(oOldCollectionDef&&oOldCollectionDef.isMany&&oOldCollectionDef.isOrdered){if(oNewParentObject!==oOldParentObject){oNewCollectionInfo=this.editor.getObjectClassReference(oObject.classDefinition.qualifiedName,oNewParentObject,undefined,true);if(oNewCollectionInfo!==undefined){oNewCollectionDef=oNewCollectionInfo.parentObject.classDefinition.getReference(oNewCollectionInfo.referenceName)}}else{oNewCollectionDef=oOldCollectionDef}if(oNewCollectionDef&&oNewCollectionDef.isMany&&oNewCollectionDef.isOrdered){oOldCollection=oOldParentObject[oOldCollectionDef.name];oNewCollection=oNewParentObject[oNewCollectionDef.name];if(oOldCollection!==undefined&&oNewCollection!==undefined){if(bSaveGroup){oOldCollection.removeAt(nOldIndex);oNewCollection.insert(nNewIndex,oObject)}else{index=oNewCollection.indexOf(oObject);if(index!==-1){if(index!==nNewIndex){oNewCollection.removeAt(index);oNewCollection.insert(nNewIndex,oObject)}}else{oOldCollection.removeAt(nOldIndex);oNewCollection.insert(nNewIndex,oObject)}}}}}}},beforeMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){},postMoveSymbol:function(oSymbol,oTracker,oEvent,oTransitionDefinition){var oOldParentSymbol=oSymbol.parentSymbol,oNewParentSymbol,nOldIndex=this.oldIndex,nNewIndex=this.newIndex;if(oSymbol&&oTracker){oNewParentSymbol=oTracker._parentHighlighter&&oTracker._parentHighlighter.highlighted;oNewParentSymbol=oNewParentSymbol||oSymbol.parentSymbol;if(oOldParentSymbol!==undefined&&oNewParentSymbol!==undefined&&!oNewParentSymbol.isDiagram&&!isNaN(nOldIndex)&&!isNaN(nNewIndex)){this.changeSymbolOrder(oSymbol,oOldParentSymbol,oNewParentSymbol,nOldIndex,nNewIndex)}}this.dispose()},beforeMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){},postMoveSymbols:function(aSymbols,oTracker,oEvent,oTransitionDefinition){var oOldParentSymbol,oNewParentSymbol,nOldIndex,nNewIndex=this.newIndex,index,oSymbolInfo,oSymbol,aUpdateSymbols=[];if(aSymbols!==undefined&&oTracker!==undefined){oNewParentSymbol=oTracker._parentHighlighter&&oTracker._parentHighlighter.highlighted;if(oNewParentSymbol!==undefined&&aSymbols!==undefined&&!isNaN(nNewIndex)){for(index=0;index<aSymbols.length;index++,nNewIndex++){oSymbol=aSymbols[index];oOldParentSymbol=oSymbol.parentSymbol;nOldIndex=oOldParentSymbol.symbols.indexOf(oSymbol);this.changeSymbolOrder(oSymbol,oOldParentSymbol,oNewParentSymbol,nOldIndex,nNewIndex);if(!oSymbol.isInternal){aUpdateSymbols.push(oSymbol)}}}}return aUpdateSymbols}}})}());
(function(){sap.galilei.ui.editor.DiagramEditor=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.DiagramEditor",initialize:function(oDiagram,sEditorSelector,oParam){if(!sEditorSelector){throw"Error: The parent node CSS selector must be specified."}this.diagram=oDiagram;this.setParentSelector(sEditorSelector);this.setViewerParameters(oParam,false);this.setExtensionParameters(oParam,false);this.preInitialization();if(oParam){this.set(oParam)}this.createViewer();this.createExtension();this.postInitialization();this.updateDiagram()},properties:{resource:{field:"_resource",get:function(){if(this._resource){return this._resource}if(this.model){return this.model.resource}if(this.diagram){return this.diagram.resource}return undefined},set:function(oResource){this._resource=oResource}},model:{field:"_model",get:function(){if(this._model){return this._model}if(this.diagram){return this.diagram.model||this.diagram.resource.model||this.diagram.container}return undefined},set:function(oModel){this._model=oModel}},diagram:{field:"_diagram",get:function(){return this._diagram},set:function(oNewDiagram){this.changeDiagram(oNewDiagram)}},isReadOnly:{value:false,onChange:function(){var index,aSymbols=[];if(this.viewer&&this.selectedSymbols.length>0){for(index=0;index<this.selectedSymbols.length;index++){aSymbols.push(this.selectedSymbols[index])}this.unselectAllSymbols();this.selectSymbols(aSymbols)}if(this.tool){this.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false)}}},extension:undefined,extensionClass:undefined,extensionParam:undefined,parentNodeSelector:undefined,viewer:undefined,viewerClass:undefined,viewerParam:undefined,showGrid:{get:function(){if(this.viewer){return this.viewer.showGrid}return false},set:function(bValue){if(this.viewer){this.viewer.showGrid=bValue}}},gridSize:{get:function(){if(this.viewer){return this.viewer.gridSize}return false},set:function(nValue){if(this.viewer){this.viewer.gridSize=nValue;if(this.snapToGrid){this.unselectAllSymbols()}}}},snapToGrid:{field:"_snapToGrid",value:false,get:function(){return this._snapToGrid},set:function(bValue){this._snapToGrid=bValue;this.unselectAllSymbols()}},snapToShapes:{field:"_snapToShapes",value:true,get:function(){return this._snapToShapes},set:function(bValue){this._snapToShapes=bValue;this.unselectAllSymbols()}},snapToShapesCenter:true,snapToShapesBorder:true,useContextButtonPad:true,orientation:undefined,isSwimlaneDetachable:false,selectedSymbols:{type:sap.galilei.core.EnumPropertyType.collection,writable:false},showConnectedSymbols:{field:"_showConnectedSymbols",value:false,get:function(){return this._showConnectedSymbols},set:function(bShow){var oSymbol;if(bShow!==undefined){this._showConnectedSymbols=bShow;if(this.diagram){if(this._showConnectedSymbols){if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols.get(0);this.highlightConnectedSymbols(oSymbol)}}else{this.unhighlightConnectedSymbols()}}}}},grayoutNonConnectedSymbols:false,hasHighlightedSymbol:false,highlightStrokeColor:sap.galilei.ui.common.style.Color.orange,highlightStrokeWidth:3,highlightFillColor:sap.galilei.ui.common.style.Color.orange,highlightFillColortBrightFactor:0.8,highlightStyleSheet:{field:"_highlightStyleSheet",get:function(){var oParam={};if(!this._highlightStyleSheet){if(this.highlightStrokeWidth!==undefined){oParam.strokeWidth=this.highlightStrokeWidth}if(this.highlightStrokeColor!==undefined){oParam.stroke=this.highlightStrokeColor}if(this.highlightFillColor!==undefined){if(this.highlightFillColortBrightFactor!==1){oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.highlightFillColor,this.highlightFillColortBrightFactor)}else{oParam.fill=this.highlightFillColor}}this._highlightStyleSheet=new sap.galilei.ui.common.style.StyleSheet(oParam)}return this._highlightStyleSheet}},tool:undefined,multiSelectionTracker:undefined,enableAnimation:{get:function(){return(this.viewer!==undefined)?this.viewer.enableAnimation:true},set:function(bEnableAnimation){if(this.viewer!==undefined){this.viewer.enableAnimation=bEnableAnimation}}},transitionDefinition:{get:function(){if(!this.enableAnimation){return false}if(!this._transitionDefinition){this._transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}return this._transitionDefinition},set:function(oTransitionDef){this._transitionDefinition=oTransitionDef}},undoRedoTransitionDefinition:{get:function(){if(!this.enableAnimation){return false}if(!this._undoTransitionDefinition){this._undoTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:500})}return this._undoTransitionDefinition},set:function(oTransitionDef){this._undoTransitionDefinition=oTransitionDef}},disableClearUndoRedo:false,isInUndoRedo:false,isActiveEditor:{get:function(){return sap.galilei.ui.editor.DiagramEditor.getActiveEditor()===this}},pressedKeys:undefined,profile:{field:"_profile",get:function(){return this._profile},set:function(value){this._profile=value;if(this.extension){this.extension.onSetEditorProfile(value)}}},enablePreserveLinkAfterDelete:true,enableSelectSymbol:true,selectSymbolAfterCreate:true,selectTableSymbolFirst:true,enableLinkRedirection:true,enableDeleteSymbol:true,enableInPlaceEditing:true,enableInPlaceEditingAfterCreate:true,inPlaceEditControlAdapterName:"sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter"},methods:{preInitialization:function(){},postInitialization:function(){var self=this;sap.galilei.core.Event.unSubscribeScope("register.symbol",this);sap.galilei.core.Event.subscribe("register.symbol",this.onRegisterSymbolEvent,this);sap.galilei.core.Event.unSubscribeScope("update.symbol",this);sap.galilei.core.Event.subscribe("update.symbol",this.onUpdateSymbol,this);sap.galilei.core.Event.unSubscribeScope("update.all.symbols",this);sap.galilei.core.Event.subscribe("update.all.symbols",this.onUpdateAllSymbols,this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.subscribe("delete.symbol",this.onDeleteSymbol,this);if(!this._symbolPointerTracker){this._symbolPointerTracker=new sap.galilei.ui.editor.tracker.SymbolPointerTracker({editor:this})}if(!this._linkSymbolPointerTracker){this._linkSymbolPointerTracker=new sap.galilei.ui.editor.tracker.LinkSymbolPointerTracker({editor:this})}if(!this._diagramPointerTracker){this._diagramPointerTracker=new sap.galilei.ui.editor.tracker.DiagramPointerTracker({editor:this})}if(!this._onKeyDownCallback){this._onKeyDownCallback=jQuery.proxy(this.onKeyDown,this);document.addEventListener("keydown",this._onKeyDownCallback,false)}if(!this._onKeyUpCallback){this._onKeyUpCallback=jQuery.proxy(this.onKeyUp,this);document.addEventListener("keyup",this._onKeyUpCallback,false)}this.pressedKeys={};this.registerDiagramEditor()},registerDiagramEditor:function(){var index;if(!sap.galilei.ui.editor.DiagramEditor.diagramEditors){sap.galilei.ui.editor.DiagramEditor.diagramEditors=[]}index=sap.galilei.ui.editor.DiagramEditor.diagramEditors.indexOf(this);if(index===-1){sap.galilei.ui.editor.DiagramEditor.diagramEditors.push(this)}},unregisterDiagramEditor:function(){var index;if(sap.galilei.ui.editor.DiagramEditor.diagramEditors){index=sap.galilei.ui.editor.DiagramEditor.diagramEditors.indexOf(this);if(index!==-1){sap.galilei.ui.editor.DiagramEditor.diagramEditors.splice(index,1)}}},onRegisterSymbolEvent:function(oEvent){if(oEvent&&oEvent.sourceSymbol){this.registerSymbolEvents(oEvent.sourceSymbol)}},onUpdateSymbol:function(oEvent){this.extension.onUpdateSymbol(oEvent)},onUpdateAllSymbols:function(oEvent){if(this.diagram){var index,max,oSymbol,aLinkSymbols=[];oEvent=oEvent||{};for(index=0,max=this.diagram.symbols.length;index<max;++index){oSymbol=this.diagram.symbols.get(index);oEvent.sourceSymbol=oSymbol;if(oSymbol.isLinkSymbol){aLinkSymbols.push(oSymbol)}else{this.onUpdateSymbol(oEvent)}}for(index=0,max=aLinkSymbols.length;index<max;index++){oEvent.sourceSymbol=aLinkSymbols[index];this.onUpdateSymbol(oEvent)}}},onDeleteSymbol:function(oEvent){this.extension.onDeleteSymbol(oEvent)},handleArrowKey:function(oEvent){var self=this,nKeyCode=oEvent&&oEvent.keyCode,bProcessed=false,bResize=false,nDelta=10,dx=0,dy=0,dWidth=0,dHeight=0,oSymbol,oTracker;if(this.selectedSymbols.length>0){if(!this._isDisableMoveSymbolByArrow){if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];if(oEvent.ctrlKey){if(oSymbol.isKeepSize||this.isReadOnly){return false}bResize=true}if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")){return this.handleRowSymbolArrowKey(oEvent)}if(oSymbol.isKeepPosition||this.isReadOnly){return false}oTracker=oSymbol._tracker}else{if(this.isReadOnly){return false}oTracker=this.multiSelectionTracker}if(!bResize){switch(nKeyCode){case 37:dx=-nDelta;break;case 39:dx=nDelta;break;case 38:dy=-nDelta;break;case 40:dy=nDelta;break}}else{switch(nKeyCode){case 37:dWidth=-(nDelta+nDelta);break;case 39:dWidth=nDelta+nDelta;break;case 38:dHeight=nDelta+nDelta;break;case 40:dHeight=-(nDelta+nDelta);break}}if(oTracker&&oTracker.initialBBox){if(oTracker.getOrCreateParentHighlighter){oTracker.getOrCreateParentHighlighter()}if(!bResize){oTracker.movedBBox=oTracker.initialBBox.clone();oTracker.movedBBox.moveBy(dx,dy);if(this.selectedSymbols.length===1){if(oTracker.canMoveShape(oEvent)){oTracker.moveShape(oEvent)}}else{if(oTracker.canMoveSymbols(oEvent)){oTracker.moveSymbols(oEvent)}}}else{if(this.selectedSymbols.length===1){oTracker.resizedBBox=oTracker.initialBBox.clone();oTracker.resizedBBox.resize(oTracker.resizedBBox.width+dWidth,oTracker.resizedBBox.height+dHeight,false,false,true);if(oTracker.canResizeShape(oEvent)){oTracker.resizeShape(oEvent)}}else{}}this._isDisableMoveSymbolByArrow=true;setTimeout(function(){delete self._isDisableMoveSymbolByArrow},100)}}bProcessed=true}return bProcessed},handleRowSymbolArrowKey:function(oEvent){var nKeyCode=oEvent&&oEvent.keyCode,bProcessed=false,oSymbol,index,oldIndex,nCount,oSelectSymbol;if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")){nCount=oSymbol.parentSymbol.symbols.length;index=oldIndex=oSymbol.parentSymbol.symbols.indexOf(oSymbol);switch(nKeyCode){case 38:--index;bProcessed=true;break;case 40:++index;bProcessed=true;break;case 36:index=0;bProcessed=true;break;case 35:index=nCount-1;bProcessed=true;break}if(index>=0&&index<nCount&&index!==oldIndex){oSelectSymbol=oSymbol.parentSymbol.symbols.get(index);this.unselectSymbol(oSymbol,true,undefined,false);this.selectSymbol(oSelectSymbol,true,undefined,true,false,true)}}}return bProcessed},defaultOnKeyDown:function(oEvent){var bProcessed=false,index,oLayer,oSymbol,oTracker;if(this.viewer&&!this.viewer.hasFocus){return false}switch(oEvent.keyCode){case 65:if(oEvent.ctrlKey){this.selectAllSymbols(true);bProcessed=true}break;case 83:if(oEvent.ctrlKey&&oEvent.shiftKey){this.getSymbolSize();bProcessed=true}else{if(oEvent.ctrlKey&&oEvent.altKey){this.applySymbolSize();bProcessed=true}}break;case 89:if(oEvent.ctrlKey&&!this.isReadOnly){this.redo();bProcessed=true}break;case 90:if(oEvent.ctrlKey&&!this.isReadOnly){this.undo();bProcessed=true}break;case 46:if(!this.isReadOnly&&this.enableDeleteSymbol){this.deleteSelectedSymbols(!oEvent.ctrlKey,this.enablePreserveLinkAfterDelete,true);bProcessed=true}break;case 27:if(this.tool&&this.tool.name!==sap.galilei.ui.editor.tool.PointerTool.NAME){this.tool.onUnselected();this.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);bProcessed=true}else{if(this.selectedSymbols.length>0){if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];oTracker=oSymbol._tracker}else{oTracker=this.multiSelectionTracker}if(oTracker){oTracker.cancel();bProcessed=true}}}break;case 37:case 39:case 38:case 40:case 36:case 35:bProcessed=this.handleArrowKey(oEvent);break;case 113:if(!this.isReadOnly&&this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];this.enterInPlaceEditing(oSymbol);bProcessed=true}break}if(!bProcessed){for(index=0;index<this.viewer.layers.length;++index){oLayer=this.viewer.layers[index];if(oLayer.isVisible&&oLayer.defaultOnKeyDown){if(oLayer.defaultOnKeyDown(oEvent)){bProcessed=true;break}}}}return bProcessed},onKeyDown:function(oEvent){if(this.viewer&&!this.viewer.hasFocus){return false}var bProcessed=this.extension.onKeyDown(oEvent);if(!this.pressedKeys){this.pressedKeys={}}this.pressedKeys.ctrlKey=oEvent.ctrlKey;this.pressedKeys.shiftKey=oEvent.shiftKey;this.pressedKeys.altKey=oEvent.altKey;if(bProcessed){oEvent.preventDefault();oEvent.stopImmediatePropagation()}return bProcessed},defaultOnKeyUp:function(oEvent){var self=this,bProcessed=false,index,oLayer;if(this.viewer&&!this.viewer.hasFocus){return false}if(!bProcessed){for(index=0;index<this.viewer.layers.length;++index){oLayer=this.viewer.layers[index];if(oLayer.isVisible&&oLayer.defaultOnKeyUp){if(oLayer.defaultOnKeyUp(oEvent)){bProcessed=true;break}}}}return bProcessed},onKeyUp:function(oEvent){if(this.viewer&&!this.viewer.hasFocus){return false}if(!this.pressedKeys){this.pressedKeys={}}this.pressedKeys.ctrlKey=oEvent.ctrlKey;this.pressedKeys.shiftKey=oEvent.shiftKey;this.pressedKeys.altKey=oEvent.altKey;var bProcessed=this.extension.onKeyUp(oEvent);if(bProcessed){oEvent.preventDefault();oEvent.stopImmediatePropagation()}return bProcessed},setParentSelector:function(sEditorSelector,bRecreate){var oOldDiagram,nOldScale,nOldTranslate,index,aSymbols=[];this.parentNodeSelector=sEditorSelector;if(bRecreate){this.resetEditor(true,true)}},resetEditor:function(bPreserveZoomScale,bPreserveSelection){var oOldDiagram,nOldScale,nOldTranslate,index,aSymbols=[];oOldDiagram=this.diagram;if(oOldDiagram){if(bPreserveSelection&&this.selectedSymbols.length>0){for(index=0;index<this.selectedSymbols.length;index++){aSymbols.push(this.selectedSymbols[index])}}this.unselectAllSymbols();this.unregisterAllSymbolEvents()}if(this.viewer){nOldScale=this.viewer.zoomScale;nOldTranslate=this.viewer.zoomTranslate;this.viewer.dispose();this.viewer.setParentNode(this.parentNodeSelector);this.viewer.createSvg();this.viewer.layers.forEach(function(oLayer){oLayer.isDisableKeyboardEvents=true})}if(this.extension){this.extension.onInitialize()}this.diagram=undefined;if(bPreserveZoomScale&&nOldScale!==undefined&&nOldTranslate){this.viewer.zoomTo(nOldScale,nOldTranslate,false)}this.diagram=oOldDiagram;if(aSymbols.length>0){this.selectSymbols(aSymbols)}},setExtensionParameters:function(oParam,bCreate){var sProp;this.extensionParam={};if(oParam&&oParam.extension){if(oParam.extension.extensionClass){this.extensionClass=oParam.extension.extensionClass}for(sProp in oParam.extension){if(oParam.extension.hasOwnProperty(sProp)){this.extensionParam[sProp]=oParam.extension[sProp]}}delete oParam.extension}if(bCreate||bCreate===undefined){this.createExtension()}},setViewerParameters:function(oParam,bCreate){var sProp;this.viewerParam={};if(oParam&&oParam.viewer){if(oParam.viewer.viewerClass){this.viewerClass=oParam.viewer.viewerClass}for(sProp in oParam.viewer){if(oParam.viewer.hasOwnProperty(sProp)){this.viewerParam[sProp]=oParam.viewer[sProp]}}delete oParam.viewer;if(bCreate||bCreate===undefined){this.createViewer()}}},createExtension:function(){var ExtensionClass=this.extensionClass,oExtensionParam=this.extensionParam||{};if(this.extension){this.extension.dispose()}if(typeof ExtensionClass==="string"){ExtensionClass=sap.galilei.core.getClass(ExtensionClass)}ExtensionClass=ExtensionClass||sap.galilei.ui.editor.DiagramEditorExtension;this.extension=new ExtensionClass(this,oExtensionParam);if(!this.extension){throw"Error: Cannot create the diagram editor extension."}this.updateExtension();return this.extension},createViewer:function(){var ViewerClass=this.viewerClass||sap.galilei.ui.common.svg.Viewer,oViewerParam=this.viewerParam||{};this.viewer=new ViewerClass(this.parentNodeSelector,oViewerParam);if(!this.viewer){throw"Error: Cannot create the viewer."}this.viewer.onPreZoomPan=jQuery.proxy(this.onPreZoomPan,this);this.viewer.onPostZoomPan=jQuery.proxy(this.onPostZoomPan,this);this.viewer.layers.forEach(function(oLayer){oLayer.isDisableKeyboardEvents=true});return this.viewer},updateExtension:function(){this.registerStandardTools();this.registerDiagramTools();this.registerDiagramCommands()},dispose:function(){var oNode,index,max;if(this._diagram){this.unselectAllSymbols();this.unregisterAllSymbolEvents();if(this._diagram.dispose){this._diagram.dispose()}}if(this._diagramPointerTracker){this._diagramPointerTracker.dispose();this._diagramPointerTracker=undefined}if(this._linkSymbolPointerTracker){this._linkSymbolPointerTracker.dispose();this._linkSymbolPointerTracker=undefined}if(this._symbolPointerTracker){this._symbolPointerTracker.dispose();this._symbolPointerTracker=undefined}if(this._onKeyDownCallback){document.removeEventListener("keydown",this._onKeyDownCallback,false);this._onKeyDownCallback=undefined}if(this._onKeyUpCallback){document.removeEventListener("keyup",this._onKeyUpCallback,false);this._onKeyUpCallback=undefined}sap.galilei.core.Event.unSubscribeScope("update.symbol",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);this.tool=undefined;this.multiSelectionTracker=undefined;this._diagram=undefined;this._model=undefined;this._resource=undefined;this._toolsDefinition=undefined;this.unregisterDiagramEditor();oNode=this.viewer.d3MainShapeLayer&&this.viewer.d3MainShapeLayer.node();if(oNode&&oNode.childNodes){for(max=oNode.childNodes.length,index=max-1;index>=0;index--){oNode.removeChild(oNode.childNodes[index])}}},changeDiagram:function(oNewDiagram,bForceChange){var oldDiagram=this.diagram;if(oldDiagram!==oNewDiagram||bForceChange){if(oldDiagram!==undefined){this.dispose()}this._diagram=oNewDiagram;if(oNewDiagram){if(!this.disableClearUndoRedo){this.clearUndoRedo()}this.disableClearUndoRedo=true}if(this.viewer&&this._diagram){this.postInitialization();this.updateDiagram()}}return oldDiagram},updateDiagram:function(oTransitionDef,aAttributes){var self=this;if(this.diagram){if(this._linkSymbolPointerTracker){this._linkSymbolPointerTracker.removeEventHandlers();this._linkSymbolPointerTracker.addEventHandlers()}if(this._diagramPointerTracker){this._diagramPointerTracker.removeEventHandlers();this._diagramPointerTracker.addEventHandlers()}this.registerAllSymbolEvents();this.drawAllSymbols(oTransitionDef,aAttributes);this.resource.applyUndoableAction(function(){self.adjustAllSymbols(oTransitionDef)},"AdjustAllSymbols",true)}},changeResource:function(oResource,bClearOldResource){if(oResource){var oOldResource=this.resource,oNewDiagram,index;for(index=0;index<oResource.objects.length;index++){oNewDiagram=oResource.objects.get(index);if(sap.galilei.model.isInstanceOf(oNewDiagram,"sap.galilei.ui.diagram.Diagram")){this.changeDiagram(oNewDiagram,true);break}}if(oOldResource&&bClearOldResource){oOldResource.clear()}}},getQualifiedObjectClassName:function(sObjectClassName){if(sObjectClassName){if(this.extension.modelPackageName&&sObjectClassName.indexOf(".")===-1){sObjectClassName=this.extension.modelPackageName+"."+sObjectClassName}}return sObjectClassName},getQualifiedSymbolClassName:function(sSymbolClassName){if(sSymbolClassName){if(this.extension.diagramPackageName&&sSymbolClassName.indexOf(".")===-1){sSymbolClassName=this.extension.diagramPackageName+"."+sSymbolClassName}}return sSymbolClassName},getObjectClass:function(sObjectClassName){if(sObjectClassName){sObjectClassName=this.getQualifiedObjectClassName(sObjectClassName);return this.extension.getObjectClass(sObjectClassName)}return undefined},getSymbolClass:function(sSymbolClassName){if(sSymbolClassName){sSymbolClassName=this.getQualifiedSymbolClassName(sSymbolClassName);return sap.galilei.model.getClass(sSymbolClassName)}return undefined},getObjectClassOfSymbolClass:function(sSymbolClassName){var oSymbolClass;if(sSymbolClassName){oSymbolClass=this.getSymbolClass(sSymbolClassName);if(oSymbolClass&&oSymbolClass.runtimeClass){return oSymbolClass.runtimeClass.objectClass}}return undefined},setDefaultObjectName:function(oObject){this.extension.setDefaultObjectName(oObject)},defaultCanCreateSymbol:function(sSymbolClass,oCreateParam){return this.extension.defaultCanCreateSymbol(sSymbolClass,oCreateParam)},canCreateSymbol:function(sSymbolClass,oCreateParam){return this.extension.canCreateSymbol(sSymbolClass,oCreateParam)},canCreateObject:function(sObjectClass,oParent,oProperties){return this.extension.canCreateObject(sObjectClass,oParent,oProperties)},defaultCanSetObjectProperties:function(oObject,oProperties){return true},canSetObjectProperties:function(oObject,oProperties){return this.extension.canSetObjectProperties(oObject,oProperties)},canCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkTool){return this.extension.canCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkTool)},canInsertSymbolOnLinkSymbol:function(sSymbolClass,oCreateParam){return this.extension.canInsertSymbolOnLinkSymbol(sSymbolClass,oCreateParam)},canPreserveLinkAfterDelete:function(oSymbol){return this.extension.canPreserveLinkAfterDelete(oSymbol)},selectLinkSymbolDefinition:function(oSourceSymbol,oTargetSymbol){return this.extension.selectLinkSymbolDefinition(oSourceSymbol,oTargetSymbol)},defaultPostCreateSymbol:function(oSymbol){if(oSymbol.isSwimlaneSymbol&&!oSymbol.isDetachable&&oSymbol.parentSymbol&&oSymbol.parentSymbol.isSwimlaneSymbol){var oBBox=oSymbol.parentSymbol.getContentAreaBBox();oSymbol.moveTo(oSymbol.isVertical?oSymbol.x:oBBox.x,oSymbol.isVertical?oBBox.y:oSymbol.y,undefined,this.viewer)}return oSymbol},postCreateSymbol:function(oSymbol){return this.extension.postCreateSymbol(oSymbol)},postCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkSymbol){return this.extension.postCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkSymbol)},defaultCreateObject:function(sObjectClassName,oParam){var oObjectClass,oObject,sProp;if(sObjectClassName){oObjectClass=this.getObjectClass(sObjectClassName);if(oObjectClass){oParam=oParam||{};oParam._creationContext=oParam._creationContext||{};oParam._creationContext.diagram=oParam._creationContext.diagram||this.diagram;oObject=oObjectClass.create(this.resource,oParam);if(oObject){for(sProp in oParam){oObject.set(sProp,oParam[sProp])}this.setDefaultObjectName(oObject)}}}return oObject},createObject:function(sObjectClassName,oParam){return this.extension.createObject(sObjectClassName,oParam)},defaultCreateSymbol:function(sSymbolClassName,oParam){var oSymbolClass,oSymbol,sProp;if(sSymbolClassName){oSymbolClass=this.getSymbolClass(sSymbolClassName);if(oSymbolClass){oParam=oParam||{};oSymbol=oSymbolClass.create(this.resource,oParam);if(oSymbol){for(sProp in oParam){oSymbol.set(sProp,oParam[sProp])}}}}return oSymbol},createSymbol:function(sSymbolClassName,oParam){return this.extension.createSymbol(sSymbolClassName,oParam)},defaultCreateSymbolAndObject:function(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex){var oSymbol,oObject,oEvent={},oContext;if(!sObjectClass&&sSymbolClass){sObjectClass=this.getObjectClassOfSymbolClass(sSymbolClass)}if(oObjectParent){oObjectParams=oObjectParams||{};oObjectParams._creationContext=oObjectParams._creationContext||{};oObjectParams._creationContext.container=oObjectParent;if(sObjectReference){oObjectParams._creationContext.containmentReference=sObjectReference;if(nObjectIndex!==undefined){oObjectParams._creationContext.containmentIndex=nObjectIndex}}if(oSymbolParent&&oSymbolParent.isDiagram){oObjectParams._creationContext.diagram=oSymbolParent}else{if(this.diagram){oObjectParams._creationContext.diagram=this.diagram}}}if(sObjectClass){oObject=this.createObject(sObjectClass,oObjectParams);if(oObject){this.insertObject(oObject,nObjectIndex,oObjectParent,sObjectReference)}}if(sSymbolClass){oSymbolParams=oSymbolParams||{};oSymbolParams.object=oObject;oSymbol=this.createSymbol(sSymbolClass,oSymbolParams);delete oSymbolParams.object;if(oSymbol){this.insertSymbol(oSymbol,nSymbolIndex,oSymbolParent);this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("create.symbol",this,this,oEvent)}}return oSymbol},createSymbolAndObject:function(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex){return this.extension.createSymbolAndObject(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex)},defaultGetParentObjectByParentSymbol:function(oParentSymbol,sObjectClass){if(oParentSymbol&&oParentSymbol.object){return oParentSymbol.object}return this.diagram.container},getParentObjectByParentSymbol:function(oParentSymbol,sObjectClass){return this.extension.getParentObjectByParentSymbol(oParentSymbol,sObjectClass)},getLinkObjectSourceReferenceName:function(sLinkObjectClass){return this.extension.getLinkObjectSourceReferenceName(sLinkObjectClass)},getLinkObjectTargetReferenceName:function(sLinkObjectClass){return this.extension.getLinkObjectTargetReferenceName(sLinkObjectClass)},getLinkObjectSource:function(oLinkObject){var sSourceName;sSourceName=oLinkObject&&oLinkObject.isLinkObject&&this.getLinkObjectSourceReferenceName(oLinkObject.classDefinition.qualifiedName);return sSourceName&&oLinkObject[sSourceName]},getLinkObjectTarget:function(oLinkObject){var sTargetName;sTargetName=oLinkObject&&oLinkObject.isLinkObject&&this.getLinkObjectTargetReferenceName(oLinkObject.classDefinition.qualifiedName);return sTargetName&&oLinkObject[sTargetName]},canCreateLinkObject:function(oSourceObject,oTargetObject,sObjectClassName,oParent,oProperties){return this.extension.canCreateLinkObject(oSourceObject,oTargetObject,sObjectClassName,oParent,oProperties)},defaultCreateLinkSymbolAndObject:function(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2){var oSourceObject,oTargetObject,oLinkObject,oLinkSymbol,oParam={},oEvent={};if(oSourceSymbol&&oTargetSymbol){if(oLinkObjectParams){oSourceObject=oLinkObjectParams[this.getLinkObjectSourceReferenceName(sLinkObjectClass)];oTargetObject=oLinkObjectParams[this.getLinkObjectTargetReferenceName(sLinkObjectClass)]}oSourceObject=oSourceObject||oSourceSymbol.object;oTargetObject=oTargetObject||oTargetSymbol.object;if(!sLinkObjectClass&&sLinkSymbolClass){sLinkObjectClass=this.getObjectClassOfSymbolClass(sLinkSymbolClass)}if(sLinkObjectClass&&oSourceObject&&oTargetObject){if(oLinkObjectParams){sap.galilei.core.copyProperties(oParam,oLinkObjectParams)}oParam[this.getLinkObjectSourceReferenceName(sLinkObjectClass)]=oSourceObject;oParam[this.getLinkObjectTargetReferenceName(sLinkObjectClass)]=oTargetObject;oParam._creationContext=oParam._creationContext||{};oParam._creationContext.container=oParam._creationContext.container||oLinkObjectParent;oLinkObject=this.createObject(sLinkObjectClass,oParam);if(oLinkObject){if(!oLinkObject.container){this.addObject(oLinkObject,oLinkObjectParent,sLinkObjectReference)}if(oLinkObjectParent2&&sLinkObjectReference2){this.addObject(oLinkObject,oLinkObjectParent2,sLinkObjectReference2)}}}if(sLinkSymbolClass){oLinkSymbolParams=oLinkSymbolParams||{};oLinkSymbolParams.sourceSymbol=oSourceSymbol;oLinkSymbolParams.targetSymbol=oTargetSymbol;if(oLinkObject){oLinkSymbolParams.object=oLinkObject}oLinkSymbol=this.createSymbol(sLinkSymbolClass,oLinkSymbolParams);if(oLinkObject){delete oLinkSymbolParams.object}if(oLinkSymbol){this.addSymbol(oLinkSymbol,oLinkSymbolParent);this.addEventProperties(oEvent,oLinkSymbol);sap.galilei.core.Event.publish("create.linksymbol",this,this,oEvent)}}}return oLinkSymbol},createLinkSymbolAndObject:function(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2){return this.extension.createLinkSymbolAndObject(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2)},copyObjectProperties:function(oTargetObject,oSourceObject,aExcludeNames){if(oTargetObject&&oSourceObject){this.extension.copyObjectProperties(oTargetObject,oSourceObject,aExcludeNames)}},defaultReplaceObjectAndSymbol:function(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions){var oOldSymbol=oSymbol,oOldObject,oNewSymbol,oNewObject,bReplaceDirectReferences,sOldSourceName,sOldTargetName,sSourceName,sTargetName,aExcludeNames,bChangeSymbol,bSelected,index,oSubsymbol,aSubsymbols=[],oEvent;if(oSymbol&&sObjectClass){oOldSymbol=oSymbol;oOldObject=oOldSymbol.object;bChangeSymbol=(sSymbolClass!==undefined);oOptions=oOptions||{};bReplaceDirectReferences=(oOptions.preserveDirectReferences!==undefined)?oOptions.preserveDirectReferences:true;if(oOldSymbol&&oOldObject&&bChangeSymbol){for(index=0;index<oOldSymbol.symbols.length;index++){oSubsymbol=oOldSymbol.symbols.get(index);if(oSubsymbol.object){aSubsymbols.push(oSubsymbol)}}}if(oOldObject.isLinkObject){sOldSourceName=this.getLinkObjectSourceReferenceName(oOldObject.classDefinition.qualifiedName);sOldTargetName=this.getLinkObjectTargetReferenceName(oOldObject.classDefinition.qualifiedName);sSourceName=this.getLinkObjectSourceReferenceName(sObjectClass);sTargetName=this.getLinkObjectTargetReferenceName(sObjectClass)}oNewObject=this.createObject(sObjectClass,oObjectParams);if(oNewObject){if(oObjectParams){aExcludeNames=sap.galilei.core.getObjectPropertyNames(oObjectParams)}this.copyObjectProperties(oNewObject,oOldObject,aExcludeNames);if(bChangeSymbol){oOldSymbol.object=undefined}oOldObject.replaceByObject(oNewObject,bReplaceDirectReferences);if(sOldSourceName&&sOldTargetName&&sSourceName&&sTargetName){if(sOldSourceName!==sSourceName){oNewObject[sOldSourceName]=undefined;oNewObject[sSourceName]=oSymbol.sourceSymbol.object}if(sOldTargetName!==sTargetName){oNewObject[sOldTargetName]=undefined;oNewObject[sTargetName]=oSymbol.targetSymbol.object}}if(bChangeSymbol){oNewSymbol=this.createSymbol(sSymbolClass,oSymbolParams);if(!oNewSymbol){console.log("Cannot create symbol "+sSymbolClass);oNewObject.deleteObject();return undefined}if(oOldSymbol){oNewSymbol.x=oOldSymbol.x;oNewSymbol.y=oOldSymbol.y;oNewSymbol.width=oOldSymbol.width;oNewSymbol.height=oOldSymbol.height;oNewSymbol.zindex=oOldSymbol.zindex;bSelected=oOldSymbol.isSelected;if(oSymbolParams){sap.galilei.core.copyProperties(oNewSymbol,oSymbolParams)}oOldSymbol.replaceByObject(oNewSymbol,bReplaceDirectReferences);oNewSymbol.dispose();this.deleteSymbol(oOldSymbol,true,false);for(index=0;index<aSubsymbols.length;index++){oSubsymbol=aSubsymbols[index];if(oNewSymbol.symbols.contains(oSubsymbol)&&!oSubsymbol.object){this.deleteSymbol(oSubsymbol,true,false)}}oNewSymbol.object=oNewObject;this.registerSymbolEvents(oNewSymbol);oEvent={};this.addEventProperties(oEvent,oNewSymbol);sap.galilei.core.Event.publish("create.symbol",this,this,oEvent)}this.updateSymbolDrawingOrder();this.drawSymbol(oNewSymbol);this.layoutLinkSymbols(oNewSymbol);if(bSelected){this.selectSymbol(oNewSymbol)}}else{this.drawSymbol(oSymbol)}}else{console.log("Cannot create object "+sObjectClass)}}return oNewSymbol},replaceObjectAndSymbol:function(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions){return this.extension.replaceObjectAndSymbol(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions)},checkSubSymbols:function(oSymbol){this.extension.checkSubSymbols(oSymbol)},layoutLinkSymbols:function(oSymbol,bAutomaticRouting){var oLinks,oLinkSymbol,index;if(oSymbol){bAutomaticRouting=bAutomaticRouting===undefined?true:bAutomaticRouting;oLinks=oSymbol.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];if(oLinkSymbol.sourceSymbol===oSymbol||oLinkSymbol.targetSymbol===oSymbol){oLinkSymbol.isAutomaticRouting=bAutomaticRouting;oLinkSymbol.updateLinkRouting(true,this.viewer)}}}}},defaultRegisterSymbolEvents:function(oSymbol){if(oSymbol!==undefined&&(oSymbol.diagram===undefined||oSymbol.diagram===this.diagram)){this.updateSymbolEvents(oSymbol);if(this._linkSymbolPointerTracker){this._linkSymbolPointerTracker.addEventHandlers(oSymbol)}if(this._symbolPointerTracker){this._symbolPointerTracker.addEventHandlers(oSymbol)}if(!oSymbol._mouseHoverHandler){oSymbol._mouseHoverHandler=new sap.galilei.ui.editor.tracker.MouseHoverHandler(oSymbol);oSymbol._mouseHoverHandler.editor=this}this.registerSymbolDecorators(oSymbol)}},updateSymbolEvents:function(oSymbol){var oSymbolClass,oShape;if(oSymbol!==undefined&&(oSymbol.diagram===undefined||oSymbol.diagram===this.diagram)){oSymbolClass=oSymbol.runtimeClass;if(oSymbolClass&&oSymbolClass.events){oSymbol.onEvents(oSymbolClass.events,undefined,oSymbol,this.extension)}oShape=oSymbol.getOrCreateShape();if(oShape){this.updateSymbolShapeEvents(oSymbol,oShape)}}},updateSymbolShapeEvents:function(oSymbol,oShape){var index;if(oSymbol&&oShape){if(oShape.events){oShape.onEvents(oShape.events,undefined,oSymbol,this.extension)}if(oShape.isComposite){for(index=0;index<oShape.shapes.length;index++){this.updateSymbolShapeEvents(oSymbol,oShape.shapes[index])}}}},registerSymbolEvents:function(oSymbol){if(oSymbol!==undefined&&!oSymbol._isEventsRegistered&&(oSymbol.diagram===undefined||oSymbol.diagram===this.diagram)){if(this.extension){this.extension.registerSymbolEvents(oSymbol)}if(oSymbol.isComposite){this.registerSymbolsEvents(oSymbol.symbols)}oSymbol._isEventsRegistered=true}},registerSymbolsEvents:function(vSymbols){var index,oSymbol;if(vSymbols){for(index=0;index<vSymbols.length;++index){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.registerSymbolEvents(oSymbol)}}},registerAllSymbolEvents:function(){if(this.diagram!==undefined){this.registerSymbolsEvents(this.diagram.symbols)}},defaultUnregisterSymbolEvents:function(oSymbol){if(oSymbol!==undefined&&oSymbol._isEventsRegistered&&(oSymbol.diagram===undefined||oSymbol.diagram===this.diagram)){if(this._symbolPointerTracker){this._symbolPointerTracker.removeEventHandlers(oSymbol)}if(this._linkSymbolPointerTracker){this._linkSymbolPointerTracker.removeEventHandlers(oSymbol)}this.removeSymbolDecorators(oSymbol);delete oSymbol._isEventsRegistered}},unregisterSymbolEvents:function(oSymbol){if(oSymbol!==undefined&&oSymbol._isEventsRegistered&&(oSymbol.diagram===undefined||oSymbol.diagram===this.diagram)){if(this.extension){this.extension.unregisterSymbolEvents(oSymbol)}if(oSymbol.isComposite){this.unregisterSymbolsEvents(oSymbol.symbols)}}},unregisterSymbolsEvents:function(oSymbols){var index,oSymbol;if(oSymbols!==undefined){for(index=0;index<oSymbols.length;++index){oSymbol=oSymbols.get(index);this.unregisterSymbolEvents(oSymbol)}}},unregisterAllSymbolEvents:function(){if(this.diagram!==undefined){this.unregisterSymbolsEvents(this.diagram.symbols)}},getAllSymbols:function(fnFilter){if(this.diagram!==undefined){return this.diagram.getAllSymbols(fnFilter)}return[]},getDisplayedObjects:function(fnFilter){if(this.diagram!==undefined){return this.diagram.getDisplayedObjects(fnFilter)}return[]},getAllObjects:function(fnFilter){var aObjects=[],index,max,oObject;if(this.resource!==undefined){for(index=0,max=this.resource.objects.length;index<max;index++){oObject=this.resource.objects.get(index);if(!oObject.isModel&&!oObject.isDiagram&&!oObject.isSymbol&&(fnFilter===undefined||fnFilter.call(undefined,oObject)===true)){aObjects.push(oObject)}}}return aObjects},isSymbolInView:function(oSymbol){if(oSymbol!==undefined&&!oSymbol.isHidden){return this.viewer.isRectInView(oSymbol.getBBox())}return false},isSymbolVisible:function(oSymbol){if(oSymbol!==undefined&&!oSymbol.isHidden){return this.viewer.isRectVisible(oSymbol.getBBox())}return false},getActiveSymbol:function(){var oElement=document.activeElement,oFocusedSymbol;if(oElement!=undefined){if(oElement.nodeName==="g"&&(sap.galilei.ui.common.svg.Svg.hasClass(oElement,"sapGalileiSymbolNode")||sap.galilei.ui.common.svg.Svg.hasClass(oElement,"sapGalileiSymbolLink"))){oFocusedSymbol=this.resource.selectObject({isSymbol:true,"object.objectId":oElement.id})}}return oFocusedSymbol},getSymbolSize:function(){var oSymbol;this.defaultSymbolSize=undefined;if(this.selectedSymbols.length>0){oSymbol=this.selectedSymbols.get(this.selectedSymbols.length-1);if(!oSymbol.isLinkSymbol){this.defaultSymbolSize={width:oSymbol.width,height:oSymbol.height}}}return this.defaultSymbolSize},applySymbolSize:function(){var self=this,index,max=this.selectedSymbols.length,oSymbol,bIsLinkSymbol,oResizeOptions;if(!this.isReadOnly&&this.defaultSymbolSize&&max>0){this.resource.applyUndoableAction(function(){oResizeOptions={moveSubSymbols:true,moveLinkSymbols:true,keepCenter:true,extendToContent:true,extendParent:true,updateBoundarySymbols:true,updateLinkSymbols:true};for(index=0;index<max;index++){oSymbol=self.selectedSymbols.get(index);if(!oSymbol.isLinkSymbol&&!oSymbol.isKeepSize){if(!isNaN(self.defaultSymbolSize.width)&&!isNaN(self.defaultSymbolSize.height)&&(oSymbol.width!==self.defaultSymbolSize.width||oSymbol.height!==self.defaultSymbolSize.height)){oSymbol.resize(self.defaultSymbolSize.width,self.defaultSymbolSize.height,oResizeOptions,self.viewer,self.transitionDefinition)}}}},"Apply size")}},bringSymbolToView:function(oSymbol,bPreserveZoomScale,bCenterInView){if(oSymbol){this.bringSymbolsToView([oSymbol],bPreserveZoomScale,bCenterInView)}return this},bringSymbolsToView:function(aSymbols,bPreserveZoomScale,bCenterInView){var self=this,oRect,oBBox;function computeBBox(oSymbol){var oButton,oPopup;oBBox=oSymbol.getBBox();if(oRect){oRect.unionRect(oBBox)}else{oRect=oBBox}oButton=oSymbol._contextButtonPad;if(oButton&&!oButton.isHidden){oBBox=oButton.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0){oBBox=self.viewer.clientBBoxToViewBBox(oBBox,false,true);oRect.unionRect(oBBox)}if(oButton.getPopupContextButtonPad){oPopup=oButton.getPopupContextButtonPad();if(oPopup&&!oPopup.isHidden){oBBox=oPopup.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0){oBBox=self.viewer.clientBBoxToViewBBox(oBBox,false,true);oRect.unionRect(oBBox)}}}}}if(aSymbols){aSymbols.forEach(computeBBox)}if(oRect){this.viewer.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,bPreserveZoomScale,bCenterInView)}return this},bringSelectedSymbolsToView:function(bPreserveZoomScale,bCenterInView){this.bringSymbolsToView(this.selectedSymbols,bPreserveZoomScale,bCenterInView)},zoomIn:function(){this.viewer.zoomIn();return this},zoomOut:function(){this.viewer.zoomOut();return this},zoomToPercentage:function(iPercentage){this.viewer.zoomToPercentage(iPercentage);return this},showInitialView:function(){this.viewer.showInitialView();return this},getGlobalViewRect:function(fnFilter){var aSymbols=this.getAllSymbols(fnFilter),index,max,oSymbol,oRect,oBBox;for(index=0,max=aSymbols.length;index<max;index++){oSymbol=aSymbols[index];if(!oSymbol.isHidden){oBBox=oSymbol.getBBox();if(oRect){oRect.unionRect(oBBox)}else{oRect=oBBox}}}return oRect},showGlobalView:function(){var oRect=this.getGlobalViewRect();if(oRect){this.viewer.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,false,true)}return this},getObjectClassReference:function(sObjectClassName,oParentObject,sObjectReference,bIsContainment){return this.extension.getObjectClassReference(sObjectClassName,oParentObject,sObjectReference,bIsContainment)},getObjectReference:function(oObject,oParentObject,sObjectReference,bIsContainment){return this.extension.getObjectReference(oObject,oParentObject,sObjectReference,bIsContainment)},updateReference:function(oObject,oParentObject,sObjectReference,bIsContainment,bAddOrRemove){var oInitialParentObject=oParentObject,oReference,oReferenceDefinition,oReferenceClass,oChildObject,index;if(oObject&&oParentObject){oReferenceDefinition=this.getObjectReference(oObject,oParentObject,sObjectReference,bIsContainment);if(oReferenceDefinition){sObjectReference=oReferenceDefinition.referenceName;if(oReferenceDefinition.isInverse!==true){oParentObject=oReferenceDefinition.parentObject;oChildObject=oObject}else{oParentObject=oObject;oChildObject=oReferenceDefinition.parentObject}if(oParentObject&&sObjectReference){if(bAddOrRemove===true){oChildObject.addReference(oParentObject,sObjectReference)}else{oChildObject.removeReference(oParentObject,sObjectReference)}}}}},addObject:function(oObject,oParentObject,sObjectReference){return this.insertObject(oObject,-1,oParentObject,sObjectReference)},insertObject:function(oObject,nIndex,oParentObject,sObjectReference){if(oObject){var oInitialParentObject=oParentObject,sInitialObjectReference=sObjectReference,oReferenceDefinition,oReference;oReferenceDefinition=this.getObjectReference(oObject,oParentObject,sObjectReference,true);if(oReferenceDefinition){oParentObject=oReferenceDefinition.parentObject;sObjectReference=oReferenceDefinition.referenceName}if(oParentObject){if(sObjectReference&&oParentObject[sObjectReference]){oReference=oParentObject[sObjectReference];if(oReference.indexOf(oObject)===-1){if(nIndex!==undefined&&nIndex>=0&&nIndex<oReference.length){oReference.insert(nIndex,oObject)}else{oReference.push(oObject)}if(oInitialParentObject&&oParentObject!==oInitialParentObject){this.updateReference(oObject,oInitialParentObject,sInitialObjectReference,false,true)}}}else{throw"Cannot find the reference for "+oObject.classDefinition.qualifiedName+(oParentObject?" in "+oParentObject.classDefinition.qualifiedName:"")}}else{console.log("Cannot find the parent object to insert "+oObject.classDefinition.qualifiedName+".")}}return oObject},addSymbol:function(oSymbol,oParentSymbol){return this.insertSymbol(oSymbol,-1,oParentSymbol)},insertSymbol:function(oSymbol,nIndex,oParentSymbol){if(oSymbol){var oContainer,nMax;if(oParentSymbol&&(oParentSymbol.isDiagram||oParentSymbol.isComposite)){oContainer=oParentSymbol;if(!oParentSymbol.isDiagram&&!oSymbol.isBoundarySymbol){oParentSymbol.isExpanded=true}}else{oContainer=this.diagram}if(oContainer&&oContainer.symbols.indexOf(oSymbol)===-1){nMax=oContainer.symbols.length;if(nIndex!==undefined&&nIndex>=0&&nIndex<nMax){oContainer.symbols.insert(nIndex,oSymbol)}else{oContainer.symbols.push(oSymbol)}this.registerSymbolEvents(oSymbol)}}return oSymbol},canDeleteSymbol:function(oSymbol){if(oSymbol){if(this.extension){return this.extension.canDeleteSymbol(oSymbol)}}return true},canDeleteSymbols:function(aSymbols){if(aSymbols){if(this.extension){return this.extension.canDeleteSymbols(aSymbols)}}return true},detachSymbol:function(oSymbol,bUseAnimation){if(oSymbol){this.unselectSymbol(oSymbol);if(bUseAnimation===undefined){bUseAnimation=true}oSymbol.hide(this.viewer,bUseAnimation?this.transitionDefinition:undefined);this.unregisterSymbolEvents(oSymbol);oSymbol.dispose()}},detachSymbols:function(vSymbols,bUseAnimation){var index,oSymbol;if(vSymbols){for(index=0;index<vSymbols.length;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.detachSymbol(oSymbol,bUseAnimation)}}},deleteSymbol:function(oSymbol,bDeleteObject,bPreserveLink,bUseUndoAction,bTriggerPostDelete,bCheckCanDelete){var self=this;bDeleteObject=bDeleteObject===undefined?true:bDeleteObject;bPreserveLink=bPreserveLink===undefined?this.enablePreserveLinkAfterDelete:bPreserveLink;bPreserveLink=bPreserveLink&&this.canPreserveLinkAfterDelete(oSymbol);bUseUndoAction=bUseUndoAction===undefined?true:bUseUndoAction;bTriggerPostDelete=bTriggerPostDelete===undefined?true:bTriggerPostDelete;bCheckCanDelete=bCheckCanDelete===undefined?true:bCheckCanDelete;function deleteSymbolAction(){var aRootSwimlanes=[],oRootSwimLane,oLinks,oLink,index,oLinkSymbol1,oLinkSymbol2,oContainer,oRelatedSymbols,nRelatedSymbolsIndex,nRelatedSymbolsCount,oCurrentRelatedSymbol,oLayouter;oContainer=oSymbol.container;if(oSymbol.isSwimlaneSymbol&&oSymbol.parentSymbol){aRootSwimlanes.push(sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oSymbol.parentSymbol));oRelatedSymbols=oSymbol.object&&oSymbol.object.relatedSymbols;if(oRelatedSymbols){for(nRelatedSymbolsIndex=0,nRelatedSymbolsCount=oRelatedSymbols.length;nRelatedSymbolsIndex<nRelatedSymbolsCount;nRelatedSymbolsIndex++){oCurrentRelatedSymbol=oRelatedSymbols.get(nRelatedSymbolsIndex);oRootSwimLane=oCurrentRelatedSymbol&&oCurrentRelatedSymbol.isSwimlaneSymbol&&oCurrentRelatedSymbol.parentSymbol&&sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oCurrentRelatedSymbol.parentSymbol);if(oRootSwimLane&&aRootSwimlanes.indexOf(oRootSwimLane)===-1){aRootSwimlanes.push(oRootSwimLane)}}}}if(bPreserveLink){oLinks=oSymbol.getLinkSymbols();if(oLinks&&oLinks.length===2){for(index=0;index<oLinks.length;index++){oLink=oLinks[index];if(oLink.targetSymbol===oSymbol&&oLink.sourceSymbol!==oSymbol){oLinkSymbol1=oLink}else{if(oLink.sourceSymbol===oSymbol&&oLink.targetSymbol!==oSymbol){oLinkSymbol2=oLink}}}}if(oLinkSymbol1&&oLinkSymbol2&&oLinkSymbol1.classDefinition===oLinkSymbol2.classDefinition){if(oLinkSymbol1.object&&oLinkSymbol2.object){oLinkSymbol1.object[self.getLinkObjectTargetReferenceName(oLinkSymbol1.object.classDefinition.qualifiedName)]=oLinkSymbol2.targetSymbol.object}oLinkSymbol1.targetSymbol=oLinkSymbol2.targetSymbol;oLinkSymbol1.isAutomaticRouting=true;oLinkSymbol1.updateLinkRouting(false);oLinkSymbol1.drawSymbol(self.viewer,self.transitionDefinition)}}oLayouter=self.getOrCreateSymbolLayouter(oSymbol);if(oLayouter&&oLayouter.beforeDeleteSymbol){oLayouter.beforeDeleteSymbol(oSymbol,self.transitionDefinition)}self.detachSymbol(oSymbol);if(oSymbol.parentSymbol!==undefined&&oSymbol.parentSymbol!==self.diagram){index=oSymbol.parentSymbol.symbols.indexOf(oSymbol);if(index!==-1){index=oSymbol.parentSymbol.symbols.removeAt(index)}}oSymbol.deleteSymbol(bDeleteObject);if(aRootSwimlanes.length>0){for(nRelatedSymbolsIndex=0,nRelatedSymbolsCount=aRootSwimlanes.length;nRelatedSymbolsIndex<nRelatedSymbolsCount;nRelatedSymbolsIndex++){oCurrentRelatedSymbol=aRootSwimlanes[nRelatedSymbolsIndex];oCurrentRelatedSymbol.layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.transitionDefinition)}}if(oLayouter&&oLayouter.postDeleteSymbol){oLayouter.postDeleteSymbol(self.transitionDefinition)}if(bTriggerPostDelete){self.postDeleteSymbol(oContainer,oSymbol)}}function deleteObjectAction(){var oObject=oSymbol.object;if(oObject!==undefined&&oObject.isAlive&&!oObject.isDeleting){oObject.deleteObject()}}if(oSymbol){if(!bCheckCanDelete||(!this.isReadOnly&&this.canDeleteSymbol(oSymbol))){oSymbol.isDeleting=true;if(oSymbol.isInternal){if(bUseUndoAction){this.resource.applyUndoableAction(deleteObjectAction,"Delete an Object")}else{deleteObjectAction()}}else{if(bUseUndoAction){this.resource.applyUndoableAction(deleteSymbolAction,"Delete a Symbol")}else{deleteSymbolAction()}}}}},postDeleteSymbol:function(oContainer,oDeletedSymbol,bDeleteObject,bPreserveLink,bUseUndoAction){if(this.extension.postDeleteSymbol){this.extension.postDeleteSymbol(oContainer,oDeletedSymbol,bDeleteObject,bPreserveLink,bUseUndoAction)}},deleteSymbols:function(vSymbols,bDeleteObject,bPreserveLink,bUseUndoAction,bTriggerPostDelete,bCheckCanDelete){var self=this,aSelectedSymbols=[],aDeleteSymbols=[],aDeleteObjects=[];bDeleteObject=bDeleteObject===undefined?true:bDeleteObject;bPreserveLink=bPreserveLink===undefined?this.enablePreserveLinkAfterDelete:bPreserveLink;bUseUndoAction=bUseUndoAction===undefined?true:bUseUndoAction;bTriggerPostDelete=bTriggerPostDelete===undefined?true:bTriggerPostDelete;bCheckCanDelete=bCheckCanDelete===undefined?true:bCheckCanDelete;function deleteSymbolsAction(){var nLoop,index,oSymbol,aContainers=[],aSymbols=[];for(nLoop=0;nLoop<2;nLoop++){for(index=0;index<aDeleteSymbols.length;index++){oSymbol=aDeleteSymbols[index];if((nLoop===0&&oSymbol.isLinkSymbol)||(nLoop===1&&!oSymbol.isLinkSymbol)){if(oSymbol.container){aContainers.push(oSymbol.container);aSymbols.push(oSymbol)}self.deleteSymbol(oSymbol,bDeleteObject,bPreserveLink,false,bTriggerPostDelete,bCheckCanDelete)}}}if(bTriggerPostDelete){self.postDeleteSymbols(aContainers,aSymbols,bDeleteObject,bPreserveLink,bUseUndoAction)}}function deleteObjectsAction(){var index,max,oObject;for(index=0,max=aDeleteObjects.length;index<max;index++){oObject=aDeleteObjects[index];if(oObject.isAlive&&!oObject.isDeleting){oObject.deleteObject()}}}function isParentSymbolSelected(oSymbol){var bSelected;if(oSymbol){while(oSymbol.parentSymbol){if(vSymbols instanceof Array){bSelected=vSymbols.indexOf(oSymbol.parentSymbol)!==-1}else{bSelected=vSymbols.contains(oSymbol.parentSymbol)}if(bSelected){return true}oSymbol=oSymbol.parentSymbol}}return false}function filterSubsymbols(){var index,oSymbol;for(index=0;index<vSymbols.length;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}if(!isParentSymbolSelected(oSymbol)){aSelectedSymbols.push(oSymbol);if(oSymbol.isInternal){if(oSymbol.object!==undefined){aDeleteObjects.push(oSymbol.object)}}else{aDeleteSymbols.push(oSymbol)}}}}filterSubsymbols();if(!this.isReadOnly&&vSymbols){if(!bCheckCanDelete||this.canDeleteSymbols(aSelectedSymbols)){if(aDeleteSymbols.length>0){if(bUseUndoAction){this.resource.applyUndoableAction(deleteSymbolsAction,"Delete Symbols")}else{deleteSymbolsAction()}}if(aDeleteObjects.length>0){if(bUseUndoAction){this.resource.applyUndoableAction(deleteObjectsAction,"Delete Objects")}else{deleteObjectsAction()}}}}},postDeleteSymbols:function(aContainers,aDeletedSymbols,bDeleteObject,bPreserveLink,bUseUndoAction){if(this.extension.postDeleteSymbols){this.extension.postDeleteSymbols(aContainers,aDeletedSymbols,bDeleteObject,bPreserveLink,bUseUndoAction)}},deleteSelectedSymbols:function(bDeleteObject,bPreserveLink,bUseUndoAction,bTriggerPostDelete,bCheckCanDelete){var index,aSymbols=[],oSymbol;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];aSymbols.push(oSymbol)}this.deleteSymbols(aSymbols,bDeleteObject,bPreserveLink,bUseUndoAction,bTriggerPostDelete,bCheckCanDelete)},deleteAllSymbols:function(bDeleteObject,bUseUndoAction,bClearUndoRedo){var self=this;bDeleteObject=bDeleteObject===undefined?true:bDeleteObject;bUseUndoAction=bUseUndoAction===undefined?false:bUseUndoAction;bClearUndoRedo=bClearUndoRedo===undefined?true:bClearUndoRedo;function deleteAllSymbolsAction(){if(self.diagram){self.deleteSymbols(self.diagram.symbols,bDeleteObject,false,false,false,false);if(bDeleteObject){self.model.children.deleteAll()}}}this.resource.applyUndoableAction(deleteAllSymbolsAction,"Delete All Symbols",!bUseUndoAction);if(!bUseUndoAction&&bClearUndoRedo){this.clearUndoRedo()}},changeObjectOwner:function(oObject,oNewObjectOwner){if(oObject&&oNewObjectOwner&&oObject.container!==oNewObjectOwner){var oReferenceDefinition=this.getObjectReference(oObject,oNewObjectOwner),oOldReferenceDefinition=this.getObjectReference(oObject,oObject.container),sReference=oReferenceDefinition&&oReferenceDefinition.referenceName,sOldReference=oOldReferenceDefinition&&oOldReferenceDefinition.referenceName;if(oObject&&oNewObjectOwner&&sReference){oNewObjectOwner=oReferenceDefinition.parentObject;oObject.setContainer(oNewObjectOwner,sReference,sOldReference)}}},changeAggregationContainer:function(oObject,oOldSymbolOwner,oNewSymbolOwner,oOldObjectOwner,oNewObjectOwner){var oOldReferenceDefinition,sOldReference,oOldReference,oReferenceDefinition,sReference,oReference,index;if(oObject&&oOldSymbolOwner&&oNewSymbolOwner&&oNewSymbolOwner!==oOldSymbolOwner){if(oOldSymbolOwner.object){this.updateReference(oObject,oOldSymbolOwner.object,undefined,false,false)}if(oNewSymbolOwner.object){this.updateReference(oObject,oNewSymbolOwner.object,undefined,false,true)}}},changeSymbolOwner:function(oSymbol,oNewSymbolOwner){var oOldSymbolOwner=oSymbol&&oSymbol.container,oObject,oNewObjectOwner,oOldObjectOwner,bChanged=false;if(oSymbol&&oNewSymbolOwner&&oOldSymbolOwner){if(oNewSymbolOwner!==oOldSymbolOwner){bChanged=true;oSymbol.owner=oNewSymbolOwner;if(!oSymbol.isBoundarySymbol){if(oNewSymbolOwner.isComposite){oNewSymbolOwner.isExpanded=true}if(oOldSymbolOwner.isComposite&&oOldSymbolOwner.contentSymbols.length===0){oOldSymbolOwner.isExpanded=false}}oObject=oSymbol.object;if(oObject&&oObject.classDefinition){oOldObjectOwner=oObject&&oObject.container;oNewObjectOwner=this.getParentObjectByParentSymbol(oNewSymbolOwner,oObject.classDefinition.qualifiedName)||this.model;if(oNewObjectOwner&&oOldObjectOwner&&oNewObjectOwner!==oOldObjectOwner){this.changeObjectOwner(oObject,oNewObjectOwner)}if(oOldSymbolOwner&&oNewSymbolOwner&&oNewSymbolOwner!==oOldSymbolOwner){this.changeAggregationContainer(oObject,oOldSymbolOwner,oNewSymbolOwner,oOldObjectOwner,oNewObjectOwner)}}}}return bChanged},drawSymbol:function(oSymbol,oTransitionDef,aAttributes){if(oSymbol&&oSymbol.diagram===this.diagram){oSymbol.drawSymbol(this.viewer,oTransitionDef,aAttributes);this.showSymbolDecorators(oSymbol,oTransitionDef)}},drawSymbols:function(vSelection,oTransitionDef,aAttributes){if(vSelection){var index,oSymbol,aLinkSymbols=[];for(index=0;index<vSelection.length;++index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}if(oSymbol.isLinkSymbol){aLinkSymbols.push(oSymbol)}else{this.drawSymbol(oSymbol,oTransitionDef,aAttributes)}}for(index=0;index<aLinkSymbols.length;index++){this.drawSymbol(aLinkSymbols[index],oTransitionDef,aAttributes)}}},drawAllSymbols:function(oTransitionDef,aAttributes){if(this.diagram){this.drawSymbols(this.diagram.symbols,oTransitionDef,aAttributes)}},adjustSymbol:function(oSymbol,oTransitionDef){if(oSymbol){if(!oSymbol.isLinkSymbol&&oSymbol.isAdjustToContent){oSymbol.adjustToContent(this.viewer,oTransitionDef)}}},adjustSymbols:function(vSelection,oTransitionDef){if(vSelection){var index,oSymbol;for(index=0;index<vSelection.length;++index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}this.adjustSymbol(oSymbol,oTransitionDef)}this.updateSymbolDrawingOrder(oTransitionDef)}},adjustAllSymbols:function(oTransitionDef){if(this.diagram){this.adjustSymbols(this.diagram.symbols,oTransitionDef)}},getOrCreateSymbolTracker:function(oSymbol){return this.extension.getOrCreateSymbolTracker(oSymbol)},removeSymbolTracker:function(oSymbol){if(oSymbol){if(oSymbol._tracker){oSymbol._tracker.dispose();oSymbol._tracker=undefined}this.removeSymbolInPlaceEditControl(oSymbol)}},getOrCreateSymbolLayouter:function(oSymbol){var oLayouterClassDefinition,sSymbolClass,sLayouterClass,oParams;if(oSymbol!==undefined){if(oSymbol._layouter===undefined){sSymbolClass=oSymbol.classDefinition.qualifiedName;oLayouterClassDefinition=oSymbol.symbolLayouter;if(oLayouterClassDefinition!==undefined){sLayouterClass=oLayouterClassDefinition.className;if(sLayouterClass){oParams={editor:this,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200})};sap.galilei.core.copyProperties(oParams,oLayouterClassDefinition);if(oParams.symbolClass===undefined){oParams.symbolClass=sSymbolClass}delete oParams.className;oSymbol._layouter=sap.galilei.core.createNewInstance(sLayouterClass,oParams)}}}return oSymbol._layouter}},removeSymbolLayouter:function(oSymbol){if(oSymbol){if(oSymbol._layouter){oSymbol._layouter.dispose();oSymbol._layouter=undefined}}},getParentHighlighter:function(sSymbolClass,oSpecificParams){var oHighlighterClassDefinition,sDefaultHighlighterClass="sap.galilei.ui.editor.tracker.SymbolHighlighter",sHighlighterClass,oParams;oParams={editor:this,radius:5,strokeWidth:5};if(oSpecificParams!==undefined){sap.galilei.core.copyProperties(oParams,oSpecificParams)}if(sSymbolClass!==undefined){oHighlighterClassDefinition=sap.galilei.model.getClassStaticProperty(sSymbolClass,"parentSymbolHighlighter");if(oHighlighterClassDefinition!==undefined){sHighlighterClass=oHighlighterClassDefinition.className;sap.galilei.core.copyProperties(oParams,oHighlighterClassDefinition);if(oParams.symbolClass===undefined){oParams.symbolClass=sSymbolClass}delete oParams.className}}sHighlighterClass=sHighlighterClass||sDefaultHighlighterClass;return sap.galilei.core.createNewInstance(sHighlighterClass,oParams)},canSupportInPlaceEditing:function(oSymbol,aClientPoint,nFieldIndex){var bSupported=false;if(!this.isReadOnly&&this.enableInPlaceEditing&&oSymbol){if(this.extension.canSupportInPlaceEditing){bSupported=this.extension.canSupportInPlaceEditing(oSymbol,aClientPoint,nFieldIndex)}else{bSupported=true}}return bSupported},enterInPlaceEditing:function(oSymbol,aClientPoint,nFieldIndex){if(this.canSupportInPlaceEditing(oSymbol,aClientPoint,nFieldIndex)){var nField=-1;if(!oSymbol._inPlaceEditControl){oSymbol._inPlaceEditControl=new sap.galilei.ui.editor.widget.InPlaceEditControl({controlAdapterName:this.inPlaceEditControlAdapterName,editor:this,symbol:oSymbol})}if(aClientPoint){nField=oSymbol._inPlaceEditControl.getFieldIndex(aClientPoint);if(nField!==-1){oSymbol._inPlaceEditControl.createControlAt(aClientPoint);oSymbol._inPlaceEditControl.moveToField(nField);oSymbol._inPlaceEditControl.showWidgetAt(aClientPoint)}}else{oSymbol._inPlaceEditControl.createControl();oSymbol._inPlaceEditControl.moveToField(nFieldIndex);oSymbol._inPlaceEditControl.showWidget()}return oSymbol._inPlaceEditControl}return undefined},removeSymbolInPlaceEditControl:function(oSymbol){if(oSymbol&&oSymbol._inPlaceEditControl){oSymbol._inPlaceEditControl.dispose();oSymbol._inPlaceEditControl=undefined}},getEditablePropertyInfo:function(oSymbol,oInfo){return this.extension.getEditablePropertyInfo(oSymbol,oInfo)},getOrCreateMultiSelectionTracker:function(){if(!this.multiSelectionTracker){var oSymbol,i,bContainsSwimlane=false,nTransitionDuration=200,oParams;for(i=0;i<this.selectedSymbols.length;i++){oSymbol=this.selectedSymbols[i];if(oSymbol&&oSymbol.isSwimlaneSymbol&&!oSymbol.isDetachable){bContainsSwimlane=true;break}}oParams={editor:this,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:nTransitionDuration}),endTransitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:nTransitionDuration})};if(bContainsSwimlane){this.multiSelectionTracker=new sap.galilei.ui.editor.tracker.SwimlaneMultiSelectionTracker(oParams)}else{this.multiSelectionTracker=new sap.galilei.ui.editor.tracker.MultiSelectionTracker(oParams)}}return this.multiSelectionTracker},removeMultiSelectionTracker:function(){if(this.multiSelectionTracker){this.multiSelectionTracker.dispose();this.multiSelectionTracker=undefined}},getOrCreateContextButtonPad:function(oSymbol){if(this.extension){return this.extension.getOrCreateContextButtonPad(oSymbol)}return undefined},getContextButtonPad:function(oSymbol){if(this.extension){return this.extension.getContextButtonPad(oSymbol)}return undefined},showContextButtonPad:function(oSymbol){if(oSymbol&&oSymbol._contextButtonPad){oSymbol._contextButtonPad.showButtonPad()}},hideContextButtonPad:function(oSymbol){if(oSymbol&&oSymbol._contextButtonPad){oSymbol._contextButtonPad.hideButtonPad()}},removeContextButtonPad:function(oSymbol){if(oSymbol&&oSymbol._contextButtonPad){oSymbol._contextButtonPad.dispose();oSymbol._contextButtonPad=undefined}},registerSymbolDecorators:function(oSymbol){var oSymbolClass,index,oDecorator;if(oSymbol){oSymbolClass=oSymbol.runtimeClass;if(oSymbolClass&&oSymbolClass.decorators&&oSymbolClass.decorators.length>0){for(index=0;index<oSymbolClass.decorators.length;index++){oDecorator=oSymbolClass.decorators[index];oSymbol.addDecorator(oDecorator)}}}},showSymbolDecorators:function(oSymbol,oTransition){if(oSymbol&&oSymbol.isDrawn){oTransition=oTransition||this.transitionDefinition;sap.galilei.ui.editor.widget.WidgetGroup.showDecorators(this,oSymbol,oTransition)}},showAllSymbolDecorators:function(oTransition){var aAllSymbols=this.getAllSymbols(),index;if(aAllSymbols){for(index=0;index<aAllSymbols.length;index++){this.showSymbolDecorators(aAllSymbols[index],oTransition)}}},hideSymbolDecorators:function(oSymbol,oTransition){if(oSymbol){oTransition=oTransition||this.transitionDefinition;sap.galilei.ui.editor.widget.WidgetGroup.hideDecorators(this,oSymbol,oTransition)}},hideAllSymbolDecorators:function(oTransition){var aAllSymbols=this.getAllSymbols(),index;if(aAllSymbols){for(index=0;index<aAllSymbols.length;index++){this.hideSymbolDecorators(aAllSymbols[index],oTransition)}}},removeSymbolDecorators:function(oSymbol,oTransition){if(oSymbol){oTransition=oTransition||this.transitionDefinition;sap.galilei.ui.editor.widget.WidgetGroup.removeDecorators(this,oSymbol,oTransition)}},removeAllSymbolDecorators:function(oTransition){var aAllSymbols=this.getAllSymbols(),index;if(aAllSymbols){for(index=0;index<aAllSymbols.length;index++){this.removeSymbolDecorators(aAllSymbols[index],oTransition)}}},selectSymbol:function(oSymbol,bDraw,oTransitionDef,bNotify,bBringToView,bShowContextButtonPad){if(this.enableSelectSymbol&&oSymbol&&!this.selectedSymbols.contains(oSymbol)){var nOldSelected=this.selectedSymbols.length,oMultiSelectionTracker,bSelected=false;if(!oSymbol.isSelected){oSymbol.isSelected=true;bSelected=true}if(!this.selectedSymbols.contains(oSymbol)){this.selectedSymbols.add(oSymbol);bSelected=true}if(bSelected&&(bDraw===undefined||bDraw)){oSymbol.addClass("sapGalileiSelected");if(this.selectedSymbols.length===1){this.highlightConnectedSymbols(oSymbol);this.getOrCreateSymbolTracker(oSymbol);if(this.useContextButtonPad&&bShowContextButtonPad!==false){this.getOrCreateContextButtonPad(oSymbol)}}else{if(nOldSelected===1){this.getOrCreateMultiSelectionTracker().showAllSelection()}else{oMultiSelectionTracker=this.getOrCreateMultiSelectionTracker();oMultiSelectionTracker.showSelection(oSymbol);oMultiSelectionTracker.updateSelectionFrame()}}if((bBringToView||bBringToView===undefined)&&!oSymbol.isLinkSymbol&&oSymbol.width<=200&&oSymbol.height<=200){if(this.selectedSymbols.length===1){this.bringSymbolToView(oSymbol,true,false)}else{this.bringSymbolsToView(this.selectedSymbols,true,false)}}if(bNotify||bNotify===undefined){this.notifySymbolSelection(oSymbol)}}}},notifySymbolSelection:function(oSymbol){var oEvent={};this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("symbol.selected",this,this,oEvent);oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)},selectSymbols:function(vSelection,bSelectSubSymbols,bDraw,oTransitionDef){if(this.enableSelectSymbol&&vSelection){var index,oSymbol,oEvent={};for(index=0;index<vSelection.length;++index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}if(oSymbol.isHidden){oSymbol=undefined}else{this.selectSymbol(oSymbol,bDraw,oTransitionDef,false,false);if(bSelectSubSymbols&&oSymbol.isComposite){this.selectSymbols(oSymbol.symbols,bSelectSubSymbols,bDraw,oTransitionDef)}}}if(oSymbol){this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("symbol.selected",this,this,oEvent)}if(vSelection.length>0){oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)}}},selectAllSymbols:function(bDraw,oTransitionDef){if(this.diagram){this.selectSymbols(this.diagram.symbols,true,bDraw,oTransitionDef)}},unselectSymbol:function(oSymbol,bDraw,oTransitionDef,bNotify){if(oSymbol&&this.selectedSymbols.contains(oSymbol)){var nOldSelected=this.selectedSymbols.length,bUnselected=false;if(oSymbol.isSelected){oSymbol.isSelected=false;bUnselected=true}if(this.selectedSymbols.contains(oSymbol)){this.selectedSymbols.remove(oSymbol);bUnselected=true}if(bUnselected&&(bDraw===undefined||bDraw)){oSymbol.removeClass("sapGalileiSelected");this.removeSymbolTracker(oSymbol);this.removeContextButtonPad(oSymbol);this.removeSymbolLayouter(oSymbol);if(nOldSelected>1){if(this.multiSelectionTracker){this.multiSelectionTracker.hideSelection(oSymbol)}}if(this.selectedSymbols.length===1){this.removeMultiSelectionTracker();this.getOrCreateSymbolTracker(this.selectedSymbols[0])}else{if(this.selectedSymbols.length>1){this.getOrCreateMultiSelectionTracker().updateSelectionFrame()}else{this.unhighlightConnectedSymbols()}}if(bNotify||bNotify===undefined){this.notifySymbolUnselection(oSymbol)}}}},notifySymbolUnselection:function(oSymbol){var oEvent={};this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("symbol.unselected",this,this,oEvent);oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)},unselectSymbols:function(vSelection,bDraw,oTransitionDef,oExcludeSybmol,bNotify){if(vSelection){var index,oSymbol,nUnselected=0,oEvent={};oEvent.notify=bNotify;for(index=vSelection.length-1;index>=0;--index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}if(oExcludeSybmol&&oSymbol===oExcludeSybmol){oSymbol=undefined;continue}this.unselectSymbol(oSymbol,bDraw,oTransitionDef,false);nUnselected++}this.addEventProperties(oEvent,oSymbol);if(oSymbol){sap.galilei.core.Event.publish("symbol.unselected",this,this,oEvent)}if(nUnselected>0){oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)}}},unselectAllSymbols:function(bDraw,oTransitionDef,oExcludeSybmol,bNotify){if(this.diagram){this.unselectSymbols(this.selectedSymbols,bDraw,oTransitionDef,oExcludeSybmol,bNotify)}},isParentSymbolSelected:function(oParentSymbol){var index,oSymbol;if(oParentSymbol){for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];if(oSymbol===oParentSymbol){return true}}if(oParentSymbol.parentSymbol){return this.isParentSymbolSelected(oParentSymbol.parentSymbol)}}return false},defaultCanSelectSymbolByPoint:function(oSymbol,aViewPoint){var oBBox,oHeaderBBox,oExcludeBBox,nDelta;if(oSymbol&&aViewPoint&&oSymbol.isSwimlaneSymbol){oBBox=oSymbol.getBBox();oHeaderBBox=oSymbol.getHeaderAreaBBox();nDelta=oSymbol.isVertical?oHeaderBBox.height:oHeaderBBox.width;if(nDelta*2<Math.min(oBBox.width,oBBox.height)){oExcludeBBox=oBBox.inflate(-nDelta,-nDelta,-nDelta,-nDelta,true)}if(!oBBox.isPointInRect(aViewPoint)||(oExcludeBBox&&oExcludeBBox.isPointInRect(aViewPoint))){return false}}return true},canSelectSymbolByPoint:function(oSymbol,aViewPoint){if(this.extension){return this.extension.canSelectSymbolByPoint(oSymbol,aViewPoint)}return true},highlightSymbol:function(oSymbol,oStyleSheet,fnStyleSheetFilter,oTransitionDefinition){if(oSymbol){oSymbol.highlight(oStyleSheet||this.highlightStyleSheet,fnStyleSheetFilter,this.viewer,oTransitionDefinition||this.transitionDefinition)}},highlightSymbols:function(vSymbols,oStyleSheet,fnStyleSheetFilter,bGrayOutOtherSymbols,vExcludeGrayOutsymbols,oTransitionDefinition){var index,max,oSymbol,aAllSymbols;if(vSymbols){max=vSymbols.length;if(max>0){bGrayOutOtherSymbols=(bGrayOutOtherSymbols!==undefined)?bGrayOutOtherSymbols:false;for(index=0;index<max;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.highlightSymbol(oSymbol,oStyleSheet,fnStyleSheetFilter,oTransitionDefinition)}if(bGrayOutOtherSymbols){aAllSymbols=this.getAllSymbols();for(index=0,max=aAllSymbols.length;index<max;index++){oSymbol=aAllSymbols[index];if(vSymbols.indexOf(oSymbol)===-1){if(vExcludeGrayOutsymbols&&vExcludeGrayOutsymbols.indexOf(oSymbol)!==-1){continue}this.grayOutSymbol(oSymbol,oTransitionDefinition)}}}}}},grayOutSymbol:function(oSymbol,oTransitionDefinition){if(oSymbol){oSymbol.grayOut(this.viewer,oTransitionDefinition||this.transitionDefinition)}},grayOutSymbols:function(vSymbols,oTransitionDefinition){var index,max,oSymbol;if(vSymbols){for(index=0,max=vSymbols.length;index<max;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.grayOutSymbol(oSymbol,oTransitionDefinition)}}},unhighlightSymbol:function(oSymbol,oTransitionDefinition){if(oSymbol){oSymbol.unhighlight(this.viewer,oTransitionDefinition||this.transitionDefinition)}},unhighlightSymbols:function(vSymbols,oTransitionDefinition){var index,max,oSymbol;if(vSymbols){for(index=0,max=vSymbols.length;index<max;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.unhighlightSymbol(oSymbol,oTransitionDefinition)}}},unhighlightAllSymbols:function(oTransitionDefinition){var aAllSymbols;aAllSymbols=this.getAllSymbols();this.unhighlightSymbols(aAllSymbols,oTransitionDefinition)},defaultGetConnectedSymbols:function(oSymbol,bIncludeLinkSymbols){var aSymbols=[];if(oSymbol){bIncludeLinkSymbols=(bIncludeLinkSymbols!==undefined)?bIncludeLinkSymbols:true;aSymbols=oSymbol.getConnectedSymbols(true,true,bIncludeLinkSymbols);if(aSymbols!==undefined&&aSymbols.length!==0){if(aSymbols.indexOf(oSymbol)===-1){aSymbols.push(oSymbol)}}}return aSymbols},getConnectedSymbols:function(oSymbol,bIncludeLinkSymbols){return this.extension.getConnectedSymbols(oSymbol,bIncludeLinkSymbols)},highlightConnectedSymbols:function(oSymbol,oStyleSheet,fnStyleSheetFilter,oTransitionDefinition){var aSymbols;if(this.showConnectedSymbols){aSymbols=this.getConnectedSymbols(oSymbol);if(aSymbols&&aSymbols.length>0){this.highlightSymbols(aSymbols,oStyleSheet,fnStyleSheetFilter,this.grayoutNonConnectedSymbols,undefined,oTransitionDefinition);this.hasHighlightedSymbols=true}}},unhighlightConnectedSymbols:function(oTransitionDefinition){if(this.showConnectedSymbols&&this.hasHighlightedSymbols){this.unhighlightAllSymbols(oTransitionDefinition);this.hasHighlightedSymbols=false}},addEventProperties:function(oEvent,oSymbol){if(oEvent){this.viewer.normalizePointerEvent(oEvent);oEvent.editor=this;oEvent.viewer=this.viewer;oEvent.diagram=this.diagram;oEvent.model=this.model;if(oSymbol){oEvent.sourceSymbol=oSymbol;if(oSymbol.object){oEvent.object=oSymbol.object}oEvent.symbolBBox=oSymbol.getBBox();if(oEvent.symbolBBox){oEvent.symbolClientBBox=this.viewer.viewBBoxToClientBBox(oEvent.symbolBBox,true);oEvent.symbolPageBBox=this.viewer.viewBBoxToPageBBox(oEvent.symbolBBox,true,true,true,true)}}}return oEvent},defaultRegisterStandardTools:function(){var aTools=[sap.galilei.ui.editor.tool.PointerTool,sap.galilei.ui.editor.tool.LassoTool],index,oTool;for(index=0;index<aTools.length;index++){oTool=new aTools[index]({editor:this});if(oTool){sap.galilei.ui.editor.tool.addTool(oTool.name,oTool)}}this.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME)},registerStandardTools:function(){this.extension.registerStandardTools()},defaultRegisterDiagramTools:function(){var oToolsDef,oToolDef,sToolClassName,oToolClass,oTool,index;oToolsDef=this.getToolsDefinition(false);if(oToolsDef){for(index=0;index<oToolsDef.length;index++){oToolDef=oToolsDef[index];oToolDef.editor=this;sToolClassName=oToolDef.className;if(!sToolClassName){switch(oToolDef.type){case sap.galilei.ui.editor.tool.Types.createNodeSymbolTool:sToolClassName="sap.galilei.ui.editor.tool.CreateNodeSymbolTool";break;case sap.galilei.ui.editor.tool.Types.createLinkSymbolTool:sToolClassName="sap.galilei.ui.editor.tool.CreateLinkSymbolTool";break;case sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool:sToolClassName="sap.galilei.ui.editor.tool.CompoundCreateNodeSymbolTool";break;default:sToolClassName="sap.galilei.ui.editor.tool.Tool";break}}oToolClass=sap.galilei.core.getClass(sToolClassName);if(oToolClass){oTool=oToolClass.create(oToolDef)}if(oTool){sap.galilei.ui.editor.tool.addTool(oTool.name,oTool)}}}},registerDiagramTools:function(){this.extension.registerDiagramTools()},getToolsDefinition:function(bUseCache){var aToolsDef;if(!bUseCache){delete this._toolsDefinition}else{aToolsDef=this._toolsDefinition}if(!aToolsDef){aToolsDef=this.extension.getToolsDefinition()}return aToolsDef},getLinkToolsDefinition:function(bUseCache){var aToolsDef,index,oToolDef,aAllLinkDefs;aToolsDef=this.getToolsDefinition(bUseCache);if(aToolsDef){for(index=0;index<aToolsDef.length;index++){oToolDef=aToolsDef[index];if(oToolDef.type===sap.galilei.ui.editor.tool.Types.createLinkSymbolTool){if(!aAllLinkDefs){aAllLinkDefs=[]}if(oToolDef.linksDefinition){aAllLinkDefs=aAllLinkDefs.concat(oToolDef.linksDefinition)}}}}return aAllLinkDefs},getTopLevelTools:function(){return this.extension.getTopLevelTools()},defaultRegisterDiagramCommands:function(){var oCommandsDef,oCommandDef,sCommandClassName,oCommandClass,oCommand,index;oCommandsDef=this.getCommandsDefinition();if(oCommandsDef){for(index=0;index<oCommandsDef.length;index++){oCommandDef=oCommandsDef[index];sCommandClassName=oCommandDef.className;if(!sCommandClassName){sCommandClassName="sap.galilei.ui.editor.command.Command"}oCommandDef.editor=this;oCommandClass=sap.galilei.core.getClass(sCommandClassName);if(oCommandClass){oCommand=oCommandClass.create(oCommandDef)}if(oCommand){sap.galilei.ui.common.command.addCommand(oCommand.name,oCommand)}}}},registerDiagramCommands:function(){this.extension.registerDiagramCommands()},getCommandsDefinition:function(){return this.extension.getCommandsDefinition()},getLinkSymbolDefinitions:function(aLinksDefinition,oSourceSymbol,oTargetSymbol,sLinkSymbolClass){if(aLinksDefinition&&oSourceSymbol&&oTargetSymbol){var index,aLinkToolDefs,oLinkToolDef,sQualifiedSourceName,sQualifiedTargetName;for(index=0;index<aLinksDefinition.length;index++){oLinkToolDef=aLinksDefinition[index];sQualifiedSourceName=oSourceSymbol.classDefinition.qualifiedName;sQualifiedTargetName=oTargetSymbol.classDefinition.qualifiedName;if((!sLinkSymbolClass||oLinkToolDef.linkSymbolClass===sLinkSymbolClass)&&(sQualifiedSourceName===oLinkToolDef.sourceSymbol||sap.galilei.model.isTypeOf(sQualifiedSourceName,oLinkToolDef.sourceSymbol))&&(sQualifiedTargetName===oLinkToolDef.targetSymbol||sap.galilei.model.isTypeOf(sQualifiedTargetName,oLinkToolDef.targetSymbol))){if(aLinkToolDefs===undefined){aLinkToolDefs=[]}aLinkToolDefs.push(oLinkToolDef)}}return aLinkToolDefs}return undefined},getAllLinkSymbolDefinitions:function(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,bUseCache){var aLinksDef,aAllLinksDef;if(sLinkSymbolClass&&oSourceSymbol&&oTargetSymbol){aAllLinksDef=this.getLinkToolsDefinition(bUseCache);if(aAllLinksDef){aLinksDef=this.getLinkSymbolDefinitions(aAllLinksDef,oSourceSymbol,oTargetSymbol,sLinkSymbolClass)}}return aLinksDef},selectTool:function(sToolName,bUnselectSymbols){var oTool=this.tool;if(sToolName){if(this.tool){this.tool.isSelected=false;this.tool.onUnselected();this.tool=undefined}oTool=sap.galilei.ui.editor.tool.getTool(sToolName);if(oTool&&oTool.isEnabled){oTool.editor=this;oTool.isSelected=true;this.tool=oTool;oTool.onSelected()}if(bUnselectSymbols!==false){this.unselectAllSymbols(true)}}return oTool},findSymbolElement:function(oElement){if(oElement){if(oElement.correspondingUseElement){oElement=oElement.correspondingUseElement}if(oElement.nodeName==="g"&&(sap.galilei.ui.common.svg.Svg.hasClass(oElement,"sapGalileiSymbolNode")||sap.galilei.ui.common.svg.Svg.hasClass(oElement,"sapGalileiSymbolLink"))){return oElement}if(sap.galilei.ui.common.svg.Svg.hasClass(oElement,"diagram-object")||sap.galilei.ui.common.svg.Svg.hasClass(oElement,"diagram-link")){return oElement}if(oElement.parentNode&&oElement.parentNode.nodeName==="g"){return this.findSymbolElement(oElement.parentNode)}}return undefined},findSymbolById:function(oSymbols,sId,bIncludeSubSymbols){if(oSymbols){var index,oSymbol,oSubSymbol;if(oSymbols){for(index=0;index<oSymbols.length;index++){if(oSymbols.get){oSymbol=oSymbols.get(index)}else{oSymbol=oSymbols[index]}if(oSymbol.objectId===sId){return oSymbol}}if(bIncludeSubSymbols){for(index=0;index<oSymbols.length;index++){if(oSymbols.get){oSymbol=oSymbols.get(index)}else{oSymbol=oSymbols[index]}if(oSymbol.isComposite){oSubSymbol=this.findSymbolById(oSymbol.symbols,sId,bIncludeSubSymbols);if(oSubSymbol){return oSubSymbol}}}}}}return undefined},checkIsPointInSymbol:function(oSymbol,x,y){if(oSymbol){var oShape,aPoint;if(oSymbol.isLinkSymbol){oShape=oSymbol.getLinkShape();if(oShape){aPoint=this.viewer.clientPointToViewPoint([x,y]);if(oShape.isPointOnBorder(aPoint,undefined,5)){return true}}return false}else{oShape=oSymbol.getBoundaryShape();if(oShape){aPoint=this.viewer.clientPointToViewPoint([x,y]);return oShape.isPointInShape(aPoint,oSymbol.getBBox())}}}return true},getSymbolByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius,fnSkip){var aNodeList,index,oSymbolNode,oSymbol;d3RootShape=d3RootShape||(this.viewer&&this.viewer.d3MainShapeLayer);if(d3RootShape&&d3RootShape.node()&&this.viewer){aNodeList=this.viewer.getElementsByPoint(x,y,d3RootShape.node(),radius);if(aNodeList){for(index=aNodeList.length-1;index>=0;index--){oSymbolNode=this.findSymbolElement(aNodeList[index]);if(oSymbolNode){oSymbol=this.findSymbolById(this.diagram.symbols,oSymbolNode.getAttribute("id"),bIncludeSubSymbols);if(oSymbol&&this.checkIsPointInSymbol(oSymbol,x,y)){if(fnSkip&&fnSkip.call(this,oSymbol)){continue}return oSymbol}}}}}return undefined},getSymbolsByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius,fnSkip){var aNodeList,index,oSymbolNode,oSymbol,aSymbols;d3RootShape=d3RootShape||(this.viewer&&this.viewer.d3MainShapeLayer);if(d3RootShape&&d3RootShape.node()&&this.viewer){aNodeList=this.viewer.getElementsByPoint(x,y,d3RootShape.node(),radius);if(aNodeList){for(index=0;index<aNodeList.length;index++){oSymbolNode=this.findSymbolElement(aNodeList[index]);if(oSymbolNode){oSymbol=this.findSymbolById(this.diagram.symbols,oSymbolNode.getAttribute("id"),bIncludeSubSymbols);if(oSymbol&&this.checkIsPointInSymbol(oSymbol,x,y)){if(fnSkip&&fnSkip.call(this,oSymbol)){continue}if(!aSymbols){aSymbols=[];aSymbols.push(oSymbol)}else{if(aSymbols.indexOf(oSymbol)===-1){aSymbols.push(oSymbol)}}}}}}}return aSymbols},getNodeSymbolByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius){return this.getSymbolByPoint(x,y,d3RootShape,bIncludeSubSymbols,radius,function(oSymbol){return oSymbol.isLinkSymbol})},getLinkSymbolByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius){return this.getSymbolByPoint(x,y,d3RootShape,bIncludeSubSymbols,radius,function(oSymbol){return !oSymbol.isLinkSymbol})},defaultCanAttachSymbol:function(oParentSymbolOrDiagram,oSymbol,oAttachParam){if(oParentSymbolOrDiagram&&oSymbol){var oCreateParam={},bCanCreate,sObjectClass,oParentObject;if(oParentSymbolOrDiagram===oSymbol||(oSymbol.parentSymbol===oParentSymbolOrDiagram&&(!oParentSymbolOrDiagram.isSwimlaneSymbol||!oSymbol.isSwimlaneSymbol))){return false}if(oParentSymbolOrDiagram.object&&oSymbol.object===oParentSymbolOrDiagram.object){return false}if(!sap.galilei.model.isInstanceOf(oParentSymbolOrDiagram,"sap.galilei.ui.diagram.Diagram")){if(!oParentSymbolOrDiagram.isComposite){return false}}if(oParentSymbolOrDiagram.isSwimlaneSymbol){if(!oSymbol.isSwimlaneSymbol&&!oParentSymbolOrDiagram.isLeafSwimlaneSymbol){return false}}oCreateParam.symbol=oSymbol;if(oAttachParam){oCreateParam.point=oAttachParam.point;oCreateParam.delta=oAttachParam.delta}if(!sap.galilei.model.isInstanceOf(oParentSymbolOrDiagram,"sap.galilei.ui.diagram.Diagram")){oCreateParam.parentSymbol=oParentSymbolOrDiagram}bCanCreate=this.canCreateSymbol(oSymbol.classDefinition.qualifiedName,oCreateParam);if(bCanCreate&&oAttachParam){oAttachParam.point=oCreateParam.point}if(bCanCreate){sObjectClass=oSymbol.object&&oSymbol.object.classDefinition.qualifiedName;oParentObject=this.getParentObjectByParentSymbol(oParentSymbolOrDiagram,sObjectClass)||oParentSymbolOrDiagram.object;if(sObjectClass&&oParentObject){bCanCreate=this.canCreateObject(sObjectClass,oParentObject)}}return bCanCreate}return false},canAttachSymbol:function(oParent,oSymbol,oAttachParam){return this.extension.canAttachSymbol(oParent,oSymbol,oAttachParam)},getObjectSymbol:function(oObject){var index,max,oSymbol;if(oObject&&oObject.relatedSymbols){for(index=0,max=oObject.relatedSymbols.length;index<max;index++){oSymbol=oObject.relatedSymbols.get(index);if(oSymbol.diagram===this.diagram){return oSymbol}}}return undefined},getObjectSymbols:function(oObject){var aSymbols=[],index,max,oSymbol;if(oObject){for(index=0,max=oObject.relatedSymbols.length;index<max;index++){oSymbol=oObject.relatedSymbols.get(index);if(oSymbol.diagram===this.diagram){aSymbols.push(oSymbol)}}}return aSymbols},getUndoRedoSymbols:function(aActions){var self=this,oUndoRedoSymbols={deleted:[],created:[],updated:[],parentChanged:[]},objectsMap={},index,oAction,oObject,objectSymbolsMap={},aSymbols,aLinkSymbols,nLinkSymbolIndex,oCurrentLinkSymbol,indexSymbol,max,oSymbol,oSubSymbol;function getObjectFromId(sId){oObject=objectsMap[sId];if(!oObject){oObject=self.resource.getObject(sId);objectsMap[sId]=oObject}return oObject}function getSymbolsOfObject(oObject){aSymbols=objectSymbolsMap[oObject.objectId];if(!aSymbols){aSymbols=self.getObjectSymbols(oObject);objectSymbolsMap[oObject.objectId]=aSymbols}return aSymbols}if(aActions){for(index=0;index<aActions.length;index++){oAction=aActions[index];oObject=getObjectFromId(oAction.objectId);if(oObject){if(sap.galilei.model.isInstanceOf(oObject,"sap.galilei.ui.diagram.Symbol")){oSymbol=oObject;switch(oAction.type){case sap.galilei.model.ActionTypes.deleteObject:oUndoRedoSymbols.deleted.push(oSymbol);break;case sap.galilei.model.ActionTypes.createObject:oUndoRedoSymbols.created.push(oSymbol);break;default:if(oUndoRedoSymbols.deleted.indexOf(oSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oSymbol)===-1){oUndoRedoSymbols.updated.push(oSymbol)}aLinkSymbols=oSymbol.getLinkSymbols();for(nLinkSymbolIndex in aLinkSymbols){oCurrentLinkSymbol=aLinkSymbols[nLinkSymbolIndex];if(oCurrentLinkSymbol&&oUndoRedoSymbols.deleted.indexOf(oCurrentLinkSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oCurrentLinkSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oCurrentLinkSymbol)===-1){oUndoRedoSymbols.updated.push(oCurrentLinkSymbol)}}if(oAction.type===sap.galilei.model.ActionTypes.addReferenceObject&&oAction.referenceName==="symbols"){oSubSymbol=getObjectFromId(oAction.actionParameters.objectId);if(oSubSymbol){if(oUndoRedoSymbols.deleted.indexOf(oSubSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oSubSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oSubSymbol)===-1){oUndoRedoSymbols.updated.push(oSubSymbol)}oUndoRedoSymbols.parentChanged.push(oSubSymbol)}}break}}else{switch(oAction.type){case sap.galilei.model.ActionTypes.deleteObject:case sap.galilei.model.ActionTypes.createObject:break;default:aSymbols=getSymbolsOfObject(oObject);for(indexSymbol=0,max=aSymbols.length;indexSymbol<max;indexSymbol++){oSymbol=aSymbols[indexSymbol];if(oUndoRedoSymbols.deleted.indexOf(oSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oSymbol)===-1){oUndoRedoSymbols.updated.push(oSymbol)}}break}}}}}return oUndoRedoSymbols},updateUndoRedoSymbols:function(oUndoRedoSymbols,bUseAnimation){if(oUndoRedoSymbols){if(bUseAnimation===undefined){bUseAnimation=true}if(oUndoRedoSymbols.deleted.length>0){this.detachSymbols(oUndoRedoSymbols.deleted,bUseAnimation)}if(oUndoRedoSymbols.created.length>0){this.registerSymbolsEvents(oUndoRedoSymbols.created);this.drawSymbols(oUndoRedoSymbols.created,bUseAnimation?this.undoRedoTransitionDefinition:undefined)}if(oUndoRedoSymbols.updated.length>0){this.drawSymbols(oUndoRedoSymbols.updated,bUseAnimation?this.undoRedoTransitionDefinition:undefined)}}},canUndo:function(){if(!this.isReadOnly&&this.resource){return this.resource.canUndo()}return false},canRedo:function(){if(!this.isReadOnly&&this.resource){return this.resource.canRedo()}return false},undo:function(){var aActions;if(!this.isReadOnly&&this.canUndo()&&this.resource){this.isInUndoRedo=true;aActions=this.resource.undo();this.updateUndoRedoSymbols(this.getUndoRedoSymbols(aActions));this.isInUndoRedo=false}},redo:function(){var aActions;if(!this.isReadOnly&&this.canRedo()&&this.resource){this.isInUndoRedo=true;aActions=this.resource.redo();this.updateUndoRedoSymbols(this.getUndoRedoSymbols(aActions));this.isInUndoRedo=false}},undoAll:function(){var aAllActions=[],aActions;if(!this.isReadOnly&&this.canUndo()&&this.resource){this.isInUndoRedo=true;while(this.canUndo()){aActions=this.resource.undo();if(aActions){aAllActions=aAllActions.concat(aActions)}}this.updateUndoRedoSymbols(this.getUndoRedoSymbols(aAllActions),false);this.isInUndoRedo=false}},clearUndoRedo:function(bClearListActions){if(this.resource){this.resource.clearUndoStack();this.resource.clearRedoStack();if(bClearListActions===undefined||bClearListActions){this.resource.clearListOfActions()}}},onPreZoomPan:function(oViewer,scale,translate){if(scale!==oViewer.oldZoomScale||translate[0]!==oViewer.oldZoomTranslate[0]||translate[1]!==oViewer.oldZoomTranslate[1]){if(this.extension.onPreZoomPan){this.extension.onPreZoomPan(scale,translate)}}},onPostZoomPan:function(oViewer,scale,translate){if(scale!==oViewer.oldZoomScale||translate[0]!==oViewer.oldZoomTranslate[0]||translate[1]!==oViewer.oldZoomTranslate[1]){if(this.extension.onPostZoomPan){this.extension.onPostZoomPan(scale,translate)}}},moveSymbolsBy:function(vSymbols,dx,dy,oViewer,oTransitionDef){var self=this,oSymbol,aSymbols=vSymbols,bSingleSymbol=false,oLinkSymbol,oSource,oTarget,aNodeSymbols=[],oLinkSymbolMap={},oNodeSymbolMap={},aCollection,i,j,k,length,aStack,sId,bSourceMoved,bTargetMoved,aPoints,oEvent={};function publishAfterMove(){for(i=0,length=aNodeSymbols.length;i<length;i++){oSymbol=aNodeSymbols[i];if(bSingleSymbol&&oSymbol!==vSymbols){self.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("move.symbol.after",self,undefined,oEvent)}}}if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)&&(dx!==0||dy!==0)&&vSymbols){if(sap.galilei.model.isInstanceOf(vSymbols,"sap.galilei.ui.diagram.Symbol")){aSymbols=[vSymbols];bSingleSymbol=true}for(i=0,length=aSymbols.length;i<length;i++){aStack=[sap.galilei.core.isInstanceOf(aSymbols,"Array")?aSymbols[i]:aSymbols.get(i)];while(aStack.length>0){oSymbol=aStack.pop();if(oSymbol.isLinkSymbol){if(oSymbol&&!oLinkSymbolMap[oSymbol.objectId]){oLinkSymbolMap[oSymbol.objectId]=oSymbol}}else{aNodeSymbols.push(oSymbol);oNodeSymbolMap[oSymbol.objectId]=oSymbol;aCollection=oSymbol.getLinkSymbols();if(aCollection){for(k=0;k<aCollection.length;k++){oLinkSymbol=aCollection[k];if(oLinkSymbol&&!oLinkSymbolMap[oLinkSymbol.objectId]){oLinkSymbolMap[oLinkSymbol.objectId]=oLinkSymbol}}}}if(oSymbol.isComposite){for(j=oSymbol.symbols.length-1;j>=0;j--){aStack.push(oSymbol.symbols.get(j))}}}}for(i=0,length=aNodeSymbols.length;i<length;i++){oSymbol=aNodeSymbols[i];if(bSingleSymbol&&oSymbol!==vSymbols){this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("move.symbol.before",this,undefined,oEvent)}oSymbol.moveBy(dx,dy,{moveSubSymbols:false,moveLinkSymbols:false},oViewer,oTransitionDef)}for(sId in oLinkSymbolMap){oLinkSymbol=oLinkSymbolMap[sId];oSource=oLinkSymbol.sourceSymbol;oTarget=oLinkSymbol.targetSymbol;if(oSource&&oTarget){bSourceMoved=oNodeSymbolMap[oSource.objectId];bTargetMoved=oNodeSymbolMap[oTarget.objectId];if(bSourceMoved&&bTargetMoved){oLinkSymbol.moveBy(dx,dy,undefined,oViewer,oTransitionDef)}else{if(bSourceMoved||bTargetMoved){aPoints=oLinkSymbol.points.clone();if(bSourceMoved){aPoints[0][0]+=dx;aPoints[0][1]+=dy}else{if(bTargetMoved){aPoints[aPoints.length-1][0]+=dx;aPoints[aPoints.length-1][1]+=dy}}oLinkSymbol.points=aPoints;oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(true,oViewer,oTransitionDef)}}}}if(aSymbols&&aSymbols.length>0){setTimeout(publishAfterMove,oTransitionDef?oTransitionDef:0)}}},postMoveSymbols:function(vSymbols,oSymbolContainers){if(this.extension.postMoveSymbols){this.extension.postMoveSymbols(vSymbols,oSymbolContainers)}},updateSymbolDrawingOrder:function(oTransitionDef){var oParentNode=this.viewer&&this.viewer.svgMainShapeLayer,i,j,length,oNode,oRefNode,zindex,refZindex;if(oParentNode){setTimeout(function(){for(i=1,length=oParentNode.childNodes.length;i<length;i++){oNode=oParentNode.childNodes[i];if(!oNode.getAttributeNS){continue}zindex=parseInt(oNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex"));if(isNaN(zindex)){continue}for(j=i-1;j>=0;j--){oRefNode=oParentNode.childNodes[j];if(!oRefNode.getAttributeNS){continue}refZindex=parseInt(oRefNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex"));if(isNaN(refZindex)){continue}if(refZindex<=zindex){oParentNode.insertBefore(oNode,oRefNode.nextSibling);break}}if(j===-1){oParentNode.insertBefore(oNode,oParentNode.firstChild)}}},oTransitionDef?oTransitionDef.duration:0)}},cloneLinkObjectParams:function(oSourceLink){return this.extension.cloneLinkObjectParams(oSourceLink)}},statics:{diagramEditors:undefined,getActiveEditor:function(){var index,oDiagramEditor;if(sap.galilei.ui.editor.DiagramEditor.diagramEditors!==undefined){for(index=0;index<sap.galilei.ui.editor.DiagramEditor.diagramEditors.length;index++){oDiagramEditor=sap.galilei.ui.editor.DiagramEditor.diagramEditors[index];if(oDiagramEditor.viewer.hasFocus){return oDiagramEditor}}for(index=0;index<sap.galilei.ui.editor.DiagramEditor.diagramEditors.length;index++){oDiagramEditor=sap.galilei.ui.editor.DiagramEditor.diagramEditors[index];if(oDiagramEditor.viewer===sap.galilei.ui.common.svg.Viewer.currentViewer){return oDiagramEditor}}}return undefined}}})}());
(function(){sap.galilei.ui.editor.DiagramEditorExtension=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.DiagramEditorExtension",initialize:function(oEditor,oParam){if(!oEditor){throw"Error: The diagram editor must be specified."}this.editor=oEditor;if(oParam){this.set(oParam)}this.defaultOnInitialize();if(this.onInitialize){this.onInitialize()}},properties:{editor:undefined,resource:{get:function(){if(this.editor){return this.editor.resource}return undefined}},model:{get:function(){if(this.editor){return this.editor.model}return undefined}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},viewer:{get:function(){if(this.editor){return this.editor.viewer}return undefined}},transitionDefinition:{get:function(){if(this.editor){return this.editor.transitionDefinition}return undefined}},modelPackageName:undefined,diagramPackageName:undefined,LINK_OBJECT_SOURCE:"source",LINK_OBJECT_TARGET:"target",EXCLUDE_COPY_PROPERTIES:["objectId","isProxy","isProxyAutoResolve","isVolatile","isVolatile","onDelete","proxiedObjectId","proxiedObjectResourceId"],imagesFolder:"images"},methods:{defaultOnInitialize:function(){var glowFilter=new sap.galilei.ui.common.style.Glow({id:"filterSelectionGlow",color:"#7CAAC6",size:3});glowFilter.create(this.viewer)},onInitialize:function(){},dispose:function(){},getObjectClass:function(sObjectClassName){return sap.galilei.model.getClass(sObjectClassName)},createObject:function(sObjectClassName,oParam){return this.editor.defaultCreateObject(sObjectClassName,oParam)},defaultSetDefaultObjectName:function(oObject){if(oObject){var count;if(!oObject.name||!oObject.displayName){count=oObject.classDefinition.objectCount;if(count===undefined){count=0}count++;oObject.classDefinition.objectCount=count}if(oObject.displayName===undefined){oObject.displayName=oObject.classDefinition.displayName+" "+count}if(!oObject.name){oObject.name=oObject.classDefinition.name+count}}},setDefaultObjectName:function(oObject){return this.defaultSetDefaultObjectName(oObject)},defaultCanCreateSymbol:function(sSymbolClass,oCreateParam){if(oCreateParam&&oCreateParam.parentSymbol){if(!oCreateParam.parentSymbol.isDiagram){if(!oCreateParam.parentSymbol.isComposite){return false}}}return true},canCreateSymbol:function(sSymbolClass,oCreateParam){return this.defaultCanCreateSymbol(sSymbolClass,oCreateParam)},defaultCanCreateObject:function(sObjectClassName,oParentObject,oProperties){if(oParentObject){if(oParentObject.isProxy){return false}if(oParentObject.getContainingReference(sObjectClassName,false,true)!==undefined){return true}return false}return true},canCreateObject:function(sObjectClassName,oParentObject,oProperties){return this.defaultCanCreateObject(sObjectClassName,oParentObject,oProperties)},canCreateInstance:function(sObjectClassName,oParams){return sObjectClassName!==undefined},defaultCreateSymbolAndObject:function(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex){return this.editor.defaultCreateSymbolAndObject(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex)},createSymbolAndObject:function(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex){return this.defaultCreateSymbolAndObject(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex)},defaultCreateLinkSymbolAndObject:function(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2){return this.editor.defaultCreateLinkSymbolAndObject(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2)},createLinkSymbolAndObject:function(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2){return this.defaultCreateLinkSymbolAndObject(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference,oLinkObjectParent2,sLinkObjectReference2)},canSetObjectProperties:function(oObject,oProperties){return this.editor.defaultCanSetObjectProperties(oObject,oProperties)},copyObjectProperties:function(oTargetObject,oSourceObject,aExcludeNames){if(oTargetObject&&oSourceObject){aExcludeNames=aExcludeNames||[];aExcludeNames=aExcludeNames.concat(this.EXCLUDE_COPY_PROPERTIES);oTargetObject.copyObjectProperties(oSourceObject,undefined,aExcludeNames)}},getParentObjectByParentSymbol:function(oParentSymbol,sObjectClass){return this.editor.defaultGetParentObjectByParentSymbol(oParentSymbol,sObjectClass)},canAttachSymbol:function(oParent,oSymbol,oAttachParam){return this.editor.defaultCanAttachSymbol(oParent,oSymbol,oAttachParam)},createSymbol:function(sSymbolClassName,oParam){return this.editor.defaultCreateSymbol(sSymbolClassName,oParam)},postCreateSymbol:function(oSymbol){return this.editor.defaultPostCreateSymbol(oSymbol)},defaultCanCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkTool){return oLinkTool&&oSourceSymbol&&oTargetSymbol&&this.canCreateInstance(oLinkTool.linkSymbolClass)&&this.editor.getAllLinkSymbolDefinitions(oSourceSymbol,oTargetSymbol,oLinkTool.linkSymbolClass,true)!==undefined},canCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkTool){return this.defaultCanCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkTool)},defaultCanCreateLinkObject:function(oSourceObject,oTargetObject,sObjectClassName,oParentObject,oProperties){return this.defaultCanCreateObject(sObjectClassName,oParentObject,oProperties)},canCreateLinkObject:function(oSourceObject,oTargetObject,sObjectClassName,oParentObject,oProperties){return this.defaultCanCreateLinkObject(oSourceObject,oTargetObject,sObjectClassName,oParentObject,oProperties)},defaultCanInsertSymbolOnLinkSymbol:function(sSymbolClass,oCreateParam){var oLinkSymbol=oCreateParam&&oCreateParam.linkSymbol,oSymbol=oCreateParam&&oCreateParam.symbol,aNodeSymbols,index,max,oNodeSymbol,aLinkSymbols;if(oSymbol!==undefined&&oLinkSymbol!==undefined){if(oSymbol.isLinkSymbol||sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")){return false}if(oLinkSymbol.sourceSymbol===oSymbol||oLinkSymbol.targetSymbol===oSymbol){return false}aNodeSymbols=oSymbol.getConnectedSymbols();for(index=0,max=aNodeSymbols.length;index<max;index++){oNodeSymbol=aNodeSymbols[index];aLinkSymbols=oNodeSymbol.getLinkSymbols();if(aLinkSymbols!==undefined&&aLinkSymbols.indexOf(oLinkSymbol)!==-1){return false}}}return true},canInsertSymbolOnLinkSymbol:function(sSymbolClass,oCreateParam){return this.defaultCanInsertSymbolOnLinkSymbol(sSymbolClass,oCreateParam)},canPreserveLinkAfterDelete:function(oSymbol){return this.editor.enablePreserveLinkAfterDelete},canDeleteSymbol:function(oSymbol){var oEvent={};if(oSymbol&&oSymbol.object&&oSymbol.object.container){if(oSymbol.object.container.isProxy){return false}}oEvent.cancel=false;this.editor.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("can.delete.symbol",this.editor,this.editor,oEvent);return !oEvent.cancel},canDeleteSymbols:function(aSymbols){var index,max,oSymbol,oEvent={};oEvent.cancel=false;this.editor.addEventProperties(oEvent);oEvent.selectedSymbols=aSymbols;sap.galilei.core.Event.publish("can.delete.symbols",this.editor,this.editor,oEvent);if(oEvent.cancel){return false}for(index=0,max=aSymbols.length;index<max;index++){if(aSymbols instanceof Array){oSymbol=aSymbols[index]}else{oSymbol=aSymbols.get(index)}if(!this.canDeleteSymbol(oSymbol)){return false}}return true},postDeleteSymbol:function(oContainer,oDeletedSymbol,bDeleteObject,bPreserveLink,bUseUndoAction){},postDeleteSymbols:function(aContainers,aDeletedSymbols,bDeleteObject,bPreserveLink,bUseUndoAction){},selectLinkSymbolDefinition:function(oSourceSymbol,oTargetSymbol){return undefined},defaultGetObjectClassReference:function(sObjectClassName,oParentObject,sObjectReference,bIsContainment){var oDiagram=this.diagram,oContainer=(oDiagram&&oDiagram.container)||this.model,oReference,oParent,oResult,bSearchAncestors;if(sObjectClassName){oParent=oParentObject||oContainer;if(bIsContainment===undefined){bIsContainment=true}bSearchAncestors=bIsContainment;if(oParent){if(!sObjectReference){oResult=oParent.getContainingReference(sObjectClassName,bSearchAncestors,bIsContainment)}else{while(oParent){oReference=oParent[sObjectReference];if(oReference&&oReference.reference&&oReference.reference.isContainment===bIsContainment){break}else{oParent=oParent.container}}if(oParent===undefined){oParent=oParentObject}oResult={parentObject:oParent,referenceName:sObjectReference}}}}return oResult},getObjectClassReference:function(sObjectClassName,oParentObject,sObjectReference,bIsContainment){return this.defaultGetObjectClassReference(sObjectClassName,oParentObject,sObjectReference,bIsContainment)},defaultGetObjectReference:function(oObject,oParentObject,sObjectReference,bIsContainment){return this.getObjectClassReference(oObject&&oObject.classDefinition.qualifiedName,oParentObject,sObjectReference,bIsContainment)},getObjectReference:function(oObject,oParentObject,sObjectReference,bIsContainment){return this.defaultGetObjectReference(oObject,oParentObject,sObjectReference,bIsContainment)},getLinkObjectSourceReferenceName:function(sLinkObjectClass){return this.LINK_OBJECT_SOURCE},getLinkObjectTargetReferenceName:function(sLinkObjectClass){return this.LINK_OBJECT_TARGET},cloneLinkObjectParams:function(oSourceLink){return{}},postCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkSymbol){},replaceObjectAndSymbol:function(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions){return this.editor.defaultReplaceObjectAndSymbol(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams,oOptions)},checkSubSymbols:function(oSymbol){},registerSymbolEvents:function(oSymbol){return this.editor.defaultRegisterSymbolEvents(oSymbol)},unregisterSymbolEvents:function(oSymbol){return this.editor.defaultUnregisterSymbolEvents(oSymbol)},defaultOnUpdateSymbol:function(oEvent){var oSymbol=oEvent&&oEvent.sourceSymbol,bChangeSelected=false,self=this;if(oSymbol&&oSymbol.diagram===this.diagram){if(oSymbol.isComposite&&!oSymbol.isKeepSize){if(oSymbol.isTableSymbol){bChangeSelected=oSymbol.isSelected}if(bChangeSelected){this.editor.unselectSymbol(oSymbol)}if(oSymbol.isAdjustToContent||oSymbol.isTableSymbol){oSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,this.viewer,this.transitionDefinition)}else{this.editor.drawSymbol(oSymbol)}if(bChangeSelected){setTimeout(function(){self.editor.selectSymbol(oSymbol)},100)}}else{this.editor.drawSymbol(oSymbol)}}},onUpdateSymbol:function(oEvent){this.defaultOnUpdateSymbol(oEvent)},defaultOnDeleteSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol){this.editor.unselectSymbol(oEvent.sourceSymbol);this.editor.unregisterSymbolEvents(oEvent.sourceSymbol)}},onDeleteSymbol:function(oEvent){this.defaultOnDeleteSymbol(oEvent)},onKeyDown:function(oEvent){return this.editor.defaultOnKeyDown(oEvent)},onKeyUp:function(oEvent){return this.editor.defaultOnKeyUp(oEvent)},onSymbolDoubleClick:function(oEvent){return false},defaultCanSupportInPlaceEditing:function(oSymbol,aClientPoint,nFieldIndex){if(oSymbol&&oSymbol.object){if(oSymbol.object.isProxy||(oSymbol.object.container&&oSymbol.object.container.isProxy)){return false}return true}return false},canSupportInPlaceEditing:function(oSymbol,aClientPoint,nFieldIndex){return this.defaultCanSupportInPlaceEditing(oSymbol,aClientPoint,nFieldIndex)},defaultGetOrCreateSymbolTracker:function(oSymbol){var oTrackerClassDefinition,sDefaultTrackerClass,sTrackerClass,oParams={};if(oSymbol){if(!oSymbol._tracker){if(oSymbol.isLinkSymbol){sDefaultTrackerClass="sap.galilei.ui.editor.tracker.LinkSymbolTracker";oParams={editor:this.editor,symbol:oSymbol,endTransitionDefinition:this.editor.enableAnimation?new sap.galilei.ui.common.TransitionDefinition({duration:200}):undefined,frameColor:sap.galilei.ui.common.style.Color.orange}}else{sDefaultTrackerClass="sap.galilei.ui.editor.tracker.RectangularSymbolTracker";oParams={editor:this.editor,symbol:oSymbol,endTransitionDefinition:this.editor.enableAnimation?new sap.galilei.ui.common.TransitionDefinition({duration:200}):undefined,frameColor:sap.galilei.ui.common.style.Color.orange,isKeepSize:oSymbol.isKeepSize,isKeepAspectRatio:oSymbol.isKeepAspectRatio,isKeepCenter:oSymbol.isKeepCenter}}oTrackerClassDefinition=oSymbol.symbolTracker;if(oTrackerClassDefinition){sTrackerClass=oTrackerClassDefinition.className;sap.galilei.core.copyProperties(oParams,oTrackerClassDefinition);delete oParams.className}sTrackerClass=sTrackerClass||sDefaultTrackerClass;oSymbol._tracker=sap.galilei.core.createNewInstance(sTrackerClass,oParams)}return oSymbol._tracker}return undefined},getOrCreateSymbolTracker:function(oSymbol){return this.defaultGetOrCreateSymbolTracker(oSymbol)},getEditablePropertyInfo:function(oSymbol,oInfo){return oInfo},getConnectedSymbols:function(oSymbol,bIncludeLinkSymbols){return this.editor.defaultGetConnectedSymbols(oSymbol,bIncludeLinkSymbols)},registerStandardTools:function(){return this.editor.defaultRegisterStandardTools()},registerDiagramTools:function(){this.editor.defaultRegisterDiagramTools()},getToolsDefinition:function(){return undefined},addToolDefinition:function(aToolsDefinition,sName,sType,sSymbolClass,sObjectClass,oObjectParam,sObjectReference,sSmallIcon,oParams){var oTool;if(aToolsDefinition&&sName&&sSymbolClass&&sObjectClass){oTool={name:sName,type:sType||sap.galilei.ui.editor.tool.Types.createNodeSymbolTool,symbolClass:sSymbolClass,objectClass:sObjectClass,objectParam:oObjectParam,objectReference:sObjectReference,smallIcon:sSmallIcon};if(oParams){sap.galilei.core.copyProperties(oTool,oParams,true)}aToolsDefinition.push(oTool)}},addLinkDefinition:function(aLinksDefinition,sSourceSymbol,sTargetSymbol,sLinkSymbol,sLinkObjectReference,sLinkObjectParam,oParams){var oLinkDef;if(aLinksDefinition){oLinkDef={sourceSymbol:sSourceSymbol,targetSymbol:sTargetSymbol,linkSymbolClass:sLinkSymbol,linkObjectReference:sLinkObjectReference,linkObjectParam:sLinkObjectParam};if(oParams){sap.galilei.core.copyProperties(oLinkDef,oParams,true)}aLinksDefinition.push(oLinkDef)}return this},getTopLevelTools:function(){return undefined},registerDiagramCommands:function(){this.editor.defaultRegisterDiagramCommands()},getCommandsDefinition:function(){return undefined},defaultGetOrCreateContextButtonPad:function(oSymbol){if(!this.editor.isReadOnly&&oSymbol){if(!oSymbol._contextButtonPad){var aButtons=this.getContextButtonPad(oSymbol),oContextButtonPad;if(aButtons){oContextButtonPad=new sap.galilei.ui.editor.widget.ContextButtonPad({editor:this.editor,symbol:oSymbol,buttonsDefinition:aButtons});oContextButtonPad.createContextButtonPad();oSymbol._contextButtonPad=oContextButtonPad}}return oSymbol._contextButtonPad}return undefined},getOrCreateContextButtonPad:function(oSymbol){return this.defaultGetOrCreateContextButtonPad(oSymbol)},getContextButtonPad:function(oSymbol){return undefined},canSelectSymbolByPoint:function(oSymbol,aViewPoint){return this.editor.defaultCanSelectSymbolByPoint(oSymbol,aViewPoint)},addImagesFolder:function(oToolsDef){if(oToolsDef&&this.imagesFolder){var index,oTool;for(index=0;index<oToolsDef.length;index++){oTool=oToolsDef[index];if(oTool){if(oTool.smallIcon&&oTool.smallIcon[0]!=="#"&&oTool.smallIcon.substring(0,11)!=="sap-icon://"){oTool.smallIcon=this.imagesFolder+"/"+oTool.smallIcon}if(oTool.largeIcon&&oTool.largeIcon[0]!=="#"&&oTool.largeIcon.substring(0,11)!=="sap-icon://"){oTool.largeIcon=this.imagesFolder+"/"+oTool.largeIcon}if(oTool.cursor&&oTool.cursor[0]!=="#"){oTool.cursor=this.imagesFolder+"/"+oTool.cursor}if(oTool.values){this.addImagesFolder(oTool.values)}if(oTool.items){this.addImagesFolder(oTool.items)}}}}},onSetEditorProfile:function(sProfileName){}}});sap.galilei.ui.editor.defineDiagramEditorExtension=function(oDiagramEditorExtDef){oDiagramEditorExtDef=sap.galilei.ui.editor.transformDiagramEditorExtensionDef(oDiagramEditorExtDef);return sap.galilei.core.defineClass(oDiagramEditorExtDef)};sap.galilei.ui.editor.transformDiagramEditorExtensionDef=function(oDiagramEditorExtDef){var parent=oDiagramEditorExtDef.parent||sap.galilei.ui.editor.DiagramEditorExtension;oDiagramEditorExtDef.parent=parent;return oDiagramEditorExtDef}}());
(function(){namespace("sap.galilei.ui.editor.impactAnalysis")}());
(function(){namespace("sap.galilei.impactAnalysis");sap.galilei.impactAnalysis.ObjectAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.impactAnalysis.ObjectAdapter",properties:{impactAnalyzer:undefined,serviceProvider:undefined,objectSerializer:undefined},methods:{getServiceProvider:function(oAnalysisObject){var oServiceProvider=this.serviceProvider;if(!oServiceProvider){oServiceProvider=this.impactAnalyzer&&this.impactAnalyzer.getServiceProvider()}if(oServiceProvider){oServiceProvider.objectAdapter=this}return oServiceProvider},getObjectSerializer:function(oAnalysisObject){var oObjectSerializer=this.objectSerializer;if(!oObjectSerializer){oObjectSerializer=this.impactAnalyzer&&this.impactAnalyzer.getObjectSerializer()}return oObjectSerializer},getDisplayName:function(oAnalysisObject){return oAnalysisObject?(oAnalysisObject.displayName||oAnalysisObject.name):""},getIcon:function(oAnalysisObject){return undefined},hasImpact:function(oAnalysisObject,oNode){return false},hasLineage:function(oAnalysisObject,oNode){return false},getHasImpactObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){if(fnSuccess){fnSuccess(this.hasImpact(oAnalysisObject,oNode))}},getHasLineageObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){if(fnSuccess){fnSuccess(this.hasLineage(oAnalysisObject,oNode))}},retrieveImpactObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){var self=this,nLevel=1,oServiceProvider,oCustomData={analysisObject:oAnalysisObject,node:oNode};if(oAnalysisObject){oServiceProvider=this.getServiceProvider(oAnalysisObject);if(oServiceProvider){jQuery.when(oServiceProvider.getImpactAndLineageAsync(oAnalysisObject.uri,true,false,nLevel,oCustomData)).done(function(oIAData){if(fnSuccess){fnSuccess(oIAData)}}).fail(function(){if(fnError){fnError()}})}else{if(fnError){fnError()}}}else{if(fnError){fnError()}}},retrieveLineageObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){var self=this,nLevel=1,oServiceProvider,oCustomData={analysisObject:oAnalysisObject,node:oNode};if(oAnalysisObject){oServiceProvider=this.getServiceProvider(oAnalysisObject);if(oServiceProvider){jQuery.when(oServiceProvider.getImpactAndLineageAsync(oAnalysisObject.uri,false,true,nLevel,oCustomData)).done(function(oIAData){if(fnSuccess){fnSuccess(oIAData)}}).fail(function(){if(fnError){fnError()}})}else{if(fnError){fnError()}}}else{if(fnError){fnError()}}},getLinkObject:function(aLinkObjects,oSourceObject,oTargetObject){var index,max,oLinkObject;if(aLinkObjects&&oSourceObject&&oTargetObject){for(index=0,max=aLinkObjects.length;index<max;index++){if(sap.galilei.core.isInstanceOf(aLinkObjects,"Array")){oLinkObject=aLinkObjects[index]}else{oLinkObject=aLinkObjects.get(index)}if(oLinkObject.source===oSourceObject&&oLinkObject.target===oTargetObject){return oLinkObject}}}return undefined},getObjectsInfo:function(oAnalysisObject,aObjects,aLinkObjects){var aObjectsInfo=[],index,max,oObject,oLinkObject,oObjectInfo;if(oAnalysisObject&&aObjects){for(index=0,max=aObjects.length;index<max;index++){if(sap.galilei.core.isInstanceOf(aObjects,"Array")){oObject=aObjects[index]}else{oObject=aObjects.get(index)}oObjectInfo={source:oAnalysisObject,object:oObject};if(aLinkObjects&&aLinkObjects.length>0){oLinkObject=this.getLinkObject(aLinkObjects,oAnalysisObject,oObject);if(oLinkObject){oObjectInfo.link={object:oLinkObject}}}aObjectsInfo.push(oObjectInfo)}}return aObjectsInfo}},statics:{_instance:undefined,getInstance:function(){if(!this._instance){this._instance=new sap.galilei.impactAnalysis.ObjectAdapter()}return this._instance}}})}());
(function(){namespace("sap.galilei.impactAnalysis");sap.galilei.impactAnalysis.ServiceProvider=sap.galilei.core.defineClass({fullClassName:"sap.galilei.impactAnalysis.ServiceProvider",properties:{impactAnalyzer:undefined,objectAdapter:undefined,isSupportMultipleLevels:false},methods:{getImpactAndLineageAsync:function(sObjectUri,bGetImpact,bGetLineage,nLevel,oCustomData){var oResult=jQuery.Deferred();oResult.resolve();return oResult},getHasImpactAndLineageAsync:function(sObjectUri,bGetImpact,bGetLineage,oCustomData){var oResult=jQuery.Deferred();oResult.resolve(false);return oResult}},statics:{_instance:undefined,getInstance:function(){if(!this._instance){this._instance=new sap.galilei.impactAnalysis.ServiceProvider()}return this._instance}}})}());
(function(){namespace("sap.galilei.impactAnalysis");sap.galilei.impactAnalysis.ObjectSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.impactAnalysis.ObjectSerializer",properties:{impactAnalyzer:undefined},methods:{getOrCreateAnalysisObjects:function(oAnalysisModel,oParentObject,oIAData,aObjects,aLinks){var nObjects=0;if(oAnalysisModel&&oParentObject){nObjects+=oParentObject.impactObjects.length;nObjects+=oParentObject.lineageObjects.length}return nObjects}},statics:{_instance:undefined,getInstance:function(){if(!this._instance){this._instance=new sap.galilei.impactAnalysis.ObjectSerializer()}return this._instance}}})}());
(function(){sap.galilei.ui.editor.impactAnalysis.DiagramEditorExtension=sap.galilei.ui.editor.defineDiagramEditorExtension({fullClassName:"sap.galilei.ui.editor.impactAnalysis.DiagramEditorExtension",properties:{impactAnalyzer:undefined},methods:{onKeyDownImpactAnalysis:function(oEvent){var self=this,bProcessed=false,bExpandAll;switch(oEvent.keyCode){case 107:if(this.editor.selectedSymbols.length>0){bExpandAll=oEvent.ctrlKey;this.impactAnalyzer.expandSelectedNodes(true,true,false,bExpandAll?sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL:1);bProcessed=true}break;case 109:if(this.editor.selectedSymbols.length>0){this.impactAnalyzer.collapseSelectedNodes(true,true,false);bProcessed=true}break}return bProcessed||this.editor.defaultOnKeyDown(oEvent)},onKeyDown:function(oEvent){return this.onKeyDownImpactAnalysis(oEvent)}}})}());
(function(){var oResource,oReader,oDiagramDef={contents:{"Sap.Galilei.ImpactAnalysis.Diagram":{classDefinition:"sap.galilei.model.Package",displayName:"Impact Analysis Diagram",namespaceName:"sap.galilei.impactAnalysis.ui",classifiers:{Diagram:{displayName:"Diagram",parent:"sap.galilei.ui.diagram.Diagram",properties:{orientation:{dataType:sap.galilei.model.dataTypes.gString,defaultValue:sap.galilei.ui.symbol.Orientation.horizontal},showImpact:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true},showLineage:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false}}},NodeSymbol:{displayName:"Node Symbol",parent:"sap.galilei.ui.diagram.Symbol",properties:{"NodeSymbol.isAdjustToContent":{name:"isAdjustToContent",defaultValue:false},"NodeSymbol.isKeepSize":{name:"isKeepSize",defaultValue:true},"NodeSymbol.isKeepPosition":{name:"isKeepPosition",defaultValue:true},"NodeSymbol.showImpact":{name:"showImpact",get:function(){return this.diagram.showImpact&&this.object&&(this.object.isRoot||this.object.isImpact)&&this.object.hasImpact}},"NodeSymbol.showLineage":{name:"showLineage",get:function(){return this.diagram.showLineage&&this.object&&(this.object.isRoot||this.object.isLineage)&&this.object.hasLineage}},"NodeSymbol.tooltip":{name:"tooltip",get:function(){var oAnalysisObject=this.object&&this.object.analysisObject,sClassName,sObjectName,oRootContainer,sContainerClassName,sContainerObjectName;if(oAnalysisObject){if(!sap.galilei.model.isInstanceOf(oAnalysisObject,"sap.galilei.impactAnalysis.generic.AnalysisObject")){sClassName=oAnalysisObject.classDefinition&&oAnalysisObject.classDefinition.displayName}sObjectName=((oAnalysisObject.getFormattedValue&&oAnalysisObject.getFormattedValue("Name"))||oAnalysisObject.displayName||oAnalysisObject.name||"");if(sClassName){sObjectName=sObjectName?(sClassName+" '"+sObjectName+"'"):sClassName}oRootContainer=oAnalysisObject.rootContainer;if(oRootContainer){if(!sap.galilei.model.isInstanceOf(oRootContainer,"sap.galilei.impactAnalysis.generic.AnalysisModel")){sContainerClassName=oRootContainer.classDefinition&&oRootContainer.classDefinition.displayName;sContainerObjectName=((oRootContainer.getFormattedValue&&oRootContainer.getFormattedValue("Name"))||oRootContainer.displayName||oRootContainer.name||"");if(sContainerClassName){sContainerObjectName=sContainerObjectName?(sContainerClassName+" '"+sContainerObjectName+"'"):sContainerClassName}sObjectName=sObjectName+" ("+sContainerObjectName+")"}}return sObjectName}}}},statics:{objectClass:{value:"sap.galilei.impactAnalysis.Node"},layoutTemplate:{mainShape:[{shape:"RoundedRectangle",domClass:"node",padding:0,r:"{object/isRoot:radius}",stroke:"{object/isRoot:stroke}",strokeWidth:"{object/isRoot:strokeWidth}",fill:"{object/isRoot:fill}",width:"{object/isRoot:width}",height:"{object/isRoot:height}"},{shape:"Panel",isFixedDocking:true,shapes:[{shape:"Image",useReference:true,width:10,height:10,href:"{object/isImpactExpanded:expanderIcon}",isVisible:"{showImpact}",dockPosition:"{diagram/orientation:impactExpanderPosition}",marginRight:"{diagram/orientation:impactExpanderMarginRight}",marginBottom:"{diagram/orientation:impactExpanderMarginBottom}",fill:"{object/isImpactExpanded:expanderFill}"},{shape:"Circle",width:10,height:10,isVisible:"{showImpact}",dockPosition:"{diagram/orientation:impactExpanderPosition}",marginRight:"{diagram/orientation:impactExpanderMarginRight}",marginBottom:"{diagram/orientation:impactExpanderMarginBottom}",stroke:"none",fill:"white",opacity:0,events:{pointerdown:function(oEvent,oSymbol,oExtension){var oImpactAnalyzer=oExtension.impactAnalyzer;oEvent.preventDefault();oEvent.stopPropagation();oImpactAnalyzer.onToggleImpactExpander(oSymbol,oEvent.ctrlKey)}}},{shape:"Image",useReference:true,width:10,height:10,href:"{object/isLineageExpanded:expanderIcon}",isVisible:"{showLineage}",dockPosition:"{diagram/orientation:lineageExpanderPosition}",marginLeft:"{diagram/orientation:lineageExpanderMarginLeft}",marginTop:"{diagram/orientation:lineageExpanderMarginTop}",fill:"{object/isLineageExpanded:expanderFill}"},{shape:"Circle",width:10,height:10,isVisible:"{showLineage}",dockPosition:"{diagram/orientation:lineageExpanderPosition}",marginLeft:"{diagram/orientation:lineageExpanderMarginLeft}",marginTop:"{diagram/orientation:lineageExpanderMarginTop}",stroke:"none",fill:"white",opacity:0,events:{pointerdown:function(oEvent,oSymbol,oExtension){var oImpactAnalyzer=oExtension.impactAnalyzer;oEvent.preventDefault();oEvent.stopPropagation();oImpactAnalyzer.onToggleLineageExpander(oSymbol,oEvent.ctrlKey)}}}]}],contentShape:{shape:"Stack",orientation:"horizontal",horizontalAlignment:"width",verticalAlignment:"height",padding:2,innerPadding:0,shapes:[{shape:"Image",href:"{object/icon}",isVisible:"{object/icon:hasIcon}",width:16,height:16,verticalAlignment:"middle"},{shape:"Text",domClass:"nodeName",text:"{object/displayName}",font:"{object/isRoot:textFont}",fill:"black",horizontalAlignment:"{object/isRoot:textHorzAlignment}",verticalAlignment:"middle",isWordWrap:true,isEllipsis:true}]}},formatters:{radius:function(vValue,oObject,oSymbol){return vValue?8:4},impactExpanderPosition:{horizontal:"right",vertical:"bottom"},impactExpanderMarginRight:{horizontal:-10,vertical:0},impactExpanderMarginBottom:{horizontal:0,vertical:-10},expanderIcon:function(vValue,oObject,oSymbol){return vValue?"#ImpactAnalysis.RoundExpanderExpanded":"#ImpactAnalysis.RoundExpanderCollapsed"},lineageExpanderPosition:{horizontal:"left",vertical:"top"},lineageExpanderMarginLeft:{horizontal:-10,vertical:0},lineageExpanderMarginTop:{horizontal:0,vertical:-10},expanderFill:function(vValue,oObject,oSymbol){return vValue?"white":"#0099EB"},stroke:function(vValue,oObject,oSymbol){return vValue?sap.galilei.ui.common.style.Color.green:"#428EB0"},fill:function(vValue,oObject,oSymbol){return vValue?sap.galilei.ui.common.style.Color.getBrighterColor(sap.galilei.ui.common.style.Color.green,0.8):"white"},strokeWidth:function(vValue,oObject,oSymbol){return vValue?3:1},width:function(vValue,oObject,oSymbol){return vValue?140:120},height:function(vValue,oObject,oSymbol){return vValue?40:24},textHorzAlignment:function(vValue,oObject,oSymbol){return"width"},textFont:function(vValue,oObject,oSymbol){return vValue?"bold 14px Tahoma, Geneva, sans-serif":"10.5px Tahoma, Geneva, sans-serif"},hasIcon:function(vValue,oObject,oSymbol){return vValue?true:false}}}},NodeLinkSymbol:{displayName:"Node Link Symbol",parent:"sap.galilei.ui.diagram.LinkSymbol",properties:{"NodeLinkSymbol.isKeepPosition":{name:"isKeepPosition",defaultValue:true},"NodeLinkSymbol.lineStyle":{name:"lineStyle",get:function(){return this.diagram&&this.diagram.orientation===sap.galilei.ui.symbol.Orientation.vertical?sap.galilei.ui.common.LineStyle.vertDiagonalBezier:sap.galilei.ui.common.LineStyle.horzDiagonalBezier}},supportedSourceDirections:{get:function(){return[this.diagram&&this.diagram.orientation===sap.galilei.ui.symbol.Orientation.vertical?sap.galilei.ui.common.LinkDirection.north:sap.galilei.ui.common.LinkDirection.east]}},supportedTargetDirections:{get:function(){return[this.diagram&&this.diagram.orientation===sap.galilei.ui.symbol.Orientation.vertical?sap.galilei.ui.common.LinkDirection.south:sap.galilei.ui.common.LinkDirection.west]}},"LinkSymbol.tooltip":{name:"tooltip",get:function(){var oAnalysisObject=this.object&&this.object.analysisObject,sClassName,sObjectName,oRootContainer,sContainerClassName,sContainerObjectName;if(oAnalysisObject){if(!sap.galilei.model.isInstanceOf(oAnalysisObject,"sap.galilei.impactAnalysis.generic.AnalysisLinkObject")){sClassName=oAnalysisObject.classDefinition&&oAnalysisObject.classDefinition.displayName}sObjectName=(oAnalysisObject.Name||oAnalysisObject.displayName||oAnalysisObject.name||oAnalysisObject.Code||"");if(sClassName){sObjectName=sObjectName?(sClassName+" '"+sObjectName+"'"):sClassName}oRootContainer=oAnalysisObject.rootContainer;if(oRootContainer){if(!sap.galilei.model.isInstanceOf(oRootContainer,"sap.galilei.impactAnalysis.generic.AnalysisModel")){sContainerClassName=oRootContainer.classDefinition&&oRootContainer.classDefinition.displayName;sContainerObjectName=(oRootContainer.Name||oRootContainer.displayName||oRootContainer.name||oRootContainer.Code||"");if(sContainerClassName){sContainerObjectName=sContainerObjectName?(sContainerClassName+" '"+sContainerObjectName+"'"):sContainerClassName}sObjectName=sObjectName+" ("+sContainerObjectName+")"}}return sObjectName}}}},statics:{layoutTemplate:{stroke:"#428EB0",strokeWidth:1,lineStyle:"{lineStyle}"}}}}}}};oResource=new sap.galilei.model.Resource();oReader=new sap.galilei.model.JSONReader();oReader.load(oResource,oDiagramDef);sap.galilei.impactAnalysis.ui.Library=sap.galilei.ui.common.library.defineLibrary({fullClassName:"sap.galilei.impactAnalysis.ui.Library",libraryName:"ImpactAnalysis",statics:{onInitialize:function(){this.addShape("RoundExpanderExpanded",[{shape:"Circle",domClass:"expandedIconStrokeFill",stroke:"#428EB0",strokeWidth:1,cx:5,cy:5,r:5,fill:"white"},{shape:"Line",domClass:"expandedIconStroke",stroke:"#428EB0",strokeWidth:1,x1:2,y1:5,x2:8,y2:5}]);this.addShape("RoundExpanderCollapsed",[{shape:"Circle",domClass:"collapsedIconStrokeFill",stroke:"#428EB0",strokeWidth:1,cx:5,cy:5,r:5,fill:sap.galilei.ui.common.style.Color.getBrighterColor("#428EB0",0.3)},{shape:"Line",domClass:"collapsedIconStroke",stroke:"white",strokeWidth:1,x1:2,y1:5,x2:8,y2:5},{shape:"Line",domClass:"collapsedIconStroke",stroke:"white",strokeWidth:1,x1:5,y1:2,x2:5,y2:8}])}}})}());
(function(){var oResource,oReader,oModelDef={contents:{"Sap.Galilei.ImpactAnalysis.Model":{classDefinition:"sap.galilei.model.Package",displayName:"Impact Analysis Model",namespaceName:"sap.galilei.impactAnalysis",classifiers:{Node:{displayName:"Node",parent:"sap.galilei.common.NamedObject",properties:{"Node.objectAdapter":{name:"objectAdapter",dataType:sap.galilei.model.dataTypes.gBlob,isVolatile:true},"Node.displayName":{name:"displayName",get:function(){var sName;if(this.analysisObject){if(this.objectAdapter){sName=this.objectAdapter.getDisplayName(this.analysisObject)}else{sName=this.analysisObject.displayName}}return sName}},"Node.icon":{name:"icon",get:function(){var sIcon;if(this.analysisObject&&this.objectAdapter){sIcon=this.objectAdapter.getIcon(this.analysisObject)}return sIcon}},"Node.hasImpact":{name:"hasImpact",get:function(){if(this._hasImpactObjects===undefined){if(this.isImpactExpanding){this.isImpactExpanding=false;return true}else{if(this.rootContainer&&this.rootContainer.autoUpdateExpander){jQuery.when(this.getHasImpactAsync()).done(function(bHasImpact){})}else{return true}}}return(this._hasImpactObjects!==undefined)?this._hasImpactObjects:false}},"Node.hasLineage":{name:"hasLineage",get:function(){if(this._hasLineageObjects===undefined){if(this.isLineageExpanding){this.isLineageExpanding=false;return true}else{if(this.rootContainer&&this.rootContainer.autoUpdateExpander){jQuery.when(this.getHasLineageAsync()).done(function(hasLineage){})}else{return true}}}return(this._hasLineageObjects!==undefined)?this._hasLineageObjects:false}},"Node.isRoot":{name:"isRoot",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isImpact":{name:"isImpact",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isLineage":{name:"isLineage",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isImpactLoaded":{name:"isImpactLoaded",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isLineageLoaded":{name:"isLineageLoaded",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isImpactObjectsCreated":{name:"isImpactObjectsCreated",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isLineageObjectsCreated":{name:"isLineageObjectsCreated",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isImpactExpanding":{name:"isImpactExpanding",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isLineageExpanding":{name:"isLineageExpanding",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isImpactExpanded":{name:"isImpactExpanded",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true},"Node.isLineageExpanded":{name:"isLineageExpanded",dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isVolatile:true}},references:{"Node.analysisObject":{name:"analysisObject",displayName:"Analysis Object",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:false}},methods:{getHasImpactAsync:function(){var self=this,oResult=jQuery.Deferred();if(this._hasImpactObjects===undefined){if(this.analysisObject&&this.objectAdapter){this.objectAdapter.getHasImpactObjects(this.analysisObject,this,function(bHasImpact){self._hasImpactObjects=bHasImpact;self.updateMonitor("hasImpact",bHasImpact);oResult.resolve(bHasImpact)},function(){oResult.resolve(false)})}else{oResult.resolve()}}else{oResult.resolve((this._hasImpactObjects!==undefined)?this._hasImpactObjects:false)}return oResult},getHasLineageAsync:function(){var self=this,oResult=jQuery.Deferred();if(this._hasLineageObjects===undefined){if(this.analysisObject&&this.objectAdapter){this.objectAdapter.getHasLineageObjects(this.analysisObject,this,function(bHasLineage){self._hasLineageObjects=bHasLineage;self.updateMonitor("hasLineage",bHasLineage);oResult.resolve(bHasLineage)},function(){oResult.resolve(false)})}else{oResult.resolve()}}else{oResult.resolve((this._hasLineageObjects!==undefined)?this._hasLineageObjects:false)}return oResult},retrieveImpactObjects:function(fnSuccess,fnError){var self=this;function successCallback(aObjects){self.isImpactLoaded=true;if(fnSuccess){fnSuccess(aObjects)}}if(this.analysisObject&&this.objectAdapter){this.objectAdapter.retrieveImpactObjects(this.analysisObject,this,successCallback,fnError)}},retrieveLineageObjects:function(fnSuccess,fnError){var self=this;function successCallback(aObjects){self.isLineageLoaded=true;if(fnSuccess){fnSuccess(aObjects)}}if(this.analysisObject&&this.objectAdapter){this.objectAdapter.retrieveLineageObjects(this.analysisObject,this,successCallback,fnError)}},getImpactNodes:function(){var aNodes=[],aLinks,index,max,oNode;aLinks=this.getSourceLinkObjects();if(aLinks){for(index=0,max=aLinks.length;index<max;index++){oNode=aLinks[index].target;if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}}}return aNodes},getLineageNodes:function(){var aNodes=[],aLinks,index,max,oNode;aLinks=this.getTargetLinkObjects();if(aLinks){for(index=0,max=aLinks.length;index<max;index++){oNode=aLinks[index].source;if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}}}return aNodes}}},NodeLink:{displayName:"Node Link",parent:"sap.galilei.common.LinkObject",properties:{"NodeLink.referenceName":{name:"referenceName",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true}},references:{"NodeLink.analysisObject":{name:"analysisObject",displayName:"Analysis Object",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:false}}},Model:{displayName:"Model",parent:"sap.galilei.common.Model",properties:{autoUpdateExpander:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true}},references:{"Model.nodes":{name:"nodes",contentType:"sap.galilei.impactAnalysis.Node",isMany:true,isContainment:true},"Model.nodeLinks":{name:"nodeLinks",contentType:"sap.galilei.impactAnalysis.NodeLink",isMany:true,isContainment:true}}}}}}};oResource=new sap.galilei.model.Resource();oReader=new sap.galilei.model.JSONReader();oReader.load(oResource,oModelDef)}());
(function(){sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer",initialize:function(oParams){var oEditor,sParentSelector,sExtensionClass,oEditorParams,oViewerParams;oParams=oParams||{};oEditor=oParams.editor||this.editor;sParentSelector=oParams.parentSelector;sExtensionClass=oParams.extensionClass;oEditorParams=oParams.editorParams;oViewerParams=oParams.viewerParams;delete oParams.editor;delete oParams.parentSelector;delete oParams.extensionClass;delete oParams.editorParams;delete oParams.viewerParams;if(!oEditor&&sParentSelector){sExtensionClass=sExtensionClass||sap.galilei.ui.editor.impactAnalysis.DiagramEditorExtension;oViewerParams=oViewerParams||{showPageLimit:false,showGrid:false,showZoomTools:true};oEditor=new sap.galilei.ui.editor.DiagramEditor(undefined,sParentSelector,{extension:{extensionClass:sExtensionClass},viewer:oViewerParams,highlightFillColor:undefined});if(oEditorParams){oEditor.set(oEditorParams)}}else{if(oEditor){if(sExtensionClass){oEditor.extensionClass=sExtensionClass;oEditor.createExtension()}if(oEditorParams){oEditor.set(oEditorParams)}if(oViewerParams){sap.galilei.core.copyProperties(oEditor.viewer,oViewerParams)}}}if(oEditor){this.editor=oEditor;this.editor.extension.impactAnalyzer=this;this.editor.isReadOnly=true}this.setAnalysisOptions(oParams)},statics:{MAX_EXPAND_LEVEL:10},fields:{EXPANDER_SIZE:10,layoutSymbols:undefined},properties:{impactAnalysisModelClassName:"sap.galilei.impactAnalysis.Model",impactAnalysisNodeClassName:"sap.galilei.impactAnalysis.Node",impactAnalysisNodeLinkClassName:"sap.galilei.impactAnalysis.NodeLink",impactAnalysisDiagramClassName:"sap.galilei.impactAnalysis.ui.Diagram",impactAnalysisNodeSymbolClassName:"sap.galilei.impactAnalysis.ui.NodeSymbol",impactAnalysisNodeLinkSymbolClassName:"sap.galilei.impactAnalysis.ui.NodeLinkSymbol",objectAdapterClassName:"sap.galilei.impactAnalysis.ObjectAdapter",serviceProviderClassName:"sap.galilei.impactAnalysis.ServiceProvider",objectSerializerClassName:"sap.galilei.impactAnalysis.ObjectSerializer",rootNodeSymbolLayoutTemplate:undefined,nodeSymbolLayoutTemplate:undefined,nodeSymbolFormatters:undefined,linkSymbolLayoutTemplate:undefined,linkSymbolFormatters:undefined,orientation:{field:"_orientation",value:sap.galilei.ui.symbol.Orientation.horizontal,get:function(){return this._orientation},set:function(sOrientation){this._orientation=sOrientation;if(this.diagram){this.diagram.orientation=sOrientation}}},showImpact:{field:"_showImpact",value:true,get:function(){return this._showImpact},set:function(bShowImpact){this._showImpact=bShowImpact;if(this.diagram){this.diagram.showImpact=bShowImpact;if(!this._showImpact){this.collapseRooNode(true,false,true)}else{this.expandRooNode(true,false,true)}}}},showLineage:{field:"_showLineage",value:true,get:function(){return this._showLineage},set:function(bShowLineage){this._showLineage=bShowLineage;if(this.diagram){this.diagram.showLineage=bShowLineage;if(!this._showLineage){this.collapseRooNode(false,true,true)}else{this.expandRooNode(false,true,true)}}}},showPath:{field:"_showPath",value:true,get:function(){return this._showPath},set:function(bShowPath){var oSymbol;this._showPath=bShowPath;if(this.diagram){if(this._showPath){if(this.editor&&this.editor.selectedSymbols.length===1){oSymbol=this.editor.selectedSymbols.get(0);this.highlightPath(oSymbol)}}else{this.unhighlightPath()}}}},autoUpdateExpander:{field:"_autoUpdateExpander",value:true,get:function(){return this._autoUpdateExpander},set:function(nValue){this._autoUpdateExpander=nValue;if(this.model){this.model.autoUpdateExpander=nValue}}},expandLevel:{field:"_expandLevel",value:1,get:function(){var nLevel=this._expandLevel;if(nLevel>sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL){nLevel=sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL}return nLevel},set:function(nValue){if(nValue>sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL){nValue=sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL}this._expandLevel=nValue}},analysisObject:undefined,editor:undefined,resource:undefined,model:undefined,diagram:undefined,rootNode:undefined,rootNodeSymbol:undefined,layoutOptions:{field:"_layoutOptions",get:function(){if(!this._layoutOptions){this._layoutOptions={name:"Layered",direction:(this.diagram&&(this.diagram.orientation===sap.galilei.ui.symbol.Orientation.vertical))?"DOWN":"RIGHT",nodePlace:"LINEAR_SEGMENTS",edgeRouting:"ORTHOGONAL",spacing:8,levelSpacing:40,edgeSpacingFactor:0.4}}return this._layoutOptions},set:function(oLayoutOptions){if(oLayoutOptions){this._layoutOptions=oLayoutOptions}}},autoLayout:{get:function(){if(!this._autoLayout){this._autoLayout=new sap.galilei.ui.editor.layout.DiagramAutoLayout()}return this._autoLayout},set:function(oAutoLayout){this._autoLayout=oAutoLayout}},delayedLayoutDuration:100,animationDuration:1000,supportBusyDialog:false,hasHighlighted:false},methods:{setAnalysisOptions:function(oParams){oParams=oParams||{};this.set(oParams)},analyze:function(oAnalysisObject,oParams){var self=this;this.dispose();this.analysisObject=oAnalysisObject;this.setAnalysisOptions(oParams);function createAnalysisModel(){self.createModel();self.createDiagram();self.createRootNodeObjectAndSymbol();self.rootNode.isImpactExpanding=self.showImpact;self.rootNode.isLineageExpanding=self.showLineage}if(this.editor){this.resource=new sap.galilei.model.Resource();this.resource.applyUndoableAction(createAnalysisModel,"Create impact analysis model",true);this.editor.diagram=this.diagram;this.editor.isReadOnly=true;sap.galilei.core.Event.subscribe("symbol.selected",this._onSymbolSelected,this,this.editor);sap.galilei.core.Event.subscribe("symbol.unselected",this._onSymbolUnselected,this,this.editor);this.expandRooNode(this.showImpact,this.showLineage,true)}},analyzeImpact:function(oAnalysisObject,oParams){oParams=oParams||{};oParams.showImpact=true;oParams.showLineage=false;this.analyze(oAnalysisObject,oParams)},analyzeLineage:function(oAnalysisObject,oParams){oParams=oParams||{};oParams.showImpact=false;oParams.showLineage=true;this.analyze(oAnalysisObject,oParams)},dispose:function(){if(this.editor){this.editor.dispose()}this.model=undefined;this.diagram=undefined;if(this.resource){this.resource.clear();this.resource=undefined}this.analysisObject=undefined;this.rootNode=undefined;this.rootNodeSymbol=undefined;this.autoLayout=undefined;sap.galilei.core.Event.unSubscribeScope("symbol.selected",this);sap.galilei.core.Event.unSubscribeScope("symbol.unselected",this)},createModel:function(){this.model=sap.galilei.model.createNewInstance(this.impactAnalysisModelClassName,this.resource);this.model.autoUpdateExpander=this.autoUpdateExpander},createDiagram:function(){this.diagram=sap.galilei.model.createNewInstance(this.impactAnalysisDiagramClassName,this.resource,{model:this.model,orientation:this.orientation,showImpact:this.showImpact,showLineage:this.showLineage})},_onSymbolSelected:function(oEvent){var oSymbol=oEvent&&oEvent.sourceSymbol;if(oSymbol&&this.showPath){this.highlightPath(oSymbol)}},_onSymbolUnselected:function(oEvent){var oEditor=oEvent&&oEvent.editor;if(oEditor&&this.showPath&&oEditor.selectedSymbols.length===0){this.unhighlightPath()}},getObjectAdapter:function(oAnalysisObject){var oClass,oInstance;if(this.objectAdapterClassName){oClass=sap.galilei.core.getClass(this.objectAdapterClassName);if(oClass&&oClass.getInstance){oInstance=oClass.getInstance();oInstance.impactAnalyzer=this}}else{throw"The object adapter class name objectAdapterClassName is not defined and the getObjectAdapter() function is not implemented."}return oInstance},getObjectSerializer:function(oAnalysisObject){var oClass,oInstance;if(this.objectSerializerClassName){oClass=sap.galilei.core.getClass(this.objectSerializerClassName);if(oClass&&oClass.getInstance){oInstance=oClass.getInstance();oInstance.impactAnalyzer=this}}return oInstance},getServiceProvider:function(oAnalysisObject){var oClass,oInstance;if(this.serviceProviderClassName){oClass=sap.galilei.core.getClass(this.serviceProviderClassName);if(oClass&&oClass.getInstance){oInstance=oClass.getInstance();oInstance.impactAnalyzer=this}}return oInstance},getNodeObject:function(oAnalysisObject){var oNode;if(oAnalysisObject&&this.model){oNode=this.model.nodes.selectObject({"analysisObject.objectId":oAnalysisObject.objectId})}return oNode},getNodeLinkObject:function(oSourceNode,oTargetNode){var oNodeLink;if(oSourceNode&&oTargetNode&&this.model){oNodeLink=this.model.nodeLinks.selectObject({"source.objectId":oSourceNode.objectId,"target.objectId":oTargetNode.objectId})}return oNodeLink},canCreateNode:function(oParentNode,oAnalysisObject,bIsImpact){var oNode,aNodes=[];if(oParentNode&&oAnalysisObject){oNode=this.getNodeObject(oAnalysisObject);if(oNode){if(bIsImpact){if(oNode.isLineage){return false}this.getLineageNodes(oParentNode,aNodes,false)}else{if(oNode.isImpact){return false}this.getImpactNodes(oParentNode,aNodes,false)}if(aNodes.indexOf(oNode)!==-1){return false}}}return true},createNodeObject:function(oAnalysisObject){var oNode;if(oAnalysisObject&&this.model){oNode=this.getNodeObject(oAnalysisObject);if(!oNode){oNode=sap.galilei.model.createNewInstance(this.impactAnalysisNodeClassName,this.resource,{analysisObject:oAnalysisObject,objectAdapter:this.getObjectAdapter(oAnalysisObject)});if(oNode){this.model.nodes.push(oNode)}}}return oNode},getNodeSymbolLayoutTemplate:function(oNode){return(oNode&&oNode.isRoot&&this.rootNodeSymbolLayoutTemplate)?this.rootNodeSymbolLayoutTemplate:this.nodeSymbolLayoutTemplate},getNodeSymbolFormatters:function(oNode){return this.nodeSymbolFormatters},getLinkSymbolLayoutTemplate:function(oNode){return this.linkSymbolLayoutTemplate},getLinkSymbolFormatters:function(oNode){return this.nodeSymbolFormatters},createNodeSymbol:function(oNode){var oNodeSymbol,oSymbolLayoutTemplate,oSymbolFormatters,oFormatters;if(oNode&&this.model){if(oNode.relatedSymbols.length===0){oNodeSymbol=sap.galilei.model.createNewInstance(this.impactAnalysisNodeSymbolClassName,this.resource,{object:oNode});if(oNodeSymbol){oSymbolLayoutTemplate=this.getNodeSymbolLayoutTemplate();if(oSymbolLayoutTemplate){oNodeSymbol.layoutTemplate=oSymbolLayoutTemplate}oSymbolFormatters=this.getNodeSymbolFormatters();if(oSymbolFormatters){oFormatters={};if(oNodeSymbol.runtimeClass.formatters){sap.galilei.core.copyProperties(oFormatters,oNodeSymbol.runtimeClass.formatters,true)}sap.galilei.core.copyProperties(oFormatters,oSymbolFormatters,true);oNodeSymbol.formatters=oFormatters}this.diagram.symbols.push(oNodeSymbol)}}else{oNodeSymbol=oNode.relatedSymbols.get(0)}}return oNodeSymbol},createNodeObjectAndSymbol:function(oAnalysisObject){return this.createNodeSymbol(this.createNodeObject(oAnalysisObject))},createRootNodeObjectAndSymbol:function(){if(this.analysisObject){this.rootNode=this.createNodeObject(this.analysisObject);if(this.rootNode){this.rootNode.isRoot=true;this.rootNodeSymbol=this.createNodeSymbol(this.rootNode);this.rootNodeSymbol.getOrCreateShape();this.rootNodeSymbol.x=(this.editor.viewer.viewWidth-this.rootNodeSymbol.width)/2;this.rootNodeSymbol.y=(this.editor.viewer.viewHeight-this.rootNodeSymbol.height)/2}}return this.rootNodeSymbol},createNodeLinkObject:function(oSourceNode,oTargetNode){var oNodeLink;if(oSourceNode&&oTargetNode&&this.model){oNodeLink=sap.galilei.model.createNewInstance(this.impactAnalysisNodeLinkClassName,this.resource,{source:oSourceNode,target:oTargetNode});if(oNodeLink){this.model.nodeLinks.push(oNodeLink)}}return oNodeLink},createNodeLinkSymbol:function(oSourceNodeSymbol,oTargetNodeSymbol,oNodeLink){var oNodeLinkSymbol,oSymbolLayoutTemplate,oSymbolFormatters,oFormatters;if(oSourceNodeSymbol&&oTargetNodeSymbol&&oNodeLink&&this.model){oNodeLinkSymbol=sap.galilei.model.createNewInstance(this.impactAnalysisNodeLinkSymbolClassName,this.resource,{object:oNodeLink,sourceSymbol:oSourceNodeSymbol,targetSymbol:oTargetNodeSymbol});if(oNodeLinkSymbol){oSymbolLayoutTemplate=this.getLinkSymbolLayoutTemplate();if(oSymbolLayoutTemplate){oNodeLinkSymbol.layoutTemplate=oSymbolLayoutTemplate}oSymbolFormatters=this.getLinkSymbolFormatters();if(oSymbolFormatters){oFormatters={};if(oNodeLinkSymbol.runtimeClass.formatters){sap.galilei.core.copyProperties(oFormatters,oNodeLinkSymbol.runtimeClass.formatters,true)}sap.galilei.core.copyProperties(oFormatters,oSymbolFormatters,true);oNodeLinkSymbol.formatters=oFormatters}if(this.diagram.symbols.indexOf(oNodeLinkSymbol)===-1){this.diagram.symbols.push(oNodeLinkSymbol)}}}return oNodeLinkSymbol},createNodeLinkObjectAndSymbol:function(oSourceNode,oTargetNode){var oSourceNodeSymbol,oTargetNodeSymbol,oNodeLink,oNodeLinkSymbol;if(oSourceNode&&oTargetNode){oSourceNodeSymbol=oSourceNode.relatedSymbols.length>0?oSourceNode.relatedSymbols.get(0):undefined;oTargetNodeSymbol=oTargetNode.relatedSymbols.length>0?oTargetNode.relatedSymbols.get(0):undefined;if(oSourceNodeSymbol&&oTargetNodeSymbol){oNodeLink=this.createNodeLinkObject(oSourceNode,oTargetNode);if(oNodeLink){oNodeLinkSymbol=this.createNodeLinkSymbol(oSourceNodeSymbol,oTargetNodeSymbol,oNodeLink)}}}return oNodeLinkSymbol},getImpactNodes:function(oNode,aNodes,bBreakAtRoot){var aImpactNodes=[],index,max,oImpactNode;if(oNode&&aNodes){bBreakAtRoot=(bBreakAtRoot===undefined)?true:bBreakAtRoot;aImpactNodes=oNode.getImpactNodes();if(aImpactNodes){for(index=0,max=aImpactNodes.length;index<max;index++){oImpactNode=aImpactNodes[index];if(aNodes.indexOf(oImpactNode)===-1){aNodes.push(oImpactNode)}if(bBreakAtRoot&&oNode===this.rootNode){return}this.getImpactNodes(oImpactNode,aNodes,bBreakAtRoot)}}}},getLineageNodes:function(oNode,aNodes,bBreakAtRoot){var aLineageNodes=[],index,max,oLineageNode;if(oNode&&aNodes){bBreakAtRoot=(bBreakAtRoot===undefined)?true:bBreakAtRoot;aLineageNodes=oNode.getLineageNodes();if(aLineageNodes){for(index=0,max=aLineageNodes.length;index<max;index++){oLineageNode=aLineageNodes[index];if(aNodes.indexOf(oLineageNode)===-1){aNodes.push(oLineageNode)}if(bBreakAtRoot&&oNode===this.rootNode){return}this.getLineageNodes(oLineageNode,aNodes,bBreakAtRoot)}}}},getImpactSymbols:function(oNodeSymbol,aSymbols,bIncludeLinks,bIncludeHiddenSymbols,bBreakAtRoot,bIncludeRoot,nExpandLevel,nCurrentLevel){var aLinkSymbols,oLinkSymbol,index,max;if(oNodeSymbol&&aSymbols){bBreakAtRoot=(bBreakAtRoot===undefined)?true:bBreakAtRoot;bIncludeRoot=(bIncludeRoot===undefined)?false:bIncludeRoot;if(nExpandLevel!==undefined&&nExpandLevel>sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL){nExpandLevel=sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL}nCurrentLevel=(nCurrentLevel===undefined)?1:nCurrentLevel;aLinkSymbols=oNodeSymbol.getLinkSymbols(true,false);if(aLinkSymbols){for(index=0,max=aLinkSymbols.length;index<max;index++){oLinkSymbol=aLinkSymbols[index];if(!bIncludeHiddenSymbols&&oLinkSymbol.isHidden){continue}if(bIncludeLinks&&aSymbols.indexOf(oLinkSymbol)===-1){aSymbols.push(oLinkSymbol)}if(bBreakAtRoot&&oLinkSymbol.targetSymbol===this.rootNodeSymbol){if(bIncludeRoot){aSymbols.push(this.rootNodeSymbol)}continue}if(aSymbols.indexOf(oLinkSymbol.targetSymbol)===-1){aSymbols.push(oLinkSymbol.targetSymbol)}if(nExpandLevel===undefined||nCurrentLevel<nExpandLevel){this.getImpactSymbols(oLinkSymbol.targetSymbol,aSymbols,bIncludeLinks,bIncludeHiddenSymbols,bBreakAtRoot,bIncludeRoot,nExpandLevel,nCurrentLevel+1)}}}}},getLineageSymbols:function(oNodeSymbol,aSymbols,bIncludeLinks,bIncludeHiddenSymbols,bBreakAtRoot,bIncludeRoot,nExpandLevel,nCurrentLevel){var aLinkSymbols,oLinkSymbol,index,max;if(oNodeSymbol&&aSymbols){bBreakAtRoot=(bBreakAtRoot===undefined)?true:bBreakAtRoot;bIncludeRoot=(bIncludeRoot===undefined)?false:bIncludeRoot;if(nExpandLevel!==undefined&&nExpandLevel>sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL){nExpandLevel=sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL}nCurrentLevel=(nCurrentLevel===undefined)?1:nCurrentLevel;aLinkSymbols=oNodeSymbol.getLinkSymbols(false,true);if(aLinkSymbols){for(index=0,max=aLinkSymbols.length;index<max;index++){oLinkSymbol=aLinkSymbols[index];if(!bIncludeHiddenSymbols&&oLinkSymbol.isHidden){continue}if(bIncludeLinks&&aSymbols.indexOf(oLinkSymbol)===-1){aSymbols.push(oLinkSymbol)}if(bBreakAtRoot&&oLinkSymbol.sourceSymbol===this.rootNodeSymbol){if(bIncludeRoot){aSymbols.push(this.rootNodeSymbol)}continue}if(aSymbols.indexOf(oLinkSymbol.sourceSymbol)===-1){aSymbols.push(oLinkSymbol.sourceSymbol)}if(nExpandLevel===undefined||nCurrentLevel<nExpandLevel){this.getLineageSymbols(oLinkSymbol.sourceSymbol,aSymbols,bIncludeLinks,bIncludeHiddenSymbols,bBreakAtRoot,bIncludeRoot,nExpandLevel,nCurrentLevel+1)}}}}},getPath:function(oCurrentSymbol){var aSymbols=[],index;if(oCurrentSymbol&&oCurrentSymbol.object){if(!oCurrentSymbol.isLinkSymbol){if(!oCurrentSymbol.object.isRoot){aSymbols.push(oCurrentSymbol);if(oCurrentSymbol.object.isImpact){this.getLineageSymbols(oCurrentSymbol,aSymbols,true,false,true,false)}else{this.getImpactSymbols(oCurrentSymbol,aSymbols,true,false,true,false)}index=aSymbols.indexOf(this.rootNodeSymbol);if(index!==-1){aSymbols.splice(index,1)}if(aSymbols.length===1){aSymbols=[]}}}else{aSymbols.push(oCurrentSymbol);if(oCurrentSymbol.sourceSymbol&&oCurrentSymbol.sourceSymbol!==this.rootNodeSymbol){aSymbols.push(oCurrentSymbol.sourceSymbol)}if(oCurrentSymbol.targetSymbol&&oCurrentSymbol.targetSymbol!==this.rootNodeSymbol){aSymbols.push(oCurrentSymbol.targetSymbol)}}}return aSymbols},highlightPath:function(oCurrentSymbol){var aSymbols;if(this.showPath){aSymbols=this.getPath(oCurrentSymbol);if(aSymbols&&aSymbols.length>0){this.editor.highlightSymbols(aSymbols,undefined,undefined,true,[this.rootNodeSymbol]);this.hasHighlighted=true}}},unhighlightPath:function(){if(this.hasHighlighted){this.editor.unhighlightAllSymbols();this.hasHighlighted=false}},_expandOneNode:function(oNodeSymbol,bImpact,bLineage,bLayoutDiagram,bShowGlobalView,nExpandLevel,nCurrentLevel,fnAfterExpand){var oNode,self=this,aSymbols=[],index,max,oShowSymbol,aImpactNodeSymbols=[],oImpactNodeSymbol,aLineageNodeSymbols=[],oLineageNodeSymbol,bExpandChildNodes;nExpandLevel=(nExpandLevel!==undefined)?nExpandLevel:((this.expandLevel!==undefined)?this.expandLevel:1);if(nExpandLevel>sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL){nExpandLevel=sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL}nCurrentLevel=(nCurrentLevel===undefined)?1:nCurrentLevel;bExpandChildNodes=nExpandLevel>1&&nCurrentLevel<nExpandLevel;if(!this._bringToViewSymbols){this._bringToViewSymbols=[]}if(oNodeSymbol&&oNodeSymbol.object){oNode=oNodeSymbol.object;if(bImpact&&(oNode.isImpact||oNode.isRoot)){oNode.isImpactExpanded=true;this._asyncCalls++;jQuery.when(oNode.getHasImpactAsync()).done(function(){self._asyncCalls--;if(oNode.hasImpact){if(!oNode.isImpactLoaded||!oNode.isImpactObjectsCreated){self._asyncCalls++;oNode.retrieveImpactObjects(function(aObjectsInfo){self._asyncCalls--;var index,max,oObjectInfo,oImpactObject,oImpactSymbol,oImpactNode,oImpactNodeLink,oImpactNodeLinkSymbol,oLinkInfo,bSymbolCreated;function createImpactObjects(){for(index=0,max=aObjectsInfo.length;index<max;index++){oObjectInfo=aObjectsInfo[index];oImpactObject=oObjectInfo.object;oImpactNode=self.getNodeObject(oImpactObject);if(!oImpactNode&&self.canCreateNode(oNode,oImpactObject,true)){oImpactNode=self.createNodeObject(oImpactObject);if(oImpactNode){oImpactNode.isImpact=true;if(bExpandChildNodes){oImpactNode.isImpactExpanding=true}}}else{if(oImpactNode){if(oImpactNode.isRoot||oImpactNode.isLineage){continue}}}oImpactSymbol=undefined;if(oImpactNode){bSymbolCreated=false;oImpactSymbol=oImpactNode.relatedSymbols.get(0);if(!oImpactSymbol){oImpactSymbol=self.createNodeSymbol(oImpactNode);if(oImpactSymbol){bSymbolCreated=true}}if(oImpactSymbol){if(bSymbolCreated||oImpactSymbol.isHidden){if(self.orientation===sap.galilei.ui.symbol.Orientation.horizontal){oImpactSymbol.x=oNodeSymbol.x+oNodeSymbol.width;oImpactSymbol.y=oNodeSymbol.y}else{oImpactSymbol.x=oNodeSymbol.x;oImpactSymbol.y=oNodeSymbol.y+oNodeSymbol.height}if(bSymbolCreated){self.editor.registerSymbolEvents(oImpactSymbol);oImpactSymbol.drawSymbol(self.editor.viewer)}else{self.editor.updateSymbolEvents(oImpactSymbol);oImpactSymbol.show(self.editor.viewer,undefined,{showLinkSymbols:false})}}self._bringToViewSymbols.push(oImpactSymbol)}}oImpactNodeLinkSymbol=undefined;if(oImpactNode&&oImpactSymbol){oImpactNodeLink=self.getNodeLinkObject(oNode,oImpactNode);if(!oImpactNodeLink){if(self.canCreateNode(oNode,oImpactObject,true)){oImpactNodeLink=self.createNodeLinkObject(oNode,oImpactNode);if(oImpactNodeLink){oImpactNodeLink.isImpact=true;if(oObjectInfo.link){oLinkInfo=oObjectInfo.link;oImpactNodeLink.analysisObject=oLinkInfo.object;oImpactNodeLink.referenceName=oLinkInfo.referenceName}}}}else{oImpactNodeLinkSymbol=oImpactNodeLink.relatedSymbols.get(0)}bSymbolCreated=false;if(!oImpactNodeLinkSymbol){oImpactNodeLinkSymbol=self.createNodeLinkSymbol(oNode.relatedSymbols.get(0),oImpactNode.relatedSymbols.get(0),oImpactNodeLink);if(oImpactNodeLinkSymbol){bSymbolCreated=true}}if(oImpactNodeLinkSymbol){if(bSymbolCreated||oImpactNodeLinkSymbol.isHidden){oImpactNodeLinkSymbol.points=undefined;if(bSymbolCreated){self.editor.registerSymbolEvents(oImpactNodeLinkSymbol);oImpactNodeLinkSymbol.drawSymbol(self.editor.viewer)}else{self.editor.updateSymbolEvents(oImpactNodeLinkSymbol);oImpactNodeLinkSymbol.show(self.editor.viewer)}}}}if(bExpandChildNodes&&oImpactSymbol){aImpactNodeSymbols.push(oImpactSymbol)}}}if(aObjectsInfo&&aObjectsInfo.length>0){self.resource.applyUndoableAction(createImpactObjects,"Create impact objects",true);self._isNeedLayoutDiagram=true}oNode.isImpactObjectsCreated=true;if(bExpandChildNodes){for(index=0,max=aImpactNodeSymbols.length;index<max;index++){oImpactNodeSymbol=aImpactNodeSymbols[index];self._expandOneNode(oImpactNodeSymbol,true,false,bLayoutDiagram,bShowGlobalView,nExpandLevel,nCurrentLevel+1,fnAfterExpand)}}if(fnAfterExpand){fnAfterExpand()}})}else{self.getImpactSymbols(oNodeSymbol,aSymbols,true,true,false,false,1);for(index=0,max=aSymbols.length;index<max;index++){oShowSymbol=aSymbols[index];if(oShowSymbol.isHidden){if(oShowSymbol.isLinkSymbol){oShowSymbol.points=undefined}else{if(self.orientation===sap.galilei.ui.symbol.Orientation.horizontal){oShowSymbol.x=oNodeSymbol.x+oNodeSymbol.width;oShowSymbol.y=oNodeSymbol.y+(oNodeSymbol.height-oShowSymbol.height)/2}else{oShowSymbol.x=oNodeSymbol.x+(oNodeSymbol.width-oShowSymbol.width)/2;oShowSymbol.y=oNodeSymbol.y+oNodeSymbol.height}}self.editor.updateSymbolEvents(oShowSymbol);oShowSymbol.show(self.editor.viewer,undefined,{showLinkSymbols:false})}if(!oShowSymbol.isLinkSymbol){self._bringToViewSymbols.push(oShowSymbol)}if(bExpandChildNodes&&!oShowSymbol.isLinkSymbol){aImpactNodeSymbols.push(oShowSymbol)}}if(bExpandChildNodes){for(index=0,max=aImpactNodeSymbols.length;index<max;index++){oImpactNodeSymbol=aImpactNodeSymbols[index];self._expandOneNode(oImpactNodeSymbol,true,false,bLayoutDiagram,bShowGlobalView,nExpandLevel,nCurrentLevel+1,fnAfterExpand)}}self._isNeedLayoutDiagram=true}}}).fail(function(){self._asyncCalls--})}if(bLineage&&(oNode.isLineage||oNode.isRoot)){oNode.isLineageExpanded=true;this._asyncCalls++;jQuery.when(oNode.getHasLineageAsync()).done(function(){self._asyncCalls--;if(oNode.hasLineage){if(!oNode.isLineageLoaded||!oNode.isLineageObjectsCreated){self._asyncCalls++;oNode.retrieveLineageObjects(function(aObjectsInfo){self._asyncCalls--;var index,max,oObjectInfo,oLineageObject,oLineageSymbol,oLineageNode,oLineageNodeLink,oLineageNodeLinkSymbol,oLinkInfo,bSymbolCreated;function createLineageObjects(){for(index=0,max=aObjectsInfo.length;index<max;index++){oObjectInfo=aObjectsInfo[index];oLineageObject=oObjectInfo.object;oLineageNode=self.getNodeObject(oLineageObject);if(!oLineageNode&&self.canCreateNode(oNode,oLineageObject,false)){oLineageNode=self.createNodeObject(oLineageObject);if(oLineageNode){oLineageNode.isLineage=true;if(bExpandChildNodes){oLineageNode.isLineageExpanding=true}}}else{if(oLineageNode){if(oLineageNode.isRoot||oLineageNode.isImpact){continue}}}oLineageSymbol=undefined;if(oLineageNode){bSymbolCreated=false;oLineageSymbol=oLineageNode.relatedSymbols.get(0);if(!oLineageSymbol){oLineageSymbol=self.createNodeSymbol(oLineageNode);if(oLineageSymbol){bSymbolCreated=true}}if(oLineageSymbol){if(bSymbolCreated||oLineageSymbol.isHidden){if(self.orientation===sap.galilei.ui.symbol.Orientation.horizontal){oLineageSymbol.x=oNodeSymbol.x-oNodeSymbol.width;oLineageSymbol.y=oNodeSymbol.y}else{oLineageSymbol.x=oNodeSymbol.x;oLineageSymbol.y=oNodeSymbol.y-oNodeSymbol.height}if(bSymbolCreated){self.editor.registerSymbolEvents(oLineageSymbol);oLineageSymbol.drawSymbol(self.editor.viewer)}else{self.editor.updateSymbolEvents(oLineageSymbol);oLineageSymbol.show(self.editor.viewer,undefined,{showLinkSymbols:false})}}self._bringToViewSymbols.push(oLineageSymbol)}}oLineageNodeLinkSymbol=undefined;if(oLineageNode&&oLineageSymbol){oLineageNodeLink=self.getNodeLinkObject(oLineageNode,oNode);if(!oLineageNodeLink&&self.canCreateNode(oNode,oLineageObject,false)){oLineageNodeLink=self.createNodeLinkObject(oLineageNode,oNode);if(oLineageNodeLink){oLineageNodeLink.isLineage=true;if(oObjectInfo.link){oLinkInfo=oObjectInfo.link;oLineageNodeLink.analysisObject=oLinkInfo.object;oLineageNodeLink.referenceName=oLinkInfo.referenceName}}else{oLineageNodeLinkSymbol=oLineageNodeLink.relatedSymbols.get(0)}bSymbolCreated=false;if(!oLineageNodeLinkSymbol){oLineageNodeLinkSymbol=self.createNodeLinkSymbol(oLineageNode.relatedSymbols.get(0),oNode.relatedSymbols.get(0),oLineageNodeLink);if(oLineageNodeLinkSymbol){bSymbolCreated=true}}if(oLineageNodeLinkSymbol){if(bSymbolCreated||oLineageNodeLinkSymbol.isHidden){oLineageNodeLinkSymbol.points=undefined;if(bSymbolCreated){self.editor.registerSymbolEvents(oLineageNodeLinkSymbol);oLineageNodeLinkSymbol.drawSymbol(self.editor.viewer)}else{self.editor.updateSymbolEvents(oLineageNodeLinkSymbol);oLineageNodeLinkSymbol.show(self.editor.viewer)}}}}}if(bExpandChildNodes&&oLineageSymbol){aLineageNodeSymbols.push(oLineageSymbol)}}}if(aObjectsInfo&&aObjectsInfo.length>0){self.resource.applyUndoableAction(createLineageObjects,"Create lineage objects",true);self._isNeedLayoutDiagram=true}oNode.isLineageObjectsCreated=true;if(bExpandChildNodes){for(index=0,max=aLineageNodeSymbols.length;index<max;index++){oLineageNodeSymbol=aLineageNodeSymbols[index];self._expandOneNode(oLineageNodeSymbol,false,true,bLayoutDiagram,bShowGlobalView,nExpandLevel,nCurrentLevel+1,fnAfterExpand)}}if(fnAfterExpand){fnAfterExpand()}})}else{self.getLineageSymbols(oNodeSymbol,aSymbols,true,true,false,false,1);for(index=0,max=aSymbols.length;index<max;index++){oShowSymbol=aSymbols[index];if(oShowSymbol.isHidden){if(oShowSymbol.isLinkSymbol){oShowSymbol.points=undefined}else{if(self.orientation===sap.galilei.ui.symbol.Orientation.horizontal){oShowSymbol.x=oNodeSymbol.x-oNodeSymbol.width;oShowSymbol.y=oNodeSymbol.y+(oNodeSymbol.height-oShowSymbol.height)/2}else{oShowSymbol.x=oNodeSymbol.x+(oNodeSymbol.width-oShowSymbol.width)/2;oShowSymbol.y=oNodeSymbol.y-oNodeSymbol.height}}self.editor.updateSymbolEvents(oShowSymbol);oShowSymbol.show(self.editor.viewer,undefined,{showLinkSymbols:false})}if(!oShowSymbol.isLinkSymbol){self._bringToViewSymbols.push(oShowSymbol)}if(bExpandChildNodes&&!oShowSymbol.isLinkSymbol){aLineageNodeSymbols.push(oShowSymbol)}}if(bExpandChildNodes){for(index=0,max=aLineageNodeSymbols.length;index<max;index++){oLineageNodeSymbol=aLineageNodeSymbols[index];self._expandOneNode(oLineageNodeSymbol,false,true,bLayoutDiagram,bShowGlobalView,nExpandLevel,nCurrentLevel+1,fnAfterExpand)}}self._isNeedLayoutDiagram=true}}}).fail(function(){self._asyncCalls--})}}},expandNodes:function(vSymbols,bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish){var self=this,index,max,oSymbol,oNode,oTransitionDefinition,oEvent={};function afterExpandNode(){var bLayout=false,nAnimationDuration=0;if(max>0&&(index===max-1||index===max)&&self._asyncCalls===0){if(bShowGlobalView){bLayout=true;if(self.editor.transitionDefinition!==undefined){nAnimationDuration+=self.editor.transitionDefinition.duration}}else{if(self._isNeedLayoutDiagram){bLayout=true;nAnimationDuration+=self.animationDuration;if(self._bringToViewSymbols&&self._bringToViewSymbols.length>0&&self.editor.transitionDefinition!==undefined){nAnimationDuration+=self.editor.transitionDefinition.duration}}}nAnimationDuration+=self.delayedLayoutDuration;if(bLayout){self.delayedLayoutDiagram(bImpact,bLineage,bShowGlobalView)}setTimeout(function(){self._asyncCalls=0;self._isNeedLayoutDiagram=false;delete self._currentNode;self.editor.enableSelectSymbol=true;if(self._selectedSymbols&&self._selectedSymbols.length>0){if(self.editor.diagram.symbols.length<20){self.editor.selectSymbols(self._selectedSymbols)}self._selectedSymbols=[]}self.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("impactAnalysis.after.expand",self,self,oEvent);if(fnFinish){fnFinish()}},nAnimationDuration)}}function expandNodes(){for(index=0;index<max;index++){if(sap.galilei.core.isInstanceOf(vSymbols,"Array")){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}oNode=oSymbol.object;self._currentNode=oNode;self._expandOneNode(oSymbol,bImpact,bLineage,false,false,nExpandLevel,1,afterExpandNode)}afterExpandNode()}if(this.editor&&vSymbols){this._asyncCalls=0;this._isNeedLayoutDiagram=false;this._bringToViewSymbols=[];max=vSymbols.length;if(max>0){this.editor.enableSelectSymbol=false;this._selectedSymbols=[];if(this.editor.selectedSymbols.length>0){sap.galilei.ui.editor.layout.Layout.mergeListSymbols(this._selectedSymbols,this.editor.selectedSymbols);oTransitionDefinition=this.editor.transitionDefinition;this.editor.transitionDefinition=undefined;this.editor.unselectAllSymbols(true);this.editor.transitionDefinition=oTransitionDefinition}this.editor.addEventProperties(oEvent);oEvent.symbols=vSymbols;sap.galilei.core.Event.publish("impactAnalysis.before.expand",this,this,oEvent);if(this.supportBusyDialog){setTimeout(expandNodes,100)}else{expandNodes()}}}},expandNode:function(oNodeSymbol,bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish){if(oNodeSymbol){this.expandNodes([oNodeSymbol],bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish)}},expandSelectedNodes:function(bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish){var aSymbols=[],index,max,oSymbol,oNode;for(index=0,max=this.editor.selectedSymbols.length;index<max;index++){oSymbol=this.editor.selectedSymbols[index];oNode=oSymbol.object;if(oNode&&(oNode.isRoot||(bImpact&&oNode.isImpact)||(bLineage&&oNode.isLineage))){aSymbols.push(oSymbol)}}if(max>0){this.expandNodes(aSymbols,bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish)}},expandRooNode:function(bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish){this.expandNode(this.rootNodeSymbol,bImpact,bLineage,bShowGlobalView,nExpandLevel,fnFinish)},hideSymbols:function(aSymbols){var index,max,oHideSymbol;if(aSymbols){for(index=0,max=aSymbols.length;index<max;index++){oHideSymbol=aSymbols[index];oHideSymbol.hide(this.editor.viewer,this.editor.transitionDefinition,{removeShape:true})}}},collapseNodes:function(vSymbols,bImpact,bLineage,bShowGlobalView,fnFinish){var self=this,index,max,oNodeSymbol,oNode,aSymbols=[],aRootSymbols,aLinkSymbols,aVisibleSymbols,bChanged,oHideSymbol,oTransitionDefinition;function afterCollapseNodes(){self.delayedLayoutDiagram(bImpact,bLineage,bShowGlobalView);setTimeout(function(){self.editor.enableSelectSymbol=true;if(self._selectedSymbols&&self._selectedSymbols.length>0){if(self.editor.diagram.symbols.length<20){self.editor.selectSymbols(self._selectedSymbols)}self._selectedSymbols=[]}if(fnFinish){fnFinish()}},self.animationDuration+self.delayedLayoutDuration)}if(this.editor&&vSymbols){this.editor.enableSelectSymbol=false;this._selectedSymbols=[];if(this.editor.selectedSymbols.length>0){sap.galilei.ui.editor.layout.Layout.mergeListSymbols(this._selectedSymbols,this.editor.selectedSymbols);oTransitionDefinition=this.editor.transitionDefinition;this.editor.transitionDefinition=undefined;this.editor.unselectAllSymbols(true);this.editor.transitionDefinition=oTransitionDefinition}for(index=0,max=vSymbols.length;index<max;index++){if(sap.galilei.core.isInstanceOf(vSymbols,"Array")){oNodeSymbol=vSymbols[index]}else{oNodeSymbol=vSymbols.get(index)}oNode=oNodeSymbol.object;if(oNode){if(bImpact&&(oNode.isImpact||oNode.isRoot)){oNode.isImpactExpanded=false;this.getImpactSymbols(oNodeSymbol,aSymbols,false,false,false);aLinkSymbols=oNodeSymbol.getLinkSymbols(true,false);this.hideSymbols(aLinkSymbols)}if(bLineage&&(oNode.isLineage||oNode.isRoot)){oNode.isLineageExpanded=false;this.getLineageSymbols(oNodeSymbol,aSymbols,false,false,false);aLinkSymbols=oNodeSymbol.getLinkSymbols(false,true);this.hideSymbols(aLinkSymbols)}}}do{aVisibleSymbols=[];bChanged=false;for(index=0,max=aSymbols.length;index<max;index++){oHideSymbol=aSymbols[index];oNode=oHideSymbol.object;if(oNode){if(bImpact&&(oNode.isImpact||oNode.isRoot)){aRootSymbols=[];this.getLineageSymbols(oHideSymbol,aRootSymbols,false,false,true,true,1);if(aRootSymbols.length===0){this.hideSymbols([oHideSymbol]);oNode.isImpactExpanded=false;bChanged=true}else{aVisibleSymbols.push(oHideSymbol)}}if(bLineage&&(oNode.isLineage||oNode.isRoot)){aRootSymbols=[];this.getImpactSymbols(oHideSymbol,aRootSymbols,false,false,true,true,1);if(aRootSymbols.length===0){this.hideSymbols([oHideSymbol]);oNode.isLineageExpanded=false;bChanged=true}else{aVisibleSymbols.push(oHideSymbol)}}}}aSymbols=aVisibleSymbols}while(bChanged);if(vSymbols.length>0){afterCollapseNodes()}}},collapseNode:function(oNodeSymbol,bImpact,bLineage,bShowGlobalView,fnFinish){if(oNodeSymbol){this.collapseNodes([oNodeSymbol],bImpact,bLineage,bShowGlobalView,fnFinish)}},collapseSelectedNodes:function(bImpact,bLineage,bShowGlobalView,fnFinish){var aSymbols=[],index,max,oSymbol,oNode;for(index=0,max=this.editor.selectedSymbols.length;index<max;index++){oSymbol=this.editor.selectedSymbols[index];oNode=oSymbol.object;if(oNode&&(oNode.isRoot||(bImpact&&oNode.isImpact)||(bLineage&&oNode.isLineage))){aSymbols.push(oSymbol)}}if(max>0){this.collapseNodes(aSymbols,bImpact,bLineage,bShowGlobalView,fnFinish)}},collapseRooNode:function(bImpact,bLineage,bShowGlobalView,fnFinish){this.collapseNode(this.rootNodeSymbol,bImpact,bLineage,bShowGlobalView,fnFinish)},onToggleImpactExpander:function(oSymbol,bToggleAll,fnFinish){var self=this,nExpandLevel;if(!this.editor.enableSelectSymbol){return}if(this._toggleTimerId){return}this._toggleTimerId=setTimeout(function(){self._toggleTimerId=undefined},500);if(oSymbol&&oSymbol.object){bToggleAll=(bToggleAll!==undefined)?bToggleAll:false;nExpandLevel=bToggleAll?sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL:1;if(this.editor.selectedSymbols.indexOf(oSymbol)!==-1){if(oSymbol.object.isImpactExpanded){this.collapseSelectedNodes(true,false,false,fnFinish)}else{this.expandSelectedNodes(true,false,false,nExpandLevel,fnFinish)}}else{setTimeout(function(){if(oSymbol.object.isImpactExpanded){self.collapseNode(oSymbol,true,false,false,fnFinish)}else{self.expandNode(oSymbol,true,false,false,nExpandLevel,fnFinish)}},10)}}},onToggleLineageExpander:function(oSymbol,bToggleAll,fnFinish){var self=this,nExpandLevel;if(!this.editor.enableSelectSymbol){return}if(this._toggleTimerId){return}this._toggleTimerId=setTimeout(function(){self._toggleTimerId=undefined},500);if(oSymbol&&oSymbol.object){bToggleAll=(bToggleAll!==undefined)?bToggleAll:false;nExpandLevel=bToggleAll?sap.galilei.ui.editor.impactAnalysis.ImpactAnalyzer.MAX_EXPAND_LEVEL:1;if(this.editor.selectedSymbols.indexOf(oSymbol)!==-1){if(oSymbol.object.isLineageExpanded){this.collapseSelectedNodes(false,true,false,fnFinish)}else{this.expandSelectedNodes(false,true,false,nExpandLevel,fnFinish)}}else{setTimeout(function(){if(oSymbol.object.isLineageExpanded){self.collapseNode(oSymbol,false,true,false,fnFinish)}else{self.expandNode(oSymbol,false,true,false,nExpandLevel,fnFinish)}},10)}}},onFilterNodeSymbol:function(oGraphBuilder,oSymbol){var bSkip=false,oObject=oSymbol&&oSymbol.object;if((this._bImpact&&!this._bLineage&&oSymbol.object.isLineage)||(!this._bImpact&&this._bLineage&&oSymbol.object.isImpact)){if(oGraphBuilder.autoLayout.fixedSymbols===undefined){oGraphBuilder.autoLayout.fixedSymbols=[]}oGraphBuilder.autoLayout.fixedSymbols.push(oSymbol)}return !bSkip},onFilterLinkSymbol:function(oGraphBuilder,oSymbol){var bSkip=false;if(oSymbol&&oSymbol.object&&oSymbol.object.source&&oSymbol.object.target){if(!oSymbol.object.source.isImpactExpanded&&!oSymbol.object.target.isLineageExpanded){bSkip=true}}return !bSkip},onPreUpdateSymbols:function(oGraphUpdater){oGraphUpdater.editor.updateSymbolDrawingOrder()},onPostUpdateLinkSymbol:function(oAutoLayout,oLinkSymbol,oEdge){var oBBox,aPoint1,aPoint2,index,max;if(oLinkSymbol&&oLinkSymbol.sourceSymbol&&oLinkSymbol.targetSymbol){oBBox=oLinkSymbol.sourceSymbol.getBBox();if(oAutoLayout.layout.direction==="RIGHT"){aPoint1=oBBox.getPoint(sap.galilei.ui.common.DockPosition.right);if(oLinkSymbol.object.isImpact){aPoint1[0]+=this.EXPANDER_SIZE}}else{aPoint1=oBBox.getPoint(sap.galilei.ui.common.DockPosition.bottom);if(oLinkSymbol.object.isImpact){aPoint1[1]+=this.EXPANDER_SIZE}}oBBox=oLinkSymbol.targetSymbol.getBBox();if(oAutoLayout.layout.direction==="RIGHT"){aPoint2=oBBox.getPoint(sap.galilei.ui.common.DockPosition.left);if(oLinkSymbol.object.isLineage){aPoint2[0]-=this.EXPANDER_SIZE}}else{aPoint2=oBBox.getPoint(sap.galilei.ui.common.DockPosition.top);if(oLinkSymbol.object.isLineage){aPoint2[1]-=this.EXPANDER_SIZE}}if(oLinkSymbol.points&&oLinkSymbol.points.length>=2){oLinkSymbol.points[0]=[aPoint1[0],aPoint1[1]];oLinkSymbol.points[oLinkSymbol.points.length-1]=[aPoint2[0],aPoint2[1]];if(oLinkSymbol.points.length===4){if(oAutoLayout.layout.direction==="RIGHT"){oLinkSymbol.points[1]=[(aPoint1[0]+aPoint2[0])/2,aPoint1[1]];oLinkSymbol.points[2]=[(aPoint1[0]+aPoint2[0])/2,aPoint2[1]]}else{oLinkSymbol.points[1]=[aPoint1[0],(aPoint1[1]+aPoint2[1])/2];oLinkSymbol.points[2]=[aPoint2[0],(aPoint1[1]+aPoint2[1])/2]}}else{for(index=0,max=oLinkSymbol.points.length-2;index<max;index++){oLinkSymbol.points.removeAt(1)}}}else{oLinkSymbol.points=new sap.galilei.ui.common.Points([aPoint1,aPoint2])}}},onAutoLayoutSuccess:function(oAutoLayout){var self=this,bAnimation=false,oEvent={};if(this._bShowGlobalView){oAutoLayout.editor.showGlobalView();bAnimation=true}else{if(this._bringToViewSymbols&&this._bringToViewSymbols.length>0){oAutoLayout.editor.bringSymbolsToView(this._bringToViewSymbols,true,false);bAnimation=true}}this._bringToViewSymbols=[];delete this._bImpact;delete this._bLineage;delete this._bShowGlobalView;if(bAnimation){setTimeout(function(){delete self._isLayouting},this.animationDuration)}else{delete this._isLayouting}},onAutoLayoutError:function(error){this._bringToViewSymbols=[];delete this._bImpact;delete this._bLineage;delete this._bShowGlobalView;delete this._isLayouting;throw error},layoutDiagram:function(bImpact,bLineage,bShowGlobalView){var self=this,oLayoutOptions;bImpact=(bImpact===undefined)?this.showImpact:bImpact;bLineage=(bLineage===undefined)?this.showLineage:bLineage;bShowGlobalView=(bShowGlobalView===undefined)?false:bShowGlobalView;if(this.editor&&this.diagram){this._bImpact=bImpact;this._bLineage=bLineage;this._bShowGlobalView=bShowGlobalView;this._isLayouting=true;this.autoLayout.layoutDiagram(this.diagram,{isSupportMultiEdges:true,isIncludeSubLinkSymbols:true,isDirected:true,isDoubleTree:true,layout:this.layoutOptions,onFilterNodeSymbol:jQuery.proxy(this.onFilterNodeSymbol,this),onFilterLinkSymbol:jQuery.proxy(this.onFilterLinkSymbol,this),onPreUpdateSymbols:jQuery.proxy(this.onPreUpdateSymbols,this),onPostUpdateLinkSymbol:jQuery.proxy(this.onPostUpdateLinkSymbol,this),animationDuration:this.animationDuration,fixedSymbol:this.rootNodeSymbol},this.editor,jQuery.proxy(this.onAutoLayoutSuccess,this),jQuery.proxy(this.onAutoLayoutError,this))}},delayedLayoutDiagram:function(bImpact,bLineage,bShowGlobalView){var self=this;function layout(){self._layoutTimerId=undefined;if(!self._isLayouting){self.layoutDiagram(bImpact,bLineage,bShowGlobalView)}else{self._layoutTimerId=setTimeout(layout,self.delayedLayoutDuration)}}if(this._layoutTimerId){clearTimeout(this._layoutTimerId)}this._layoutTimerId=setTimeout(layout,this.delayedLayoutDuration)}}})}());
namespace("sap.galilei.impactAnalysis.generic",function(nsLocal){var oResource,oReader,oModelDef={contents:{"Sap.Galilei.ImpactAnalysis.GenericModel":{classDefinition:"sap.galilei.model.Package",displayName:"Impact Analysis Generic Model",namespaceName:"sap.galilei.impactAnalysis.generic",classifiers:{AnalysisObject:{displayName:"Analysis Object",parent:"sap.galilei.common.NamedObject",properties:{"AnalysisObject.uri":{name:"uri",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisObject.type":{name:"type",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisObject.description":{name:"description",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisObject.icon":{name:"icon",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisObject.editorURL":{name:"editorURL",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisObject.properties":{name:"properties",dataType:sap.galilei.model.dataTypes.gBlob,isVolatile:true}},references:{"AnalysisObject.impactObjects":{name:"impactObjects",contentType:"sap.galilei.impactAnalysis.generic.AnalysisObject",isMany:true,isContainment:false},"AnalysisObject.lineageObjects":{name:"lineageObjects",contentType:"sap.galilei.impactAnalysis.generic.AnalysisObject",isMany:true,isContainment:false},"AnalysisObject.impactLinkObjects":{name:"impactLinkObjects",contentType:"sap.galilei.impactAnalysis.generic.AnalysisLinkObject",isMany:true,isContainment:false},"AnalysisObject.lineageLinkObjects":{name:"lineageLinkObjects",contentType:"sap.galilei.impactAnalysis.generic.AnalysisLinkObject",isMany:true,isContainment:false}}},AnalysisLinkObject:{displayName:"Analysis Link Object",parent:"sap.galilei.common.LinkObject",properties:{"AnalysisLinkObject.label":{name:"label",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisLinkObject.type":{name:"type",dataType:sap.galilei.model.dataTypes.gString,isVolatile:true},"AnalysisLinkObject.properties":{name:"properties",dataType:sap.galilei.model.dataTypes.gBlob,isVolatile:true}}},AnalysisModel:{displayName:"Analysis Model",parent:"sap.galilei.common.Model",references:{"AnalysisModel.analysisObjects":{name:"analysisObjects",contentType:"sap.galilei.impactAnalysis.generic.AnalysisObject",isMany:true,isContainment:true},"AnalysisModel.analysisLinkObjects":{name:"analysisLinkObjects",contentType:"sap.galilei.impactAnalysis.generic.AnalysisLinkObject",isMany:true,isContainment:true}}}}}}};oResource=new sap.galilei.model.Resource();oReader=new sap.galilei.model.JSONReader();oReader.load(oResource,oModelDef);sap.galilei.impactAnalysis.generic.createModel=function(){var oResource=new sap.galilei.model.Resource(),oModel=new sap.galilei.impactAnalysis.generic.AnalysisModel(oResource);return oModel};sap.galilei.impactAnalysis.generic.getOrCreateAnalysisObject=function(oModel,oObjectData){var oSerializer,oObject;if(oModel&&oObjectData&&oObjectData.uri){oSerializer=sap.galilei.impactAnalysis.generic.ObjectSerializer.getInstance();oObject=oSerializer.getOrCreateAnalysisObject(oModel,oObjectData)}return oObject};sap.galilei.impactAnalysis.generic.createModelAndRootObject=function(oObjectData){var oModel,oObject;if(oObjectData&&oObjectData.uri){oModel=sap.galilei.impactAnalysis.generic.createModel();oObject=oModel&&sap.galilei.impactAnalysis.generic.getOrCreateAnalysisObject(oModel,oObjectData)}return oObject}});
namespace("sap.galilei.impactAnalysis.generic",function(nsLocal){nsLocal.ObjectAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.impactAnalysis.generic.ObjectAdapter",parent:sap.galilei.impactAnalysis.ObjectAdapter,methods:{hasImpact:function(oAnalysisObject,oNode){return oAnalysisObject?(oAnalysisObject.impactObjects!==undefined&&oAnalysisObject.impactObjects.length>0):false},hasLineage:function(oAnalysisObject,oNode){return oAnalysisObject?(oAnalysisObject.lineageObjects!==undefined&&oAnalysisObject.lineageObjects.length>0):false},getHasImpactObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){var self=this,nLevel=1,oServiceProvider,oImpactAnalyzer,oCustomData={analysisObject:oAnalysisObject,node:oNode};if(oAnalysisObject&&oNode){if(!oNode.isImpactLoaded){oServiceProvider=this.getServiceProvider(oAnalysisObject);if(oServiceProvider){oImpactAnalyzer=oServiceProvider.impactAnalyzer;if(oImpactAnalyzer&&oServiceProvider.isSupportMultipleLevels){nLevel=oImpactAnalyzer.expandLevel}}if(this.hasImpact(oAnalysisObject,oNode)){oNode.isImpactLoaded=true;oNode._hasImpactObjects=true;if(fnSuccess){fnSuccess(true)}}else{if(oImpactAnalyzer&&oImpactAnalyzer._currentNode&&(oNode.level-oImpactAnalyzer._currentNode.level)>0&&(oNode.level-oImpactAnalyzer._currentNode.level)<nLevel){oNode.isImpactLoaded=true;oNode._hasImpactObjects=false;if(fnSuccess){fnSuccess(false)}}else{if(oServiceProvider){jQuery.when(oServiceProvider.getImpactAndLineageAsync(oAnalysisObject.uri,true,false,nLevel,oCustomData)).done(function(oIAData){oNode.isImpactLoaded=true;oNode._IAData=oIAData;if(fnSuccess){fnSuccess(oIAData!==undefined&&oIAData.impact!==undefined)}}).fail(function(){if(fnError){fnError()}})}else{if(fnError){fnError()}}}}}else{return oNode._hasImpactObjects}}else{if(fnError){fnError()}}},getHasLineageObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){var self=this,nLevel=1,oServiceProvider,oImpactAnalyzer,oCustomData={analysisObject:oAnalysisObject,node:oNode};if(oAnalysisObject&&oNode){if(!oNode.isLineageLoaded){oServiceProvider=this.getServiceProvider(oAnalysisObject);if(oServiceProvider){oImpactAnalyzer=oServiceProvider.impactAnalyzer;if(oImpactAnalyzer&&oServiceProvider.isSupportMultipleLevels){nLevel=oImpactAnalyzer.expandLevel}}if(this.hasLineage(oAnalysisObject,oNode)){oNode.isLineageLoaded=true;oNode._hasLineageObjects=true;if(fnSuccess){fnSuccess(true)}}else{if(oImpactAnalyzer&&oImpactAnalyzer._currentNode&&(oNode.level-oImpactAnalyzer._currentNode.level)>0&&(oNode.level-oImpactAnalyzer._currentNode.level)<nLevel){oNode.isLineageLoaded=true;oNode._hasLineageObjects=false;if(fnSuccess){fnSuccess(false)}}else{if(oServiceProvider){jQuery.when(oServiceProvider.getImpactAndLineageAsync(oAnalysisObject.uri,false,true,nLevel,oCustomData)).done(function(oIAData){oNode.isLineageLoaded=true;oNode._IAData=oIAData;if(fnSuccess){fnSuccess(oIAData!==undefined&&oIAData.lineage!==undefined)}}).fail(function(){if(fnError){fnError()}})}else{if(fnError){fnError()}}}}}else{return oNode._hasLineageObjects}}else{if(fnError){fnError()}}},retrieveImpactObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){var self=this,nLevel=1,oServiceProvider,oSerializer,oCustomData={analysisObject:oAnalysisObject,node:oNode};function readIAData(oIAData){if(oIAData){oSerializer=self.getObjectSerializer(oAnalysisObject);if(oSerializer){oSerializer.getOrCreateAnalysisObjects(oAnalysisObject.rootContainer,oAnalysisObject,oIAData)}}if(fnSuccess){fnSuccess(self.getObjectsInfo(oAnalysisObject,oAnalysisObject.impactObjects,oAnalysisObject.impactLinkObjects))}}function onError(){if(fnError){fnError()}}if(oAnalysisObject&&oNode){if(!oNode.isImpactLoaded){oServiceProvider=this.getServiceProvider(oAnalysisObject);if(oServiceProvider){if(oServiceProvider.impactAnalyzer&&oServiceProvider.isSupportMultipleLevels){nLevel=oServiceProvider.impactAnalyzer.expandLevel}jQuery.when(oServiceProvider.getImpactAndLineageAsync(oAnalysisObject.uri,true,false,nLevel,oCustomData)).done(readIAData).fail(onError)}else{onError()}}else{readIAData(oNode._IAData);delete oNode._IAData}}else{onError()}},retrieveLineageObjects:function(oAnalysisObject,oNode,fnSuccess,fnError){var self=this,nLevel=1,oServiceProvider,oSerializer,oCustomData={analysisObject:oAnalysisObject,node:oNode};function readIAData(oIAData){if(oIAData){oSerializer=self.getObjectSerializer(oAnalysisObject);if(oSerializer){oSerializer.getOrCreateAnalysisObjects(oAnalysisObject.rootContainer,oAnalysisObject,oIAData)}}if(fnSuccess){fnSuccess(self.getObjectsInfo(oAnalysisObject,oAnalysisObject.lineageObjects,oAnalysisObject.lineageLinkObjects))}}function onError(){if(fnError){fnError()}}if(oAnalysisObject&&oNode){if(!oNode.isLineageLoaded){oServiceProvider=this.getServiceProvider(oAnalysisObject);if(oServiceProvider){if(oServiceProvider.impactAnalyzer&&oServiceProvider.isSupportMultipleLevels){nLevel=oServiceProvider.impactAnalyzer.expandLevel}jQuery.when(oServiceProvider.getImpactAndLineageAsync(oAnalysisObject.uri,false,true,nLevel,oCustomData)).done(readIAData).fail(onError)}else{onError()}}else{readIAData(oNode._IAData);delete oNode._IAData}}else{onError()}}},statics:{_instance:undefined,getInstance:function(){if(!this._instance){this._instance=new sap.galilei.impactAnalysis.generic.ObjectAdapter()}return this._instance}}})});
namespace("sap.galilei.impactAnalysis.generic",function(nsLocal){nsLocal.ObjectSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.impactAnalysis.generic.ObjectSerializer",parent:sap.galilei.impactAnalysis.ObjectSerializer,properties:{impactAnalyzer:undefined},methods:{getAnalysisObject:function(oAnalysisModel,sObjectUri){var oObject=oAnalysisModel&&sObjectUri&&oAnalysisModel.resource.selectObject({uri:sObjectUri});return oObject},createAnalysisObject:function(oAnalysisModel,oObjectData,aObjects,aLinks){var oObject,oLinkObject;if(oAnalysisModel&&oObjectData&&oObjectData.uri){oObject=new sap.galilei.impactAnalysis.generic.AnalysisObject(oAnalysisModel.resource);this.copyProperties(oObject,oObjectData);oObject.displayName=oObject.displayName||oObject.name;oAnalysisModel.analysisObjects.push(oObject);this.getOrCreateAnalysisObjects(oAnalysisModel,oObject,oObjectData,aObjects,aLinks)}return oObject},getOrCreateAnalysisObject:function(oAnalysisModel,oObjectData,aObjects,aLinks){var oObject;if(oAnalysisModel&&oObjectData&&oObjectData.uri){oObject=this.getAnalysisObject(oAnalysisModel,oObjectData.uri);if(!oObject){oObject=this.createAnalysisObject(oAnalysisModel,oObjectData,aObjects,aLinks)}if(aObjects){if(aObjects.indexOf(oObject)==-1){aObjects.push(oObject)}}}return oObject},createAnalysisLinkObject:function(oAnalysisModel,oSourceObject,oTargetObject,oLinkObjectData,aLinks){var oLinkObject;if(oAnalysisModel&&oSourceObject&&oTargetObject&&oLinkObjectData){oLinkObject=new sap.galilei.impactAnalysis.generic.AnalysisLinkObject(oAnalysisModel.resource);this.copyProperties(oLinkObject,oLinkObjectData);oLinkObject.source=oSourceObject;oLinkObject.target=oTargetObject;oLinkObject.displayName=oLinkObject.displayName||oLinkObject.name||oLinkObject.type;oAnalysisModel.analysisLinkObjects.push(oLinkObject);if(aLinks){aLinks.push(oLinkObject)}}return oLinkObject},copyProperties:function(oObject,oPropertiesData){var aKeys,index,max,sKey,oOtherProperties={};if(oObject&&oPropertiesData){aKeys=Object.keys(oPropertiesData);if(aKeys){for(index=0,max=aKeys.length;index<max;index++){sKey=aKeys[index];if(sKey!=="impact"&&sKey!=="lineage"){if(sap.galilei.core.hasProperty(oObject,sKey)){oObject[sKey]=oPropertiesData[sKey]}else{oOtherProperties[sKey]=oPropertiesData[sKey]}}}if(!oObject.properties){oObject.properties=oOtherProperties}else{sap.galilei.core.copyProperties(oObject.properties,oOtherProperties,true)}}}},getOrCreateImpactObjects:function(oAnalysisModel,oParentObject,oImpactData,aObjects,aLinks){var oObject,oLinkObject,index,max,nImpactObjects=0;if(oAnalysisModel&&oParentObject&&oParentObject.uri&&oImpactData){if(sap.galilei.core.isInstanceOf(oImpactData,"Array")){for(index=0,max=oImpactData.length;index<max;index++){nImpactObjects+=this.getOrCreateImpactObjects(oAnalysisModel,oParentObject,oImpactData[index],aObjects,aLinks)}}else{oObject=this.getOrCreateAnalysisObject(oAnalysisModel,oImpactData,aObjects,aLinks);if(oObject){if(oParentObject.impactObjects.indexOf(oObject)==-1){oParentObject.impactObjects.push(oObject);nImpactObjects++}if(oImpactData.link){oLinkObject=this.createAnalysisLinkObject(oAnalysisModel,oParentObject,oObject,oImpactData.link,aLinks);oParentObject.impactLinkObjects.push(oLinkObject)}if(oImpactData.impact){nImpactObjects+=this.getOrCreateImpactObjects(oAnalysisModel,oObject,oImpactData.impact,aObjects,aLinks)}}}}return nImpactObjects},getOrCreateLineageObjects:function(oAnalysisModel,oParentObject,oLineageData,aObjects,aLinks){var oObject,oLinkObject,index,max,nLineageObjects=0;if(oAnalysisModel&&oParentObject&&oParentObject.uri&&oLineageData){if(sap.galilei.core.isInstanceOf(oLineageData,"Array")){for(index=0,max=oLineageData.length;index<max;index++){nLineageObjects+=this.getOrCreateLineageObjects(oAnalysisModel,oParentObject,oLineageData[index],aObjects,aLinks)}}else{oObject=this.getOrCreateAnalysisObject(oAnalysisModel,oLineageData,aObjects,aLinks);if(oObject){if(oParentObject.lineageObjects.indexOf(oObject)==-1){oParentObject.lineageObjects.push(oObject);nLineageObjects++}if(oLineageData.link){oLinkObject=this.createAnalysisLinkObject(oAnalysisModel,oParentObject,oObject,oLineageData.link,aLinks);oParentObject.lineageLinkObjects.push(oLinkObject)}if(oLineageData.lineage){nLineageObjects+=this.getOrCreateLineageObjects(oAnalysisModel,oObject,oLineageData.lineage,aObjects,aLinks)}}}}return nLineageObjects},getOrCreateAnalysisObjects:function(oAnalysisModel,oParentObject,oIAData,aObjects,aLinks){var nObjects=0;if(oAnalysisModel&&oParentObject&&oIAData){if(oIAData.impact){nObjects+=this.getOrCreateImpactObjects(oAnalysisModel,oParentObject,oIAData.impact,aObjects,aLinks)}if(oIAData.lineage){nObjects+=this.getOrCreateLineageObjects(oAnalysisModel,oParentObject,oIAData.lineage,aObjects,aLinks)}}return nObjects}},statics:{_instance:undefined,getInstance:function(){if(!this._instance){this._instance=new sap.galilei.impactAnalysis.generic.ObjectSerializer()}return this._instance}}})});
namespace("sap.galilei.impactAnalysis.generic",function(nsLocal){nsLocal.ServiceProvider=sap.galilei.core.defineClass({fullClassName:"sap.galilei.impactAnalysis.generic.ServiceProvider",parent:sap.galilei.impactAnalysis.ServiceProvider,properties:{isSupportMultipleLevels:true},methods:{getImpactAndLineageAsync:function(sObjectUri,bGetImpact,bGetLineage,nLevel,oCustomData){var oResult=jQuery.Deferred();oResult.resolve();return oResult},getHasImpactAndLineageAsync:function(sObjectUri,bGetImpact,bGetLineage,oCustomData){var oResult=jQuery.Deferred();oResult.resolve(false);return oResult}},statics:{_instance:undefined,getInstance:function(){if(!this._instance){this._instance=new sap.galilei.impactAnalysis.generic.ServiceProvider()}return this._instance}}})});
