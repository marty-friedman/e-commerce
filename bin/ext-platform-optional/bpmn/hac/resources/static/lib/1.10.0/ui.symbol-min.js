"use strict";namespace("sap.galilei.ui.symbol");
"use strict";sap.galilei.ui.symbol.Orientation={vertical:"vertical",horizontal:"horizontal",DEFAULT:"vertical"};sap.galilei.ui.symbol.LayoutSwimlaneDirection={axis:"axis",antiAxis:"antiAxis",DEFAULT:"axis"};sap.galilei.ui.symbol.EdgeType={NONE:0,LEFT:1,RIGHT:2,TOP:4,BOTTOM:8,ALL:15};
"use strict";sap.galilei.model.metamodel("Galilei.Common",{contents:{"sap.galilei.common":{name:"Galilei.Common",classDefinition:"sap.galilei.model.Package",displayName:"Galilei Model Metamodel",namespaceName:"sap.galilei.common",classifiers:{NamedObject:{classDefinition:"sap.galilei.model.Class",name:"NamedObject",displayName:"Named Object",properties:{comment:{name:"comment",displayName:"Comment",classDefinition:"sap.galilei.model.Property",dataType:sap.galilei.model.dataTypes.gString}}},Model:{classDefinition:"sap.galilei.model.Class",name:"Model",displayName:"Model",parent:"NamedObject",properties:{isModel:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true}},references:{packages:{name:"packages",displayName:"Packages",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Package",isMany:true,isContainment:true},"Model.diagrams":{name:"diagrams",displayName:"Diagrams",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:true,isContainment:true}}},Package:{classDefinition:"sap.galilei.model.Class",name:"Package",displayName:"Package",parent:"NamedObject",references:{"Package.diagrams":{name:"diagrams",displayName:"Diagrams",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:true,isContainment:true}}},LinkObject:{classDefinition:"sap.galilei.model.Class",name:"LinkObject",displayName:"Link Object",parent:"NamedObject",properties:{isLinkObject:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true}},references:{source:{name:"source",displayName:"Source",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:false},target:{name:"target",displayName:"Target",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:false}}}}}}});
(function(){sap.galilei.model.metamodel("Galilei.Diagram",{contents:{stringToPointsConverter:{name:"stringToPointsConverter",classDefinition:"sap.galilei.model.Converter",convertFrom:function(sValue){var aPoints;if(sap.galilei.core.isInstanceOf(sValue,sap.galilei.ui.common.Points)){return sValue}aPoints=new sap.galilei.ui.common.Points();aPoints.points=sValue;return aPoints},convertTo:function(oPoints){return sap.galilei.ui.common.Points.toString(oPoints)}},"sap.galilei.ui.diagram":{name:"Galilei.Diagram",classDefinition:"sap.galilei.model.Package",displayName:"Galilei Diagram Metamodel",namespaceName:"sap.galilei.ui.diagram",classifiers:{Symbol:{displayName:"Symbol",onDelete:function(oEvent){oEvent.sourceSymbol=this;sap.galilei.core.Event.publish("delete.symbol",this,undefined,oEvent);this.dispose(this.resource&&this.resource.isInUndoRedo)},properties:{name:{dataType:sap.galilei.model.dataTypes.gString},defaultTooltip:{dataType:sap.galilei.model.dataTypes.gString,get:function(){var sClassName,sObjectName;sClassName=this.object&&this.object.classDefinition&&this.object.classDefinition.displayName;sObjectName=this.object&&((this.object.getFormattedValue&&this.object.getFormattedValue("Name"))||this.object.displayName||this.object.name||"");if(sClassName){sObjectName=sObjectName?(sClassName+" '"+sObjectName+"'"):sClassName}return sObjectName}},tooltip:{dataType:sap.galilei.model.dataTypes.gString,get:function(){if(this._tooltip){return this._tooltip}return this.defaultTooltip},set:function(sTooltip){this._tooltip=sTooltip}},automationId:{dataType:sap.galilei.model.dataTypes.gString,get:function(){var sClassName,sObjectName="",oParentObject,sParentObjectName;if(this.object){sClassName=this.object.classDefinition&&this.object.classDefinition.name;sObjectName=(this.object.getFormattedValue&&this.object.getFormattedValue("Name"))||this.object.name||this.object.displayName||"";if(sClassName){sObjectName=sObjectName?(sClassName+"/"+sObjectName):sClassName}oParentObject=this.object.container;while(oParentObject&&oParentObject!==this.object.rootContainer){sClassName=oParentObject.classDefinition&&oParentObject.classDefinition.displayName;sParentObjectName=((oParentObject.getFormattedValue&&oParentObject.getFormattedValue("Name"))||oParentObject.name||oParentObject.displayName);if(sClassName){sParentObjectName=sObjectName?(sClassName+"/"+sParentObjectName):sClassName}sObjectName=sParentObjectName+"/"+sObjectName;oParentObject=oParentObject.container}}return sObjectName}},displayMode:{dataType:sap.galilei.model.dataTypes.gString,defaultValue:sap.galilei.ui.common.ShapeLayoutModes.detail},x:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},y:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},width:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},height:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},minWidth:{dataType:sap.galilei.model.dataTypes.gDouble,isInternal:true},minHeight:{dataType:sap.galilei.model.dataTypes.gDouble,isInternal:true},maxWidth:{dataType:sap.galilei.model.dataTypes.gDouble,isInternal:true},maxHeight:{dataType:sap.galilei.model.dataTypes.gDouble,isInternal:true},isSymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true},isComposite:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isBoundarySymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isInternal:true},isAdjustToContent:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isKeepAspectRatio:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isKeepCenter:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isKeepSize:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isKeepPosition:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isHidden:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isSelected:{dataType:sap.galilei.model.dataTypes.gBool,isInternal:true,defaultValue:false},isEnableDraw:{dataType:sap.galilei.model.dataTypes.gBool,isInternal:true,get:function(){var oParentSymbol;if(this.isDeleting){return false}if(this.object&&this.object.isDeleting){return false}if(this.isHidden){return false}oParentSymbol=this.parentSymbol;if(oParentSymbol){if(oParentSymbol.isDeleting){return false}if(oParentSymbol.object&&oParentSymbol.object.isDeleting){return false}if(!oParentSymbol.isDrawn||(!this.isBoundarySymbol&&oParentSymbol.isExpanded===false)){return false}}return true}},isDrawn:{dataType:sap.galilei.model.dataTypes.gBool,isInternal:true,get:function(){return this.shape?this.shape.isDrawn:false}},stroke:{dataType:sap.galilei.model.dataTypes.gString},strokeWidth:{dataType:sap.galilei.model.dataTypes.gString},fill:{dataType:sap.galilei.model.dataTypes.gString},layoutTemplate:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},formatters:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},symbolLayout:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},shape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},decoratorGroups:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},eventHandlers:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},zindex:{dataType:sap.galilei.model.dataTypes.gInteger,defaultValue:0,isInternal:true},boundaryDirection:{dataType:sap.galilei.model.dataTypes.gInteger,isInternal:true},runtimeClass:{isInternal:true,get:function(){return this.classDefinition?this.classDefinition.runtimeClass:undefined}},ariaLabel:{dataType:sap.galilei.model.dataTypes.gString},role:{dataType:sap.galilei.model.dataTypes.gString},isNeedUpdateSymbol:{isInternal:true,defaultValue:true}},references:{object:{contentType:"sap.galilei.model.Object",isMany:false},"Symbol.symbols":{name:"symbols",contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,isContainment:true,onCascadeChange:function(oEventArgs){var oInstance=oEventArgs.instance,oObject=oEventArgs.newObject,sChangeType=oEventArgs.eventType;if(!this.resource.isLoading){if(sChangeType==="referenceAdd"){if(!(oInstance.isComposite)){throw"It is not possible to add SubSymbols to a Symbol that is not composite"}if(oInstance.zindex>oObject.zindex-sap.galilei.ui.common.ZINDEX_STEP){if(oInstance.updateZIndex){oInstance.updateZIndex()}}if(oObject&&oObject.updateLinkSymbolOwners){oObject.updateLinkSymbolOwners()}}else{if(sChangeType==="referenceRemove"){if(oInstance.updateZIndex){oInstance.updateZIndex()}}}}}},parentSymbol:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:false,get:function(){var oContainer=this.container;if(oContainer&&!sap.galilei.model.isInstanceOf(oContainer,"sap.galilei.ui.diagram.Diagram")){return oContainer}return undefined}},diagram:{contentType:"sap.galilei.ui.diagram.Diagram",isMany:false,get:function(){var oContainer=this.container;while(oContainer!==undefined){if(oContainer.isDiagram){return oContainer}else{oContainer=oContainer.container;if(oContainer===this.container){break}}}if(oContainer&&!oContainer.isDiagram){oContainer=undefined}return oContainer}},owner:{contentType:"sap.galilei.model.Object",isMany:false,isContainment:false,get:function(){if(this.parentSymbol){return this.parentSymbol}return this.diagram},set:function(oOwner){var oOldCollection,oNewCollection,nOldIndex;if(oOwner){oOldCollection=this.parentSymbol?this.parentSymbol.symbols:this.diagram.symbols;if(sap.galilei.model.isInstanceOf(oOwner,"sap.galilei.ui.diagram.Diagram")||oOwner.isComposite){oNewCollection=oOwner.symbols}if(oNewCollection&&oNewCollection.indexOf(this)<0){nOldIndex=oOldCollection.indexOf(this);if(nOldIndex>=0){oOldCollection.removeAt(nOldIndex);oNewCollection.push(this)}}}}},contentSymbols:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,get:function(){var aContentSymbols=new sap.galilei.model.ArrayCollection(),index,max,oSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(!oSymbol.isBoundarySymbol){aContentSymbols.push(oSymbol)}}return aContentSymbols}},boundarySymbols:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,get:function(){var aBoundarySymbols=new sap.galilei.model.ArrayCollection(),index,max,oSymbol;if(this.symbols){for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(oSymbol.isBoundarySymbol){aBoundarySymbols.push(oSymbol)}}}return aBoundarySymbols}}},methods:{getOwner:function(){return this.parentSymbol||this.diagram},on:function(sEventName,fnEventHandler,oScope){if(sEventName){var oEventHandler,aEventArgs=Array.prototype.slice.call(arguments,3),aEventHandlers,oExistingEventHandler;if(sEventName===sap.galilei.ui.common.DOMEvents.contextmenu){this.off(sEventName)}this.eventHandlers=this.eventHandlers||{};aEventHandlers=this.eventHandlers[sEventName]||[];if(fnEventHandler){if(typeof fnEventHandler==="function"){oEventHandler={callback:fnEventHandler};if(oScope){oEventHandler.scope=oScope}if(aEventArgs&&aEventArgs.length>0){oEventHandler["arguments"]=aEventArgs}}}if(oEventHandler){if(this.eventHandlers[sEventName]){oExistingEventHandler=this.findEventHandler(sEventName,fnEventHandler,oScope);if(oExistingEventHandler){oExistingEventHandler["arguments"]=aEventArgs}else{aEventHandlers.push(oEventHandler)}}else{this.eventHandlers[sEventName]=[oEventHandler]}this.registerEventHandler(sEventName,oEventHandler)}}return this},off:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=aEventHandlers.length-1;index>=0;index--){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){this.unregisterEventHandler(sEventName,oEventHandler);this.eventHandlers[sEventName].splice(index,1);if(this.eventHandlers[sEventName].length===0){delete this.eventHandlers[sEventName];if(!sap.galilei.core.hasObjects(this.eventHandlers)){this.eventHandlers=undefined}}}}}},onEvents:function(oEvents,oScope){var sEvent,aEventParams,aEventArgs;if(oEvents){if(arguments.length>2){aEventArgs=Array.prototype.slice.call(arguments,2)}for(sEvent in oEvents){if(oEvents.hasOwnProperty(sEvent)){aEventParams=[];aEventParams.push(sEvent);aEventParams.push(oEvents[sEvent]);aEventParams.push(oScope);if(aEventArgs){aEventParams=aEventParams.concat(aEventArgs)}this.on.apply(this,aEventParams)}}}return this},findEventHandler:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName){var aEventHandlers=this.eventHandlers[sEventName],oEventHandler,index;if(aEventHandlers){for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if((!fnEventHandler||oEventHandler.callback===fnEventHandler)&&(!oScope&&oEventHandler.scope===oScope)){return oEventHandler}}}}return undefined},enableEventHandler:function(sEventName,fnEventHandler,oScope,bEnable){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var shape=this.shape,aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){if(!bEnable){oEventHandler.disabled=true}else{if(oEventHandler.disabled){delete oEventHandler.disabled}}}}if(shape){shape.enableEventHandler(sEventName,fnEventHandler,oScope,bEnable)}}return this},registerEventHandler:function(sEventName,oEventHandler){var self=this,shape,oScope,fnEventHandler,aEventArgs,bDisabled,aOnArgs;function symbolEventHandler(oEvent){if(!bDisabled&&fnEventHandler){if(arguments.length>=3&&arguments[2]!==undefined&&arguments[2].diagram!==undefined&&self.diagram!==arguments[2].diagram){return}oEvent.sourceSymbol=self;if(!oScope){oScope=self}fnEventHandler.apply(oScope,arguments)}}if(this.eventHandlers&&sEventName&&oEventHandler){shape=this.shape;oScope=oEventHandler.scope;fnEventHandler=oEventHandler.callback;aEventArgs=oEventHandler["arguments"];bDisabled=oEventHandler.disabled;if(shape&&shape.isDrawn&&fnEventHandler){aOnArgs=[sEventName,symbolEventHandler];if(oScope){aOnArgs.push(oScope)}if(aEventArgs&&aEventArgs.length>0){if(!oScope){aOnArgs.push(oScope)}aOnArgs=aOnArgs.concat(aEventArgs)}shape.on.apply(shape,aOnArgs);oEventHandler.registeredEventHandler=symbolEventHandler}}return this},unregisterEventHandler:function(sEventName,oEventHandler){if(sEventName&&oEventHandler){if(this.shape){this.shape.off(sEventName,oEventHandler.registeredEventHandler,oEventHandler.scope)}}},registerEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.registerEventHandler(sEventName,aEventHandlers[index])}}}return this},unregisterEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.unregisterEventHandler(sEventName,aEventHandlers[index])}}}return this},triggerEvent:function(sEventName,oEvent){var oEventHandler,args=[],bTriggered=false;if(sEventName){oEventHandler=this.findEventHandler(sEventName);if(oEventHandler&&oEventHandler.callback){args.push(oEvent);if(oEventHandler["arguments"]){args=args.concat(oEventHandler["arguments"])}oEventHandler.callback.apply(this,args);bTriggered=true}}return bTriggered},getLayoutTemplate:function(bShared){var vLayoutTemplate;if(!bShared){vLayoutTemplate=this.layoutTemplate}else{vLayoutTemplate=this.runtimeClass.layoutTemplate}return vLayoutTemplate},selectLayoutTemplate:function(vLayoutTemplate){var oLayoutIndex=-1;if(vLayoutTemplate instanceof Array){if(vLayoutTemplate.length>0){oLayoutIndex=0}}return oLayoutIndex},createSymbolLayout:function(oLayoutTemplate){return sap.galilei.ui.diagram.Symbol.createSymbolLayout(oLayoutTemplate)},getOrCreateSymbolLayout:function(){var vLayoutTemplate,oLayoutIndex,oLayoutTemplate,oSymbolLayout=this.symbolLayout;if(!oSymbolLayout){vLayoutTemplate=this.getLayoutTemplate(false);if(vLayoutTemplate){oLayoutIndex=this.selectLayoutTemplate(vLayoutTemplate);if(oLayoutIndex===-1){oLayoutTemplate=vLayoutTemplate;oSymbolLayout=this.symbolLayout}else{oLayoutTemplate=vLayoutTemplate[oLayoutIndex];oSymbolLayout=this.symbolLayout&&this.symbolLayout[oLayoutIndex]}if(!oSymbolLayout){oSymbolLayout=this.createSymbolLayout(oLayoutTemplate);if(oLayoutIndex===-1){this.symbolLayout=oSymbolLayout}else{this.symbolLayout=this.symbolLayout||{};this.symbolLayout[oLayoutIndex]=oSymbolLayout}}}}if(!oSymbolLayout){vLayoutTemplate=this.getLayoutTemplate(true);if(vLayoutTemplate){oLayoutIndex=this.selectLayoutTemplate(vLayoutTemplate);if(oLayoutIndex===-1){oLayoutTemplate=vLayoutTemplate;oSymbolLayout=this.runtimeClass.symbolLayout}else{oLayoutTemplate=vLayoutTemplate[oLayoutIndex];oSymbolLayout=this.runtimeClass.symbolLayout&&this.runtimeClass.symbolLayout[oLayoutIndex]}if(!oSymbolLayout){oSymbolLayout=this.createSymbolLayout(oLayoutTemplate);if(oLayoutIndex===-1){this.runtimeClass.symbolLayout=oSymbolLayout}else{this.runtimeClass.symbolLayout=this.runtimeClass.symbolLayout||{};this.runtimeClass.symbolLayout[oLayoutIndex]=oSymbolLayout}}}}return oSymbolLayout},hasClass:function(sDomClass){if(sDomClass){if(this.shape&&this.shape.isDrawn){return sap.galilei.ui.common.svg.Svg.hasClass(this.shape.svgNode,sDomClass)}}return false},addClass:function(sDomClass){if(sDomClass){if(this.shape){this.shape.addClass(sDomClass);if(this.shape.isDrawn){sap.galilei.ui.common.svg.Svg.addClass(this.shape.svgNode,sDomClass)}}}},removeClass:function(sDomClass){if(sDomClass){if(this.shape){this.shape.removeClass(sDomClass);if(this.shape.isDrawn){sap.galilei.ui.common.svg.Svg.removeClass(this.shape.svgNode,sDomClass)}}}},defaultDispose:function(bCascade){var index,oSymbol,oLinks;if(this.shape){this.shape.dispose();this.shape=undefined}this.unregisterEventHandlers();this.layoutTemplate=undefined;this.symbolLayout=undefined;if(this._mouseHoverHandler){this._mouseHoverHandler.dispose();delete this._mouseHoverHandler}if(this._contextButtonPad){this._contextButtonPad.dispose();delete this._contextButtonPad}if(this._tracker){this._tracker.dispose();delete this._tracker}if(this._layouter){this._layouter.dispose();delete this._layouter}if(this._inPlaceEditControl){this._inPlaceEditControl.dispose();delete this._inPlaceEditControl}if(this._tooltipControl){this._tooltipControl.dispose();delete this._tooltipControl}if(bCascade||bCascade===undefined){oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oSymbol=oLinks[index];oSymbol.dispose()}}if(this.isComposite){for(index=0;index<this.symbols.length;index++){oSymbol=this.symbols.get(index);oSymbol.dispose()}}}},dispose:function(bCascade){this.defaultDispose(bCascade)},defaultDeleteSymbol:function(bDeleteObject,bDeleteObjectOnLinkSymbols){var oDiagram,oObject,oLinks,nLoop,index,oSymbol,aSynonyms,oSynonymSymbol,oCollection,nIndex,oContainer,sContainingReferenceName;this.isDeleting=true;oDiagram=this.diagram;if(bDeleteObjectOnLinkSymbols===undefined){bDeleteObjectOnLinkSymbols=bDeleteObject}this.dispose();oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=oLinks.length-1;index>=0;index--){oLinks[index].deleteSymbol(bDeleteObjectOnLinkSymbols)}}if(bDeleteObject){aSynonyms=this.getSynonymSymbols();for(index=0;index<aSynonyms.length;index++){oSynonymSymbol=aSynonyms[index];if(oSynonymSymbol.diagram===oDiagram){oSynonymSymbol.deleteSymbol(false)}}}if(this.isComposite&&this.symbols.length>0){for(nLoop=0;nLoop<2;nLoop++){for(index=this.symbols.length-1;index>=0;index--){oSymbol=this.symbols.get(index);if((nLoop===0&&oSymbol.isLinkSymbol)||(nLoop===1&&!oSymbol.isLinkSymbol)){if(oSymbol.isInternal){this.resource.applyUndoableAction(function(){oSymbol.deleteSymbol(false)},"Delete Sub-Symbol",true)}else{oSymbol.deleteSymbol(false)}}}}}oObject=this.object;if(oObject){this.object=undefined}if(bDeleteObject&&oObject&&oObject.deleteObject){oContainer=oObject.container;sContainingReferenceName=oContainer&&oContainer.getContainingReference(oObject.classDefinition.qualifiedName);oCollection=sContainingReferenceName&&oContainer[sContainingReferenceName];nIndex=oCollection&&oCollection.indexOf(oObject);if(oCollection&&nIndex!==-1){oCollection.removeAt(nIndex)}oContainer=this.container&&this.container.object;sContainingReferenceName=oContainer&&oContainer.getContainingReference(oObject.classDefinition.qualifiedName,false,false);oCollection=sContainingReferenceName&&oContainer[sContainingReferenceName];nIndex=oCollection&&oCollection.indexOf(oObject);if(oCollection&&nIndex!==-1){oCollection.removeAt(nIndex)}oObject.deleteObject()}this.deleteObject()},deleteSymbol:function(bDeleteObject,bDeleteObjectOnLinkSymbols){this.defaultDeleteSymbol(bDeleteObject,bDeleteObjectOnLinkSymbols)},defaultCreateShape:function(){var oSymbolLayout=this.getOrCreateSymbolLayout(),oShape;if(oSymbolLayout){oShape=oSymbolLayout.createShape(this)}return oShape},createShape:function(){return this.defaultCreateShape()},getOrCreateShape:function(){if(!this.shape){this.shape=this.createShape();this.createContent()}return this.shape},createContent:function(){if(this.shape!==undefined){this.shape.createContent()}return this.shape},updateContent:function(){if(this.shape!==undefined){this.shape.updateContent()}return this.shape},getBoundaryShape:function(){if(this.shape!==undefined){return this.shape.boundaryShape}return undefined},getMainShape:function(){if(this.shape!==undefined){return this.shape.mainShape}return undefined},setMainShape:function(oMainShape){var oOldMainShape;if(oMainShape!==undefined&&this.shape!==undefined){oOldMainShape=this.shape.mainShape;this.shape.mainShape=oMainShape;if(this.shape.shapes[0]===oOldMainShape){this.shape.shapes[0]=oMainShape}}},addDecoratorPanel:function(){var oMainShape=this.getMainShape(),oPanelShape,oGroupShape;if(oMainShape!==undefined){oPanelShape=oMainShape.selectShape({name:"Panel"});if(oPanelShape===undefined){oPanelShape=new sap.galilei.ui.common.shape.Panel({id:"decoratorPanel"+sap.galilei.ui.common.shape.Shape.getNextId(),x:0,y:0,width:oMainShape.width,height:oMainShape.height});if(!oMainShape.isGroup){oGroupShape=new sap.galilei.ui.common.shape.Group({id:"mainShapeGroup"+sap.galilei.ui.common.shape.Shape.getNextId()});oGroupShape.addSubShape(oMainShape);this.setMainShape(oGroupShape);oMainShape=oGroupShape}oMainShape.addSubShape(oPanelShape)}}return oPanelShape},getContentShape:function(){if(this.shape!==undefined){return this.shape.contentShape}return undefined},setContentShape:function(oContentShape){var oOldContentShape;if(oContentShape!==undefined&&this.shape!==undefined){oOldContentShape=this.shape.contentShape;this.shape.contentShape=oContentShape;if(this.shape.shapes[1]===oOldContentShape){this.shape.shapes[1]=oContentShape}}},getBBox:function(bIncludeAllSubSymbols){var oRect,index,oShape,oSubShape,oSubRect,dx;if(bIncludeAllSubSymbols){oShape=this.shape;if(oShape){if(oShape.domClass==="sapGalileiSymbolNode"){oRect=oShape.getBBox()}else{if((oShape.displayMode===sap.galilei.ui.common.ShapeLayoutModes.icon)&&oShape.contentShape){oRect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height);for(index=0;index<oShape.contentShape.shapes.length;++index){oSubShape=oShape.contentShape.shapes[index];if((oSubShape.isVisible!==false)&&(oSubShape.name==="Text")){if(oSubRect===undefined){oSubRect=new sap.galilei.ui.common.Rect(0,0,oSubShape.textWidth,oSubShape.textHeight)}else{oSubRect.height+=oShape.textHeight;if(oSubShape.textWidth>oSubRect.width){oSubRect.width=oSubShape.textWidth}}}}if(oSubRect){dx=(oSubRect.width-oRect.width)/2;if(dx>0){dx=this.x-dx}else{dx=this.x}oSubRect.moveBy(dx,this.y+this.height+sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING);oRect.unionRect(oSubRect)}}}}}if(!oRect){oRect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height)}return oRect},setBBox:function(oRect,options,oViewer,oTransitionDef){if(oRect){var oNewRect=oRect.clone().normalize(),oMoveOptions={},oResizeOptions={};options=options||{};oMoveOptions.moveSubSymbols=options.moveSubSymbols;oMoveOptions.moveLinkSymbols=options.moveLinkSymbols;oResizeOptions.keepAspectRatio=options.keepAspectRatio;oResizeOptions.keepCenter=options.keepCenter;oResizeOptions.extendToContent=options.extendToContent;oResizeOptions.edgeOption=options.edgeOption;oResizeOptions.extendParent=options.extendParent;oResizeOptions.updateBoundarySymbols=options.updateBoundarySymbols;oResizeOptions.updateLinkSymbols=options.updateLinkSymbols;this.moveTo(oNewRect.left,oNewRect.top,oMoveOptions,oViewer,oTransitionDef);this.resize(oNewRect.width,oNewRect.height,oResizeOptions,oViewer,oTransitionDef)}},canSetBBox:function(oRect){if(this.isComposite&&this.symbols&&this.contentSymbols.length>0){var oSubBBox=this.getSubSymbolsBBox(undefined,true);if(oSubBBox&&!oRect.isRectInRect(oSubBBox)){return false}}return true},getCenter:function(bRound){var cx=0,cy=0;if(this.x!==undefined&&!isNaN(this.x)&&this.y!==undefined&&!isNaN(this.y)){cx=this.x;cy=this.y;if(this.width!==undefined&&!isNaN(this.width)&&this.height!==undefined&&!isNaN(this.height)){cx=this.x+this.width/2;cy=this.y+this.height/2;if(bRound){cx=Math.round(cx);cy=Math.round(cy)}}}return[cx,cy]},setCenter:function(cx,cy,options,oViewer,oTransitionDef){var aCenter,cx0,cy0;aCenter=this.getCenter();cx0=aCenter[0];cy0=aCenter[1];if(cx0!==undefined&&!isNaN(cx0)&&cy0!==undefined&&!isNaN(cy0)&&cx!==undefined&&!isNaN(cx)&&cy!==undefined&&!isNaN(cy)){this.moveBy(cx-cx0,cy-cy0,options,oViewer,oTransitionDef)}},isPointInSymbol:function(vPoint){var oShape;if(vPoint){oShape=this.getBoundaryShape();if(oShape){return oShape.isPointInShape(vPoint,this.getBBox())}}return false},isPointOnBorder:function(vPoint,nRadius){var oShape;if(vPoint){oShape=this.getBoundaryShape();if(oShape){return oShape.isPointOnBorder(vPoint,this.getBBox(),nRadius)}}return false},onPreDrawSymbol:function(oViewer,oTransitionDef){},onPostDrawSymbol:function(oViewer,oTransitionDef){},drawSymbol:function(oViewer,oTransitionDef,aAttributes){var oShape=this.getOrCreateShape(),bMoved=false,bResized=false,oUpdateShapeStatus,oEvent={};if(!this.isEnableDraw){if(this.isDrawn){this.hide(oViewer,oTransitionDef,{setIsHidden:false,removeShape:true})}return}this.onPreDrawSymbol(oViewer,oTransitionDef);if(oShape){oUpdateShapeStatus=this.updateShape();bMoved=oUpdateShapeStatus.moved;bResized=oUpdateShapeStatus.resized;if(!oShape.isDrawn){if(!oShape.isDisableDrawing){oShape.draw(oViewer,undefined,oTransitionDef)}this.registerEventHandlers()}else{if(oViewer){if(bMoved||bResized){oEvent.sourceSymbol=this;oEvent.transitionDefinition=oTransitionDef;sap.galilei.core.Event.publish(bResized?"resize.symbol.before":"move.symbol.before",this,undefined,oEvent)}oShape.updateDrawing(oViewer,oTransitionDef,aAttributes);if(bMoved||bResized){if(oTransitionDef){setTimeout(function(){sap.galilei.core.Event.publish(bResized?"resize.symbol.after":"move.symbol.after",oEvent.sourceSymbol,undefined,oEvent)},oTransitionDef.duration)}else{sap.galilei.core.Event.publish(bResized?"resize.symbol.after":"move.symbol.after",oEvent.sourceSymbol,undefined,oEvent)}}}}}if(this.isComposite){this.drawSubSymbols(oViewer,oTransitionDef,aAttributes)}this.onPostDrawSymbol(oViewer,oTransitionDef)},updateShape:function(){var oShape=this.getOrCreateShape(),bMoved=false,bResized=false;if(oShape){if(!oShape.isDrawn){if(oShape.x!==this.x||oShape.y!==this.y){oShape.x=this.x;oShape.y=this.y}this.updateLayout(false);oShape._oldWidth=this.width;oShape._oldHeight=this.height}else{if(oShape.x!==this.x||oShape.y!==this.y){oShape.x=this.x;oShape.y=this.y;bMoved=true}if(oShape._oldWidth!==this.width||oShape._oldHeight!==this.height){this.updateLayout(false);oShape._oldWidth=this.width;oShape._oldHeight=this.height;bResized=true}oShape.zindex=this.getShapeZIndex()}}return{moved:bMoved,resized:bResized,}},updateZIndex:function(){var i,length,min,oSymbol;for(i=0,length=this.symbols.length;i<length;i++){oSymbol=this.symbols.get(i);if(oSymbol&&!oSymbol.isLinkSymbol){if(min===undefined||min>oSymbol.zindex){min=oSymbol.zindex}}}min=min===undefined?sap.galilei.ui.common.ZINDEX_STEP:min;if(this.zindex!==min-sap.galilei.ui.common.ZINDEX_STEP){this.zindex=min-sap.galilei.ui.common.ZINDEX_STEP;if(this.parentSymbol){this.parentSymbol.updateZIndex()}}},getShapeZIndex:function(){return this.isComposite?this.zindex-2*sap.galilei.ui.common.ZINDEX_STEP_MINOR:this.zindex},adjustToContent:function(oViewer,oTransitionDef){if((!this.isKeepSize||this.width===undefined||this.height===undefined)){var oSymbolLayout=this.getOrCreateSymbolLayout(),oShape=this.getOrCreateShape(),left=this.x,right=this.x+this.width,top=this.y,bottom=this.y+this.height,width=this.width,height=this.height,oBBox=this.getBBox(),oShapeBBox,oSubSymbolsBBox,oContentAreaBBox,bSymbolChanged=false,oOldBBox;if(oSymbolLayout&&oShape){if(!this.isAdjustToContent){this.isAdjustToContent=true}if(this.isComposite){this.updateSubSymbolsLayout(oViewer,oTransitionDef);oContentAreaBBox=this.getContentAreaBBox();if(!oContentAreaBBox){oContentAreaBBox=oBBox.clone()}oSubSymbolsBBox=this.getSubSymbolsBBox(undefined,true);if(!oSubSymbolsBBox){oSubSymbolsBBox=oContentAreaBBox.clone()}left=oSubSymbolsBBox.left-(oContentAreaBBox.left-left);top=oSubSymbolsBBox.top-(oContentAreaBBox.top-top);width=(oSubSymbolsBBox.right+(right-oContentAreaBBox.right))-left;height=(oSubSymbolsBBox.bottom+(bottom-oContentAreaBBox.bottom))-top;if(left!==this.x||top!==this.y){this.moveTo(left,top,{moveSubSymbols:false},oViewer,oTransitionDef)}}else{oShapeBBox=this.shape.getBBox();left=oShapeBBox.x;top=oShapeBBox.y;if(left!==this.x||top!==this.y){this.moveTo(left,top,{moveSubSymbols:false},oViewer,oTransitionDef)}width=Math.max(width,oShapeBBox.width);height=Math.max(height,oShapeBBox.height)}oOldBBox=this.getBBox();bSymbolChanged=oSymbolLayout.layoutShape(this,this.shape,width,height,this.isKeepAspectRatio,this.symbols.length>0?this.isKeepCenter:true);if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}if(bSymbolChanged){this.updateLinkSymbolRoutings(oOldBBox,this.getBBox(),true,false,oViewer,oTransitionDef)}}}},defaultExtendToContent:function(options,edgeOption,oViewer,oTransitionDef){if((!this.isKeepSize||this.width===undefined||this.height===undefined)){var oSymbolLayout=this.getOrCreateSymbolLayout(),left=this.x,top=this.y,right=this.x+this.width,bottom=this.y+this.height,width=this.width,height=this.height,oSubSymbolsBBox,oContentAreaBBox,oOldBBox=this.getBBox(),bExtendParent,bMove;if(oSymbolLayout){options=options||{};bExtendParent=oOldBBox!==undefined?options.extendParent:false;if(this.isComposite&&(this.isExpanded||this.isExpanded===undefined)&&this.symbols.length>0){this.updateSubSymbolsLayout();oContentAreaBBox=this.getContentAreaBBox();oSubSymbolsBBox=this.getSubSymbolsBBox(undefined,true);if(oSubSymbolsBBox){if(oContentAreaBBox.left>oSubSymbolsBBox.left&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.LEFT)!==0)){left-=oContentAreaBBox.left-oSubSymbolsBBox.left;bMove=true}if(oContentAreaBBox.top>oSubSymbolsBBox.top&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.TOP)!==0)){top-=oContentAreaBBox.top-oSubSymbolsBBox.top;bMove=true}if(oContentAreaBBox.right<oSubSymbolsBBox.right&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0)){right+=oSubSymbolsBBox.right-oContentAreaBBox.right}if(oContentAreaBBox.bottom<oSubSymbolsBBox.bottom&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0)){bottom+=oSubSymbolsBBox.bottom-oContentAreaBBox.bottom}width=right-left;height=bottom-top;if(bMove){this.moveTo(left,top,{moveSubSymbols:false,moveLinkSymbols:false},oViewer,oTransitionDef)}}}oSymbolLayout.layoutShape(this,this.shape,width,height,this.isKeepAspectRatio,this.isKeepCenter);if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}if(options.updateBoundarySymbols||options.updateBoundarySymbols===undefined){this.updateBoundarySymbols(oOldBBox,this.getBBox(),true,oViewer,oTransitionDef)}if(options.updateLinkSymbols){this.updateLinkSymbolRoutings(oOldBBox,this.getBBox(),true,false,oViewer,oTransitionDef)}else{if(oViewer){this.drawLinkSymbols(oViewer,oTransitionDef)}}if(bExtendParent&&this.parentSymbol&&this.parentSymbol.extendToContent){this.parentSymbol.extendToContent({extendParent:true,updateLinkSymbols:true},edgeOption,oViewer,oTransitionDef)}}}},extendToContent:function(options,edgeOption,oViewer,oTransitionDef){this.defaultExtendToContent(options,edgeOption,oViewer,oTransitionDef)},updateLayout:function(bCanChangeSymbol,oViewer,oTransitionDef){var oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){if(oSymbolLayout instanceof sap.galilei.ui.symbol.LinkSymbolLayout){oSymbolLayout.layoutLinkShape(this,this.shape)}else{if(oSymbolLayout instanceof sap.galilei.ui.symbol.SymbolLayout){oSymbolLayout.layoutShape(this,this.shape,this.width,this.height,this.isKeepAspectRatio,this.isKeepCenter,bCanChangeSymbol)}}if(oViewer&&this.isDrawn){this.drawSymbol(oViewer,oTransitionDef)}}},defaultUpdateSymbol:function(oViewer,oTransitionDef,bPublish){var oEvent,self=this;if(this.isNeedUpdateSymbol!==false){this.updateContent();if(this.isComposite){this.updateSubSymbolsLayout(oViewer,oTransitionDef)}this.updateLayout(false,oViewer,oTransitionDef);if(bPublish){oEvent={sourceSymbol:self};sap.galilei.core.Event.publish("update.symbol",self,undefined,oEvent)}}},updateSymbol:function(oViewer,oTransitionDef,bPublish){this.defaultUpdateSymbol(oViewer,oTransitionDef,bPublish)},moveBy:function(dx,dy,options,oViewer,oTransitionDef){var self=this,x=this.x,y=this.y,bMoveSubSymbols=(!options||options.moveSubSymbols===undefined||options.moveSubSymbols),bMoveLinkSymbols=(!options||options.moveLinkSymbols===undefined||options.moveLinkSymbols);if(isNaN(x)){x=0}if(isNaN(y)){y=0}if(!isNaN(dx)&&Math.abs(dx)>0.01){x+=dx}else{dx=0}if(!isNaN(dy)&&Math.abs(dy)>0.01){y+=dy}else{dy=0}this.x=x;this.y=y;if((dx!==0||dy!==0)&&this.shape){this.shape.x=x;this.shape.y=y;if(oViewer&&this.shape.isDrawn){this.shape.updateDrawing(oViewer,oTransitionDef,["groupTransform"])}}if((dx!==0||dy!==0)&&this.isComposite&&bMoveSubSymbols){this.moveSubSymbolsBy(dx,dy,options,oViewer,oTransitionDef)}if((dx!==0||dy!==0)&&bMoveLinkSymbols){this.moveLinkSymbolsBy(dx,dy,oViewer,oTransitionDef);if(oTransitionDef&&(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1)){setTimeout(function(){self.drawLinkSymbols(oViewer)},oTransitionDef.duration+50)}}},moveTo:function(x,y,options,oViewer,oTransitionDef){var x0=this.x,y0=this.y,dx=0,dy=0;if(x0===undefined||isNaN(x0)){x0=0}if(y0===undefined||isNaN(y0)){y0=0}if(x!==undefined&&!isNaN(x)){dx=x-x0;if(Math.abs(dx)<0.01){dx=0}}if(y!==undefined&&!isNaN(y)){dy=y-y0;if(Math.abs(dy)<0.01){dy=0}}if(dx!==0||dy!==0){this.moveBy(dx,dy,options,oViewer,oTransitionDef)}},defaultResize:function(width,height,options,oViewer,oTransitionDef){if(width!==this.width||height!==this.height){var oSymbolLayout=this.getOrCreateSymbolLayout(),oldWidth=this.width,oldHeight=this.height,oOldBBox=this.getBBox(),bKeepAspectRatio,bKeepCenter,bExtendToContent,bExtendParent;if(oSymbolLayout){options=options||{};bKeepAspectRatio=options.keepAspectRatio===undefined?this.isKeepAspectRatio:options.keepAspectRatio;bKeepCenter=options.keepCenter===undefined?this.isKeepCenter:options.keepCenter;bExtendToContent=options.extendToContent===undefined?false:options.extendToContent;bExtendParent=options.extendParent===undefined?false:options.extendParent;oSymbolLayout.layoutShape(this,this.shape,width,height,bKeepAspectRatio,bKeepCenter);if(this.isAdjustToContent&&(this.width!==oldWidth||this.height!==oldHeight)){this.isAdjustToContent=false}if(bExtendToContent||bExtendParent){this.extendToContent(options,options.edgeOption,oViewer,oTransitionDef)}else{if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}if(options.updateBoundarySymbols||options.updateBoundarySymbols===undefined){this.updateBoundarySymbols(oOldBBox,this.getBBox(),true,oViewer,oTransitionDef)}if(options.updateLinkSymbols){this.updateLinkSymbolRoutings(oOldBBox,this.getBBox(),true,false,oViewer,oTransitionDef)}else{if(oViewer){this.drawLinkSymbols(oViewer,oTransitionDef)}}}}}},resize:function(width,height,options,oViewer,oTransitionDef){this.defaultResize(width,height,options,oViewer,oTransitionDef)},show:function(oViewer,oTransitionDef,oOptions){if(this.isHidden){var oShape=this.getOrCreateShape(),bSetHidden,bShowLinkSymbols;oOptions=oOptions||{};bSetHidden=(oOptions.setIsHidden!==undefined)?oOptions.setIsHidden:true;bShowLinkSymbols=(oOptions.showLinkSymbols!==undefined)?oOptions.showLinkSymbols:true;if(bSetHidden){this.isHidden=false}if(oShape&&oShape.isDrawn){oShape.opacity=1;oShape.setAllProperties({isVisible:true});if(oViewer){oShape.updateDrawing(oViewer,oTransitionDef,["opacity"])}this.showSubSymbols(oViewer,oTransitionDef,oOptions);if(bShowLinkSymbols){this.showLinkSymbols(oViewer,oTransitionDef,oOptions)}}else{this.drawSymbol(oViewer,oTransitionDef);if(bShowLinkSymbols){this.showLinkSymbols(oViewer,oTransitionDef,oOptions)}}}},hide:function(oViewer,oTransitionDef,oOptions){if(!this.isHidden){var self=this,oShape=this.shape,bSetHidden,bRemoveShape;oOptions=oOptions||{};bSetHidden=(oOptions.setIsHidden!==undefined)?oOptions.setIsHidden:true;bRemoveShape=(oOptions.removeShape!==undefined)?oOptions.removeShape:false;if(bSetHidden){this.isHidden=true}if(oShape&&oShape.isDrawn){if(oViewer&&oTransitionDef&&oShape.opacity===undefined){oShape.opacity=1;oShape.updateDrawing(oViewer,undefined,["opacity"])}oShape.opacity=0;oShape.setAllProperties({isVisible:false});if(oViewer){oShape.updateDrawing(oViewer,oTransitionDef,["opacity"])}this.hideSubSymbols(oViewer,oTransitionDef,oOptions);this.hideLinkSymbols(oViewer,oTransitionDef,oOptions);if(bRemoveShape){if(oTransitionDef){setTimeout(function(){oShape.dispose();self.shape=undefined},oTransitionDef.duration)}else{oShape.dispose();this.shape=undefined}}}}},highlight:function(oStyleSheet,fnStyleSheetFilter,oViewer,oTransitionDefinition){var oShape=this.shape,oMainShape;if(oShape!==undefined&&oStyleSheet!==undefined){oMainShape=this.getBoundaryShape();if(oMainShape!==undefined&&oMainShape.opacity===0){oMainShape._oldOpacity=oMainShape.opacity;oMainShape.opacity=1;oMainShape.updateDrawing(oViewer,undefined,["opacity"])}return oShape.highlight(oStyleSheet,fnStyleSheetFilter,true,oViewer,oTransitionDefinition)}return false},unhighlight:function(oViewer,oTransitionDefinition){var oShape=this.shape,oMainShape;if(oShape!==undefined){oMainShape=this.getBoundaryShape();if(oMainShape!==undefined&&oMainShape._oldOpacity!==undefined){oMainShape.opacity=oMainShape._oldOpacity;oMainShape.updateDrawing(oViewer,undefined,["opacity"]);delete oMainShape._oldOpacity}return oShape.unhighlight(true,oViewer,oTransitionDefinition)}return false},grayOut:function(oViewer,oTransitionDefinition){var oShape=this.shape;if(oShape!==undefined){return oShape.grayOut(true,oViewer,oTransitionDefinition)}return false},_getAllSymbols:function(oSymbols,aSymbols,fnFilter){var oSymbol,index,max;if(oSymbols&&aSymbols){for(index=0,max=oSymbols.length;index<max;index++){oSymbol=oSymbols.get(index);if(fnFilter===undefined||fnFilter.call(undefined,oSymbol)===true){aSymbols.push(oSymbol)}if(oSymbol.isComposite){this._getAllSymbols(oSymbol.symbols,aSymbols,fnFilter)}}}},getAllSymbols:function(fnFilter){var aSymbols=[];this._getAllSymbols(this.symbols,aSymbols,fnFilter);return aSymbols},getSubSymbolsBBox:function(fnCustomFilter,bIncludeAllSubSymbols){var aContentSymbols,oRect,i,oSymbol;if(this.isComposite){aContentSymbols=this.contentSymbols;for(i=0;i<aContentSymbols.length;i++){oSymbol=aContentSymbols.get(i);if(!oSymbol.isLinkSymbol){if(fnCustomFilter&&fnCustomFilter.call(this,oSymbol)){if(oRect===undefined){oRect=oSymbol.getSubSymbolsBBox(fnCustomFilter,bIncludeAllSubSymbols)}else{oRect.unionRect(oSymbol.getSubSymbolsBBox(fnCustomFilter,bIncludeAllSubSymbols))}continue}if(oRect===undefined){oRect=oSymbol.getBBox(bIncludeAllSubSymbols)}else{oRect.unionRect(oSymbol.getBBox(bIncludeAllSubSymbols))}if(oSymbol.isComposite&&bIncludeAllSubSymbols){oRect.unionRect(oSymbol.getSubSymbolsBBox(fnCustomFilter,bIncludeAllSubSymbols))}}}}return oRect},defaultGetContentAreaInfo:function(bRelative){var oContentInfo={},oContentRect,oBoundaryMargin;if(this.shape&&this.shape.contentShape&&this.shape.contentShape.contentLayoutRect){oContentInfo.contentShape=this.shape.contentShape;oContentRect=this.shape.contentShape.contentLayoutRect.clone();oBoundaryMargin=this.getBoundarySymbolsMargin();if(oBoundaryMargin!==undefined){oContentRect.inflate(-oBoundaryMargin.left,-oBoundaryMargin.top,-oBoundaryMargin.right,-oBoundaryMargin.bottom)}oContentRect.x+=this.x;oContentRect.y+=this.y}else{oContentRect=this.getBBox()}if(bRelative){oContentRect.x-=this.x;oContentRect.y-=this.y}oContentInfo.contentBBox=oContentRect;oContentInfo.paddingLeft=0;oContentInfo.paddingRight=0;oContentInfo.paddingTop=0;oContentInfo.paddingBottom=0;if(oContentInfo.contentShape!==undefined){if(oContentInfo.contentShape.paddingLeft!==undefined){oContentInfo.paddingLeft=oContentInfo.contentShape.paddingLeft}if(oContentInfo.contentShape.paddingRight!==undefined){oContentInfo.paddingRight=oContentInfo.contentShape.paddingRight}if(oContentInfo.contentShape.paddingTop!==undefined){oContentInfo.paddingTop=oContentInfo.contentShape.paddingTop}if(oContentInfo.contentShape.paddingBottom!==undefined){oContentInfo.paddingBottom=oContentInfo.contentShape.paddingBottom}}return oContentInfo},getContentAreaInfo:function(bRelative){return this.defaultGetContentAreaInfo(bRelative)},defaultGetContentAreaBBox:function(bRelative){var oContentInfo=this.getContentAreaInfo(bRelative);return oContentInfo&&oContentInfo.contentBBox},getContentAreaBBox:function(bRelative){return this.defaultGetContentAreaBBox(bRelative)},drawSubSymbols:function(oViewer,oTransitionDef,aAttributes){if(this.isComposite){var aLinkSymbols=[],index,max,oSubSymbol;if(this.symbols){for(index=0,max=this.symbols.length;index<max;index++){oSubSymbol=this.symbols.get(index);if(oSubSymbol.isLinkSymbol){aLinkSymbols.push(oSubSymbol)}else{oSubSymbol.drawSymbol(oViewer,oTransitionDef,aAttributes)}}}for(index=0,max=aLinkSymbols.length;index<max;index++){oSubSymbol=aLinkSymbols[index];oSubSymbol.drawSymbol(oViewer,oTransitionDef,aAttributes)}}},updateSubSymbolsLayout:function(bCanChangeSymbol,oViewer,oTransitionDef){if(this.isComposite){var index,max,oSubSymbol;for(index=0,max=this.contentSymbols.length;index<max;index++){oSubSymbol=this.contentSymbols.get(index);oSubSymbol.updateLayout(bCanChangeSymbol,oViewer,oTransitionDef)}}},moveSubSymbolsBy:function(dx,dy,options,oViewer,oTransitionDef){if(this.isComposite){var index,max,oSubSymbol,oPublishEvent={},self=this;for(index=0,max=this.symbols.length;index<max;index++){oSubSymbol=this.symbols.get(index);if(!oSubSymbol.isLinkSymbol){oPublishEvent.sourceSymbol=oSubSymbol;sap.galilei.core.Event.publish("move.symbol.before",oSubSymbol,undefined,oPublishEvent);oSubSymbol.moveBy(dx,dy,options,oViewer,oTransitionDef);if(!oTransitionDef){sap.galilei.core.Event.publish("move.symbol.after",oSubSymbol,undefined,oPublishEvent)}}}if(oTransitionDef){setTimeout(function(){if(self.symbols!==undefined){for(index=0,max=self.symbols.length;index<max;index++){oSubSymbol=self.symbols.get(index);if(!oSubSymbol.isLinkSymbol){oPublishEvent.sourceSymbol=oSubSymbol;sap.galilei.core.Event.publish("move.symbol.after",oSubSymbol,undefined,oPublishEvent)}}}},oTransitionDef.duration)}}},showSubSymbols:function(oViewer,oTransitionDef,oOptions){if(this.isComposite){var index,max,oSubSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSubSymbol=this.symbols.get(index);oSubSymbol.show(oViewer,oTransitionDef,oOptions)}}},hideSubSymbols:function(oViewer,oTransitionDef,oOptions){if(this.isComposite){var index,max,oSubSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSubSymbol=this.symbols.get(index);oSubSymbol.hide(oViewer,oTransitionDef,oOptions)}}},updateBoundarySymbols:function(oOldParentBBox,oNewParentBBox,bMoveLinkSymbols,oViewer,oTransitionDef){if(this.isComposite){var index,max,oBoundarySymbol;for(index=0,max=this.boundarySymbols.length;index<max;index++){oBoundarySymbol=this.boundarySymbols.get(index);this.updateBoundarySymbol(oBoundarySymbol,oOldParentBBox,oNewParentBBox,bMoveLinkSymbols,oViewer,oTransitionDef)}}},updateBoundarySymbol:function(oBoundarySymbol,oOldParentBBox,oNewParentBBox,bMoveLinkSymbols,oViewer,oTransitionDef){if(oBoundarySymbol){var oBoundarySymbolBBox=oBoundarySymbol.getBBox(),options={},oNewBBox=this.computeBoundarySymbolBBox(oBoundarySymbol,undefined,oOldParentBBox,oNewParentBBox);if(bMoveLinkSymbols){options.moveLinkSymbols=true}if(oNewBBox&&oBoundarySymbolBBox&&(oNewBBox.x!==oBoundarySymbolBBox.x||oNewBBox.y!==oBoundarySymbolBBox.y)){oBoundarySymbol.moveTo(oNewBBox.x,oNewBBox.y,options,oViewer,oTransitionDef)}}},setBoundarySymbolAttachPoint:function(oBoundarySymbol,x,y,bMoveLinkSymbols,oViewer,oTransitionDef){if(oBoundarySymbol){var oBoundarySymbolBBox=oBoundarySymbol.getBBox(),nOffsetX=0,nOffsetY=0,options={},oNewBBox;if(!isNaN(oBoundarySymbol.offsetX)){nOffsetX=oBoundarySymbol.offsetX}if(!isNaN(oBoundarySymbol.offsetY)){nOffsetY=oBoundarySymbol.offsetY}oNewBBox=oBoundarySymbolBBox.clone();oNewBBox.setCenter(x+nOffsetX,y+nOffsetY);if(bMoveLinkSymbols){options.moveLinkSymbols=true}if(oNewBBox.x!==oBoundarySymbolBBox.x||oNewBBox.y!==oBoundarySymbolBBox.y){oBoundarySymbol.moveTo(oNewBBox.x,oNewBBox.y,options,oViewer,oTransitionDef)}}},computeBoundarySymbolBBox:function(oBoundarySymbol,oBoundarySymbolBBox,oOldParentBBox,oNewParentBBox){var oBoundaryShape,oBoundaryRect,nOffsetX=0,nOffsetY=0,aOldCenter,aCenter,aNewAttachCenter,aNewCenter,oPoint,oMatrix;oBoundaryShape=this.getBoundaryShape();if(oBoundaryShape&&(oBoundarySymbol||oBoundarySymbolBBox)){if(oBoundarySymbol&&!oBoundarySymbolBBox){oBoundarySymbolBBox=oBoundarySymbol.getBBox()}aOldCenter=aCenter=oBoundarySymbolBBox.getCenter();if(oBoundarySymbol){if(!isNaN(oBoundarySymbol.offsetX)){nOffsetX=oBoundarySymbol.offsetX}if(!isNaN(oBoundarySymbol.offsetY)){nOffsetY=oBoundarySymbol.offsetY}aOldCenter[0]-=nOffsetX;aOldCenter[1]-=nOffsetY;aCenter[0]-=nOffsetX;aCenter[1]-=nOffsetY}if(!oNewParentBBox){oNewParentBBox=this.getBBox()}if(oOldParentBBox&&oNewParentBBox&&!oNewParentBBox.equals(oOldParentBBox)){oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oOldParentBBox,oNewParentBBox);oPoint=new sap.galilei.ui.common.Point(aOldCenter);oPoint.matrixTransform(oMatrix);aCenter=[oPoint.x,oPoint.y]}oBoundaryRect=oBoundaryShape.getBBox();if(oNewParentBBox){oBoundaryRect=oBoundaryRect.clone();oBoundaryRect.width=oNewParentBBox.width;oBoundaryRect.height=oNewParentBBox.height}aNewAttachCenter=aNewCenter=oBoundaryShape.getClosestPointOnBorder(aCenter,oBoundaryRect,oNewParentBBox);if(aNewCenter){aNewCenter[0]+=nOffsetX;aNewCenter[1]+=nOffsetY}if(aNewCenter&&(aNewCenter[0]!==aOldCenter[0]||aNewCenter[1]!==aOldCenter[1])){oBoundarySymbolBBox=oBoundarySymbolBBox.clone();oBoundarySymbolBBox.setCenter(aNewCenter[0],aNewCenter[1])}if(oBoundarySymbol){oBoundarySymbol.boundaryDirection=oNewParentBBox.getPointDirection(aNewAttachCenter)}}return oBoundarySymbolBBox},getBoundarySymbolsMargin:function(){var oParentBBox=this.getBBox(),index,max,oBoundarySymbol,oBoundaryBBox,vDirection,nWest=0,nEast=0,nNorth=0,nSouth=0;if(this.isComposite){for(index=0,max=this.boundarySymbols.length;index<max;index++){oBoundarySymbol=this.boundarySymbols.get(index);if(oBoundarySymbol.boundaryDirection!==undefined){vDirection=oBoundarySymbol.boundaryDirection}else{oBoundaryBBox=oBoundarySymbol.getBBox();vDirection=oParentBBox.getPointDirection(oBoundaryBBox.getCenter())}switch(vDirection){case sap.galilei.ui.common.LinkDirection.west:nWest=Math.max(nWest,oBoundarySymbol.width/2);break;case sap.galilei.ui.common.LinkDirection.east:nEast=Math.max(nEast,oBoundarySymbol.width/2);break;case sap.galilei.ui.common.LinkDirection.north:nNorth=Math.max(nNorth,oBoundarySymbol.height/2);break;case sap.galilei.ui.common.LinkDirection.south:nSouth=Math.max(nSouth,oBoundarySymbol.height/2);break}}}return{left:nWest,right:nEast,top:nNorth,bottom:nSouth}},getLinkSymbols:function(bIncludeSource,bIncludeTarget){var oRef,aLinks,aLinks2;if(bIncludeSource||bIncludeSource===undefined){oRef=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.sourceSymbol");if(oRef&&oRef.values&&oRef.values.length>0){aLinks=oRef.values}}if(bIncludeTarget||bIncludeTarget===undefined){oRef=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.targetSymbol");if(oRef&&oRef.values&&oRef.values.length>0){aLinks2=oRef.values}}if(aLinks&&aLinks2){aLinks=aLinks.concat(aLinks2)}else{if(!aLinks&&aLinks2){aLinks=aLinks2}}return aLinks},getSourceLinkSymbols:function(){return this.getLinkSymbols(true,false)},getTargetLinkSymbols:function(){return this.getLinkSymbols(false,true)},defaultGetConnectedSymbols:function(bIncludeSource,bIncludeTarget,bIncludeLinkSymbols){var aLinkSymbols,aSymbols=[],index,max,oNodeSymbol,oLinkSymbol;bIncludeSource=(bIncludeSource!==undefined)?bIncludeSource:true;bIncludeTarget=(bIncludeTarget!==undefined)?bIncludeTarget:true;bIncludeLinkSymbols=(bIncludeLinkSymbols!==undefined)?bIncludeLinkSymbols:false;aLinkSymbols=this.getLinkSymbols(bIncludeSource,bIncludeTarget);if(aLinkSymbols){for(index=0,max=aLinkSymbols.length;index<max;index++){oLinkSymbol=aLinkSymbols[index];if(bIncludeLinkSymbols){aSymbols.push(oLinkSymbol)}if(oLinkSymbol.sourceSymbol===this){oNodeSymbol=oLinkSymbol.targetSymbol}else{oNodeSymbol=oLinkSymbol.sourceSymbol}if(aSymbols.indexOf(oNodeSymbol)===-1){aSymbols.push(oNodeSymbol)}}}return aSymbols},getConnectedSymbols:function(bIncludeSource,bIncludeTarget,bIncludeLinkSymbols){return this.defaultGetConnectedSymbols(bIncludeSource,bIncludeTarget,bIncludeLinkSymbols)},getSourceSymbols:function(bIncludeLinkSymbols){return this.getConnectedSymbols(true,false,bIncludeLinkSymbols)},getTargetSymbols:function(bIncludeLinkSymbols){return this.getConnectedSymbols(false,true,bIncludeLinkSymbols)},getSynonymSymbols:function(){var i,oRef,aResult=[];if(this.object){oRef=this.object.classDefinition.getReverseReference(this.object,"sap.galilei.ui.diagram.Symbol.object");if(oRef&&oRef.values&&oRef.values.length>0){for(i=0;i<oRef.values.length;i++){if(oRef.values[i]!==this){aResult.push(oRef.values[i])}}}}return aResult},hasLinkSymbol:function(){var aOutgoings,aIncomings;if(!this.isLinkSymbol){aOutgoings=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.sourceSymbol");if(aOutgoings&&aOutgoings.values&&aOutgoings.values.length>0){return true}aIncomings=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.targetSymbol");if(aIncomings&&aIncomings.values&&aIncomings.values.length>0){return true}}return false},drawLinkSymbols:function(oViewer,oTransitionDef,aAttributes){var oLinks,oLinkSymbol,index;oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];if(oLinkSymbol&&this.diagram===oLinkSymbol.diagram&&oLinkSymbol.targetSymbol!==undefined&&oLinkSymbol.sourceSymbol!==undefined){oLinkSymbol.drawSymbol(oViewer,oTransitionDef,aAttributes)}}}},moveLinkSymbolsBy:function(dx,dy,oViewer,oTransitionDef){var aLinks,oLinkSymbol,i,length,aPoints,bPreserveAttachPoints=false;aLinks=this.getLinkSymbols();if(aLinks&&aLinks.length>0){for(i=0,length=aLinks.length;i<length;i++){bPreserveAttachPoints=false;oLinkSymbol=aLinks[i];if(oLinkSymbol&&oLinkSymbol.points){if(oLinkSymbol.points.length>=2){aPoints=oLinkSymbol.points.clone();if(oLinkSymbol.sourceSymbol===this){aPoints[0][0]+=dx;aPoints[0][1]+=dy}else{if(oLinkSymbol.targetSymbol===this){aPoints[aPoints.length-1][0]+=dx;aPoints[aPoints.length-1][1]+=dy}}oLinkSymbol.points=aPoints;bPreserveAttachPoints=true}oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(bPreserveAttachPoints,oViewer,oTransitionDef)}}}},defaultUpdateLinkSymbolRoutings:function(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef){var aLinks=this.getLinkSymbols(),index,max,oLinkSymbol;if(aLinks){for(index=0,max=aLinks.length;index<max;index++){oLinkSymbol=aLinks[index];oLinkSymbol.isAutomaticRouting=bIsAutomaticRouting;oLinkSymbol.updateLinkRouting(bPreserveAttachPoints,oViewer,oTransitionDef)}}},updateLinkSymbolRoutings:function(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef){this.defaultUpdateLinkSymbolRoutings(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef)},updateLinkSymbolOwners:function(){var i,length,oSymbol,aLinkSymbols;aLinkSymbols=this.getLinkSymbols();if(aLinkSymbols&&aLinkSymbols.length>0){for(i=0,length=aLinkSymbols.length;i<length;i++){aLinkSymbols[i].updateOwner()}}if(this.isComposite){for(i=0,length=this.symbols.length;i<length;i++){oSymbol=this.symbols.get(i);if(oSymbol){oSymbol.updateLinkSymbolOwners()}}}},showLinkSymbols:function(oViewer,oTransitionDef,oOptions){var oLinks,oLinkSymbol,index;oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];oLinkSymbol.show(oViewer,oTransitionDef,oOptions)}}},hideLinkSymbols:function(oViewer,oTransitionDef,oOptions){var oLinks,oLinkSymbol,index;oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];oLinkSymbol.hide(oViewer,oTransitionDef,oOptions)}}},getAttachPoints:function(bIsSource){if(this.isLinkSymbol){return undefined}var aPoints,oBBox=this.getBBox(),dx=16,dy=16,nHorzPoints=0,nVertPoints=0,index;aPoints=[[oBBox.x+0.5*oBBox.width,oBBox.y+0.5*oBBox.height],[oBBox.x+0.5*oBBox.width,oBBox.y],[oBBox.x,oBBox.y+0.5*oBBox.height],[oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height],[oBBox.x+0.5*oBBox.width,oBBox.y+oBBox.height]];if(!this.isKeepSize){if(oBBox.width<48){nHorzPoints=0}else{if(oBBox.width<80){nHorzPoints=1}else{if(oBBox.width<200){nHorzPoints=2}}}if(oBBox.height<48){nVertPoints=0}else{if(oBBox.height<80){nVertPoints=1}else{if(oBBox.height<200){nVertPoints=2}}}for(index=1;index<=nHorzPoints;index++){aPoints.push([oBBox.x+0.5*oBBox.width-dx*index,oBBox.y]);aPoints.push([oBBox.x+0.5*oBBox.width+dx*index,oBBox.y]);aPoints.push([oBBox.x+0.5*oBBox.width-dx*index,oBBox.y+oBBox.height]);aPoints.push([oBBox.x+0.5*oBBox.width+dx*index,oBBox.y+oBBox.height])}for(index=1;index<=nVertPoints;index++){aPoints.push([oBBox.x,oBBox.y+0.5*oBBox.height-dy*index]);aPoints.push([oBBox.x,oBBox.y+0.5*oBBox.height+dy*index]);aPoints.push([oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height-dy*index]);aPoints.push([oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height+dy*index])}}return{isFixedPoints:false,points:aPoints}},getDecoratorGroup:function(sAttachPosition){var oDecoratorGroup;if(this.decoratorGroups){oDecoratorGroup=this.decoratorGroups.getDecoratorGroup(sAttachPosition)}return oDecoratorGroup},getOrCreateDecoratorGroup:function(sAttachPosition){var oDecoratorGroup;if(!this.decoratorGroups){this.decoratorGroups=new sap.galilei.ui.common.decorator.DecoratorGroups()}oDecoratorGroup=this.decoratorGroups.getOrCreateDecoratorGroup(sAttachPosition);return oDecoratorGroup},addDecorator:function(oDecorator){if(oDecorator){if(!this.decoratorGroups){this.decoratorGroups=new sap.galilei.ui.common.decorator.DecoratorGroups()}this.decoratorGroups.addDecorator(oDecorator)}},getDecorator:function(sId){return this.decoratorGroups&&this.decoratorGroups.getDecoratorById(sId)},removeDecorator:function(sId){if(this.decoratorGroups){this.decoratorGroups.removeDecorator(sId)}},removeAllDecorators:function(sId){if(this.decoratorGroups){this.decoratorGroups.removeAllDecorators()}}},statics:{objectClass:{value:undefined},parentSymbolHighlighter:{get:function(){return{className:"sap.galilei.ui.editor.tracker.SymbolHighlighter"}}},createSymbolLayout:function(vLayoutTemplate,nIndex){var oSymbolLayout;if(vLayoutTemplate){if((vLayoutTemplate instanceof Array)&&vLayoutTemplate.length>0){nIndex=(nIndex===undefined)?0:nIndex;oSymbolLayout=sap.galilei.ui.symbol.SymbolLayoutSerializer.load(vLayoutTemplate[nIndex])}else{if((typeof vLayoutTemplate)=="object"){oSymbolLayout=sap.galilei.ui.symbol.SymbolLayoutSerializer.load(vLayoutTemplate)}}}return oSymbolLayout},getOrCreateSymbolLayout:function(oClassDefinition,nIndex){var oRuntimeClass,oSymbolLayout,bMultipleTemplates=false;if(oClassDefinition){oRuntimeClass=oClassDefinition.runtimeClass;if(oRuntimeClass){oSymbolLayout=oRuntimeClass.symbolLayout;if(oRuntimeClass.layoutTemplate instanceof Array){bMultipleTemplates=true;nIndex=(nIndex===undefined)?0:nIndex}if(bMultipleTemplates){oSymbolLayout=oSymbolLayout&&oSymbolLayout[nIndex]}if(!oSymbolLayout&&oRuntimeClass.layoutTemplate){oSymbolLayout=sap.galilei.ui.diagram.Symbol.createSymbolLayout(oRuntimeClass.layoutTemplate,nIndex);if(bMultipleTemplates){if(!oRuntimeClass.symbolLayout){oRuntimeClass.symbolLayout={}}oRuntimeClass.symbolLayout[nIndex]=oSymbolLayout}else{oRuntimeClass.symbolLayout=oSymbolLayout}}}}return oSymbolLayout},traverseSubSymbols:function(oSymbol,aResult,escapeCallback){var i;if(!oSymbol||(escapeCallback&&escapeCallback.call(undefined,oSymbol))){return}aResult.push(oSymbol);if(oSymbol.isComposite&&oSymbol.symbols.length>0){for(i=0;i<oSymbol.symbols.length;i++){sap.galilei.ui.diagram.Symbol.traverseSubSymbols(oSymbol.symbols.get(i),aResult,escapeCallback)}}}}},LinkSymbol:{displayName:"Link Symbol",parent:"Symbol",properties:{"LinkSymbol.isAdjustToContent":{name:"isAdjustToContent",defaultValue:false},points:{dataType:sap.galilei.model.dataTypes.gBlob,defaultValue:undefined,converter:"stringToPointsConverter"},lineStyle:{dataType:sap.galilei.model.dataTypes.gShort,defaultValue:sap.galilei.ui.common.LineStyle.rounded},sourceAttachPoint:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,get:function(){if(this.points&&this.points.length>=2){return this.points[0]}return undefined},set:function(vPoint){var aPoint;if(!this.points){this.points=new sap.galilei.ui.common.Points();this.points.push(undefined);this.points.push(undefined)}aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint&&aPoint.length===2&&this.points&&this.points.length>=2){this.points[0]=[aPoint[0],aPoint[1]]}}},targetAttachPoint:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,get:function(){if(this.points&&this.points.length>=2){return this.points[this.points.length-1]}return undefined},set:function(vPoint){var aPoint;if(!this.points){this.points=new sap.galilei.ui.common.Points();this.points.push(undefined);this.points.push(undefined)}aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint&&aPoint.length===2&&this.points&&this.points.length>=2){this.points[this.points.length-1]=[aPoint[0],aPoint[1]]}}},supportedSourceDirections:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},supportedTargetDirections:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},sourceDirection:{defaultValue:undefined,dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},targetDirection:{defaultValue:undefined,dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},isAutomaticRouting:{defaultValue:true,dataType:sap.galilei.model.dataTypes.gBool,isInternal:true},isLinkSymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true},middleArrowShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined},sourceContentShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined},middleContentShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined},targetContentShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined}},references:{sourceSymbol:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:false,isContainment:false,onCascadeChange:function(oEventArgs){var oInstance=oEventArgs.instance,oObject=oEventArgs.newObject;if(!this.resource.isLoading){if(oObject&&oInstance.updateOwner){oInstance.updateOwner()}}}},targetSymbol:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:false,isContainment:false,onCascadeChange:function(oEventArgs){var oInstance=oEventArgs.instance,oObject=oEventArgs.newObject;if(!this.resource.isLoading){if(oObject&&oInstance.updateOwner){oInstance.updateOwner()}}}}},methods:{createSymbolLayout:function(vLayoutTemplate){return sap.galilei.ui.diagram.LinkSymbol.createSymbolLayout(vLayoutTemplate)},getLinkShape:function(){var oShape=this.shape;if(oShape&&oShape.shapes.length>0){return oShape.shapes[0]}return oShape},getMainShape:function(){return this.getLinkShape()},setMainShape:function(oMainShape){},setContentShape:function(oContentShape){},updateLinkRouting:function(bPreserveAttachPoints,oViewer,oTransitionDef){var oLinkSymbolLayout,oPublishEvent={},self=this;if(this.isAutomaticRouting||!this.points||this.points.length<2){oLinkSymbolLayout=this.getOrCreateSymbolLayout();if(oLinkSymbolLayout){if(oViewer){oPublishEvent.sourceSymbol=this;sap.galilei.core.Event.publish("layout.linksymbol.before",this,undefined,oPublishEvent)}oLinkSymbolLayout.updateLinkRouting(this,bPreserveAttachPoints);if(oViewer){this.drawSymbol(oViewer,oTransitionDef);if(oTransitionDef){setTimeout(function(){sap.galilei.core.Event.publish("layout.linksymbol.after",self,undefined,oPublishEvent)},oTransitionDef.duration)}else{sap.galilei.core.Event.publish("layout.linksymbol.after",this,undefined,oPublishEvent)}}}}},getLinkPoints:function(bIncludeStrokeWidth){var oSymbolLayout,aPoints=this.points;if(this.sourceSymbol&&this.targetSymbol&&aPoints){oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){aPoints=oSymbolLayout.getLinkPoints(this,bIncludeStrokeWidth)}}return aPoints},drawSymbol:function(oViewer,oTransitionDef,aAttributes){if(!this.isEnableDraw){if(this.isDrawn){this.hide(oViewer,oTransitionDef,{setIsHidden:false,removeShape:true})}return}if(this.sourceSymbol&&this.targetSymbol&&this.sourceSymbol.isDrawn&&this.targetSymbol.isDrawn){var oShape=this.getOrCreateShape(),oLinkShape=this.getLinkShape(),oSymbolLayout,aOldPoints,bModified,oEvent={};this.onPreDrawSymbol(oViewer,oTransitionDef);if(oShape&&oLinkShape){aOldPoints=oLinkShape.points.clone();oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){if(!this.points||this.points.length<2){oSymbolLayout.updateLinkRouting(this,false)}oSymbolLayout.layoutLinkShape(this,oLinkShape)}if(!oShape.isDrawn){if(!oShape.isDisableDrawing){oShape.draw(oViewer,undefined,oTransitionDef)}this.registerEventHandlers()}else{oShape.zindex=this.getShapeZIndex();if(oViewer){bModified=aOldPoints&&!aOldPoints.equals(oLinkShape.points);if(bModified){oEvent.sourceSymbol=this;oEvent.transitionDefinition=oTransitionDef;sap.galilei.core.Event.publish("modify.linksymbol.before",this,undefined,oEvent)}oShape.updateDrawing(oViewer,oTransitionDef,aAttributes);if(bModified){if(oTransitionDef){setTimeout(function(){sap.galilei.core.Event.publish("modify.linksymbol.after",oEvent.sourceSymbol,undefined,oEvent)},oTransitionDef.duration)}else{sap.galilei.core.Event.publish("modify.linksymbol.after",oEvent.sourceSymbol,undefined,oEvent)}}}}}this.onPostDrawSymbol(oViewer,oTransitionDef)}},getShapeZIndex:function(){return -1*sap.galilei.ui.common.ZINDEX_STEP_MINOR},updateOwner:function(){var oOwner=this.getOwner(),oNewOwner,oOldColl;if(!oOwner){return undefined}oOldColl=oOwner.symbols;if(this.sourceSymbol&&this.targetSymbol){oNewOwner=sap.galilei.ui.diagram.LinkSymbol.getLinkSymbolOwner(this.sourceSymbol,this.targetSymbol);if(oNewOwner&&oOwner!==oNewOwner){if(oOldColl){oOldColl.removeAt(oOldColl.indexOf(this))}if(oNewOwner.symbols){oNewOwner.symbols.push(this)}return oNewOwner}}return oOwner},moveBy:function(dx,dy,options,oViewer,oTransitionDef){var aPoints;if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)&&(Math.abs(dx)>0.01||Math.abs(dy)>0.01)&&this.points){aPoints=this.points.clone();aPoints.moveBy(dx,dy);this.points=aPoints;if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}}},getCenter:function(){var oLinkShape=this.getLinkShape(),aPoints,length,middleIndex,bOdd;if(oLinkShape!==undefined){aPoints=oLinkShape.points;length=aPoints.length;if(length>1){bOdd=length%2===0?false:true;middleIndex=Math.ceil(length/2)-1;if(bOdd){return aPoints[middleIndex]}else{return[(aPoints[middleIndex][0]+aPoints[middleIndex+1][0])/2,(aPoints[middleIndex][1]+aPoints[middleIndex+1][1])/2]}}}},getBBox:function(bIncludeAllSubSymbols){if(this.points){return this.points.getBBox()}return new sap.galilei.ui.common.Rect()},defaultGetConnectedSymbols:function(bIncludeSource,bIncludeTarget,bIncludeLinkSymbols){var aSymbols=[];bIncludeSource=(bIncludeSource!==undefined)?bIncludeSource:true;bIncludeTarget=(bIncludeTarget!==undefined)?bIncludeTarget:true;bIncludeLinkSymbols=(bIncludeLinkSymbols!==undefined)?bIncludeLinkSymbols:false;if(bIncludeLinkSymbols){aSymbols.push(this)}if(bIncludeSource&&this.sourceSymbol!==undefined){aSymbols.push(this.sourceSymbol)}if(bIncludeTarget&&this.targetSymbol!==undefined){if(!(bIncludeSource&&this.sourceSymbol!==undefined&&this.sourceSymbol===this.targetSymbol)){aSymbols.push(this.targetSymbol)}}return aSymbols}},statics:{createSymbolLayout:function(vLayoutTemplate){var oSymbolLayout;if(vLayoutTemplate){if((vLayoutTemplate instanceof Array)&&vLayoutTemplate.length>0){oSymbolLayout=sap.galilei.ui.symbol.LinkSymbolLayoutSerializer.load(vLayoutTemplate[0])}else{if((typeof vLayoutTemplate)=="object"){oSymbolLayout=sap.galilei.ui.symbol.LinkSymbolLayoutSerializer.load(vLayoutTemplate)}}}return oSymbolLayout},getOrCreateSymbolLayout:function(oClassDefinition){var oRuntimeClass,oSymbolLayout,aKeys,index,max,sKey;if(oClassDefinition){oRuntimeClass=oClassDefinition.runtimeClass;if(oRuntimeClass){if(!oRuntimeClass.symbolLayout&&oRuntimeClass.layoutTemplate){oRuntimeClass.symbolLayout=sap.galilei.ui.diagram.LinkSymbol.createSymbolLayout(oRuntimeClass.layoutTemplate)}oSymbolLayout=oRuntimeClass.symbolLayout;if(oSymbolLayout){if(oSymbolLayout[0]){oSymbolLayout=oSymbolLayout[0]}else{aKeys=Object.keys(oSymbolLayout);if(aKeys&&aKeys.length>0){for(index=0,max=aKeys.length;index<max;index++){sKey=aKeys[index];if(!isNaN(sKey)){oSymbolLayout=oSymbolLayout[sKey];break}}}}}}}return oSymbolLayout},getLinkSymbolOwner:function(oSourceSymbol,oTargetSymbol){var oSourceOwner,oTargetOwner;if(oSourceSymbol&&oTargetSymbol){oTargetOwner=oTargetSymbol.getOwner();while(oTargetOwner){oSourceOwner=oSourceSymbol.getOwner();while(oSourceOwner){if((oSourceOwner===oTargetOwner)&&(!oSourceOwner.isSwimlaneSymbol||oSourceOwner.isLeafSwimlaneSymbol)){return oSourceOwner}oSourceOwner=oSourceOwner.getOwner()}oTargetOwner=oTargetOwner.getOwner()}return oSourceSymbol.diagram}}}},CompositeSymbol:{displayName:"Composite Symbol",parent:"Symbol",properties:{"CompositeSymbol.isComposite":{name:"isComposite",get:function(){return true}},isExpanded:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true},supportExpandAndCollapse:{dataType:sap.galilei.model.dataTypes.gBool,isInternal:true,defaultValue:false}},methods:{expand:function(oViewer,oTransitionDef){},collapse:function(oViewer,oTransitionDef){},toggleExpanded:function(oViewer,oTransitionDef){if(this.isExpanded){this.collapse(oViewer,oTransitionDef)}else{this.expand(oViewer,oTransitionDef)}}}},SwimlaneSymbol:{displayName:"Swimlane Symbol",parent:"CompositeSymbol",properties:{"SwimlaneSymbol.isAdjustToContent":{name:"isAdjustToContent",get:function(){return false}},"SwimlaneSymbol.isKeepAspectRatio":{name:"isKeepAspectRatio",get:function(){return false}},"SwimlaneSymbol.isKeepCenter":{name:"isKeepCenter",get:function(){return false}},orientation:{dataType:sap.galilei.model.dataTypes.gString,defaultValue:sap.galilei.ui.symbol.Orientation.DEFAULT},isVertical:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.vertical}},isHorizontal:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.horizontal}},isDetachable:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},length:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.vertical?this.height:this.width},set:function(value){if(this.orientation===sap.galilei.ui.symbol.Orientation.vertical){this.height=value}else{this.width=value}}},size:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.vertical?this.width:this.height},set:function(value){if(this.orientation===sap.galilei.ui.symbol.Orientation.vertical){this.width=value}else{this.height=value}}},isSwimlaneSymbol:{get:function(){return true}},isLeafSwimlaneSymbol:{get:function(){return this.symbols.length===0||!this.symbols.get(0).isSwimlaneSymbol}},isRootSwimlaneSymbol:{get:function(){return !this.parentSymbol||!this.parentSymbol.isSwimlaneSymbol}},"SwimlaneSymbol.symbolTracker":{name:"symbolTracker",get:function(){return{className:!this.isDetachable?"sap.galilei.ui.editor.tracker.SwimlaneSymbolTracker":"sap.galilei.ui.editor.tracker.RectangularSymbolTracker"}}}},methods:{layoutSwimlanes:function(sLayoutSwimlaneDirection,oViewer,oTransitionDef){var i,oSubSymbol,dCurrentPos,dSize=0,dSubSize,oContentAreaBBox,dSubLength,dHeaderLength,bSubSymbolMoved;if(this.isDeleting){return}if(this.object&&this.object.isDeleting){return}if(this.isDetachable){return}if(!sLayoutSwimlaneDirection){sLayoutSwimlaneDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT}this.updateLayout(true,oViewer,oTransitionDef);if(this.symbols.length>0){oContentAreaBBox=this.getContentAreaBBox();dHeaderLength=this.isVertical?oContentAreaBBox.top-this.y:oContentAreaBBox.left-this.x;dSubLength=this.length-dHeaderLength;if(sLayoutSwimlaneDirection!==sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis){dCurrentPos=this.isVertical?oContentAreaBBox.left:oContentAreaBBox.top;for(i=0;i<this.symbols.length;i++){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isSwimlaneSymbol){if(this.isVertical){oSubSymbol.moveTo(dCurrentPos,oContentAreaBBox.top,undefined,oViewer,oTransitionDef);oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,oViewer,oTransitionDef);dSubSize=oSubSymbol.size}else{oSubSymbol.moveTo(oContentAreaBBox.left,dCurrentPos,undefined,oViewer,oTransitionDef);oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,oViewer,oTransitionDef);dSubSize=oSubSymbol.size}if(dSubSize>0){dSize+=dSubSize;dCurrentPos+=dSubSize}}}}else{dCurrentPos=this.isVertical?oContentAreaBBox.right:oContentAreaBBox.bottom;for(i=this.symbols.length-1;i>=0;i--){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isSwimlaneSymbol){if(this.isVertical){oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,oViewer,oTransitionDef);dSubSize=oSubSymbol.size;oSubSymbol.moveTo(dCurrentPos-dSubSize,oContentAreaBBox.top,undefined,oViewer,oTransitionDef);bSubSymbolMoved=true}else{oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,oViewer,oTransitionDef);dSubSize=oSubSymbol.size;oSubSymbol.moveTo(oContentAreaBBox.left,dCurrentPos-dSubSize,undefined,oViewer,oTransitionDef);bSubSymbolMoved=true}if(dSubSize>0){dSize+=dSubSize;dCurrentPos-=dSubSize}}}if(bSubSymbolMoved){if(this.isVertical){this.moveTo(dCurrentPos,this.y,{moveSubSymbols:this.isLeafSwimlaneSymbol},oViewer,oTransitionDef)}else{this.moveTo(this.x,dCurrentPos,{moveSubSymbols:this.isLeafSwimlaneSymbol},oViewer,oTransitionDef)}}}if(dSize>0){this.size=dSize}}this.updateLayout(true,oViewer,oTransitionDef)},getContentAreaBBox:function(bRelative){var oRect,marginLeft,marginRight,marginTop,marginBottom;if(this.isDetachable){return this.defaultGetContentAreaBBox()}if(this.shape&&this.shape.contentShape&&this.shape.contentShape.contentLayoutRect){oRect=this.shape.contentShape.contentLayoutRect.clone();if(!this.isLeafSwimlaneSymbol){marginLeft=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginLeft,0);marginRight=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginRight,0);marginTop=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginTop,0);marginBottom=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginBottom,0);oRect.inflate(marginLeft,marginTop,marginRight,marginBottom)}oRect.x+=this.x;oRect.y+=this.y}else{oRect=this.getBBox()}if(bRelative){oRect.x-=this.x;oRect.y-=this.y}return oRect},getHeaderAreaBBox:function(){var oRect,oBBox=this.getBBox(),marginLeft,marginRight,marginTop,marginBottom;if(this.shape&&this.shape.contentShape&&this.shape.contentShape.contentLayoutRect){oRect=this.shape.contentShape.contentLayoutRect.clone();marginLeft=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginLeft,0);marginRight=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginRight,0);marginTop=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginTop,0);marginBottom=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginBottom,0);if(this.isVertical){oBBox.height-=(oRect.height+marginTop+marginBottom)}else{oBBox.width-=(oRect.width+marginLeft+marginRight)}}return oBBox},getLeafSwimlanes:function(aSwimlanes,bReverse){var i,oSubSymbol;aSwimlanes=aSwimlanes||[];if(this.isSwimlaneSymbol&&this.symbols.length>0&&!this.isLeafSwimlaneSymbol){if(bReverse){for(i=this.symbols.length-1;i>=0;i--){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isLeafSwimlaneSymbol){aSwimlanes.push(oSubSymbol)}if(!oSubSymbol.getLeafSwimlanes){continue}oSubSymbol.getLeafSwimlanes(aSwimlanes,bReverse)}}else{for(i=0;i<this.symbols.length;i++){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isLeafSwimlaneSymbol){aSwimlanes.push(oSubSymbol)}if(!oSubSymbol.getLeafSwimlanes){continue}oSubSymbol.getLeafSwimlanes(aSwimlanes,bReverse)}}}},extendToContent:function(options,edgeOption,oViewer,oTransitionDef){var sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT;if(this.isDetachable){this.defaultExtendToContent(options,edgeOption,oViewer,oTransitionDef);return}options=options||{};if(this.isRootSwimlaneSymbol&&!this.isLeafSwimlaneSymbol){this.defaultExtendToContent(undefined,edgeOption,oViewer,oTransitionDef);if(this.isVertical){if((edgeOption&sap.galilei.ui.symbol.EdgeType.LEFT)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis}}else{if((edgeOption&sap.galilei.ui.symbol.EdgeType.TOP)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis}}this.layoutSwimlanes(sLayoutDirection,oViewer,oTransitionDef);if(this.parentSymbol){this.parentSymbol.extendToContent(options,edgeOption,oViewer,oTransitionDef)}}else{this.defaultExtendToContent(options,edgeOption,oViewer,oTransitionDef)}},drawSymbol:function(oViewer,oTransitionDef,aAttributes){var shape=this.getOrCreateShape(),bNeedLayout=false,bMoved=false,bResized=false,oUpdateShapeStatus,oEvent={};if(!this.isEnableDraw){if(this.isDrawn){this.hide(oViewer,oTransitionDef,{setIsHidden:false,removeShape:true})}return}this.onPreDrawSymbol(oViewer,oTransitionDef);if(shape){oUpdateShapeStatus=this.updateShape();bMoved=oUpdateShapeStatus.moved;bResized=oUpdateShapeStatus.resized;if(!shape.isDrawn){shape.draw(oViewer,undefined,oTransitionDef);this.registerEventHandlers();bNeedLayout=true}else{if(oViewer){if(bMoved||bResized){oEvent.sourceSymbol=this;oEvent.transitionDefinition=oTransitionDef;sap.galilei.core.Event.publish(bResized?"resize.symbol.before":"move.symbol.before",this,undefined,oEvent)}shape.updateDrawing(oViewer,oTransitionDef,aAttributes);if(bMoved||bResized){if(oTransitionDef){setTimeout(function(){sap.galilei.core.Event.publish(bResized?"resize.symbol.after":"move.symbol.after",oEvent.sourceSymbol,undefined,oEvent)},oTransitionDef.duration)}else{sap.galilei.core.Event.publish(bResized?"resize.symbol.after":"move.symbol.after",oEvent.sourceSymbol,undefined,oEvent)}}}}}if(this.isComposite){this.drawSubSymbols(oViewer,oTransitionDef,aAttributes)}if(bNeedLayout&&this.isRootSwimlaneSymbol){}this.onPostDrawSymbol(oViewer,oTransitionDef)}},statics:{parentSymbolHighlighter:{get:function(){return{className:"sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter"}}},getRootSwimlaneSymbol:function(oSymbol){var oParentSymbol=oSymbol,oRootSwimlane;while(oParentSymbol){if(oParentSymbol.isSwimlaneSymbol){oRootSwimlane=oParentSymbol}oParentSymbol=oParentSymbol.parentSymbol}return oRootSwimlane}}},BoundarySymbol:{displayName:"Boundary Symbol",parent:"Symbol",properties:{"BoundarySymbol.isBoundarySymbol":{name:"isBoundarySymbol",defaultValue:true,isInternal:true},"BoundarySymbol.isAdjustToContent":{name:"isAdjustToContent",defaultValue:false},"BoundarySymbol.isKeepSize":{name:"isKeepSize",defaultValue:true},offsetX:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},offsetY:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0}}},TableSymbol:{displayName:"Table Symbol",parent:"CompositeSymbol",properties:{isTableSymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true},"TableSymbol.supportExpandAndCollapse":{name:"supportExpandAndCollapse",defaultValue:true},"TableSymbol.hasRowSymbols":{name:"hasRowSymbols",get:function(){var index,max,oSymbol;if(this.symbols){for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")){return true}}}return false}},"TableSymbol.isNeedLayoutRows":{name:"isNeedLayoutRows",isInternal:true,defaultValue:false}},methods:{createContent:function(){if(this.shape){this.shape.createContent();this.createRowSymbols();this.layoutRowSymbols(this.isAdjustToContent?undefined:this.width,this.isAdjustToContent?undefined:this.height)}return this.shape},updateContent:function(){if(this.shape){this.shape.updateContent();this.updateRowSymbols();this.layoutRowSymbols(this.isAdjustToContent?undefined:this.width,this.isAdjustToContent?undefined:this.height)}return this.shape},defaultOnPreDrawSymbol:function(oViewer,oTransitionDef){if(this.isNeedLayoutRows||this._needLayoutRowSymbols()){this._oldBBox=this.getBBox();this.layoutRowSymbols(this.width,this.height,!this.isNeedLayoutRows)}},onPreDrawSymbol:function(oViewer,oTransitionDef){this.defaultOnPreDrawSymbol(oViewer,oTransitionDef)},defaultOnPostDrawSymbol:function(oViewer,oTransitionDef){var self=this,oOldBBox;if(this.isNeedLayoutRows){this.resource.applyUndoableAction(function(){oOldBBox=self._oldBBox||self.getBBox();self.updateLinkSymbolRoutings(oOldBBox,self.getBBox(),true,false,oViewer,oTransitionDef);self.isNeedLayoutRows=false;delete self._oldBBox},"Post draw symbol",true)}},onPostDrawSymbol:function(oViewer,oTransitionDef){this.defaultOnPostDrawSymbol(oViewer,oTransitionDef)},expand:function(oViewer,oTransitionDef){var self=this;function expandSymbol(){var oOldBBox=self.getBBox(),index,max,oSymbol;self.isNeedUpdateSymbol=false;self.isExpanded=true;self.isNeedUpdateSymbol=true;self.createRowSymbols();self.updateSymbol();self.adjustLinkSymbols();if(oViewer){self.drawSymbol(oViewer,oTransitionDef);self.updateLinkSymbolRoutings(oOldBBox,self.getBBox(),true,false,oViewer,oTransitionDef);self.drawLinkSymbols(oViewer,oTransitionDef);max=self.symbols.length;if(max>=10){oTransitionDef=undefined}for(index=0;index<max;index++){oSymbol=self.symbols.get(index);if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")){oSymbol.drawLinkSymbols(oViewer,oTransitionDef)}}}}if(!this.isExpanded){this.resource.applyUndoableAction(expandSymbol,"Expand symbol",true)}},collapse:function(oViewer,oTransitionDef){var self=this;function collapseSymbol(){var oContentBBox=self.getContentAreaBBox(true),oOldBBox=self.getBBox();self.isNeedUpdateSymbol=false;self.isExpanded=false;self.isNeedUpdateSymbol=true;self.adjustLinkSymbols();self.removeRowSymbols();self.height=oContentBBox.y;if(oViewer){self.drawSymbol(oViewer,oTransitionDef);self.updateLinkSymbolRoutings(oOldBBox,self.getBBox(),true,false,oViewer,oTransitionDef);self.drawLinkSymbols(oViewer,oTransitionDef)}}if(this.isExpanded){this.resource.applyUndoableAction(collapseSymbol,"Collapse symbol",true,true)}},adjustLinkSymbols:function(){var index,max,index2,max2,oSymbol,aLinkSymbols,oLinkSymbol;if(this.isExpanded){aLinkSymbols=this.getLinkSymbols();if(aLinkSymbols){for(index2=0,max2=aLinkSymbols.length;index2<max2;index2++){oLinkSymbol=aLinkSymbols[index2];if(oLinkSymbol.sourceSymbol===this){for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")&&oLinkSymbol.object&&oSymbol.object===oLinkSymbol.object.source){oLinkSymbol.sourceSymbol=oSymbol;oLinkSymbol.updateSymbol();oLinkSymbol.updateLinkRouting();oLinkSymbol.updateLinkSymbolRoutings();break}}}if(oLinkSymbol.targetSymbol===this){for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")&&oLinkSymbol.object&&oSymbol.object===oLinkSymbol.object.target){oLinkSymbol.targetSymbol=oSymbol;oLinkSymbol.updateSymbol();oLinkSymbol.updateLinkRouting();oLinkSymbol.updateLinkSymbolRoutings();break}}}}}}else{for(index=0;index<this.symbols.length;index++){oSymbol=this.symbols.get(index);if(oSymbol instanceof sap.galilei.ui.diagram.RowSymbol){aLinkSymbols=oSymbol.getLinkSymbols();if(aLinkSymbols){for(index2=0;index2<aLinkSymbols.length;index2++){oLinkSymbol=aLinkSymbols[index2];if(oLinkSymbol.sourceSymbol===oSymbol){oLinkSymbol.sourceSymbol=this;oLinkSymbol.updateSymbol();oLinkSymbol.updateLinkRouting();oLinkSymbol.updateLinkSymbolRoutings()}if(oLinkSymbol.targetSymbol===oSymbol){oLinkSymbol.targetSymbol=this;oLinkSymbol.updateSymbol();oLinkSymbol.updateLinkRouting();oLinkSymbol.updateLinkSymbolRoutings()}}}}}}},updateLinkSymbolRoutings:function(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef){this.defaultUpdateLinkSymbolRoutings(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef);this.updateRowLinkSymbolRoutings(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef)},updateRowLinkSymbolRoutings:function(oOldBBox,oNewBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef){var index,max,oRowSymbol,oBBox;for(index=0,max=this.symbols.length;index<max;index++){oRowSymbol=this.symbols.get(index);if(sap.galilei.model.isInstanceOf(oRowSymbol,"sap.galilei.ui.diagram.RowSymbol")){oBBox=oRowSymbol.getBBox();oRowSymbol.updateLinkSymbolRoutings(oBBox,oBBox,bIsAutomaticRouting,bPreserveAttachPoints,oViewer,oTransitionDef)}}},createRowSymbol:function(oObject,sRowSymbolClass,vLayoutTemplate,index){var oRowSymbol,height,oEvent;if(oObject&&vLayoutTemplate){height=this._getItemsHeight(vLayoutTemplate.contentShape);oRowSymbol=sap.galilei.model.createNewInstance(sRowSymbolClass,this.resource,{object:oObject,layoutTemplate:vLayoutTemplate,height:height});if(oRowSymbol){if(index===undefined||index<0||index>this.symbols.length){this.symbols.push(oRowSymbol)}else{this.symbols.insert(index,oRowSymbol)}oRowSymbol.getOrCreateShape();oEvent={sourceSymbol:oRowSymbol};sap.galilei.core.Event.publish("register.symbol",this,undefined,oEvent)}else{throw"The symbol "+sRowSymbolClass+" is not defined."}}return oRowSymbol},getRowSymbolLayoutTemplate:function(){var oItems,oOptions,oContentBBox,width;if(!this._rowSymbolLayoutTemplate){oItems=this.runtimeClass.layoutTemplate&&this.runtimeClass.layoutTemplate.items;if(oItems&&oItems.template){oOptions=this._getItemsLayoutOptions(oItems);oContentBBox=this.getContentAreaBBox(true);width=(oContentBBox?oContentBBox.width:this.width)-oOptions.paddingLeft-oOptions.paddingRight;this._rowSymbolLayoutTemplate={mainShape:{shape:"RoundedRectangle",domClass:"rowSymbol",cx:2,cy:2,stroke:"none",strokeWidth:0,fill:"white",opacity:0,width:width,height:oOptions.rowHeight,margin:0,padding:0},contentShape:oItems.template}}}return this._rowSymbolLayoutTemplate},_onAggregationChanged:function(oEventArgs){var self=this,oTable=oEventArgs.instance,oTableSymbol,oRowObject,aSymbols,index,max,oSymbol,oRowSymbol,nPosition,oItems,sRowSymbolClass,oLayoutTemplate,bUpdateSymbol=false,oEvent;function createRowSymbolAction(){oItems=self.runtimeClass.layoutTemplate&&self.runtimeClass.layoutTemplate.items;if(oItems===undefined||oItems.path===undefined){return}oLayoutTemplate=self.getRowSymbolLayoutTemplate();sRowSymbolClass=oItems.rowSymbolClass||"sap.galilei.ui.diagram.RowSymbol";if(oRowObject&&sRowSymbolClass&&oLayoutTemplate){if(oRowObject.relatedSymbols.length===0){oRowSymbol=self.createRowSymbol(oRowObject,sRowSymbolClass,oLayoutTemplate,nPosition)}else{oRowSymbol=oRowObject.relatedSymbols.get(0)}}}function detachRowSymbolAction(){if(oRowObject===undefined&&!isNaN(nPosition)){oTableSymbol=oTable&&oTable.relatedSymbols&&oTable.relatedSymbols.get(0);if(oTableSymbol!==undefined&&nPosition<oTableSymbol.symbols.length){oRowSymbol=oTableSymbol.symbols.get(nPosition);oRowSymbol.deleteSymbol(false,false)}}if(oRowObject&&oRowObject.relatedSymbols&&oRowObject.relatedSymbols.length>0){oRowSymbol=oRowObject.relatedSymbols.get(0);oRowSymbol.object=undefined;oRowSymbol.deleteSymbol(false,false)}}if(oTable&&!oTable.isDeleting&&oTable.resource&&!oTable.resource.isLoading){aSymbols=oTable.relatedSymbols;if(aSymbols&&aSymbols.length>0){for(index=0,max=aSymbols.length;index<max;index++){bUpdateSymbol=false;oSymbol=aSymbols.get(index);oRowSymbol=undefined;if(!oSymbol.isDeleting){switch(oEventArgs.eventType){case"referenceAdd":oRowObject=oEventArgs.newObject;nPosition=oEventArgs.index;oSymbol.resource.applyUndoableAction(createRowSymbolAction,"Create row symbol",true);bUpdateSymbol=true;break;case"referenceRemove":oRowObject=oEventArgs.oldObject;nPosition=oEventArgs.index;oSymbol.resource.applyUndoableAction(detachRowSymbolAction,"Detach row symbol",true);bUpdateSymbol=true;break}if(bUpdateSymbol){oSymbol.isNeedLayoutRows=true;oEvent={sourceSymbol:oSymbol};sap.galilei.core.Event.publish("update.symbol",this,undefined,oEvent);oSymbol.isNeedLayoutRows=false}}}}}},createRowSymbols:function(){var self=this,oItems,oObjects,oObject,oLayoutTemplate,sRowSymbolClass,sReferenceName,index,max,nMaxRows=50,oRowSymbol;function createSymbols(){oItems=self.runtimeClass.layoutTemplate&&self.runtimeClass.layoutTemplate.items;oLayoutTemplate=self.getRowSymbolLayoutTemplate();if(oItems&&oItems.path&&oLayoutTemplate){sRowSymbolClass=oItems.rowSymbolClass||"sap.galilei.ui.diagram.RowSymbol";index=oItems.path.lastIndexOf("/");if(index!==-1){sReferenceName=oItems.path.substring(index+1)}oObjects=sap.galilei.core.getValueFromQualifiedPath(self,oItems.path);if(oObjects){max=oObjects.length;if(!isNaN(nMaxRows)&&max>nMaxRows){max=nMaxRows}for(index=0;index<max;index++){oObject=oObjects.get(index);oRowSymbol=self.createRowSymbol(oObject,sRowSymbolClass,oLayoutTemplate,index)}if(self.object&&!self.__onAggregationChangedProxy){self.__onAggregationChangedProxy=jQuery.proxy(self._onAggregationChanged,self);self.object.addReferenceListener({onReferenceChanged:self.__onAggregationChangedProxy},sReferenceName)}}}}if(!this.hasRowSymbols){this.resource.applyUndoableAction(createSymbols,"Create row symbols",true)}},updateRowSymbols:function(){},removeRowSymbols:function(){var index,max,oSymbol;for(max=this.symbols.length,index=max-1;index>=0;index--){oSymbol=this.symbols.get(index);if(sap.galilei.model.isInstanceOf(oSymbol,"sap.galilei.ui.diagram.RowSymbol")){oSymbol.deleteSymbol()}}},_getItemsLayoutOptions:function(oItems){var oOptions={};if(oItems){oOptions.paddingLeft=oItems.paddingLeft;oOptions.paddingTop=oItems.paddingTop;oOptions.paddingRight=oItems.paddingRight;oOptions.paddingBottom=oItems.paddingBottom;oOptions.rowMarginLeft=oItems.marginLeft;oOptions.rowMarginTop=oItems.marginTop;oOptions.rowMarginRight=oItems.marginRight;oOptions.rowMarginBottom=oItems.marginBottom;oOptions.columnInnerPadding=oItems.columnPadding;oOptions.rowInnerPadding=oItems.rowPadding;oOptions.rowHeight=this._getItemsHeight(oItems.template)}oOptions=sap.galilei.ui.common.shape.Table.checkLayoutOptions(oOptions);return oOptions},_getItemsHeight:function(oTemplate){var index,max,oItem,height=0,fontHeight;if(oTemplate instanceof Array){for(index=0,max=oTemplate.length;index<max;index++){oItem=oTemplate[index];if(!isNaN(oItem.height)){height=Math.max(height,+oItem.height)}else{if(oItem.font){fontHeight=sap.galilei.ui.common.Font.getFontHeight(oItem.font);if(!isNaN(fontHeight)){height=Math.max(height,fontHeight)}}}}}if(height===0){height=14}return height},_needLayoutRowSymbols:function(){var oItems,oOptions,oContentBBox,top,bottom,y,index,max,oRowSymbol,oRowShape;oItems=this.runtimeClass.layoutTemplate&&this.runtimeClass.layoutTemplate.items;oOptions=this._getItemsLayoutOptions(oItems);oContentBBox=this.getContentAreaBBox(true);top=this.y+oOptions.paddingTop+oOptions.rowMarginTop;if(oContentBBox){top+=oContentBBox.y}bottom=top;for(index=0,max=this.symbols.length;index<max;index++){oRowSymbol=this.symbols.get(index);if(oRowSymbol.isRowSymbol&&oRowSymbol.shape!==undefined){oRowShape=oRowSymbol.shape;if(Math.abs(oRowShape.x-this.x)>0.5||Math.abs(oRowShape.width-this.width)>0.5){return true}if(index===0&&Math.abs(oRowShape.y-top)>0.5){return true}y=oRowShape.y+oRowShape.height;if(oRowShape.y>=top&&oRowShape.y<=bottom&&y>=top&&y<=bottom){return true}bottom=Math.max(bottom,y)}}return false},layoutRowSymbols:function(nMaxWidth,nMaxHeight,bIsProtectedFromUndo){var self=this,oItems,oOptions,aColumns,aRowShapes=[],oRowShape,oSize,x,y,nRowWidth,nRowHeight,nTableWidth,oBBox=new sap.galilei.ui.common.Rect(),oContentInfo,oContentBBox,oCurrentBBox,index,max,bHasColumns=false,nMaxRows=50,oRowSymbol;function layoutRowSymbolsAction(){oItems=self.runtimeClass.layoutTemplate&&self.runtimeClass.layoutTemplate.items;oOptions=self._getItemsLayoutOptions(oItems);oContentInfo=self.getContentAreaInfo(true);oContentBBox=oContentInfo.contentBBox;if(!isNaN(nMaxWidth)){nRowWidth=nMaxWidth;if(oContentInfo!==undefined){nRowWidth-=oContentInfo.paddingLeft+oContentInfo.paddingRight}}else{nRowWidth=oContentBBox.width}if(oItems&&oItems.template&&oItems.template.length>0){if(self.isExpanded){aColumns=oItems.template;for(index=0,max=self.symbols.length;index<max;index++){oRowSymbol=self.symbols.get(index);if(oRowSymbol.isRowSymbol){oRowShape=oRowSymbol.getOrCreateShape();if(oRowShape){aRowShapes.push(oRowShape)}}}oSize=sap.galilei.ui.common.shape.Table.computeSize(aColumns,aRowShapes,oOptions);sap.galilei.ui.common.shape.Table.layoutRows(oSize,0,aColumns,aRowShapes,oOptions);if(isNaN(nRowWidth)||nRowWidth<oSize.width){nRowWidth=oSize.width}}}if(isNaN(nRowWidth)){nRowWidth=nTableWidth=self.width}else{bHasColumns=true;nTableWidth=nRowWidth;if(oContentInfo!==undefined){nTableWidth+=oContentInfo.paddingLeft+oContentInfo.paddingRight}}nTableWidth=!isNaN(self.minWidth)&&self.minWidth!==0&&nTableWidth<self.minWidth?self.minWidth:nTableWidth;nTableWidth=!isNaN(self.maxWidth)&&self.maxWidth!==0&&nTableWidth>self.maxWidth?self.maxWidth:nTableWidth;nRowWidth=nTableWidth;if(bHasColumns&&oContentInfo!==undefined){nRowWidth-=oContentInfo.paddingLeft+oContentInfo.paddingRight}nRowHeight=oContentBBox.y;if(self.isExpanded){x=self.x;if(oContentBBox){x+=oContentBBox.x}y=self.y+oOptions.paddingTop+oOptions.rowMarginTop;if(oContentBBox){y+=oContentBBox.y}nRowHeight+=oOptions.paddingTop+oOptions.rowMarginTop;if(bHasColumns&&oContentInfo!==undefined){y+=oContentInfo.paddingTop;nRowHeight+=oContentInfo.paddingTop}for(index=0,max=self.symbols.length;index<max;index++){oRowSymbol=self.symbols.get(index);if(oRowSymbol.isRowSymbol){if(!isNaN(nMaxRows)&&index>=nMaxRows){oRowSymbol.hide();continue}oCurrentBBox=oRowSymbol.getBBox();oBBox.x=x;oBBox.y=y;oBBox.width=nRowWidth;oBBox.height=oCurrentBBox.height;oRowSymbol.setBBox(oBBox);y+=oCurrentBBox.height+oOptions.rowInnerPadding;nRowHeight+=oCurrentBBox.height;if(index!==max-1){nRowHeight+=oOptions.rowInnerPadding}}}nRowHeight+=oOptions.paddingBottom+oOptions.rowMarginBottom;if(bHasColumns&&oContentInfo!==undefined){nRowHeight+=oContentInfo.paddingBottom}}}function resizeTableSymbol(){if(!isNaN(nTableWidth)&&nTableWidth!==self.width){self.width=nTableWidth}if(!isNaN(nRowHeight)){nRowHeight=!isNaN(self.minHeight)&&self.minHeight!==0&&nRowHeight<self.minHeight?self.minHeight:nRowHeight;nRowHeight=!isNaN(self.maxHeight)&&self.maxHeight!==0&&nRowHeight>self.maxHeight?self.maxHeight:nRowHeight;if(self.height!==nRowHeight){self.height=nRowHeight}}}this.resource.applyUndoableAction(layoutRowSymbolsAction,"Layout row symbols",true);bIsProtectedFromUndo=(bIsProtectedFromUndo===undefined)?false:bIsProtectedFromUndo;this.resource.applyUndoableAction(resizeTableSymbol,"Layout table symbol",bIsProtectedFromUndo)},resize:function(width,height,options,oViewer,oTransitionDef){var oOldBBox=this.getBBox();height=this.height;this.layoutRowSymbols(width,height);width=this.width;height=this.height;this.defaultResize(width,height,options,oViewer,oTransitionDef);this.moveBy(0,0,options,oViewer,oTransitionDef);this.updateLinkSymbolRoutings(oOldBBox,this.getBBox(),true,false,oViewer,oTransitionDef);this.drawLinkSymbols(oViewer,oTransitionDef)},extendToContent:function(options,edgeOption,oViewer,oTransitionDef){var oOldBBox=this.getBBox();this.layoutRowSymbols(this.width,this.height);this.updateShape();this.defaultExtendToContent(options,edgeOption,oViewer,oTransitionDef);this.moveBy(0,0,options,oViewer,oTransitionDef);this.updateLinkSymbolRoutings(oOldBBox,this.getBBox(),true,false,oViewer,oTransitionDef);this.drawLinkSymbols(oViewer,oTransitionDef)},adjustToContent:function(oViewer,oTransitionDef){}}},RowSymbol:{displayName:"Row Symbol",parent:"Symbol",properties:{isRowSymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true},"RowSymbol.isKeepSize":{name:"isKeepSize",displayName:"Keep Size",defaultValue:true},"RowSymbol.isKeepPosition":{name:"isKeepPosition",displayName:"Keep Position",defaultValue:true},"RowSymbol.isAdjustToContent":{name:"isAdjustToContent",displayName:"Adjust To Content",defaultValue:false},"RowSymbol.isInternal":{name:"isInternal",displayName:"Internal Value",defaultValue:true,isVolatile:true,isInternal:true},"RowSymbol.symbolLayouter":{name:"symbolLayouter",get:function(){return{className:"sap.galilei.ui.editor.layout.OrderedStackLayout",orientation:"vertical"}}}},references:{"RowSymbol.object":{contentType:"sap.galilei.model.Object",isMany:false,isVolatile:true,isInternal:true},},methods:{getLayoutTemplate:function(bShared){var vLayoutTemplate;if(!bShared){vLayoutTemplate=this.layoutTemplate}else{vLayoutTemplate=this.runtimeClass.layoutTemplate}if(!vLayoutTemplate&&this.parentSymbol){vLayoutTemplate=this.parentSymbol.getRowSymbolLayoutTemplate()}return vLayoutTemplate},updateSymbol:function(oViewer,oTransitionDef,bPublish){var oTableSymbol=this.parentSymbol;if(this.isNeedUpdateSymbol!==false){this.defaultUpdateSymbol(oViewer,oTransitionDef,bPublish);oTableSymbol.updateSymbol(oViewer,oTransitionDef,bPublish)}}},statics:{parentSymbolHighlighter:{get:function(){return{className:"sap.galilei.ui.editor.tracker.StackSymbolHighlighter",orientation:"vertical",offsetY:2,snapToShapes:false}}}}},PackageSymbol:{displayName:"Package Symbol",parent:"Symbol",properties:{"PackageSymbol.isAdjustToContent":{name:"isAdjustToContent",defaultValue:false},"PackageSymbol.minWidth":{name:"minWidth",defaultValue:64},"PackageSymbol.minHeight":{name:"minHeight",defaultValue:52}},statics:{layoutTemplate:{mainShape:{shape:"Package",domClass:"package",stroke:"#997C35",strokeWidth:1,fill:"#FFFFD6",width:100,height:80},contentShape:{shape:"Stack",horizontalAlignment:"width",verticalAlignment:"height",padding:4,innerPadding:0,shapes:{shape:"Text",domClass:"packageName",text:"{object/displayName}",font:"12px Arial, Helvetica, sans-serif",fill:"black",horizontalAlignment:"width",verticalAlignment:"height",isWordWrap:true,isEllipsis:true}}}}},Diagram:{displayName:"Diagram",onDelete:function(oEvent){oEvent.diagram=this;sap.galilei.core.Event.publish("delete.diagram",this,undefined,oEvent);this.dispose()},properties:{name:{dataType:sap.galilei.model.dataTypes.gString},isDiagram:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true}},references:{model:{contentType:"sap.galilei.model.Object",reverseReference:"sap.galilei.common.Model.diagrams",isMany:false},"Diagram.symbols":{name:"symbols",contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,isContainment:true,onCascadeChange:function(oEventArgs){var oObject=oEventArgs.newObject,sChangeType=oEventArgs.eventType;if(!this.resource.isLoading){if(sChangeType==="referenceAdd"){if(oObject&&oObject.updateLinkSymbolOwners){oObject.updateLinkSymbolOwners()}}}}}},methods:{defaultDispose:function(){var index,oSymbol;if(this.symbols){for(index=0;index<this.symbols.length;index++){oSymbol=this.symbols.get(index);oSymbol.dispose(true)}}},dispose:function(){this.defaultDispose()},getOwner:function(){return null},getAllSymbols:function(fnFilter){var aSymbols=[],index,max,oSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(fnFilter===undefined||fnFilter.call(undefined,oSymbol)===true){aSymbols.push(oSymbol)}if(oSymbol.isComposite){oSymbol._getAllSymbols(oSymbol.symbols,aSymbols,fnFilter)}}return aSymbols},_getDisplayedObjectsMap:function(oSymbols,oObjectsMap,fnFilter){var oSymbol,oObject,index,max;if(oSymbols&&oObjectsMap){for(index=0,max=oSymbols.length;index<max;index++){oSymbol=oSymbols.get(index);oObject=oSymbol.object;if(oObject&&oObject.objectId&&(fnFilter===undefined||fnFilter.call(undefined,oObject)===true)){oObjectsMap[oObject.objectId]=oObject}if(oSymbol.isComposite){this._getDisplayedObjectsMap(oSymbol.symbols,oObjectsMap,fnFilter)}}}},getDisplayedObjects:function(fnFilter){var aObjects=[],oObjectsMap={},sId,aNames,i,l,oCurrObject;this._getDisplayedObjectsMap(this.symbols,oObjectsMap);aNames=Object.getOwnPropertyNames(oObjectsMap);l=aNames.length;for(i=0;i<l;i++){sId=aNames[i];oCurrObject=oObjectsMap[sId];aObjects.push(oCurrObject)}return aObjects}}}}}}})}());
(function(){sap.galilei.model.loadMetamodels();sap.galilei.model.metamodelExtension("Galilei.Core.SymbolExtension",{contents:{Object:{name:"Object",properties:{onObjectBeforeDelete:{name:"onBeforeDelete",displayName:"On Before Delete",classDefinition:"sap.galilei.model.Property",isVolatile:true,isInternal:true,defaultValue:function(){var oRelatedSymbolsCollection=this.relatedSymbols,nSymbolsCount=oRelatedSymbolsCollection!==undefined?oRelatedSymbolsCollection.length:0,nSymbolIndex,oCurrentSymbol;for(nSymbolIndex=nSymbolsCount-1;nSymbolIndex>=0;nSymbolIndex--){oCurrentSymbol=oRelatedSymbolsCollection.get(nSymbolIndex);if(oCurrentSymbol&&oCurrentSymbol.deleteSymbol){if(oCurrentSymbol.isInternal){this.resource.applyUndoableAction(function(){oCurrentSymbol.deleteSymbol(false,true)},"Delete Internal Symbol",true)}else{oCurrentSymbol.deleteSymbol(false,true)}}}}}},references:{relatedSymbols:{name:"relatedSymbols",contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,reverseReference:"sap.galilei.ui.diagram.Symbol.object"}},methods:{onBeforeDetach:function(oParentObject,sReferenceName){var oParentRelatedSymbols,oRelatedSymbols,nSymbolsCount,nSymbolIndex,oSymbol;function isSubSymbol(oParentRelatedSymbols,oSymbol){var nParentSymbolsCount=oParentRelatedSymbols!==undefined?oParentRelatedSymbols.length:0,index,oParentSymbol;if(oParentRelatedSymbols&&oSymbol){for(index=0;index<nParentSymbolsCount;index++){oParentSymbol=oParentRelatedSymbols.get(index);if(oParentSymbol&&oSymbol.parentSymbol===oParentSymbol){return true}}}return false}if(oParentObject&&sReferenceName){oParentRelatedSymbols=oParentObject.relatedSymbols;if(oParentRelatedSymbols){oRelatedSymbols=this.relatedSymbols;nSymbolsCount=oRelatedSymbols!==undefined?oRelatedSymbols.length:0;for(nSymbolIndex=nSymbolsCount-1;nSymbolIndex>=0;nSymbolIndex--){oSymbol=oRelatedSymbols.get(nSymbolIndex);if(oSymbol&&isSubSymbol(oParentRelatedSymbols,oSymbol)&&oSymbol.deleteSymbol){oSymbol.deleteSymbol(false)}}}}}}}}});sap.galilei.model.loadMetamodelExtension("Galilei.Core.SymbolExtension",sap.galilei.model.internal.galileiM3Resource)}());
namespace("sap.galilei.ui.symbol.binding");
"use strict";sap.galilei.ui.symbol.binding.AggregationBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.AggregationBinding,fullClassName:"sap.galilei.ui.symbol.binding.AggregationBinding",properties:{symbol:undefined,objectContext:{field:"_objectContext",get:function(){if(this._objectContext){return this._objectContext}return this.symbol},set:function(oObjectContext){this._objectContext=oObjectContext}}}});
"use strict";sap.galilei.ui.symbol.binding.PropertyBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.PropertyBinding,fullClassName:"sap.galilei.ui.symbol.binding.PropertyBinding",properties:{symbol:undefined,objectContext:{field:"_objectContext",get:function(){if(this._objectContext){return this._objectContext}return this.symbol},set:function(oObjectContext){this._objectContext=oObjectContext}},oldValue:undefined},methods:{getObjectProperty:function(){var aParts,oObject,index,sPath,sBindingPath,bRelative=true,oFormatters,oFormatter,oFormatterContext,vValue,sValue;if(this.objectContext&&(this.path||this.formatter)){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>1){for(index=0;index<aParts.length-1;index++){sPath=aParts[index];oObject=oObject[sPath];if(!oObject){break}}if(oObject){sBindingPath=aParts[aParts.length-1]}else{return undefined}}oFormatter=this.formatter;if(oFormatter&&this.symbol){oFormatterContext=this.symbol;oFormatters=this.symbol.formatters||(this.symbol.runtimeClass&&this.symbol.runtimeClass.formatters);if((typeof oFormatter==="string")&&oFormatters){oFormatter=oFormatters[oFormatter]}vValue=oObject&&sBindingPath&&oObject[sBindingPath];if(typeof oFormatter==="function"){return oFormatter.call(oFormatterContext,vValue,oObject,this.symbol)}else{if((typeof oFormatter==="object")&&sBindingPath){if(vValue){sValue=vValue.toString();if(oFormatter.hasOwnProperty(sValue)){return oFormatter[sValue]}}if(oFormatter.hasOwnProperty("DEFAULT")){return oFormatter.DEFAULT}return undefined}}}else{if(oObject&&sBindingPath){if(!oObject.isSymbol&&typeof(oObject.getFormattedValue)==="function"){return oObject.getFormattedValue(sBindingPath)}else{return oObject[sBindingPath]}}}}return undefined},registerPropertyChangedListener:function(){var oBinding=this,aParts,oObject,index,sPath,bRelative=true,sBindingPath;if(this.objectContext&&this.path){oObject=this.objectContext;sBindingPath=this.path;this.oldValue=this.getObjectProperty();if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>=1){for(index=0;index<aParts.length;index++){sPath=aParts[index];if(oObject instanceof sap.galilei.model.Object){oObject.addPropertyListener({onPropertyChanged:this.onPropertyChanged,optionalArguments:{binding:this}},sPath)}if(index<aParts.length-1){oObject=oObject[sPath];if(!oObject){break}}}}}},unregisterPropertyChangedListener:function(){var aParts,oObject,index,sPath,bRelative=true,sBindingPath;if(this.objectContext&&this.path&&this.onPropertyChanged){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>=1){for(index=0;index<aParts.length;index++){sPath=aParts[index];if(oObject instanceof sap.galilei.model.Object){oObject.removePropertyListener({onPropertyChanged:this.onPropertyChanged},sPath)}if(index<aParts.length-1){oObject=oObject[sPath];if(!oObject){break}}}}}},onPropertyChanged:function(oEventArgs){var oBinding,vOldValue,vNewValue,nsPropertyBinding=sap.galilei.ui.symbol.binding.PropertyBinding;if(oEventArgs){oBinding=oEventArgs.binding;if(oBinding&&oBinding.objectContext){if(oBinding.symbol&&oBinding.symbol.shape){if(oBinding.shape&&oBinding.propertyName){vOldValue=oBinding.oldValue;vNewValue=oBinding.getObjectProperty();if(vNewValue!=vOldValue||(oEventArgs.oldValue!=oEventArgs.newValue&&oEventArgs.propertyName!==oBinding.propertyName&&oBinding.symbol.shape.isDrawn&&nsPropertyBinding._canUpdateSymbol(oBinding))){oBinding.setTargetProperty(vNewValue);oBinding.oldValue=vNewValue;if(!sap.galilei.model.isInUndoRedo()){oBinding.symbol.updateSymbol(undefined,undefined,true)}else{oBinding.symbol.updateLayout(false)}}}}}}},dispose:function(){this.unregisterPropertyChangedListener();this.removeBinding()}},statics:{_updateSymbolsMap:undefined,_canUpdateSymbol:function(oBinding){var oMap=sap.galilei.ui.symbol.binding.PropertyBinding._updateSymbolsMap||{},oSymbolInfo=oBinding&&oMap[oBinding.symbol.objectId],oShapeInfo,nTimestamp,nTimestampNow=Date.now(),aKeys,index,max,sKey;if(!oBinding){return false}if(oSymbolInfo){oShapeInfo=oSymbolInfo[oBinding.shape.shapeId];if(oShapeInfo){nTimestamp=oShapeInfo[oBinding.propertyName];if(nTimestamp!==undefined){if(nTimestampNow-nTimestamp<200){return false}}}}if(!oSymbolInfo){oSymbolInfo=oMap[oBinding.symbol.objectId]={}}if(!oShapeInfo){oShapeInfo=oSymbolInfo[oBinding.shape.shapeId]={}}oShapeInfo[oBinding.propertyName]=nTimestampNow;oSymbolInfo._=nTimestampNow;aKeys=Object.keys(oMap);for(index=0,max=aKeys.length;index<max;index++){sKey=aKeys[index];oSymbolInfo=oMap[sKey];if(nTimestampNow-oSymbolInfo._>60000){delete oMap[sKey]}}sap.galilei.ui.symbol.binding.PropertyBinding._updateSymbolsMap=oMap;return true}}});
"use strict";sap.galilei.ui.symbol.SymbolLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.SymbolLayout",fields:{_symbol:undefined,_object:undefined},properties:{displayMode:sap.galilei.ui.common.ShapeLayoutModes.detail,zoomScale:undefined,minimumZoomScale:undefined,maximumZoomScale:undefined,mainShape:undefined,contentShape:undefined,objectContext:{get:function(){return this._object}}},methods:{createShape:function(oSymbol){var oGroupShape,oMainShape,oContentShape,layoutRect=new sap.galilei.ui.common.Rect(),width,height;this._symbol=oSymbol;this._object=oSymbol;oGroupShape=new sap.galilei.ui.common.shape.ContentGroup({domClass:"sapGalileiSymbolNode"});if(oSymbol){oGroupShape.id=oSymbol.objectId;oGroupShape.displayMode=oSymbol.displayMode;oGroupShape.isAdjustToContent=oSymbol.isAdjustToContent;oGroupShape.zindex=oSymbol.getShapeZIndex();oGroupShape.focusable=true;oGroupShape.tabindex="1";oGroupShape.ariaLabel=oSymbol.ariaLabel;oGroupShape.role=oSymbol.role;if(oSymbol.tooltip){oGroupShape.bindProperty("tooltip","{tooltip}",oSymbol)}if(oSymbol.automationId){oGroupShape.bindProperty("automationId","{automationId}",oSymbol)}if(oSymbol.ariaLabel){oGroupShape.bindProperty("ariaLabel","{ariaLabel}",oSymbol)}if(oSymbol.role){oGroupShape.bindProperty("role","{role}",oSymbol)}}else{oGroupShape.displayMode=this.displayMode;oGroupShape.isAdjustToContent=false}if(this.mainShape){oMainShape=this.replaceBinding(this.mainShape);if(oMainShape){oGroupShape.shapes.add(oMainShape);oGroupShape.mainShape=oMainShape}}if(this.contentShape){oContentShape=this.replaceBinding(this.contentShape);if(oContentShape){oGroupShape.shapes.add(oContentShape);oGroupShape.contentShape=oContentShape}}layoutRect.x=0;layoutRect.y=0;if(oSymbol&&oSymbol.width!==undefined&&oSymbol.width!==0){layoutRect.width=oSymbol.width}else{layoutRect.width=oGroupShape.boundaryShape.width}if(oSymbol&&oSymbol.height!==undefined&&oSymbol.height!==0){layoutRect.height=oSymbol.height}else{layoutRect.height=oGroupShape.boundaryShape.height}layoutRect=oGroupShape.layout(layoutRect,false);width=layoutRect.width;height=layoutRect.height;if(oSymbol&&oSymbol.width!==undefined&&oSymbol.width!==0){width=oSymbol.width}if(oSymbol&&oSymbol.height!==undefined&&oSymbol.height!==0){height=oSymbol.height}layoutRect.width=width;layoutRect.height=height;layoutRect=oGroupShape.layout(layoutRect,true);if(oSymbol&&oSymbol.x!==undefined&&oSymbol.y!==undefined&&(oSymbol.x!==0||oSymbol.y!==0)){oGroupShape.x=oSymbol.x;oGroupShape.y=oSymbol.y}if(oSymbol&&(oSymbol.width===undefined||oSymbol.width===0||oSymbol.height===undefined||oSymbol.height===0)){width=layoutRect.width;height=layoutRect.height;width=!isNaN(oSymbol.minWidth)&&oSymbol.minWidth!==0&&width<oSymbol.minWidth?oSymbol.minWidth:width;width=!isNaN(oSymbol.maxWidth)&&oSymbol.maxWidth!==0&&width>oSymbol.maxWidth?oSymbol.maxWidth:width;height=!isNaN(oSymbol.minHeight)&&oSymbol.minHeight!==0&&height<oSymbol.minHeight?oSymbol.minHeight:height;height=!isNaN(oSymbol.maxHeight)&&oSymbol.maxHeight!==0&&height>oSymbol.maxHeight?oSymbol.maxHeight:height;oSymbol.width=width;oSymbol.height=height}this._symbol=undefined;this._object=undefined;return oGroupShape},layoutShape:function(oSymbol,oShape,nNewWidth,nNewHeight,bKeepAspectRatio,bKeepCenter,bCanChangeSymbol){var bSymbolChanged=false,layoutRect,dx=0,dy=0;if(oSymbol&&oShape&&nNewWidth!==undefined&&nNewHeight!==undefined){layoutRect=new sap.galilei.ui.common.Rect();bKeepAspectRatio=bKeepAspectRatio===undefined?oSymbol.isKeepAspectRatio:bKeepAspectRatio;bKeepCenter=bKeepCenter===undefined?oSymbol.isKeepCenter:bKeepCenter;bCanChangeSymbol=bCanChangeSymbol===undefined?true:bCanChangeSymbol;layoutRect.x=0;layoutRect.y=0;layoutRect.width=oSymbol.width;layoutRect.height=oSymbol.height;nNewWidth=!isNaN(oSymbol.minWidth)&&oSymbol.minWidth!==0&&nNewWidth<oSymbol.minWidth?oSymbol.minWidth:nNewWidth;nNewWidth=!isNaN(oSymbol.maxWidth)&&oSymbol.maxWidth!==0&&nNewWidth>oSymbol.maxWidth?oSymbol.maxWidth:nNewWidth;nNewHeight=!isNaN(oSymbol.minHeight)&&oSymbol.minHeight!==0&&nNewHeight<oSymbol.minHeight?oSymbol.minHeight:nNewHeight;nNewHeight=!isNaN(oSymbol.maxHeight)&&oSymbol.maxHeight!==0&&nNewHeight>oSymbol.maxHeight?oSymbol.maxHeight:nNewHeight;layoutRect.resize(nNewWidth,nNewHeight,false,bKeepAspectRatio,bKeepCenter);dx=layoutRect.x;dy=layoutRect.y;nNewWidth=layoutRect.width;nNewHeight=layoutRect.height;if(nNewWidth!==this.width||nNewHeight!==this.height){oShape.isAdjustToContent=false}layoutRect.x=0;layoutRect.y=0;layoutRect=oShape.layout(layoutRect,false);layoutRect.x=0;layoutRect.y=0;layoutRect.width=nNewWidth;layoutRect.height=nNewHeight;layoutRect=oShape.layout(layoutRect,true);if(bCanChangeSymbol){if(oSymbol.width!==nNewWidth){oSymbol.width=nNewWidth;bSymbolChanged=true}if(oSymbol.height!==nNewHeight){oSymbol.height=nNewHeight;bSymbolChanged=true}if(dx!==0||dy!==0){oSymbol.moveBy(dx,dy);bSymbolChanged=true}}}return bSymbolChanged},replaceBinding:function(oShape){if(oShape){var sProperty,vValue,oBindingProperties,oParam={},oCloneShape,oBinding,oBindings={},aNames=Object.getOwnPropertyNames(oShape),i,l=aNames.length;for(i=0;i<l;i++){sProperty=aNames[i];if(sProperty!=="_shapes"&&sProperty!=="_bindings"){vValue=oShape[sProperty];if(vValue instanceof sap.galilei.ui.common.Points){oParam[sProperty]=vValue.clone()}else{oParam[sProperty]=vValue}}}aNames=oShape.bindings&&Object.getOwnPropertyNames(oShape.bindings);l=aNames&&aNames.length;for(i=0;i<l;i++){sProperty=aNames[i];if(sProperty!=="shapes"){oBindingProperties=oShape.bindings[sProperty];vValue=undefined;if(this.objectContext&&oBindingProperties){if(this._symbol&&(oBindingProperties.path||oBindingProperties.formatter||oBindingProperties.template)){if(!oBindingProperties.template){oBinding=new sap.galilei.ui.symbol.binding.PropertyBinding({objectContext:this.objectContext,propertyName:sProperty,path:oBindingProperties.path,formatter:oBindingProperties.formatter,type:oBindingProperties.type,symbol:this._symbol})}else{oBinding=new sap.galilei.ui.symbol.binding.AggregationBinding({objectContext:this.objectContext,propertyName:sProperty,path:oBindingProperties.path,template:oBindingProperties.template,symbol:this._symbol})}vValue=oBinding.getObjectProperty();oBindings[sProperty]=oBinding}}oParam[sProperty]=(vValue instanceof sap.galilei.ui.common.Points)?vValue.clone():vValue}}oCloneShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(oShape.name,oParam);if(oShape.shapes.length>0){this.replaceChildBindings(oCloneShape,oShape)}aNames=oBindings&&Object.getOwnPropertyNames(oBindings);l=aNames&&aNames.length;for(i=0;i<l;i++){sProperty=aNames[i];oBinding=oBindings[sProperty];oBinding.shape=oCloneShape;if(oBinding instanceof sap.galilei.ui.symbol.binding.PropertyBinding){oBinding.registerPropertyChangedListener()}}if(sap.galilei.core.hasObjects(oBindings)){oCloneShape.bindings=oBindings}if(oShape.name==="Stack"&&oCloneShape.shapes.length===0){return undefined}return oCloneShape}return undefined},replaceChildBindings:function(oCloneShape,oShape){var oCloneSubShape,iShape,iLength,oSubShape,aChildShapes=oShape&&oShape.shapes;if(oCloneShape&&aChildShapes){iLength=aChildShapes.length;for(iShape=0;iShape<iLength;iShape++){oSubShape=aChildShapes[iShape];oCloneSubShape=this.replaceBinding(oSubShape);if(oCloneSubShape){oCloneShape.shapes.add(oCloneSubShape)}}}return oCloneShape}}});
(function(){sap.galilei.ui.symbol.LinkSymbolLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.LinkSymbolLayout",parent:sap.galilei.ui.symbol.SymbolLayout,properties:{linkShape:undefined,sourceArrow:undefined,middleArrow:undefined,targetArrow:undefined,sourceContent:undefined,middleContent:undefined,targetContent:undefined},methods:{createShape:function(oSymbol){if(oSymbol&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){var oGroup,oLink,oMiddleArrow,oSourceContent,oMiddleContent,oTargetContent;this._symbol=oSymbol;this._object=oSymbol;oGroup=new sap.galilei.ui.common.shape.Group({id:this._symbol.objectId,domClass:"sapGalileiSymbolLink",zindex:oSymbol.getShapeZIndex(),focusable:"true",tabindex:"1",ariaLabel:oSymbol.ariaLabel});if(oSymbol.tooltip){oGroup.bindProperty("tooltip","{tooltip}",oSymbol)}if(oSymbol.automationId){oGroup.bindProperty("automationId","{automationId}",oSymbol)}if(oSymbol.ariaLabel){oGroup.bindProperty("ariaLabel","{ariaLabel}",oSymbol)}if(this.linkShape){oLink=this.replaceBinding(this.linkShape);if(oLink){oGroup.shapes.add(oLink)}}if(this.middleArrow){oMiddleArrow=this.replaceBinding(this.middleArrow);if(oMiddleArrow){oGroup.shapes.add(oMiddleArrow);oSymbol.middleArrowShape=oMiddleArrow}}if(this.sourceContent){oSourceContent=this.replaceBinding(this.sourceContent);if(oSourceContent){oGroup.shapes.add(oSourceContent);oSymbol.sourceContentShape=oSourceContent}}if(this.middleContent){oMiddleContent=this.replaceBinding(this.middleContent);if(oMiddleContent){oGroup.shapes.add(oMiddleContent);oSymbol.middleContentShape=oMiddleContent}}if(this.targetContent){oTargetContent=this.replaceBinding(this.targetContent);if(oTargetContent){oGroup.shapes.add(oTargetContent);oSymbol.targetContentShape=oTargetContent}}this._symbol=undefined;this._object=undefined;return oGroup}return undefined},calculateLinkDirections:function(oLinkSymbol,oSourceSymbol,oTargetSymbol,vSourceAttachPoint,vTargetAttachPoint){function initWeight(oWeights){oWeights[sap.galilei.ui.common.LinkDirection.south]=0;oWeights[sap.galilei.ui.common.LinkDirection.west]=0;oWeights[sap.galilei.ui.common.LinkDirection.north]=0;oWeights[sap.galilei.ui.common.LinkDirection.east]=0}function getDirectionBySlope(aPoint1,aPoint2){var xDistance,yDistance,south=sap.galilei.ui.common.LinkDirection.south,west=sap.galilei.ui.common.LinkDirection.west,north=sap.galilei.ui.common.LinkDirection.north,east=sap.galilei.ui.common.LinkDirection.east;if(!aPoint1||!aPoint2){return undefined}xDistance=aPoint2[0]-aPoint1[0];yDistance=aPoint2[1]-aPoint1[1];if(xDistance>=0){if(yDistance>=0){return(yDistance>=xDistance)?[south,east]:[east,south]}else{return(Math.abs(yDistance)>=xDistance)?[north,east]:[east,north]}}else{if(yDistance>=0){return(yDistance>=Math.abs(xDistance))?[south,west]:[west,south]}else{return(Math.abs(yDistance)>=Math.abs(xDistance))?[north,west]:[west,north]}}}function getEdgeDistanceRatio(oRect,aPoint,bSource){var south,west,north,east,onEdges=[];if(oRect&&aPoint&&oRect.width>0&&oRect.height>0){south=Math.abs(aPoint[1]-(oRect.y+oRect.height));west=Math.abs(aPoint[0]-oRect.x);north=Math.abs(aPoint[1]-oRect.y);east=Math.abs(aPoint[0]-(oRect.x+oRect.width));if(south<3){onEdges.push(sap.galilei.ui.common.LinkDirection.south)}if(west<3){onEdges.push(sap.galilei.ui.common.LinkDirection.west)}if(north<3){onEdges.push(sap.galilei.ui.common.LinkDirection.north)}if(east<3){onEdges.push(sap.galilei.ui.common.LinkDirection.east)}return onEdges}}function getMaxWeightDirection(oWeights,directions){var maxWeight,maxDirection,sKey;for(sKey in oWeights){if(directions instanceof Array&&directions.indexOf(parseInt(sKey))===-1){continue}if(maxWeight===undefined||maxWeight<oWeights[sKey]){maxWeight=oWeights[sKey];maxDirection=sKey}}return parseInt(maxDirection)}var aSourceAttachPoint=sap.galilei.ui.common.Point.getPointArray(vSourceAttachPoint),aTargetAttachPoint=sap.galilei.ui.common.Point.getPointArray(vTargetAttachPoint),oSourceBBox=oSourceSymbol.getBBox(),oTargetBBox=oTargetSymbol.getBBox(),oSourceWeight={},oTargetWeight={},result,directions,i;initWeight(oSourceWeight);initWeight(oTargetWeight);if(sap.galilei.ui.common.LinkDirection.verify(oLinkSymbol.sourceDirection)){oSourceWeight[oLinkSymbol.sourceDirection]+=4}if(sap.galilei.ui.common.LinkDirection.verify(oLinkSymbol.targetDirection)){oTargetWeight[oLinkSymbol.targetDirection]+=4}directions=getDirectionBySlope(aSourceAttachPoint,aTargetAttachPoint);if(directions&&directions.length===2){oSourceWeight[directions[0]]+=0.5;oSourceWeight[directions[1]]+=0.3;oTargetWeight[sap.galilei.ui.common.LinkDirection.opposite(directions[0])]+=0.5;oTargetWeight[sap.galilei.ui.common.LinkDirection.opposite(directions[1])]+=0.3}result=getEdgeDistanceRatio(oSourceBBox,aSourceAttachPoint,true);if(result&&result.length>0){for(i=0;i<result.length;i++){oSourceWeight[result[i]]+=2}}result=getEdgeDistanceRatio(oTargetBBox,aTargetAttachPoint,false);if(result&&result.length>0){for(i=0;i<result.length;i++){oTargetWeight[result[i]]+=2}}return{source:getMaxWeightDirection(oSourceWeight,oLinkSymbol.supportedSourceDirections),target:getMaxWeightDirection(oTargetWeight,oLinkSymbol.supportedTargetDirections)}},updateLinkRouting:function(oSymbol,bPreserveAttachPoints){var aSourceEdgePt,aTargetEdgePt,oSourceSymbol,oTargetSymbol,aSourceAttachPt,aTargetAttachPt,aSourceCenterPt,aTargetCenterPt,oSourceBoundaryShape,oTargetBoundaryShape,oSourceRect,oTargetRect,aSymbolPoints,aLinkPoints,aNewPoints,oDirections,bCalculateLinkPoints=true,bUseEdgePoints=false,bRemoveElbows=true;function computeEdgePoint(aPoint,direction,oShape,oParentRect){var oSegment,aTempPoint;if(oShape){switch(direction){case sap.galilei.ui.common.LinkDirection.south:aTempPoint=[aPoint[0],oParentRect.bottom+50];break;case sap.galilei.ui.common.LinkDirection.north:aTempPoint=[aPoint[0],oParentRect.top-50];break;case sap.galilei.ui.common.LinkDirection.west:aTempPoint=[oParentRect.left-50,aPoint[1]];break;case sap.galilei.ui.common.LinkDirection.east:aTempPoint=[oParentRect.right+50,aPoint[1]];break}if(aTempPoint){oSegment=new sap.galilei.ui.common.Segment(aPoint,aTempPoint);return oShape.getIntersection(oSegment,oParentRect)}}}function setBoundarySymbolAttachPoint(oLinkSymbol,oBoundarySymbol,aAttachPoint){if(oLinkSymbol&&oBoundarySymbol&&oBoundarySymbol.isBoundarySymbol&&oBoundarySymbol.parentSymbol){var oBoundaryBBox=oBoundarySymbol.getBBox(),oParentBBox=oBoundarySymbol.parentSymbol.getBBox(),vDirection=oParentBBox.getPointDirection(aAttachPoint||oBoundaryBBox.getCenter()),aPoint;vDirection=sap.galilei.ui.common.LinkDirection.toDockPosition(vDirection);aPoint=oBoundaryBBox.getPoint(vDirection);if(aPoint){if(oBoundarySymbol===oLinkSymbol.sourceSymbol){oLinkSymbol.sourceAttachPoint=aPoint}else{oLinkSymbol.targetAttachPoint=aPoint}}}}if(oSymbol&&oSymbol.isLinkSymbol&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){oSourceSymbol=oSymbol.sourceSymbol;oTargetSymbol=oSymbol.targetSymbol;aSourceCenterPt=oSourceSymbol.getCenter();aTargetCenterPt=oTargetSymbol.getCenter();if(oSourceSymbol.isBoundarySymbol){setBoundarySymbolAttachPoint(oSymbol,oSourceSymbol,oSymbol.sourceAttachPoint)}if(oTargetSymbol.isBoundarySymbol){setBoundarySymbolAttachPoint(oSymbol,oTargetSymbol,oSymbol.targetAttachPoint)}if(bPreserveAttachPoints&&oSymbol.points&&oSymbol.points.length>=2){aSourceAttachPt=oSymbol.sourceAttachPoint;aTargetAttachPt=oSymbol.targetAttachPoint}if(!aSourceAttachPt){aSourceAttachPt=aSourceCenterPt}if(!aTargetAttachPt){aTargetAttachPt=aTargetCenterPt}if(!aSourceAttachPt||!aTargetAttachPt){return}oSourceBoundaryShape=oSourceSymbol.getBoundaryShape();oTargetBoundaryShape=oTargetSymbol.getBoundaryShape();if(!oSourceBoundaryShape||!oTargetBoundaryShape){return}oSourceRect=oSourceSymbol.getBBox();oTargetRect=oTargetSymbol.getBBox();switch(oSymbol.lineStyle){case sap.galilei.ui.common.LineStyle.normal:bCalculateLinkPoints=false;break;case sap.galilei.ui.common.LineStyle.horzDiagonalBezier:case sap.galilei.ui.common.LineStyle.vertDiagonalBezier:case sap.galilei.ui.common.LineStyle.horzDiagonal:case sap.galilei.ui.common.LineStyle.vertDiagonal:bUseEdgePoints=true;bRemoveElbows=false;oSymbol.sourceDirection=oSymbol.targetDirection=undefined;aSourceAttachPt=aSourceCenterPt;aTargetAttachPt=aTargetCenterPt;break}aSymbolPoints=new sap.galilei.ui.common.Points();if(oSymbol.points){aSymbolPoints.points=oSymbol.points}if(aSymbolPoints.length===0){aSymbolPoints.push(aSourceAttachPt);aSymbolPoints.push(aTargetAttachPt)}if(bCalculateLinkPoints){aSymbolPoints.points=[aSourceAttachPt,aTargetAttachPt];oDirections=this.calculateLinkDirections(oSymbol,oSourceSymbol,oTargetSymbol,aSourceAttachPt,aTargetAttachPt);if(oDirections&&oDirections.source!==undefined&&oDirections.target!==undefined){aSourceEdgePt=computeEdgePoint(aSourceAttachPt,oDirections.source,oSourceBoundaryShape,oSourceRect)||aSourceAttachPt;aTargetEdgePt=computeEdgePoint(aTargetAttachPt,oDirections.target,oTargetBoundaryShape,oTargetRect)||aTargetAttachPt;if(aSourceEdgePt&&aTargetEdgePt){aLinkPoints=sap.galilei.ui.common.layout.PointsLayout.routeLinkPoints(aSourceEdgePt,aTargetEdgePt,oSourceRect,oTargetRect,oDirections.source,oDirections.target);if(aLinkPoints&&aLinkPoints.length>=2){if(bUseEdgePoints){aLinkPoints[0]=[aSourceEdgePt[0],aSourceEdgePt[1]];aLinkPoints[aLinkPoints.length-1]=[aTargetEdgePt[0],aTargetEdgePt[1]]}else{aLinkPoints[0]=[aSourceAttachPt[0],aSourceAttachPt[1]];aLinkPoints[aLinkPoints.length-1]=[aTargetAttachPt[0],aTargetAttachPt[1]]}aSymbolPoints.points=aLinkPoints}}if(bRemoveElbows){aNewPoints=sap.galilei.ui.common.layout.PointsLayout.removeElbows(aSymbolPoints);if(aNewPoints&&aNewPoints.length>=2&&(aNewPoints.length!==aSymbolPoints.length||!aNewPoints.equals(aSymbolPoints))&&(!oSourceBoundaryShape||oSourceBoundaryShape.isPointInShape(aNewPoints[0],oSourceRect))&&(!oTargetBoundaryShape||oTargetBoundaryShape.isPointInShape(aNewPoints[aNewPoints.length-1],oTargetRect))){aSymbolPoints.points=aNewPoints}}}}switch(oSymbol.lineStyle){case sap.galilei.ui.common.LineStyle.streight:aSymbolPoints.points=sap.galilei.ui.common.layout.PointsLayout.getStreightLinePoints(aSymbolPoints);break;case sap.galilei.ui.common.LineStyle.horzDiagonalBezier:case sap.galilei.ui.common.LineStyle.vertDiagonalBezier:aSymbolPoints.points=sap.galilei.ui.common.layout.PointsLayout.getDiagonalBezierPoints(aSymbolPoints,(oSymbol.lineStyle===sap.galilei.ui.common.LineStyle.horzDiagonalBezier));break;case sap.galilei.ui.common.LineStyle.horzDiagonal:case sap.galilei.ui.common.LineStyle.vertDiagonal:aSymbolPoints.points=sap.galilei.ui.common.layout.PointsLayout.getDiagonalPoints(aSymbolPoints,(oSymbol.lineStyle===sap.galilei.ui.common.LineStyle.horzDiagonal));break}oSymbol.points=aSymbolPoints}},getLinkPoints:function(oSymbol,bIncludeStrokeWidth){var aSourceEdgePt,aTargetEdgePt,oSourceSymbol,oTargetSymbol,oSourceBoundaryShape,oTargetBoundaryShape,oSourceRect,oTargetRect,aLinkPoints;function computeEdgePoint(aInnerPoint,aOuterPoint,direction,oShape,oParentRect){var oSegment,aTempPoint;if(oShape){direction=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aInnerPoint,aOuterPoint);switch(direction){case sap.galilei.ui.common.LinkDirection.east:case sap.galilei.ui.common.LinkDirection.west:aTempPoint=[aOuterPoint[0],aInnerPoint[1]];break;case sap.galilei.ui.common.LinkDirection.north:case sap.galilei.ui.common.LinkDirection.south:aTempPoint=[aInnerPoint[0],aOuterPoint[1]];break}if(aTempPoint){oSegment=new sap.galilei.ui.common.Segment(aInnerPoint,aTempPoint);return oShape.getIntersection(oSegment,oParentRect,bIncludeStrokeWidth)}}}if(oSymbol&&oSymbol.isLinkSymbol){aLinkPoints=oSymbol.points&&oSymbol.points.clone();if(aLinkPoints&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){if(aLinkPoints.length>=2){oSourceSymbol=oSymbol.sourceSymbol;oTargetSymbol=oSymbol.targetSymbol;oSourceBoundaryShape=oSourceSymbol.getBoundaryShape();oTargetBoundaryShape=oTargetSymbol.getBoundaryShape();oSourceRect=oSourceSymbol.getBBox();oTargetRect=oTargetSymbol.getBBox();aSourceEdgePt=computeEdgePoint(oSymbol.points[0],oSymbol.points[1],undefined,oSourceBoundaryShape,oSourceRect);aTargetEdgePt=computeEdgePoint(oSymbol.points[oSymbol.points.length-1],oSymbol.points[oSymbol.points.length-2],undefined,oTargetBoundaryShape,oTargetRect);if(aSourceEdgePt&&aTargetEdgePt){aLinkPoints[0]=aSourceEdgePt;aLinkPoints[aLinkPoints.length-1]=aTargetEdgePt}}}}return aLinkPoints},layoutLinkShape:function(oSymbol,oLinkShape){var aLinkPoints;if(oSymbol&&oSymbol.isLinkSymbol&&oLinkShape&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){aLinkPoints=this.getLinkPoints(oSymbol);if(aLinkPoints){oLinkShape.points=aLinkPoints}this.layoutMiddleArrow(oSymbol,oLinkShape);this.layoutLinkContent(oSymbol,oLinkShape)}},layoutMiddleArrow:function(oSymbol,oLink){if(oSymbol&&oLink&&oLink.points){var aMiddlePoint,sTransform,middleArrowAngle,aPoints=oLink.points,length=aPoints.length,oLayoutRect,middleIndex;if(aPoints&&!isNaN(length)&&length>=2){aMiddlePoint=oSymbol.getCenter();if(aMiddlePoint){if(oSymbol.middleArrowShape){oSymbol.middleArrowShape.x=aMiddlePoint[0]-oSymbol.middleArrowShape.width/2;oSymbol.middleArrowShape.y=aMiddlePoint[1]-oSymbol.middleArrowShape.height/2;oLayoutRect=new sap.galilei.ui.common.Rect({x:oSymbol.middleArrowShape.x,y:oSymbol.middleArrowShape.y});oLayoutRect.width=oLayoutRect.height=undefined;oLayoutRect=oSymbol.middleArrowShape.layout(oLayoutRect,false);oSymbol.middleArrowShape.x=aMiddlePoint[0]-oLayoutRect.width/2;oSymbol.middleArrowShape.y=aMiddlePoint[1]-oLayoutRect.height/2;oLayoutRect.x=oSymbol.middleArrowShape.x;oLayoutRect.y=oSymbol.middleArrowShape.y;oSymbol.middleArrowShape.layout(oLayoutRect,true)}}}}},layoutLinkContent:function(oSymbol,oLinkShape){if(oSymbol&&oLinkShape&&oLinkShape.points){var aPoints=oLinkShape.points,length=aPoints.length,middleIndex=Math.ceil(length/2)-1,offsetX=sap.galilei.core.validateNumeric(oSymbol.contentOffsetX,5),offsetY=sap.galilei.core.validateNumeric(oSymbol.contentOffsetY,5),aStartPoint=aPoints[0],aMiddlePoint=oSymbol.getCenter(),aEndPoint=aPoints[length-1],oLayoutRect,nContentWidth,nContentHeight,direction;if(aPoints&&length>=2){if(oSymbol.middleContentShape){if(aMiddlePoint){oSymbol.middleContentShape.x=aMiddlePoint[0]-oSymbol.middleContentShape.width/2;oSymbol.middleContentShape.y=aMiddlePoint[1]-oSymbol.middleContentShape.height/2;oLayoutRect=new sap.galilei.ui.common.Rect({x:oSymbol.middleContentShape.x,y:oSymbol.middleContentShape.y});oLayoutRect.width=oLayoutRect.height=undefined;oLayoutRect=oSymbol.middleContentShape.layout(oLayoutRect,false);oSymbol.middleContentShape.x=aMiddlePoint[0]-oLayoutRect.width/2;oSymbol.middleContentShape.y=aMiddlePoint[1]-oLayoutRect.height/2;if(aPoints[middleIndex][0]===aPoints[middleIndex+1][0]){oSymbol.middleContentShape.x+=oLayoutRect.width/2+offsetX}else{if(aPoints[middleIndex][1]===aPoints[middleIndex+1][1]){oSymbol.middleContentShape.y-=oLayoutRect.height/2+offsetY}else{oSymbol.middleContentShape.y-=offsetY}}oLayoutRect.x=oSymbol.middleContentShape.x;oLayoutRect.y=oSymbol.middleContentShape.y;oSymbol.middleContentShape.layout(oLayoutRect,true)}}if(oSymbol.sourceContentShape){if(aStartPoint){oLayoutRect=new sap.galilei.ui.common.Rect({x:oSymbol.sourceContentShape.x,y:oSymbol.sourceContentShape.y});oLayoutRect.width=oLayoutRect.height=undefined;oLayoutRect=oSymbol.sourceContentShape.layout(oLayoutRect,false);nContentWidth=oLayoutRect.width;nContentHeight=oLayoutRect.height;direction=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aPoints[0],aPoints[1]);switch(direction){case sap.galilei.ui.common.LinkDirection.east:oSymbol.sourceContentShape.x=aStartPoint[0]+offsetX;oSymbol.sourceContentShape.y=aStartPoint[1]-nContentHeight-offsetY;break;case sap.galilei.ui.common.LinkDirection.south:oSymbol.sourceContentShape.x=aStartPoint[0]+offsetX;oSymbol.sourceContentShape.y=aStartPoint[1]+offsetY;break;case sap.galilei.ui.common.LinkDirection.west:oSymbol.sourceContentShape.x=aStartPoint[0]-offsetX-nContentWidth;oSymbol.sourceContentShape.y=aStartPoint[1]-nContentHeight-offsetY;break;case sap.galilei.ui.common.LinkDirection.north:oSymbol.sourceContentShape.x=aStartPoint[0]+offsetX;oSymbol.sourceContentShape.y=aStartPoint[1]-nContentHeight-offsetY;break}oLayoutRect.x=oSymbol.sourceContentShape.x;oLayoutRect.y=oSymbol.sourceContentShape.y;oSymbol.sourceContentShape.layout(oLayoutRect,true)}}if(oSymbol.targetContentShape){if(aEndPoint){oLayoutRect=new sap.galilei.ui.common.Rect({x:oSymbol.targetContentShape.x,y:oSymbol.targetContentShape.y});oLayoutRect.width=oLayoutRect.height=undefined;oLayoutRect=oSymbol.targetContentShape.layout(oLayoutRect,false);nContentWidth=oLayoutRect.width;nContentHeight=oLayoutRect.height;direction=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aPoints[length-1],aPoints[length-2]);switch(direction){case sap.galilei.ui.common.LinkDirection.east:oSymbol.targetContentShape.x=aEndPoint[0]+offsetX;oSymbol.targetContentShape.y=aEndPoint[1]-nContentHeight-offsetY;break;case sap.galilei.ui.common.LinkDirection.south:oSymbol.targetContentShape.x=aEndPoint[0]+offsetX;oSymbol.targetContentShape.y=aEndPoint[1]+offsetY;break;case sap.galilei.ui.common.LinkDirection.west:oSymbol.targetContentShape.x=aEndPoint[0]-offsetX-nContentWidth;oSymbol.targetContentShape.y=aEndPoint[1]-nContentHeight-offsetY;break;case sap.galilei.ui.common.LinkDirection.north:oSymbol.targetContentShape.x=aEndPoint[0]+offsetX;oSymbol.targetContentShape.y=aEndPoint[1]-nContentHeight-offsetY;break}oLayoutRect.x=oSymbol.targetContentShape.x;oLayoutRect.y=oSymbol.targetContentShape.y;oSymbol.targetContentShape.layout(oLayoutRect,true)}}}}}}})}());
"use strict";sap.galilei.ui.symbol.LinkSymbolLayoutSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.LinkSymbolLayoutSerializer",statics:{load:function(aLinkSymbolLayout){if(aLinkSymbolLayout){if(sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Array")){return this.loadSymbolLayouts(aLinkSymbolLayout)}else{if(sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Object")){return this.loadOneSymbolLayout(aLinkSymbolLayout)}}}return undefined},loadOneSymbolLayout:function(aLinkSymbolLayout){if(aLinkSymbolLayout&&sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Object")){var oLinkSymbolLayoutParams={},sProperty,vValue,oShape,oBindings={},aNames,i,l;aNames=Object.getOwnPropertyNames(aLinkSymbolLayout);l=aNames.length;for(i=0;i<l;i++){sProperty=aNames[i];vValue=aLinkSymbolLayout[sProperty];switch(sProperty){case"sourceArrow":if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){oBindings.markerStart=vValue}else{oLinkSymbolLayoutParams[sProperty]=vValue}break;case"targetArrow":if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){oBindings.markerEnd=vValue}else{oLinkSymbolLayoutParams[sProperty]=vValue}break;case"middleArrow":case"sourceContent":case"middleContent":case"targetContent":if(sap.galilei.core.isInstanceOf(vValue,"sap.galilei.ui.common.shape.Shape")){oShape=vValue}else{oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(vValue)}if(oShape){oLinkSymbolLayoutParams[sProperty]=oShape}break;default:if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){oBindings[sProperty]=vValue}else{oLinkSymbolLayoutParams[sProperty]=vValue}break}}if(!oLinkSymbolLayoutParams.stroke){oLinkSymbolLayoutParams.stroke="black"}if(!oLinkSymbolLayoutParams.strokeWidth){oLinkSymbolLayoutParams.strokeWidth=1}oLinkSymbolLayoutParams.linkShape=new sap.galilei.ui.common.shape.Polyline(oLinkSymbolLayoutParams);oLinkSymbolLayoutParams.linkShape.bindProperty(oBindings);if(oLinkSymbolLayoutParams.sourceArrow&&!oBindings.markerStart){oLinkSymbolLayoutParams.linkShape.markerStart=oLinkSymbolLayoutParams.sourceArrow}if(oLinkSymbolLayoutParams.targetArrow&&!oBindings.markerEnd){oLinkSymbolLayoutParams.linkShape.markerEnd=oLinkSymbolLayoutParams.targetArrow}return new sap.galilei.ui.symbol.LinkSymbolLayout(oLinkSymbolLayoutParams)}return undefined},loadSymbolLayouts:function(aLinkSymbolLayout){if(aLinkSymbolLayout&&sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Array")){var iLayout,oLayoutDef,oLayout,aLayouts=[];for(iLayout=0;iLayout<aLinkSymbolLayout.length;++iLayout){oLayoutDef=aLinkSymbolLayout[iLayout];oLayout=this.loadOneSymbolLayout(oLayoutDef);if(oLayout){aLayouts.push(oLayout)}}return aLayouts}return undefined}}});
"use strict";sap.galilei.ui.symbol.SymbolLayoutSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.SymbolLayoutSerializer",statics:{load:function(aSymbolLayout){if(aSymbolLayout){if(sap.galilei.core.isInstanceOf(aSymbolLayout,"Array")){return this.loadSymbolLayouts(aSymbolLayout)}else{if(sap.galilei.core.isInstanceOf(aSymbolLayout,"Object")){return this.loadOneSymbolLayout(aSymbolLayout)}}}return undefined},loadOneSymbolLayout:function(oSymbolLayout){if(oSymbolLayout&&sap.galilei.core.isInstanceOf(oSymbolLayout,"Object")){var oSymbolLayoutClone={},sProperty,vValue,oShape,aNames,i,l;aNames=Object.getOwnPropertyNames(oSymbolLayout);l=aNames.length;for(i=0;i<l;i++){sProperty=aNames[i];vValue=oSymbolLayout[sProperty];switch(sProperty){case"mainShape":case"contentShape":if(sap.galilei.core.isInstanceOf(vValue,"sap.galilei.ui.common.shape.Shape")){oShape=vValue}else{oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(vValue)}if(oShape){oSymbolLayoutClone[sProperty]=oShape}break;default:oSymbolLayoutClone[sProperty]=vValue;break}}return new sap.galilei.ui.symbol.SymbolLayout(oSymbolLayoutClone)}return undefined},loadSymbolLayouts:function(aSymbolLayout){if(aSymbolLayout&&sap.galilei.core.isInstanceOf(aSymbolLayout,"Array")){var iLayout,oLayoutDef,oLayout,aLayouts=[];for(iLayout=0;iLayout<aSymbolLayout.length;++iLayout){oLayoutDef=aSymbolLayout[iLayout];oLayout=this.loadOneSymbolLayout(oLayoutDef);if(oLayout){aLayouts.push(oLayout)}}return aLayouts}return undefined}}});
