(function(global){namespace("sap.galilei.ui.common")}(this));
(function(){sap.galilei.ui.common.HorizontalAlignment={left:"left",center:"center",right:"right",width:"width",DEFAULT:"left"};sap.galilei.ui.common.VerticalAlignment={top:"top",middle:"middle",bottom:"bottom",height:"height",DEFAULT:"top"};sap.galilei.ui.common.DockPosition={topLeft:"topLeft",top:"top",topRight:"topRight",right:"right",bottomRight:"bottomRight",bottom:"bottom",bottomLeft:"bottomLeft",left:"left",center:"center",width:"width",height:"height",maximize:"maximize",DEFAULT:"topLeft"};sap.galilei.ui.common.Orientation={horizontal:"horizontal",vertical:"vertical",DEFAULT:"horizontal"};sap.galilei.ui.common.FolderStatus={expanded:"expanded",collapsed:"collapsed",hidden:"hidden",DEFAULT:"collapsed"};sap.galilei.ui.common.LineCap={butt:"butt",round:"round",square:"square",DEFAULT:undefined};sap.galilei.ui.common.LineJoin={miter:"miter",round:"round",bevel:"bevel",DEFAULT:undefined};sap.galilei.ui.common.DashStyle={solid:undefined,dash:"8,4",dot:"2,2",dashDot:"8,4,2,4",dashDotDot:"8,4,2,4,2,4",DEFAULT:undefined};sap.galilei.ui.common.LineStyle={normal:0,orthogonal:1,rounded:2,bezier:3,halfBezier:4,streight:5,horzDiagonalBezier:6,vertDiagonalBezier:7,horzDiagonal:8,vertDiagonal:9,DEFAULT:0};sap.galilei.ui.common.LayoutStyle={normal:0,vertical:1,horizontal:2,DEFAULT:0};sap.galilei.ui.common.ShapeLayoutModes={detail:"detail",icon:"icon",composite:"composite",DEFAULT:"detail"};sap.galilei.ui.common.LinkDirection={south:0,west:1,north:2,east:3,DEFAULT:undefined,opposite:function(direction){return(direction+2)%4},perpendiculars:function(direction){return[(direction+1)%4,(direction+3)%4]},rotate:function(direction,degree){return(Math.floor(degree/90)+direction)%4},degree:function(direction1,direction2){return(direction2-direction1)*90},verify:function(direction){if(direction===sap.galilei.ui.common.LinkDirection.south||direction===sap.galilei.ui.common.LinkDirection.west||direction===sap.galilei.ui.common.LinkDirection.north||direction===sap.galilei.ui.common.LinkDirection.east){return true}return false},convertDockPosition:function(sDockPosition){switch(sDockPosition){case sap.galilei.ui.common.DockPosition.right:return sap.galilei.ui.common.LinkDirection.east;case sap.galilei.ui.common.DockPosition.left:return sap.galilei.ui.common.LinkDirection.west;case sap.galilei.ui.common.DockPosition.top:return sap.galilei.ui.common.LinkDirection.north;case sap.galilei.ui.common.DockPosition.bottom:return sap.galilei.ui.common.LinkDirection.south}return undefined},toDockPosition:function(nLinkDirection){switch(nLinkDirection){case sap.galilei.ui.common.LinkDirection.east:return sap.galilei.ui.common.DockPosition.right;case sap.galilei.ui.common.LinkDirection.west:return sap.galilei.ui.common.DockPosition.left;case sap.galilei.ui.common.LinkDirection.north:return sap.galilei.ui.common.DockPosition.top;case sap.galilei.ui.common.LinkDirection.south:return sap.galilei.ui.common.DockPosition.bottom}return undefined}};sap.galilei.ui.common.MouseEvents={click:"click",dblclick:"dblclick",mousedown:"mousedown",mouseup:"mouseup",mouseenter:"mouseenter",mouseleave:"mouseleave",mouseover:"mouseover",mouseout:"mouseout",mousemove:"mousemove",mousewheel:"mousewheel"};sap.galilei.ui.common.isMouseEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.MouseEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.TouchEvents={touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend",touchcancel:"touchcancel"};sap.galilei.ui.common.isTouchEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.TouchEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.PointerEvents={pointerdown:"pointerdown",pointerup:"pointerup",pointercancel:"pointercancel",pointermove:"pointermove",pointerover:"pointerover",pointerout:"pointerout",pointerenter:"pointerenter",pointerleave:"pointerleave"};sap.galilei.ui.common.PointerEventsMap={pointerdown:[sap.galilei.ui.common.MouseEvents.mousedown,sap.galilei.ui.common.TouchEvents.touchstart],pointerup:[sap.galilei.ui.common.MouseEvents.mouseup,sap.galilei.ui.common.TouchEvents.touchend],pointercancel:[sap.galilei.ui.common.TouchEvents.touchcancel],pointermove:[sap.galilei.ui.common.MouseEvents.mousemove,sap.galilei.ui.common.TouchEvents.touchmove],pointerover:[sap.galilei.ui.common.MouseEvents.mouseover],pointerout:[sap.galilei.ui.common.MouseEvents.mouseout],pointerenter:[sap.galilei.ui.common.MouseEvents.mouseenter],pointerleave:[sap.galilei.ui.common.MouseEvents.mouseleave]};sap.galilei.ui.common.isPointerEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.PointerEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.GestureEvents={hold:"hold",tap:"tap",doubletap:"doubletap",drag:"drag",dragstart:"dragstart",dragend:"dragend",dragup:"dragup",dragdown:"dragdown",dragleft:"dragleft",dragright:"dragright",swipe:"swipe",swipeup:"swipeup",swipedown:"swipedown",swipeleft:"swipeleft",swiperight:"swiperight",transform:"transform",transformstart:"transformstart",transformend:"transformend",rotate:"rotate",pinch:"pinch",pinchin:"pinchin",pinchout:"pinchout",touch:"touch",release:"release"};sap.galilei.ui.common.isGestureEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.GestureEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.KeyEvents={keydown:"keydown",keypress:"keypress",keyup:"keyup",textinput:"textinput"};sap.galilei.ui.common.isKeyEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.KeyEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX="dragdrop.";sap.galilei.ui.common.DragDropEvents={dragstart:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragstart",drag:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"drag",dragenter:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragenter",dragover:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragover",dragleave:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragleave",dragend:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragend",drop:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"drop"};sap.galilei.ui.common.isDragDropEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.DragDropEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.DOMEvents={contextmenu:"contextmenu"};sap.galilei.ui.common.isDOMEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.DOMEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.LinearGradientOrientations={leftToRight:"leftToRight",topToBottom:"topToBottom",leftTopToRightBottom:"leftTopToRightBottom",rightTopToLeftBottom:"rightTopToLeftBottom"};sap.galilei.ui.common.ZINDEX_STEP=10;sap.galilei.ui.common.ZINDEX_STEP_MINOR=1;sap.galilei.ui.common.NAMESPACE_GALILEI="http://www.sap.com/2014/galilei"}());
namespace("sap.galilei.ui.common",function(nsCommon){nsCommon.Point=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Point",initialize:function(x,y){this.set.apply(this,arguments)},fields:{x:0,y:0},methods:{set:function(aPoint){if(arguments.length===2){this.x=arguments[0];this.y=arguments[1]}else{if(arguments.length===1&&aPoint!==undefined){if((aPoint instanceof Array)&&aPoint.length===2){this.x=aPoint[0];this.y=aPoint[1]}else{this.x=aPoint.x;this.y=aPoint.y}}}return this},matrixTransform:function(oMatrix,bRound,bCreateNew){var pt;if(oMatrix){pt=nsCommon.Point.matrixTransform(this.x,this.y,oMatrix,bRound);if(pt&&pt.length===2){if(bCreateNew===true){return new nsCommon.Point(pt[0],pt[1])}else{return this.set(pt[0],pt[1])}}}return this},toArray:function(){return[this.x,this.y]},getDistance:function(pt){return nsCommon.Point.getDistance(this,pt)},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this.x+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this.y+=dy}},equals:function(vPoint){return nsCommon.Point.equals(this,vPoint)},snapToGrid:function(nGridSize,bCreateNew){var aPt=nsCommon.Point.snapToGrid(this,nGridSize);if(bCreateNew){return aPt}else{this.x=aPt[0];this.y=aPt[1];return[this.x,this.y]}}},statics:{_svgPoint:undefined,_svgPoint2:undefined,svgPoint:{get:function(){if(this._svgPoint===undefined){this._svgPoint=nsCommon.svg.Svg.hiddenSvg.createSVGPoint()}else{this._svgPoint.x=this._svgPoint.y=0}return this._svgPoint}},svgPoint2:{get:function(){if(this._svgPoint2===undefined){this._svgPoint2=nsCommon.svg.Svg.hiddenSvg.createSVGPoint()}else{this._svgPoint2.x=this._svgPoint2.y=0}return this._svgPoint2}},equals:function(vPoint1,vPoint2){if(vPoint1!==undefined&&vPoint2!==undefined){var x1,y1,x2,y2;if((vPoint1 instanceof Array)&&vPoint1.length===2){x1=+vPoint1[0];y1=+vPoint1[1]}else{if(typeof vPoint1==="object"&&vPoint1.x!==undefined&&!isNaN(vPoint1.x)&&vPoint1.y!==undefined&&!isNaN(vPoint1.y)){x1=+vPoint1.x;y1=+vPoint1.y}}if((vPoint2 instanceof Array)&&vPoint2.length===2){x2=+vPoint2[0];y2=+vPoint2[1]}else{if(typeof vPoint2==="object"&&vPoint2.x!==undefined&&!isNaN(vPoint2.x)&&vPoint2.y!==undefined&&!isNaN(vPoint2.y)){x2=+vPoint2.x;y2=+vPoint2.y}}return(x1===x2&&y1===y2)}return false},getDistance:function(pt1,pt2){var x1,y1,x2,y2,d=0;if(pt1 instanceof Array){x1=+pt1[0];y1=+pt1[1]}else{if(pt1){x1=+pt1.x;y1=+pt1.y}}if(pt2 instanceof Array){x2=+pt2[0];y2=+pt2[1]}else{if(pt2){x2=+pt2.x;y2=+pt2.y}}if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined){d=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))}return d},parse:function(sPoint){if(sPoint){var aPoint=sPoint.split(",");if(aPoint&&aPoint.length===2){return[+aPoint[0].trim(),+aPoint[1].trim()]}}return undefined},getPointArray:function(vPoint){if(vPoint){if((vPoint instanceof Array)&&vPoint.length===2){return[+vPoint[0],+vPoint[1]]}else{if(typeof vPoint==="object"&&vPoint.x!==undefined&&!isNaN(vPoint.x)&&vPoint.y!==undefined&&!isNaN(vPoint.y)){return[+vPoint.x,+vPoint.y]}}}return undefined},snapToGrid:function(vPoint,nGridSize){if(vPoint){var x,y;if((vPoint instanceof Array)&&vPoint.length===2){x=+vPoint[0];y=+vPoint[1]}else{if(typeof vPoint==="object"&&vPoint.x!==undefined&&!isNaN(vPoint.x)&&vPoint.y!==undefined&&!isNaN(vPoint.y)){x=+vPoint.x;y=+vPoint.y}}x=nsCommon.geometry.snapToGrid(x,nGridSize);y=nsCommon.geometry.snapToGrid(y,nGridSize);return[x,y]}return vPoint},matrixTransform:function(x,y,oMatrix,bRound){if(x!==undefined&&!isNaN(x)&&y!==undefined&&!isNaN(y)&&oMatrix){var svgPoint=nsCommon.Point.svgPoint,svgMatrix=nsCommon.Matrix.svgMatrix,newSvgPoint;svgPoint.x=x;svgPoint.y=y;nsCommon.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);newSvgPoint=svgPoint.matrixTransform(svgMatrix);if(bRound!==false){newSvgPoint.x=Math.round(newSvgPoint.x);newSvgPoint.y=Math.round(newSvgPoint.y)}return[newSvgPoint.x,newSvgPoint.y]}}}})});
namespace("sap.galilei.ui.common",function(nsCommon){nsCommon.Rect=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Rect",initialize:function(x,y,width,height){this.set.apply(this,arguments)},fields:{x:0,y:0,width:0,height:0,left:{get:function(){return this.x},set:function(value){this.x=value}},top:{get:function(){return this.y},set:function(value){this.y=value}},right:{get:function(){return this.x+this.width},set:function(value){this.width=value-this.x;if(this.width<0){this.normalize()}}},bottom:{get:function(){return this.y+this.height},set:function(value){this.height=value-this.y;if(this.height<0){this.normalize()}}}},methods:{set:function(x,y,width,height){var pt1,pt2,oRect;if(arguments.length===4){this.x=x;this.y=y;this.width=width;this.height=height}else{if(arguments.length===2){pt1=arguments[0];pt2=arguments[1];if((pt1 instanceof Array)&&(pt2 instanceof Array)){this.x=Math.min(pt1[0],pt2[0]);this.y=Math.min(pt1[1],pt2[1]);this.width=Math.abs(pt2[0]-pt1[0]);this.height=Math.abs(pt2[1]-pt1[1])}else{if((typeof pt1)==="object"&&(typeof pt2)==="object"){this.x=Math.min(pt1.x,pt2.x);this.y=Math.min(pt1.y,pt2.y);this.width=Math.abs(pt2.x-pt1.x);this.height=Math.abs(pt2.y-pt1.y)}}}else{if(arguments.length===1&&(typeof arguments)==="object"){oRect=arguments[0];if(oRect){if(oRect.x!==undefined){this.x=oRect.x}else{if(oRect.left!==undefined){this.x=oRect.left}}if(oRect.y!==undefined){this.y=oRect.y}else{if(oRect.top!==undefined){this.y=oRect.top}}if(oRect.width!==undefined){this.width=oRect.width}if(oRect.height!==undefined){this.height=oRect.height}}}}}return this},clone:function(){return new nsCommon.Rect(this)},matrixTransform:function(oMatrix,bRound,bCreateNew){var svgPoint1=nsCommon.Point.svgPoint,svgPoint2=nsCommon.Point.svgPoint2,pt1,pt2,svgMatrix=nsCommon.Matrix.svgMatrix;if(oMatrix&&this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){svgPoint1.x=this.x;svgPoint1.y=this.y;svgPoint2.x=this.x+this.width;svgPoint2.y=this.y+this.height;nsCommon.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);pt1=svgPoint1.matrixTransform(svgMatrix);pt2=svgPoint2.matrixTransform(svgMatrix);if(bRound!==false){pt1.x=Math.round(pt1.x);pt1.y=Math.round(pt1.y);pt2.x=Math.round(pt2.x);pt2.y=Math.round(pt2.y)}if(bCreateNew===true){return new nsCommon.Rect(pt1,pt2)}else{return this.set(pt1,pt2)}}else{return this}},normalize:function(bCreateNew){var oRect;if(bCreateNew){oRect=this.clone()}else{oRect=this}if(oRect.width<0){oRect.width=-oRect.width;oRect.x-=oRect.width}if(oRect.height<0){oRect.height=-oRect.height;oRect.y-=oRect.height}return oRect},unionRect:function(rect){var xMin,yMin,xMax,yMax;if(rect&&!isNaN(rect.x)&&!isNaN(rect.y)&&!isNaN(rect.width)&&!isNaN(rect.height)){this.normalize();rect.normalize();xMin=this.x;yMin=this.y;xMax=this.x+this.width;yMax=this.y+this.height;xMin=Math.min(xMin,rect.x);yMin=Math.min(yMin,rect.y);xMax=Math.max(xMax,rect.x+rect.width);yMax=Math.max(yMax,rect.y+rect.height);this.set(xMin,yMin,xMax-xMin,yMax-yMin)}return this},unionPoint:function(point){var xMin,yMin,xMax,yMax,x,y;if(point){if(point instanceof Array){x=+point[0];y=+point[1]}else{x=+point.x;y=+point.y}if(x!==undefined&&y!==undefined){this.normalize();xMin=this.x;yMin=this.y;xMax=this.x+this.width;yMax=this.y+this.height;xMin=Math.min(xMin,x);yMin=Math.min(yMin,y);xMax=Math.max(xMax,x);yMax=Math.max(yMax,y);this.set(xMin,yMin,xMax-xMin,yMax-yMin)}}return this},inflate:function(left,top,right,bottom,bCreateNew){var nLeft=0,nTop=0,nRight=0,nBottom=0;if(arguments.length===1||(arguments.length===2&&(arguments[1]===true||arguments[1]===false))){nLeft=nTop=nRight=nBottom=arguments[0];if(arguments.length===2){bCreateNew=arguments[1]}else{bCreateNew=false}}else{if(arguments.length===2||arguments.length===3){nLeft=nRight=arguments[0];nTop=nBottom=arguments[1];if(arguments.length===3){bCreateNew=arguments[2]}}else{if(arguments.length===4||arguments.length===5){nLeft=left;nTop=top;nRight=right;nBottom=bottom}}}if(nLeft!==undefined){nLeft+=0}else{nLeft=0}if(nTop!==undefined){nTop+=0}else{nTop=0}if(nRight!==undefined){nRight+=0}else{nRight=0}if(nBottom!==undefined){nBottom+=0}else{nBottom=0}if(bCreateNew){return new nsCommon.Rect(this.x-nLeft,this.y-nTop,this.width+nLeft+nRight,this.height+nTop+nBottom)}else{this.x-=nLeft;this.y-=nTop;this.width+=nLeft+nRight;this.height+=nTop+nBottom;return this}},resize:function(nNewWidth,nNewHeight,bCreateNew,bKeepAspectRatio,bKeepCenter,bRounded){var oRect=new nsCommon.Rect(this),fRatio,oOldCenter,oNewCenter;if(bKeepAspectRatio){if(this.width!==undefined&&!isNaN(this.width)&&this.width!==0&&this.height!==undefined&&!isNaN(this.height)&&this.height!==0){if(nNewWidth!==undefined&&!isNaN(nNewWidth)&&nNewWidth!==0&&nNewHeight!==undefined&&!isNaN(nNewHeight)&&nNewHeight!==0){fRatio=this.width/this.height;if(nNewWidth/this.width<nNewHeight/this.height){nNewHeight=nNewWidth/fRatio}else{nNewWidth=nNewHeight*fRatio}if(bRounded){nNewWidth=Math.round(nNewWidth);nNewHeight=Math.round(nNewHeight)}}}}oRect.width=nNewWidth;oRect.height=nNewHeight;if(bKeepCenter){oOldCenter=this.getCenter(bRounded);oNewCenter=oRect.getCenter(bRounded);oRect.moveBy(oOldCenter[0]-oNewCenter[0],oOldCenter[1]-oNewCenter[1])}if(bCreateNew){return oRect}else{this.set(oRect);return this}},resizeByHandle:function(x,y,ePosition,bCreateNew,bKeepAspectRatio,bKeepCenter,bRounded){var refPoint,refX,refY,horzPosition,vertPosition,dx,dy,dx2,dy2,dx3,dy3,dx4,dy4,dx5,dy5,nNewLeft,nNewTop,nNewWidth,nNewHeight,fRatio,oRect=new nsCommon.Rect();refPoint=this.getPoint(ePosition,bRounded);refX=refPoint[0];refY=refPoint[1];nNewLeft=this.left;nNewTop=this.top;nNewWidth=this.width;nNewHeight=this.height;switch(ePosition){case nsCommon.DockPosition.topLeft:horzPosition=nsCommon.HorizontalAlignment.left;vertPosition=nsCommon.VerticalAlignment.top;break;case nsCommon.DockPosition.top:horzPosition=nsCommon.HorizontalAlignment.center;vertPosition=nsCommon.VerticalAlignment.top;x=refX;break;case nsCommon.DockPosition.topRight:horzPosition=nsCommon.HorizontalAlignment.right;vertPosition=nsCommon.VerticalAlignment.top;break;case nsCommon.DockPosition.right:horzPosition=nsCommon.HorizontalAlignment.right;vertPosition=nsCommon.VerticalAlignment.middle;y=refY;break;case nsCommon.DockPosition.bottomRight:horzPosition=nsCommon.HorizontalAlignment.right;vertPosition=nsCommon.VerticalAlignment.bottom;break;case nsCommon.DockPosition.bottom:horzPosition=nsCommon.HorizontalAlignment.center;vertPosition=nsCommon.VerticalAlignment.bottom;x=refX;break;case nsCommon.DockPosition.bottomLeft:horzPosition=nsCommon.HorizontalAlignment.left;vertPosition=nsCommon.VerticalAlignment.bottom;break;case nsCommon.DockPosition.left:horzPosition=nsCommon.HorizontalAlignment.left;vertPosition=nsCommon.VerticalAlignment.middle;y=refY;break}dx=x-refX;dy=y-refY;if(bKeepCenter){dx2=dx+dx;dy2=dy+dy}else{dx2=dx;dy2=dy}switch(horzPosition){case nsCommon.HorizontalAlignment.left:nNewWidth+=-dx2;break;case nsCommon.HorizontalAlignment.right:nNewWidth+=dx2;break}switch(vertPosition){case nsCommon.VerticalAlignment.top:nNewHeight+=-dy2;break;case nsCommon.VerticalAlignment.bottom:nNewHeight+=dy2;break}if(bKeepAspectRatio){if(this.width!==undefined&&!isNaN(this.width)&&this.width!==0&&this.height!==undefined&&!isNaN(this.height)&&this.height!==0){if(nNewWidth!==undefined&&!isNaN(nNewWidth)&&nNewWidth!==0&&nNewHeight!==undefined&&!isNaN(nNewHeight)&&nNewHeight!==0){fRatio=this.width/this.height;if(horzPosition===nsCommon.HorizontalAlignment.left||horzPosition===nsCommon.HorizontalAlignment.right){nNewHeight=nNewWidth/fRatio}else{if(vertPosition===nsCommon.VerticalAlignment.top||vertPosition===nsCommon.VerticalAlignment.bottom){nNewWidth=nNewHeight*fRatio}else{if(nNewWidth/this.width>=nNewHeight/this.height){nNewHeight=nNewWidth/fRatio}else{nNewWidth=nNewHeight*fRatio}}}if(bRounded){nNewWidth=Math.round(nNewWidth);nNewHeight=Math.round(nNewHeight)}}}}switch(horzPosition){case nsCommon.HorizontalAlignment.left:nNewLeft=x;break;case nsCommon.HorizontalAlignment.right:nNewLeft=x-nNewWidth;break}switch(vertPosition){case nsCommon.VerticalAlignment.top:nNewTop=y;break;case nsCommon.VerticalAlignment.bottom:nNewTop=y-nNewHeight;break}if(bKeepAspectRatio){dx3=nNewWidth-this.width;dy3=nNewHeight-this.height;dx4=dx3/2;dy4=dy3/2;if(bRounded){dx4=Math.round(dx4);dy4=Math.round(dy4)}if(bKeepCenter){dx5=dx4;dy5=dy4}else{dx5=0;dy5=0}switch(ePosition){case nsCommon.DockPosition.topLeft:nNewLeft=this.right+dx5-nNewWidth;nNewTop=this.bottom+dy5-nNewHeight;break;case nsCommon.DockPosition.top:nNewLeft-=dx4;break;case nsCommon.DockPosition.topRight:nNewLeft=this.left-dx5;nNewTop=this.bottom+dy5-nNewHeight;break;case nsCommon.DockPosition.right:nNewTop-=dy4;break;case nsCommon.DockPosition.bottomRight:nNewLeft=this.left-dx5;nNewTop=this.top-dy5;break;case nsCommon.DockPosition.bottom:nNewLeft-=dx4;break;case nsCommon.DockPosition.bottomLeft:nNewLeft=this.right+dx5-nNewWidth;nNewTop=this.top-dy5;break;case nsCommon.DockPosition.left:nNewTop-=dy4;break}}oRect.set(nNewLeft,nNewTop,nNewWidth,nNewHeight);if(bCreateNew){return oRect}else{this.set(oRect);return this}},getPoint:function(ePosition,bRounded){var rect=(new nsCommon.Rect(this)).normalize(),cx=rect.x+rect.width/2,cy=rect.y+rect.height/2,left=rect.x,top=rect.y,right=rect.x+rect.width,bottom=rect.y+rect.height,x,y;if(bRounded){cx=Math.round(cx);cy=Math.round(cy)}ePosition=sap.galilei.core.validateEnum(nsCommon.DockPosition,ePosition,nsCommon.DockPosition.center);x=cx;y=cy;switch(ePosition){case nsCommon.DockPosition.topLeft:x=left;y=top;break;case nsCommon.DockPosition.top:x=cx;y=top;break;case nsCommon.DockPosition.topRight:x=right;y=top;break;case nsCommon.DockPosition.right:x=right;y=cy;break;case nsCommon.DockPosition.bottomRight:x=right;y=bottom;break;case nsCommon.DockPosition.bottom:x=cx;y=bottom;break;case nsCommon.DockPosition.bottomLeft:x=left;y=bottom;break;case nsCommon.DockPosition.left:x=left;y=cy;break;case nsCommon.DockPosition.center:x=cx;y=cy;break}return[x,y]},getCenter:function(bRounded){return this.getPoint(nsCommon.DockPosition.center,bRounded)},setCenter:function(x,y,bRounded){if(x!==undefined&&!isNaN(x)&&y!==undefined&&!isNaN(y)){var aCenter=this.getCenter(bRounded);this.moveBy(x-aCenter[0],y-aCenter[1])}},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this.x+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this.y+=dy}},snapToGrid:function(nGridSize,bCreateNew){var oRect;if(bCreateNew){oRect=this.clone()}else{oRect=this}oRect.normalize(false);oRect.x=nsCommon.geometry.snapToGrid(oRect.x,nGridSize);oRect.y=nsCommon.geometry.snapToGrid(oRect.y,nGridSize);oRect.right=nsCommon.geometry.snapToGrid(oRect.right,nGridSize);oRect.bottom=nsCommon.geometry.snapToGrid(oRect.bottom,nGridSize);return oRect},equals:function(oRect){if(oRect){return(this.x===oRect.x&&this.y===oRect.y&&this.width===oRect.width&&this.height===oRect.height)}return false},isPointInRect:function(vPoint){if(vPoint){var x,y,left=Math.min(this.left,this.right),top=Math.min(this.top,this.bottom),right=Math.max(this.left,this.right),bottom=Math.max(this.top,this.bottom),aPoint;aPoint=nsCommon.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1];if(x!==undefined&&y!==undefined&&x>=left&&x<=right&&y>=top&&y<=bottom){return true}}}return false},isRectInRect:function(oRect){if(oRect){var left=oRect.left,top=oRect.top,right=oRect.right,bottom=oRect.bottom;if(left>=this.left&&left<=this.right&&right>=this.left&&right<=this.right&&top>=this.top&&top<=this.bottom&&bottom>=this.top&&bottom<=this.bottom){return true}}return false},isRectIntersectRect:function(oRect){if(oRect){var left=Math.max(this.left,oRect.left),top=Math.max(this.top,oRect.top),right=Math.min(this.right,oRect.right),bottom=Math.min(this.bottom,oRect.bottom);if(right>left&&bottom>top){return true}}return false},intersectRect:function(oRect){if(oRect){var left=Math.max(this.left,oRect.left),top=Math.max(this.top,oRect.top),right=Math.min(this.right,oRect.right),bottom=Math.min(this.bottom,oRect.bottom);if(right>left&&bottom>top){return new nsCommon.Rect(left,top,right-left,bottom-top)}}return undefined},isIntersectSegment:function(oSegment){if(oSegment){var aPoint1=oSegment.point1,aPoint2=oSegment.point2,a,b,c;if(aPoint1&&aPoint2){a=aPoint1[1]-aPoint2[1];b=aPoint2[0]-aPoint1[0];c=aPoint1[0]*aPoint2[1]-aPoint2[0]*aPoint1[1];if((a*this.left+b*this.top+c>=0&&a*this.right+b*this.bottom+c<=0)||(a*this.left+b*this.top+c<=0&&a*this.right+b*this.bottom+c>=0)||(a*this.left+b*this.bottom+c>=0&&a*this.right+b*this.top+c<=0)||(a*this.left+b*this.bottom+c<=0&&a*this.right+b*this.top+c>=0)){if((aPoint1[0]<this.left&&aPoint2[0]<this.left)||(aPoint1[0]>this.right&&aPoint2[0]>this.right)||(aPoint1[1]<this.top&&aPoint2[1]<this.top)||(aPoint1[1]>this.bottom&&aPoint2[1]>this.bottom)){return false}else{return true}}else{return false}}}return false},intersectSegment:function(oSegment,bRounded){if(oSegment&&oSegment.x1!==undefined&&oSegment.y1!==undefined&&oSegment.x2!==undefined&&oSegment.y2!==undefined&&this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined&&this.isPointInRect(oSegment.point1)&&!this.isPointInRect(oSegment.point2)){var x1=oSegment.x1,y1=oSegment.y1,x2=oSegment.x2,y2=oSegment.y2,slopeAngle=Math.atan2((y1-y2),(x1-x2)),absSlopeAngle=Math.abs(slopeAngle),cornerAngle=Math.atan2(this.height,this.width),x0,y0;if(absSlopeAngle>=0&&absSlopeAngle<=cornerAngle){x0=x1-(this.width/2);y0=y1-(this.width/2)*Math.tan(slopeAngle)}else{if(absSlopeAngle>=(Math.PI-cornerAngle)&&absSlopeAngle<=Math.PI){x0=x1+(this.width/2);y0=y1+(this.width/2)*Math.tan(slopeAngle)}else{if(slopeAngle>=cornerAngle&&slopeAngle<=(Math.PI-cornerAngle)){x0=x1-(this.height/2)/Math.tan(slopeAngle);y0=y1-(this.height/2)}else{if(slopeAngle<=-cornerAngle&&slopeAngle>=-(Math.PI-cornerAngle)){x0=x1+(this.height/2)/Math.tan(slopeAngle);y0=y1+(this.height/2)}else{x0=x1;y0=y1}}}}if(x0!==undefined&&y0!==undefined){if(bRounded){x0=Math.round(x0);y0=Math.round(y0)}return[x0,y0]}}return undefined},getPointDirection:function(aPoint){if(aPoint){var dToleft,dToRight,dToTop,dToBottom,x=aPoint[0],y=aPoint[1],cx=(this.left+this.right)/2,cy=(this.top+this.bottom)/2,dMin;if(this.isPointInRect(aPoint)){dToleft=Math.abs(x-this.left);dToRight=Math.abs(this.right-x);dToTop=Math.abs(y-this.top);dToBottom=Math.abs(this.bottom-y)}else{dToleft=Math.sqrt(Math.pow((x-this.left),2)+Math.pow((y-cy),2));dToRight=Math.sqrt(Math.pow((this.right-x),2)+Math.pow((cy-y),2));dToTop=Math.sqrt(Math.pow((x-cx),2)+Math.pow((y-this.top),2));dToBottom=Math.sqrt(Math.pow((cx-x),2)+Math.pow((this.bottom-y),2))}dMin=Math.min(dToleft,dToRight,dToTop,dToBottom);switch(dMin){case dToleft:return nsCommon.LinkDirection.west;case dToRight:return nsCommon.LinkDirection.east;case dToTop:return nsCommon.LinkDirection.north;case dToBottom:return nsCommon.LinkDirection.south}}return nsCommon.LinkDirection.DEFAULT},getClosestPointOnBorder:function(aPoint){var nDirection,x,y;if(aPoint){nDirection=this.getPointDirection(aPoint);switch(nDirection){case nsCommon.LinkDirection.west:x=this.x;y=aPoint[1];if(y<this.y){y=this.y}else{if(y>this.bottom){y=this.bottom}}break;case nsCommon.LinkDirection.east:x=this.right;y=aPoint[1];if(y<this.y){y=this.y}else{if(y>this.bottom){y=this.bottom}}break;case nsCommon.LinkDirection.north:x=aPoint[0];if(x<this.x){x=this.x}else{if(x>this.right){x=this.right}}y=this.y;break;case nsCommon.LinkDirection.south:x=aPoint[0];if(x<this.x){x=this.x}else{if(x>this.right){x=this.right}}y=this.bottom;break;default:break}}if(x!==undefined&&y!==undefined){return[x,y]}return undefined}},statics:{unionRect:function(rect1,rect2){var rect=new nsCommon.Rect();if(rect1&&rect2){rect.set(rect1);rect.unionRect(rect2)}return rect},unionPoint:function(rect,point){var newRect=new nsCommon.Rect();if(rect&&point){newRect.set(rect);newRect.unionPoint(point)}return newRect}}})});
namespace("sap.galilei.ui.common",function(nsCommon){nsCommon.Points=sap.galilei.core.defineCollectionClass({fullClassName:"sap.galilei.ui.common.Points",initialize:function(vPoints){this.set.apply(this,arguments)},properties:{points:{get:function(){return this},set:function(value){this.clear();if(value instanceof Array){this.addArray(value)}else{if(typeof value==="string"){this.addArray(nsCommon.Points.parse(value))}}}}},methods:{set:function(vPoints){this.points=vPoints},close:function(){var nLength;if(this.points!==undefined){nLength=this.points.length;if(nLength>1&&!nsCommon.Point.equals(this.points[0],this.points[nLength-1])){this.points.push(this.points[0])}}},toString:function(){return this.join(" ")},clone:function(){var oPoints=new nsCommon.Points(),aPoints=[];this.forEach(function(aPoint){aPoints.push([aPoint[0],aPoint[1]])});oPoints.points=aPoints;return oPoints},isHorizontal:function(nDelta){var i,y;if(nDelta===undefined){nDelta=0}if(this.length>=2){y=this[0][1];for(i=1;i<this.length;i++){if(Math.abs(this[i][1]-y)>nDelta){return false}}return true}return false},isVertical:function(nDelta){var i,x;if(nDelta===undefined){nDelta=0}if(this.length>=2){x=this[0][0];for(i=1;i<this.length;i++){if(Math.abs(this[i][0]-x)>nDelta){return false}}return true}return false},flipHorizontal:function(){var oRect=this.getBBox(),x1=oRect.x,x2=oRect.x+oRect.width;this.forEach(function(aPoint){aPoint[0]=(x1+x2)-aPoint[0]})},flipVertical:function(){var oRect=this.getBBox(),y1=oRect.y,y2=oRect.y+oRect.height;this.forEach(function(aPoint){aPoint[1]=(y1+y2)-aPoint[1]})},reverse:function(){var i,j,nHalf,x,y;if(this.length>2){nHalf=Math.floor(this.length/2);for(i=0;i<=nHalf;i++){j=this.length-i-1;x=this[i][0];y=this[i][1];this[i][0]=this[j][0];this[i][1]=this[j][1];this[j][0]=x;this[j][1]=y}}return this},matrixTransform:function(oMatrix,bRound,bCreateNew){var svgPoint=nsCommon.Point.svgPoint,newSvgPoint,svgMatrix=nsCommon.Matrix.svgMatrix,oPoints=(bCreateNew===true)?new nsCommon.Points():this,index,x,y;if(oMatrix){nsCommon.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);for(index=0;index<this.length;++index){svgPoint.x=this[index][0];svgPoint.y=this[index][1];newSvgPoint=svgPoint.matrixTransform(svgMatrix);if(bRound!==false){x=Math.round(newSvgPoint.x);y=Math.round(newSvgPoint.y)}else{x=newSvgPoint.x;y=newSvgPoint.y}if(bCreateNew===true){oPoints.add([x,y])}else{oPoints[index][0]=x;oPoints[index][1]=y}}}return oPoints},getBBox:function(){var oRect;this.forEach(function(aPoint){if(!oRect){oRect=new nsCommon.Rect();oRect.set(aPoint[0],aPoint[1],0,0)}else{oRect.unionPoint(aPoint)}},this);return oRect},moveBy:function(dx,dy){if(this.length&&dx!==undefined&&!isNaN(dx)&&dy!==undefined&&!isNaN(dy)&&(dx!==0||dy!==0)){this.forEach(function(aPoint){if(dx!==0){aPoint[0]+=dx}if(dy!==0){aPoint[1]+=dy}})}},snapToGrid:function(nGridSize,bCreateNew){var oPoints,index;if(bCreateNew){oPoints=this.clone()}else{oPoints=this}for(index=0;index<oPoints.length;++index){oPoints[index][0]=nsCommon.geometry.snapToGrid(oPoints[index][0],nGridSize);oPoints[index][1]=nsCommon.geometry.snapToGrid(oPoints[index][1],nGridSize)}return oPoints},equals:function(oPoints,nDelta){if(oPoints){var index;nDelta=nDelta===undefined?0:nDelta;if(oPoints.length!==this.length){return false}for(index=0;index<this.length;++index){if(Math.abs(this[index][0]-oPoints[index][0])>nDelta||Math.abs(this[index][1]-oPoints[index][1])>nDelta){return false}}return true}return false}},statics:{DIAGONAL_OFFSET:10,parse:function(sPoints){if(sPoints){var aPoints=sPoints.split(" "),index,aPt,aPointsArray=[];if(aPoints&&aPoints.length>=1){for(index=0;index<aPoints.length;index++){aPt=nsCommon.Point.parse(aPoints[index]);if(aPt){aPointsArray.push(aPt)}}}return aPointsArray}return undefined},toString:function(aPoints){return aPoints.join(" ")}}})});
(function(){sap.galilei.ui.common.Segment=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Segment",initialize:function(options){this.set.apply(this,arguments)},properties:{x1:undefined,y1:undefined,x2:undefined,y2:undefined,point1:{get:function(){return[this.x1,this.y1]}},point2:{get:function(){return[this.x2,this.y2]}},length:{get:function(){return sap.galilei.ui.common.Point.getDistance(this.point1,this.point2)}}},methods:{set:function(x1,y1,x2,y2){var pt1,pt2,oSegment;if(arguments.length===4){this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2}else{if(arguments.length===2){pt1=arguments[0];pt2=arguments[1];if((pt1 instanceof Array)&&pt1.length===2&&(pt2 instanceof Array)&&pt2.length===2){this.x1=pt1[0];this.y1=pt1[1];this.x2=pt2[0];this.y2=pt2[1]}else{if((typeof pt1)==="object"&&(typeof pt2)==="object"){this.x1=pt1.x;this.y1=pt1.y;this.x2=pt2.x;this.y2=pt2.y}}}else{if(arguments.length===1&&(typeof arguments)==="object"){oSegment=arguments[0];if(oSegment.x1!==undefined){this.x1=oSegment.x1}if(oSegment.y1!==undefined){this.y1=oSegment.y1}if(oSegment.x2!==undefined){this.x2=oSegment.x2}if(oSegment.y2!==undefined){this.y2=oSegment.y2}}}}return this},clone:function(){return new sap.galilei.ui.common.Segment(this)},matrixTransform:function(oMatrix,bRound,bCreateNew){var svgPoint1=sap.galilei.ui.common.Point.svgPoint,svgPoint2=sap.galilei.ui.common.Point.svgPoint2,pt1,pt2,svgMatrix=sap.galilei.ui.common.Matrix.svgMatrix;if(oMatrix){svgPoint1.x=this.x1;svgPoint1.y=this.y1;svgPoint2.x=this.x2;svgPoint2.y=this.y2;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);pt1=svgPoint1.matrixTransform(svgMatrix);pt2=svgPoint2.matrixTransform(svgMatrix);if(bRound!==false){pt1.x=Math.round(pt1.x);pt1.y=Math.round(pt1.y);pt2.x=Math.round(pt2.x);pt2.y=Math.round(pt2.y)}if(bCreateNew===true){return new sap.galilei.ui.common.Segment(pt1,pt2)}else{return this.set(pt1,pt2)}}else{return this}},getCenter:function(bRounded){return sap.galilei.ui.common.Segment.getCenter(this.point1,this.point2,bRounded)},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this.x1+=dx;this.x2+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this.y1+=dy;this.y2+=dy}},parallelMoveTo:function(x,y,bCreateNew){var x1=this.x1,y1=this.y1,x2=this.x2,y2=this.y2,k,b,k1,c,px1,py1,dx,dy,oSeg=this;if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined&&!isNaN(x1)&&!isNaN(y1)&&!isNaN(x2)&&!isNaN(y2)&&x!==undefined&&y!==undefined&&!isNaN(x)&&!isNaN(y)){if(bCreateNew){oSeg=new sap.galilei.ui.common.Segment(this)}if(x1===x2||y1===y2){if(x1===x2){oSeg.x1=oSeg.x2=x}if(y1===y2){oSeg.y1=oSeg.y2=y}}else{k=(y2-y1)/(x2-x1);b=y-k*x;k1=-(x2-x1)/(y2-y1);c=y1-k1*x1;px1=(c-b)/(k-k1);py1=k1*px1+c;dx=px1-x1;dy=py1-y1;oSeg.x1=px1;oSeg.y1=py1;oSeg.x2+=dx;oSeg.y2+=dy}return oSeg}},snapToGrid:function(nGridSize,bCreateNew){var oSegment;if(bCreateNew){oSegment=this.clone()}else{oSegment=this}oSegment.x1=sap.galilei.ui.common.geometry.snapToGrid(oSegment.x1,nGridSize);oSegment.y1=sap.galilei.ui.common.geometry.snapToGrid(oSegment.y1,nGridSize);oSegment.x2=sap.galilei.ui.common.geometry.snapToGrid(oSegment.x2,nGridSize);oSegment.y2=sap.galilei.ui.common.geometry.snapToGrid(oSegment.y2,nGridSize);return oSegment},equals:function(oSegment){if(oSegment){return(this.x1===oSegment.x1&&this.y1===oSegment.y1&&this.x2===oSegment.x2&&this.y2===oSegment.y2)}return false},intersectSegment:function(oSegment,bRounded){if(oSegment&&oSegment.x1!==undefined&&oSegment.y1!==undefined&&oSegment.x2!==undefined&&oSegment.y2!==undefined&&this.x1!==undefined&&this.y1!==undefined&&this.x2!==undefined&&this.y2!==undefined){var x0,y0,x1,y1,x2,y2,x3,y3,x4,y4,a,b,c,d;x1=this.x1;y1=this.y1;x2=this.x2;y2=this.y2;x3=oSegment.x1;y3=oSegment.y1;x4=oSegment.x2;y4=oSegment.y2;a=b=0;if(x1!==x2){a=(y1-y2)/(x1-x2);b=(y1-a*x1)}c=d=0;if(x3!==x4){c=(y3-y4)/(x3-x4);d=(y3-c*x3)}if(x1===x2){if(x3===x4){return undefined}x0=x1;y0=c*x0+d}else{if(x3===x4){x0=x3;y0=a*x0+b}else{if(a===c){return undefined}x0=(d-b)/(a-c);if(a===0){y0=y1}else{if(c===0){y0=y3}else{y0=a*x0+b}}}}if(x0!==undefined&&y0!==undefined){if(x0>=Math.min(x1-0.000001,x2-0.000001)&&x0<=Math.max(x1+0.000001,x2+0.000001)&&x0>=Math.min(x3-0.000001,x4-0.000001)&&x0<=Math.max(x3+0.000001,x4+0.000001)&&y0>=Math.min(y1-0.000001,y2-0.000001)&&y0<=Math.max(y1+0.000001,y2+0.000001)&&y0>=Math.min(y3-0.000001,y4-0.000001)&&y0<=Math.max(y3+0.000001,y4+0.000001)){if(bRounded){x0=Math.round(x0);y0=Math.round(y0)}return[x0,y0]}}}return undefined},isPointOnSegment:function(vPoint,nRadius){var aPoint,x,y,x1=this.x1,y1=this.y1,x2=this.x2,y2=this.y2,dPrecision=1e-9,oRect;aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}nRadius=(nRadius===undefined)?0:nRadius;if(x!==undefined&&y!==undefined&&x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined&&!isNaN(x)&&!isNaN(y)&&!isNaN(x1)&&!isNaN(y1)&&!isNaN(x2)&&!isNaN(y2)){if(nRadius>0){oRect=new sap.galilei.ui.common.Rect({x:x-nRadius,y:y-nRadius,width:nRadius+nRadius,height:nRadius+nRadius});return oRect.isIntersectSegment(this)}if(x>=Math.min(x1,x2)&&x<=Math.max(x1,x2)&&y>=Math.min(y1,y2)&&y<=Math.max(y1,y2)){if((y===y1&&y1===y2)||(x===x1&&x1===x2)){return true}if(Math.abs(((y1-y2)*x+(x2-x1)*y)-(y1*x2-x1*y2))<dPrecision){return true}}}return false}},statics:{getCenter:function(pt1,pt2,bRounded){var x1,y1,x2,y2,cx,cy;if((pt1 instanceof Array)&&(pt2 instanceof Array)){x1=+pt1[0];y1=+pt1[1];x2=+pt2[0];y2=+pt2[1]}else{if(pt1&&pt2){x1=+pt1.x;y1=+pt1.y;x2=+pt2.x;y2=+pt2.y}}if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined){cx=(x1+x2)/2;cy=(y1+y2)/2;if(bRounded){cx=Math.round(cx);cy=Math.round(cy)}}return[cx,cy]},getPointAt:function(pt1,pt2,nDistance,nMaxRatio,bRounded){var x1,y1,x2,y2,x,y,nLength,nMaxDistance;if((pt1 instanceof Array)&&(pt2 instanceof Array)){x1=+pt1[0];y1=+pt1[1];x2=+pt2[0];y2=+pt2[1]}else{if(pt1&&pt2){x1=+pt1.x;y1=+pt1.y;x2=+pt2.x;y2=+pt2.y}}nLength=sap.galilei.ui.common.Point.getDistance(pt1,pt2);if(nLength===0){x=x1;y=y1}else{if(nLength!==undefined){nMaxDistance=nLength;if(nMaxRatio!==undefined){nMaxDistance*=nMaxRatio}if(nDistance!==undefined){if(nDistance>nMaxDistance){nDistance=nMaxDistance}x=(x2-x1)*nDistance/nLength+x1;y=(y2-y1)*nDistance/nLength+y1}}}if(bRounded&&x!==undefined&&y!==undefined){x=Math.round(x);y=Math.round(y)}return[x,y]}}})}());
(function(){sap.galilei.ui.common.Path=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Path",statics:{ROUNDED_CORNER_SIZE:10,PATH_OPERATORS:{M:[2],m:[2],L:[2],l:[2],H:[1],h:[1],V:[1],v:[1],C:[2,2,2],c:[2,2,2],S:[2,2],s:[2,2],Q:[2,2],q:[2,2],T:[2],t:[2],A:[2,1,1,1,2],a:[2,1,1,1,2],Z:[0],z:[0]},generatePoint:function(aPoint){if(aPoint){return aPoint[0]+","+aPoint[1]}else{return""}},generatePolylinePath:function(aPoints,bClosed){var sPath,index;if(aPoints&&aPoints.length>1){sPath="M"+sap.galilei.ui.common.Path.generatePoint(aPoints[0]);for(index=1;index<aPoints.length;++index){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoints[index])}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},generateQuadraticBezierPath:function(aPoints,bClosed){var sPath="",index;if(aPoints&&aPoints.length===2){return this.generatePolylinePath(aPoints,bClosed)}if(aPoints&&aPoints.length>=3){sPath="M"+sap.galilei.ui.common.Path.generatePoint(aPoints[0]);for(index=0;index<aPoints.length-2;index+=2){sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint(aPoints[index+1])+" "+sap.galilei.ui.common.Path.generatePoint(aPoints[index+2])}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},generateCubicBezierPath:function(aPoints,bClosed){var sPath="",index;if(aPoints&&aPoints.length===2){return this.generatePolylinePath(aPoints,bClosed)}if(aPoints&&aPoints.length>=4){sPath="M"+sap.galilei.ui.common.Path.generatePoint(aPoints[0]);for(index=0;index<aPoints.length-3;index+=3){sPath+=" C"+sap.galilei.ui.common.Path.generatePoint(aPoints[index+1])+" "+sap.galilei.ui.common.Path.generatePoint(aPoints[index+2])+" "+sap.galilei.ui.common.Path.generatePoint(aPoints[index+3])}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},generateQuadraticBezierFromPoints:function(aPoints,bClosed){var aNewPoints,sPath;if(aPoints&&aPoints.length===2){return this.generatePolylinePath(aPoints,bClosed)}if(aPoints&&aPoints.length>1){aNewPoints=sap.galilei.ui.common.layout.PointsLayout.getQuadraticBezierPoints(aPoints,bClosed);if(aNewPoints){sPath=this.generateQuadraticBezierPath(aNewPoints,bClosed)}}return sPath},generateHalfCubicBezierFromPoints:function(aPoints,bClosed){var aNewPoints,sPath;if(aPoints&&aPoints.length===2){return this.generatePolylinePath(aPoints,bClosed)}if(aPoints&&aPoints.length>1){aNewPoints=sap.galilei.ui.common.layout.PointsLayout.getHalfCubicBezierPoints(aPoints,bClosed);if(aNewPoints){sPath=this.generateCubicBezierPath(aNewPoints,bClosed)}}return sPath},generateRoundedPath:function(aPoints,nCornerSize,bClosed){var aNewPoints,sPath="",index,pt;if(aPoints&&aPoints.length===2){return this.generatePolylinePath(aPoints,bClosed)}if(aPoints&&aPoints.length>1){if(nCornerSize===undefined){nCornerSize=sap.galilei.ui.common.Path.ROUNDED_CORNER_SIZE}aNewPoints=new sap.galilei.ui.common.Points();if(!bClosed){aNewPoints.add(aPoints[0])}else{pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[0],aPoints[1],nCornerSize,0.5);aNewPoints.add(pt)}for(index=1;index<aPoints.length-1;++index){pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[index],aPoints[index-1],nCornerSize,0.5);aNewPoints.add(pt);aNewPoints.add(aPoints[index]);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[index],aPoints[index+1],nCornerSize,0.5);aNewPoints.add(pt)}if(bClosed){pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[aPoints.length-1],aPoints[aPoints.length-2],nCornerSize,0.5);aNewPoints.add(pt);aNewPoints.add(aPoints[aPoints.length-1]);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[aPoints.length-1],aPoints[0],nCornerSize,0.5);aNewPoints.add(pt);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[0],aPoints[aPoints.length-1],nCornerSize,0.5);aNewPoints.add(pt);aNewPoints.add(aPoints[0]);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[0],aPoints[1],nCornerSize,0.5);aNewPoints.add(pt)}else{aNewPoints.add(aPoints[aPoints.length-1])}sPath="M"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[0]);for(index=1;index<aNewPoints.length;index+=3){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index]);if(index<aNewPoints.length-2){sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+1])+" "+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+2])}}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},generateDiagonalBezierFromPoints:function(aPoints,bHorizontal){var aPathPoints,sPath;if(aPoints&&aPoints.length>=2){aPathPoints=sap.galilei.ui.common.layout.PointsLayout.getDiagonalBezierPoints(aPoints,bHorizontal);if(aPathPoints&&aPathPoints.length===4){sPath=sap.galilei.ui.common.Path.generateCubicBezierPath(aPathPoints,false)}}return sPath},generateStreightLineFromPoints:function(aPoints){var aPathPoints,sPath;if(aPoints&&aPoints.length>=2){aPathPoints=sap.galilei.ui.common.layout.PointsLayout.getStreightLinePoints(aPoints);if(aPathPoints){sPath=sap.galilei.ui.common.Path.generatePolylinePath(aPathPoints,false)}}return sPath},generateDiagonalFromPoints:function(aPoints,bHorizontal){var aPathPoints,sPath;if(aPoints&&aPoints.length>=2){aPathPoints=sap.galilei.ui.common.layout.PointsLayout.getDiagonalPoints(aPoints,bHorizontal);if(aPathPoints){sPath=sap.galilei.ui.common.Path.generatePolylinePath(aPathPoints,false)}}return sPath},parse:function(sPath){var aTokens,index,sToken,sOper,aArgSets,aOperators=[],oOperator,nArguments=0;function getArgumentsNumber(aArgSets){var nArgs=0;if(aArgSets){aArgSets.forEach(function(nNumber){nArgs+=+nNumber})}return nArgs}if(sPath){aTokens=sPath.split(new RegExp("[ ,]+","g"));for(index=0;index<aTokens.length;index++){sToken=aTokens[index];if(nArguments){if(oOperator){oOperator.args.push(+sToken)}nArguments--;if(nArguments===0&&oOperator){aOperators.push(oOperator);oOperator=undefined}}else{sOper=sToken.slice(0,1);aArgSets=sap.galilei.ui.common.Path.PATH_OPERATORS[sOper];if(aArgSets){sToken=sToken.substring(1);nArguments=getArgumentsNumber(aArgSets);oOperator={};oOperator.operator=sOper;oOperator.args=[];if(nArguments&&sToken!==""){oOperator.args.push(+sToken);nArguments--}if(nArguments===0){aOperators.push(oOperator);oOperator=undefined}}}}}return aOperators},serializePathOperators:function(aOperators){var sPath;function serializeArguments(aArgs,aArgSets){var index=0,sArguments="";if(aArgs&&aArgSets){aArgSets.forEach(function(nSet){var sArg;if(nSet>0){sArg=aArgs.slice(index,index+nSet).join(",");if(sArg){if(sArguments!==""){sArguments+=" "}sArguments+=sArg}index+=nSet}})}return sArguments}if(aOperators){aOperators.forEach(function(oOperator){var sOper=oOperator.operator,aArgs=oOperator.args,aArgSets=sap.galilei.ui.common.Path.PATH_OPERATORS[sOper];if(!sPath){sPath=""}else{sPath+=" "}sPath+=sOper+serializeArguments(aArgs,aArgSets)})}return sPath},getPolylineFromPath:function(sPath){var aOperators,aPoints=[],nStyle=sap.galilei.ui.common.LineStyle.normal,x0=0,y0=0,oLastOperator,bLastHorizontal=false,bLastVertical=false,bIsClosed=false,dx,dy,lastQX,lastQY,lastQX2,lastQY2,lastSX,lastSY,oPolyline;function addLastPoint(){if(lastQX!==undefined&&lastQY!==undefined){aPoints.push([lastQX,lastQY]);lastQX=undefined;lastQY=undefined}if(lastSX!==undefined&&lastSY!==undefined){aPoints.push([lastSX,lastSY]);lastSX=undefined;lastSY=undefined}}function getPointsFromOperator(oOperator){var sOper=oOperator.operator,aArgs=oOperator.args,nLastIndex,x,y,rx,ry,bProcessed=false;if(bIsClosed){return}switch(sOper){case"M":case"m":addLastPoint();x=aArgs[0];y=aArgs[1];if(sOper==="m"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0]);bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"L":case"l":addLastPoint();x=aArgs[0];y=aArgs[1];if(sOper==="l"){x+=x0;y+=y0}if(x===x0){bLastVertical=true;dy=y-y0}else{bLastVertical=false}if(y===y0){bLastHorizontal=true;dx=x-x0}else{bLastHorizontal=false}x0=x;y0=y;aPoints.push([x0,y0]);oLastOperator=oOperator;break;case"H":case"h":addLastPoint();x=aArgs[0];if(sOper==="h"){x+=x0}dx=x-x0;x0=x;aPoints.push([x0,y0]);bLastHorizontal=true;bLastVertical=false;oLastOperator=oOperator;break;case"V":case"v":addLastPoint();y=aArgs[0];if(sOper==="v"){y+=y0}dy=y-y0;y0=y;aPoints.push([x0,y0]);bLastHorizontal=false;bLastVertical=true;oLastOperator=oOperator;break;case"A":case"a":addLastPoint();if(oLastOperator&&(oLastOperator.operator==="L"||oLastOperator.operator==="l")){rx=aArgs[0];ry=aArgs[1];nLastIndex=aPoints.length-1;if(bLastHorizontal){aPoints[nLastIndex][0]+=dx>=0?rx:-rx;x0=aPoints[nLastIndex][0];nStyle=sap.galilei.ui.common.LineStyle.rounded;bProcessed=true}else{if(bLastVertical){aPoints[nLastIndex][1]+=dy>=0?ry:-ry;y0=aPoints[nLastIndex][1];nStyle=sap.galilei.ui.common.LineStyle.rounded;bProcessed=true}}}if(!bProcessed){x=aArgs[5];y=aArgs[6];if(sOper==="a"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0])}bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"C":case"c":addLastPoint();x0=aArgs[0];y0=aArgs[1];aPoints.push([x0,y0]);x0=aArgs[2];y0=aArgs[3];aPoints.push([x0,y0]);x=aArgs[4];y=aArgs[5];if(sOper==="c"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0]);lastSX=aArgs[2]+(x0-aArgs[2])*2;lastSY=aArgs[3]+(y0-aArgs[3])*2;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"S":case"s":addLastPoint();x0=aArgs[0];y0=aArgs[1];aPoints.push([x0,y0]);x=aArgs[2];y=aArgs[3];if(sOper==="s"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0]);lastSX=aArgs[0]+(x0-aArgs[0])*2;lastSY=aArgs[1]+(y0-aArgs[1])*2;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"Q":case"qs":x0=aArgs[0];y0=aArgs[1];aPoints.push([x0,y0]);x=aArgs[2];y=aArgs[3];if(sOper==="q"){x+=x0;y+=y0}x0=x;y0=y;lastQX=x0;lastQY=y0;lastQX2=aArgs[0]+(x0-aArgs[0])*2;lastQY2=aArgs[1]+(y0-aArgs[1])*2;nStyle=sap.galilei.ui.common.LineStyle.bezier;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"T":case"t":x=aArgs[0];y=aArgs[1];if(sOper==="t"){x+=x0;y+=y0}x0=x;y0=y;if(lastQX2!==undefined&&lastQY2!==undefined){aPoints.push([lastQX2,lastQY2]);lastQX2=undefined;lastQY2=undefined}lastQX=undefined;lastQY=undefined;aPoints.push([x0,y0]);nStyle=sap.galilei.ui.common.LineStyle.bezier;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"Z":case"z":addLastPoint();bIsClosed=true;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break}}if(sPath){aOperators=sap.galilei.ui.common.Path.parse(sPath);if(aOperators){aOperators.forEach(getPointsFromOperator);addLastPoint()}}if(aPoints.length>0){oPolyline={points:aPoints,lineStyle:nStyle,isClosed:bIsClosed}}return oPolyline}}})}());
(function(){namespace("sap.galilei.ui.common.geometry");sap.galilei.ui.common.geometry.isPointInEllipse=function(vPoint,oRect){if(vPoint&&oRect){var aPoint,rx,ry,h,k,oCenter,sum,x,y;rx=oRect.width/2;ry=oRect.height/2;oCenter=oRect.getCenter(false);h=oCenter[0];k=oCenter[1];aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}if(x!==undefined&&y!==undefined){sum=((x-h)*(x-h))/(rx*rx)+((y-k)*(y-k))/(ry*ry);if(sum>1.000000000001){return false}else{return true}}}return false};sap.galilei.ui.common.geometry.intersectSegmentEllipse=function(oSegment,oRect){if(oSegment&&oRect){var oCenter,x,y,h,k,x1,y1,x2,y2,xMin,yMin,xMax,yMax,a,b,c,delta,bInside1,bInside2,a2,b2,c2,delta2,d,A,B,C;oCenter=oRect.getCenter(false);h=oCenter[0];k=oCenter[1];x1=oSegment.x1;y1=oSegment.y1;x2=oSegment.x2;y2=oSegment.y2;xMin=Math.min(x1,x2);xMax=Math.max(x1,x2);yMin=Math.min(y1,y2);yMax=Math.max(y1,y2);a=oRect.width/2;b=oRect.height/2;bInside1=sap.galilei.ui.common.geometry.isPointInEllipse(oSegment.point1,oRect);bInside2=sap.galilei.ui.common.geometry.isPointInEllipse(oSegment.point2,oRect);if(bInside1===bInside2){return undefined}a2=a*a;if(x1!==x2){c=(y2-y1)/(x2-x1);d=-c*(x1-h)+y1-k;b2=b*b;c2=c*c;A=b2+a2*c2;B=a2*c*d*2;C=a2*(d*d-b2);delta2=B*B-4*A*C;if(delta2<0){return undefined}delta=Math.sqrt(delta2);x=(-B+delta)/A/2+h;if(x<xMin||x>xMax){x=(-B-delta)/A/2+h}y=c*(x-h)+d+k}else{x=x1;delta=Math.sqrt(a2-(x1-h)*(x1-h));y=k+delta*b/a;if(y<yMin||y>yMax){y=k-delta*b/a}}if(x>=xMin&&x<=xMax&&y>=yMin&&y<=yMax){return[x,y]}return undefined}return undefined};sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx=function(width,bRounded){if(width!==undefined&&!isNaN(width)){var rx=width/6;if(bRounded){rx=Math.round(rx)}return rx}return undefined};sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy=function(height,bRounded){if(height!==undefined&&!isNaN(height)){var ry=height/6;if(bRounded){ry=Math.round(ry)}return ry}return undefined};sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR=function(width,height,bRounded){var rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(width,bRounded),ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(height,bRounded);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined};sap.galilei.ui.common.geometry.isPointInRoundedRectangle=function(vPoint,oRect,rx,ry){if(vPoint&&oRect&&oRect.width!==undefined&&oRect.height!==undefined){if(rx===undefined&&ry===undefined){rx=ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(oRect.width,oRect.height)}else{if(rx===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(oRect.width)}else{if(ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(oRect.height)}}}if(oRect.isPointInRect(vPoint)){var oRectH,oRectV,oRectCorner,rx2,ry2;oRectH=oRect.inflate(0,-ry,0,-ry,true);if(oRectH.isPointInRect(vPoint)){return true}oRectV=oRect.inflate(-rx,0,-rx,0,true);if(oRectV.isPointInRect(vPoint)){return true}oRectCorner=new sap.galilei.ui.common.Rect();rx2=rx+rx;ry2=ry+ry;oRectCorner.set(oRect.left,oRect.top,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}oRectCorner.set(oRect.right-rx2,oRect.top,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}oRectCorner.set(oRect.right-rx2,oRect.bottom-ry2,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}oRectCorner.set(oRect.left,oRect.bottom-ry2,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}}}return false};sap.galilei.ui.common.geometry.intersectSegmentRoundedRectangle=function(oSegment,oRect,rx,ry){if(oSegment&&oRect&&oRect.width!==undefined&&oRect.height!==undefined){if(rx===undefined&&ry===undefined){rx=ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(oRect.width,oRect.height)}else{if(rx===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(oRect.width)}else{if(ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(oRect.height)}}}var oRectH,oRectV,aPoint,aCornerPoint,oRectCorner,oSeg,oSegEllipse,rx2,ry2;oSeg=oSegment;if(sap.galilei.ui.common.geometry.isPointInRoundedRectangle(oSegment.point1,oRect,rx,ry)){oSeg=new sap.galilei.ui.common.Segment(oSegment.point2,oSegment.point1)}oRectH=oRect.inflate(0,-ry,0,-ry,true);aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectH.left,oRectH.top,oRectH.left,oRectH.bottom),false);if(aPoint!==undefined){return aPoint}aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectH.right,oRectH.top,oRectH.right,oRectH.bottom),false);if(aPoint!==undefined){return aPoint}oRectV=oRect.inflate(-rx,0,-rx,0,true);aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectV.left,oRectV.top,oRectV.right,oRectV.top),false);if(aPoint!==undefined){return aPoint}aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectV.left,oRectV.bottom,oRectV.right,oRectV.bottom),false);if(aPoint!==undefined){return aPoint}oRectCorner=new sap.galilei.ui.common.Rect();rx2=rx+rx;ry2=ry+ry;oRectCorner.set(oRect.left,oRect.top,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.left,oRectCorner.top+ry,oRectCorner.right-rx,oRectCorner.top),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left&&aPoint[0]<=oRectCorner.left+rx&&aPoint[1]>=oRectCorner.top&&aPoint[1]<=oRectCorner.top+ry){return aPoint}oRectCorner.set(oRect.right-rx2,oRect.top,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.right,oRectCorner.top+ry,oRectCorner.left+rx,oRectCorner.top),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left+rx&&aPoint[0]<=oRectCorner.right&&aPoint[1]>=oRectCorner.top&&aPoint[1]<=oRectCorner.top+ry){return aPoint}oRectCorner.set(oRect.right-rx2,oRect.bottom-ry2,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.right,oRectCorner.bottom-ry,oRectCorner.left+rx,oRectCorner.bottom),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left+rx&&aPoint[0]<=oRectCorner.right&&aPoint[1]>=oRectCorner.bottom-ry&&aPoint[1]<=oRectCorner.bottom){return aPoint}oRectCorner.set(oRect.left,oRect.bottom-ry2,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.left,oRectCorner.bottom-ry,oRectCorner.left+rx,oRectCorner.bottom),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left&&aPoint[0]<=oRectCorner.left+rx&&aPoint[1]>=oRectCorner.bottom-ry&&aPoint[1]<=oRectCorner.bottom){return aPoint}}return undefined};sap.galilei.ui.common.geometry.isPointOnPolyline=function(vPoint,aPoints,nRadius){var i,bResult=false,oSegment;if(vPoint&&aPoints){for(i=0;i<aPoints.length-1;i++){oSegment=new sap.galilei.ui.common.Segment(aPoints[i],aPoints[i+1]);if(oSegment.isPointOnSegment(vPoint,nRadius)){bResult=true;break}}}return bResult};sap.galilei.ui.common.geometry.isPointInPolygon=function(vPoint,aPoints){if(vPoint&&aPoints){var aPoint,i,j,x,y,bResult,aPoint1,aPoint2;if(aPoints.length<3){return false}aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}if(x!==undefined&&y!==undefined){j=aPoints.length-1;bResult=false;for(i=0;i<aPoints.length;i++){aPoint1=aPoints[i];aPoint2=aPoints[j];if(((aPoint1[1]>y)!==(aPoint2[1]>y))&&(x<(aPoint2[0]-aPoint1[0])*(y-aPoint1[1])/(aPoint2[1]-aPoint1[1])+aPoint1[0])){bResult=!bResult}j=i}if(!bResult){bResult=sap.galilei.ui.common.geometry.isPointOnPolyline(vPoint,aPoints)}return bResult}}return false};sap.galilei.ui.common.geometry.intersectSegmentPolygon=function(oSegment,aPoints){var aIntersectPt,aPt1,aPt2,index,oSegInit,oSegPart;if(oSegment&&aPoints){if(aPoints.length<3){return aIntersectPt}oSegInit=new sap.galilei.ui.common.Segment(oSegment);aPt1=aPoints[aPoints.length-1];for(index=0;index<aPoints.length;index++){aPt2=aPoints[index];oSegPart=new sap.galilei.ui.common.Segment(aPt1,aPt2);aPt1=oSegInit.intersectSegment(oSegPart);if(aPt1){aIntersectPt=aPt1;oSegInit.x2=aPt1[0];oSegInit.y2=aPt1[1]}aPt1=aPt2}}return aIntersectPt};sap.galilei.ui.common.geometry._isPointOnBezierCursve=function(aPoint,aPoint0,aPoint11,aPoint12,aPoint2,bCubic,nRadius){var t,t0,t1,nStep=0.01,dx,dy,d,x,y,aPointCurve=[],oPointRect=new sap.galilei.ui.common.Rect();if(aPoint&&aPoint0&&aPoint11&&aPoint2){x=aPoint[0];y=aPoint[1];if(bCubic){dx=Math.max(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0])-Math.min(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0]);dy=Math.max(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])-Math.min(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])}else{dx=Math.max(aPoint0[0],aPoint11[0],aPoint2[0])-Math.min(aPoint0[0],aPoint11[0],aPoint2[0]);dy=Math.max(aPoint0[1],aPoint11[1],aPoint2[1])-Math.min(aPoint0[1],aPoint11[1],aPoint2[1])}d=Math.max(dx,dy);if(d>0){nStep=1/(d/(nRadius>0?nRadius:5))}for(t=0;t<1.01;t+=nStep){if(bCubic){t0=1-t;t1=3*t*t0;aPointCurve[0]=Math.round(Math.pow(t0,3)*aPoint0[0]+t1*t0*aPoint11[0]+t1*t*aPoint12[0]+Math.pow(t,3)*aPoint2[0]);aPointCurve[1]=Math.round(Math.pow(t0,3)*aPoint0[1]+t1*t0*aPoint11[1]+t1*t*aPoint12[1]+Math.pow(t,3)*aPoint2[1])}else{t0=1-t;t1=2*t*t0;aPointCurve[0]=Math.round(Math.pow(t0,2)*aPoint0[0]+t1*aPoint11[0]+Math.pow(t,2)*aPoint2[0]);aPointCurve[1]=Math.round(Math.pow(t0,2)*aPoint0[1]+t1*aPoint11[1]+Math.pow(t,2)*aPoint2[1])}oPointRect.set(x-nRadius,y-nRadius,nRadius+nRadius,nRadius+nRadius);if(sap.galilei.ui.common.geometry.isPointInEllipse(aPointCurve,oPointRect)){return true}}}return false};sap.galilei.ui.common.geometry._intersectSegmentBezierCurve=function(oSegment,aPoint0,aPoint11,aPoint12,aPoint2,bCubic){var t,t0,t1,nStep=0.01,dx,dy,d,aPointBegin=[],aPointEnd=[],aPoint,oSegmentPart=new sap.galilei.ui.common.Segment();if(oSegment&&aPoint0&&aPoint11&&aPoint2){if(bCubic){dx=Math.max(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0])-Math.min(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0]);dy=Math.max(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])-Math.min(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])}else{dx=Math.max(aPoint0[0],aPoint11[0],aPoint2[0])-Math.min(aPoint0[0],aPoint11[0],aPoint2[0]);dy=Math.max(aPoint0[1],aPoint11[1],aPoint2[1])-Math.min(aPoint0[1],aPoint11[1],aPoint2[1])}d=Math.max(dx,dy);if(d>0){nStep=1/(d/5)}aPointBegin[0]=aPoint0[0];aPointBegin[1]=aPoint0[1];for(t=0;t<1.01;t+=nStep){if(bCubic){t0=1-t;t1=3*t*t0;aPointEnd[0]=Math.round(Math.pow(t0,3)*aPoint0[0]+t1*t0*aPoint11[0]+t1*t*aPoint12[0]+Math.pow(t,3)*aPoint2[0]);aPointEnd[1]=Math.round(Math.pow(t0,3)*aPoint0[1]+t1*t0*aPoint11[1]+t1*t*aPoint12[1]+Math.pow(t,3)*aPoint2[1])}else{t0=1-t;t1=2*t*t0;aPointEnd[0]=Math.round(Math.pow(t0,2)*aPoint0[0]+t1*aPoint11[0]+Math.pow(t,2)*aPoint2[0]);aPointEnd[1]=Math.round(Math.pow(t0,2)*aPoint0[1]+t1*aPoint11[1]+Math.pow(t,2)*aPoint2[1])}oSegmentPart.set(aPointEnd,aPointBegin);aPoint=oSegmentPart.intersectSegment(oSegment,false);if(aPoint){return aPoint}aPointBegin[0]=aPointEnd[0];aPointBegin[1]=aPointEnd[1]}}return undefined};sap.galilei.ui.common.geometry.isPointOnBezier=function(vPoint,aPoints,bCubic,nRadius){if(vPoint&&aPoints){var aPoint,length=aPoints.length,index,nStep,x,y,aPoint0,aPoint11,aPoint12,aPoint2;bCubic=(bCubic===undefined)?false:bCubic;nRadius=(nRadius===undefined)?1:nRadius;if((!bCubic&&length>=3)||(bCubic&&length>=4)){aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}if(x!==undefined&&y!==undefined){nStep=bCubic?3:2;for(index=0;index<length-nStep;index+=nStep){aPoint0=aPoints[index];if(bCubic){aPoint11=aPoints[index+1];aPoint12=aPoints[index+2];aPoint2=aPoints[index+3];if(x<Math.min(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0])||x>Math.max(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0])){continue}if(y<Math.min(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])||y>Math.max(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])){continue}}else{aPoint11=aPoints[index+1];aPoint2=aPoints[index+2];if(x<Math.min(aPoint0[0],aPoint11[0],aPoint2[0])||x>Math.max(aPoint0[0],aPoint11[0],aPoint2[0])){continue}if(y<Math.min(aPoint0[1],aPoint11[1],aPoint2[1])||y>Math.max(aPoint0[1],aPoint11[1],aPoint2[1])){continue}}if(sap.galilei.ui.common.geometry._isPointOnBezierCursve(aPoint,aPoint0,aPoint11,aPoint12,aPoint2,bCubic,nRadius)){return true}}}}}return false};sap.galilei.ui.common.geometry.intersectSegmentBezier=function(oSegment,aPoints,bCubic){if(oSegment&&aPoints){var aPoint,length=aPoints.length,index,nStep,x,y,aPoint0,aPoint11,aPoint12,aPoint2;bCubic=(bCubic===undefined)?false:bCubic;if((!bCubic&&length>=3)||(bCubic&&length>=4)){nStep=bCubic?3:2;for(index=0;index<length-nStep;index+=nStep){aPoint0=aPoints[index];if(bCubic){aPoint11=aPoints[index+1];aPoint12=aPoints[index+2];aPoint2=aPoints[index+3];if(x<Math.min(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0])||x>Math.max(aPoint0[0],aPoint11[0],aPoint12[0],aPoint2[0])){continue}if(y<Math.min(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])||y>Math.max(aPoint0[1],aPoint11[1],aPoint12[1],aPoint2[1])){continue}}else{aPoint11=aPoints[index+1];aPoint2=aPoints[index+2];if(x<Math.min(aPoint0[0],aPoint11[0],aPoint2[0])||x>Math.max(aPoint0[0],aPoint11[0],aPoint2[0])){continue}if(y<Math.min(aPoint0[1],aPoint11[1],aPoint2[1])||y>Math.max(aPoint0[1],aPoint11[1],aPoint2[1])){continue}}aPoint=sap.galilei.ui.common.geometry._intersectSegmentBezierCurve(oSegment,aPoint0,aPoint11,aPoint12,aPoint2,bCubic);if(aPoint){return aPoint}}}}return undefined};sap.galilei.ui.common.geometry.isPointOnDiagonalBezier=function(vPoint,aPoints,bHorizontal,nRadius){var aPathPoints;if(aPoints&&aPoints.length>=2){aPathPoints=sap.galilei.ui.common.layout.PointsLayout.getDiagonalBezierPoints(aPoints,bHorizontal);if(aPathPoints&&aPathPoints.length===4){return sap.galilei.ui.common.geometry.isPointOnBezier(vPoint,aPathPoints,true,nRadius)}}return false};sap.galilei.ui.common.geometry.snapToGrid=function(nPosition,nGridSize){if(nPosition!==undefined&&!isNaN(nPosition)&&nGridSize!==undefined&&nGridSize!==0&&!isNaN(nGridSize)){var nMultiplier=(nPosition-0.001)/nGridSize;nMultiplier=Math.round(nMultiplier);nPosition=nMultiplier*nGridSize}return nPosition}}());
(function(){namespace("sap.galilei.ui.common.canvas");sap.galilei.ui.common.canvas.Canvas=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.canvas.Canvas",statics:{HIDDEN_CANVAS_ID:"__canvas__",HIDDEN_CANVAS_CLASS:"hiddenCanvas",NEWLINE_SEPARATOR:"\r\n",DEFAULT_FONT:"12px Arial, Helvetica, sans-serif",_defaultCanvas:undefined,_defaultContext:undefined,fontProperties:undefined,fontHeight:undefined,defaultCanvas:{get:function(){if(!this._defaultCanvas){this._defaultCanvas=document.createElement("canvas");this._defaultCanvas.setAttribute("id",this.HIDDEN_CANVAS_ID);this._defaultCanvas.setAttribute("class",this.HIDDEN_CANVAS_CLASS);this._defaultCanvas.setAttribute("width","0");this._defaultCanvas.setAttribute("height","0");this._defaultCanvas.setAttribute("visibility","hidden")}return this._defaultCanvas}},removeCanvas:function(){this._defaultCanvas=undefined;this._defaultContext=undefined},defaultContext:{get:function(){if(!this._defaultContext){var canvas=this.defaultCanvas;if(canvas&&canvas.getContext){this._defaultContext=canvas.getContext("2d");if(this._defaultContext){if(!this.fontProperties){this.fontProperties=this._defaultContext.font}else{this._defaultContext.font=this.fontProperties}if(!this.fontHeight){this.fontHeight=this.computeFontHeight(this.fontProperties)}}}}return this._defaultContext}},font:function(sFontProps){var oContext;if(!sFontProps||sFontProps.length===0){if(this.fontProperties){sFontProps=this.fontProperties}else{sFontProps=this.DEFAULT_FONT}}if(this.fontProperties!==sFontProps||!this._defaultContext){oContext=this.defaultContext;if(oContext){oContext.font=sFontProps}this.fontProperties=sFontProps;this.fontHeight=this.computeFontHeight(sFontProps)}return sFontProps},computeFontHeight:function(sFontProps){var iSize=10,aNumbers;if(sFontProps&&sFontProps.length>0){aNumbers=sFontProps.match(/\d+/g);if(aNumbers&&aNumbers.length>0){iSize=+aNumbers[0]}}return iSize},getFontHeight:function(sFontProps){if((!sFontProps||sFontProps.length===0)&&this.fontHeight){return this.fontHeight}var sCurrentFont=this.font();if(sCurrentFont===sFontProps&&this.fontHeight){return this.fontHeight}this.fontHeight=this.computeFontHeight(sFontProps||sCurrentFont);return this.fontHeight},measureText:function(text,sFontProps){text=(text==undefined)?"":text;var oContext=this.defaultContext;if(oContext!==undefined){this.font(sFontProps);return oContext.measureText(text)}return undefined},measureTextLineWidth:function(text,sFontProps){if(text!=undefined&&text.length>0){var oMetrics=this.measureText(text,sFontProps);if(oMetrics!==undefined){return oMetrics.width}}return 0},measureTextSize:function(text,sFontProps){var iWidth=0,iHeight=0,aLines,i,sLine,iLineWidth,iLineHeight;if(text){aLines=text.split(this.NEWLINE_SEPARATOR);if(aLines&&aLines.length>0){this.font(sFontProps);iLineHeight=this.getFontHeight();for(i=0;i<aLines.length;++i){sLine=aLines[i];iLineWidth=this.measureTextLineWidth(sLine);iWidth=Math.max(iWidth,iLineWidth);iHeight+=iLineHeight}}}return{width:iWidth,height:iHeight}},convertImageToDataUrl:function(oImage,sImageFormat,oOptions){var oCanvas,oContext,x,y,width,height,bAdjustTargetImageSize,bFitInTargetImage,backColor,nCanvasWidth,nCanvasHeight,oRect,sURL;if(oImage){try{oCanvas=this.defaultCanvas;oContext=this.defaultContext;if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}oOptions=oOptions||{};x=oOptions.x;y=oOptions.y;width=oOptions.width;height=oOptions.height;bAdjustTargetImageSize=(oOptions.adjustTargetImageSize!==undefined)?oOptions.adjustTargetImageSize:true;bFitInTargetImage=(oOptions.fitInTargetImage!==undefined)?oOptions.fitInTargetImage:true;backColor=oOptions.backColor;if(isNaN(width)||isNaN(height)){x=y=0;nCanvasWidth=width=oImage.width;nCanvasHeight=height=oImage.height}else{oRect=new sap.galilei.ui.common.Rect({x:0,y:0,width:oImage.width,height:oImage.height});oRect.resize(width,height,false,true,false,true);if(bAdjustTargetImageSize){x=y=0;nCanvasWidth=width=oRect.width;nCanvasHeight=height=oRect.height}else{nCanvasWidth=width;nCanvasHeight=height;if(isNaN(x)||isNaN(y)){x=Math.floor((width-oRect.width)/2);y=Math.floor((height-oRect.height)/2)}if(bFitInTargetImage){width=oRect.width;height=oRect.height}else{width=oImage.width;height=oImage.height}}}oCanvas.setAttribute("width",nCanvasWidth);oCanvas.setAttribute("height",nCanvasHeight);if(backColor){oContext.fillStyle=backColor;oContext.fillRect(0,0,nCanvasWidth,nCanvasHeight)}oContext.drawImage(oImage,x,y,width,height);sURL=oCanvas.toDataURL(sImageFormat,(sImageFormat==="image/jpeg")?1:undefined);this._defaultContext=undefined;return sURL}catch(e){if(typeof canvg!=="undefined"&&oContext.drawSvg){try{oContext.drawSvg(oImage,x,y,width,height);sURL=oCanvas.toDataURL(sImageFormat,(sImageFormat==="image/jpeg")?1:undefined);this._defaultContext=undefined;return sURL}catch(e2){this.removeCanvas();throw"Cannot convert a HTML image to data URL. Usually, it is caused by cross-origine security issue. ("+e2.message+")"}}else{this.removeCanvas();throw"Cannot convert a HTML image to data URL. Usually, it is caused by cross-origine security issue. ("+e.message+")"}}finally{this._defaultContext=undefined}}return undefined}}})}());
(function(){sap.galilei.ui.common.Device=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Device",statics:{_screenWidth:undefined,_screenHeight:undefined,_dpiX:undefined,_dpiY:undefined,screenWidth:{get:function(){return window&&window.screen.width}},screenHeight:{get:function(){return window&&window.screen.height}},devicePixelRatio:{get:function(){if(window&&window.devicePixelRatio!==undefined){return window&&window.devicePixelRatio}return 1}},screenDpiX:{get:function(){sap.galilei.ui.common.Device._getScreenDpi();if(sap.galilei.ui.common.Device._dpiX!==undefined&&sap.galilei.ui.common.Device.devicePixelRatio!==undefined){return sap.galilei.ui.common.Device._dpiX*sap.galilei.ui.common.Device.devicePixelRatio}}},screenDpiY:{get:function(){sap.galilei.ui.common.Device._getScreenDpi();if(sap.galilei.ui.common.Device._dpiY!==undefined&&sap.galilei.ui.common.Device.devicePixelRatio!==undefined){return sap.galilei.ui.common.Device._dpiY*sap.galilei.ui.common.Device.devicePixelRatio}}},_getScreenDpi:function(){var oDiv;if(sap.galilei.ui.common.Device._dpiX===undefined||sap.galilei.ui.common.Device._dpiY===undefined||sap.galilei.ui.common.Device._screenWidth===undefined||sap.galilei.ui.common.Device._screenWidth!==sap.galilei.ui.common.Device.screenWidth||sap.galilei.ui.common.Device._screenHeight===undefined||sap.galilei.ui.common.Device._screenHeight!==sap.galilei.ui.common.Device.screenHeight){sap.galilei.ui.common.Device._screenWidth=sap.galilei.ui.common.Device.screenWidth;sap.galilei.ui.common.Device._screenHeight=sap.galilei.ui.common.Device.screenHeight;if(document&&document.body){jQuery("body").append("<div id='dpiDetector' style='width:1in;padding:0px;height:1in;visibility:hidden;' />");oDiv=jQuery("#dpiDetector");if(oDiv){sap.galilei.ui.common.Device._dpiX=+oDiv.prop("offsetWidth");sap.galilei.ui.common.Device._dpiY=+oDiv.prop("offsetHeight");oDiv.remove();return}}}sap.galilei.ui.common.Device._dpiX=96;sap.galilei.ui.common.Device._dpiY=96}}})}());
(function(){sap.galilei.ui.common.MeasureUnits={mm:"mm",inch:"inch",px:"px"};sap.galilei.ui.common.Measure=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Measure",statics:{convertMeasure:function(nValue,sFromUnit,sToUnit,nPrecision){if(nValue!==undefined&&!isNaN(nValue)&&sFromUnit&&sToUnit){switch(sFromUnit){case sap.galilei.ui.common.MeasureUnits.mm:switch(sToUnit){case sap.galilei.ui.common.MeasureUnits.inch:nValue/=25.4;break}break;case sap.galilei.ui.common.MeasureUnits.inch:switch(sToUnit){case sap.galilei.ui.common.MeasureUnits.mm:nValue*=25.4;break}break}}if(nValue!==undefined&&!isNaN(nValue)&&nPrecision!==undefined&&!isNaN(nPrecision)){nValue=+nValue.toFixed(nPrecision)}return nValue},measureToPixel:function(nValue,sFromUnit,bIsXAxis,nPrecision){if(nValue!==undefined&&!isNaN(nValue)&&sFromUnit){if(sFromUnit===sap.galilei.ui.common.MeasureUnits.mm){nValue/=25.4}if(bIsXAxis===undefined||bIsXAxis){nValue*=sap.galilei.ui.common.Device.screenDpiX}else{nValue*=sap.galilei.ui.common.Device.screenDpiY}}if(nValue!==undefined&&!isNaN(nValue)&&nPrecision!==undefined&&!isNaN(nPrecision)){nValue=+nValue.toFixed(nPrecision)}return nValue},pixelToMeasure:function(nValue,sToUnit,bIsXAxis,nPrecision){if(nValue!==undefined&&!isNaN(nValue)&&sToUnit){if(bIsXAxis===undefined||bIsXAxis){nValue/=sap.galilei.ui.common.Device.screenDpiX}else{nValue/=sap.galilei.ui.common.Device.screenDpiY}if(sToUnit===sap.galilei.ui.common.MeasureUnits.mm){nValue*=25.4}}if(nValue!==undefined&&!isNaN(nValue)&&nPrecision!==undefined&&!isNaN(nPrecision)){nValue=+nValue.toFixed(nPrecision)}return nValue}}})}());
(function(){sap.galilei.ui.common.PaperTypes={A5:"A5",A4:"A4",A3:"A3",B5:"B5",B4:"B4",letter:"letter",legal:"legal",ledger:"ledger",custom:"custom"};sap.galilei.ui.common.PaperSizes={A5:{paperWidth:148,paperHeight:210,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},A4:{paperWidth:210,paperHeight:297,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},A3:{paperWidth:297,paperHeight:420,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},B5:{paperWidth:176,paperHeight:250,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},B4:{paperWidth:250,paperHeight:353,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},letter:{paperWidth:215.9,paperHeight:279.4,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},legal:{paperWidth:215.9,paperHeight:355.6,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10},ledger:{paperWidth:279.4,paperHeight:431.8,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10}};sap.galilei.ui.common.PageOrientations={portrait:"portrait",landscape:"landscape"};sap.galilei.ui.common.Page=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Page",properties:{paperType:sap.galilei.ui.common.PaperTypes.A4,paperWidth:210,paperHeight:297,paperLeftMargin:10,paperTopMargin:10,paperRightMargin:10,paperBottomMargin:10,pageOrientation:sap.galilei.ui.common.PageOrientations.portrait,isCanChangeOrientation:true,pageScale:1,pageWidth:{get:function(){var nWidth;if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){nWidth=this.paperWidth-this.paperLeftMargin-this.paperRightMargin}else{nWidth=this.paperHeight-this.paperTopMargin-this.paperBottomMargin}if(this.pageScale!==undefined&&!isNaN(this.pageScale)&&this.pageScale!==0){nWidth/=this.pageScale}return nWidth}},pageHeight:{get:function(){var nWidth;if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){nWidth=this.paperHeight-this.paperTopMargin-this.paperBottomMargin}else{nWidth=this.paperWidth-this.paperLeftMargin-this.paperRightMargin}if(this.pageScale!==undefined&&!isNaN(this.pageScale)&&this.pageScale!==0){nWidth/=this.pageScale}return nWidth}},pageLeftMargin:{get:function(){if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){return this.paperLeftMargin}else{return this.paperTopMargin}}},pageTopMargin:{get:function(){if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){return this.paperTopMargin}else{return this.paperLeftMargin}}},pageRightMargin:{get:function(){if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){return this.paperRightMargin}else{return this.paperBottomMargin}}},pageBottomMargin:{get:function(){if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){return this.paperBottomMargin}else{return this.paperRightMargin}}},pageWidthPixels:{get:function(){return sap.galilei.ui.common.Measure.measureToPixel(this.pageWidth,"mm",true,0)}},pageHeightPixels:{get:function(){return sap.galilei.ui.common.Measure.measureToPixel(this.pageHeight,"mm",false,0)}},pageLeftOffsetPixels:{get:function(){return -Math.floor(this.pageWidthPixels/2)}},pageTopOffsetPixels:{get:function(){return -Math.floor(this.pageHeightPixels/2)}},pageLeftMarginPixels:{get:function(){return sap.galilei.ui.common.Measure.measureToPixel(this.pageLeftMargin,"mm",false,0)}},pageTopMarginPixels:{get:function(){return sap.galilei.ui.common.Measure.measureToPixel(this.pageTopMargin,"mm",false,0)}},pageRightMarginPixels:{get:function(){return sap.galilei.ui.common.Measure.measureToPixel(this.pageRightMargin,"mm",false,0)}},pageBottomMarginPixels:{get:function(){return sap.galilei.ui.common.Measure.measureToPixel(this.pageBottomMargin,"mm",false,0)}}},methods:{clone:function(){return new sap.galilei.ui.common.Page(this)},set:function(oPage){if(oPage){if(oPage.paperType!==undefined){this.paperType=oPage.paperType}if(oPage.paperWidth!==undefined){this.paperWidth=oPage.paperWidth}if(oPage.paperHeight!==undefined){this.paperHeight=oPage.paperHeight}if(oPage.paperLeftMargin!==undefined){this.paperLeftMargin=oPage.paperLeftMargin}if(oPage.paperTopMargin!==undefined){this.paperTopMargin=oPage.paperTopMargin}if(oPage.paperRightMargin!==undefined){this.paperRightMargin=oPage.paperRightMargin}if(oPage.paperBottomMargin!==undefined){this.paperBottomMargin=oPage.paperBottomMargin}if(oPage.pageOrientation!==undefined){this.pageOrientation=oPage.pageOrientation}if(oPage.isCanChangeOrientation!==undefined){this.isCanChangeOrientation=oPage.isCanChangeOrientation}if(oPage.pageScale!==undefined){this.pageScale=oPage.pageScale}}},getPaperSize:function(sUnit,nPrecision){var nWidth,nHeight,nLeftMargin,nTopMargin,nRightMargin,nBottomMargin,oPaper={};nWidth=this.paperWidth;nHeight=this.paperHeight;nLeftMargin=this.paperLeftMargin;nTopMargin=this.paperTopMargin;nRightMargin=this.paperRightMargin;nBottomMargin=this.paperBottomMargin;if(sUnit){switch(sUnit){case sap.galilei.ui.common.MeasureUnits.inch:nWidth=sap.galilei.ui.common.Measure.convertMeasure(nWidth,"mm","inch",nPrecision);nHeight=sap.galilei.ui.common.Measure.convertMeasure(nHeight,"mm","inch",nPrecision);nLeftMargin=sap.galilei.ui.common.Measure.convertMeasure(nLeftMargin,"mm","inch",nPrecision);nTopMargin=sap.galilei.ui.common.Measure.convertMeasure(nTopMargin,"mm","inch",nPrecision);nRightMargin=sap.galilei.ui.common.Measure.convertMeasure(nRightMargin,"mm","inch",nPrecision);nBottomMargin=sap.galilei.ui.common.Measure.convertMeasure(nBottomMargin,"mm","inch",nPrecision);break;case sap.galilei.ui.common.MeasureUnits.px:nWidth=sap.galilei.ui.common.Measure.measureToPixel(nWidth,"mm",true,nPrecision);nHeight=sap.galilei.ui.common.Measure.measureToPixel(nHeight,"mm",false,nPrecision);nLeftMargin=sap.galilei.ui.common.Measure.measureToPixel(nLeftMargin,"mm",true,nPrecision);nTopMargin=sap.galilei.ui.common.Measure.measureToPixel(nTopMargin,"mm",false,nPrecision);nRightMargin=sap.galilei.ui.common.Measure.measureToPixel(nRightMargin,"mm",true,nPrecision);nBottomMargin=sap.galilei.ui.common.Measure.measureToPixel(nBottomMargin,"mm",false,nPrecision);break}}oPaper.paperType=this.paperType;oPaper.paperWidth=nWidth;oPaper.paperHeight=nHeight;oPaper.paperLeftMargin=nLeftMargin;oPaper.paperTopMargin=nTopMargin;oPaper.paperRightMargin=nRightMargin;oPaper.paperBottomMargin=nBottomMargin;return oPaper},setPaperSize:function(sPaperType,oOptions){if(sPaperType){switch(sPaperType){case sap.galilei.ui.common.PaperTypes.A5:case sap.galilei.ui.common.PaperTypes.A4:case sap.galilei.ui.common.PaperTypes.A3:case sap.galilei.ui.common.PaperTypes.B5:case sap.galilei.ui.common.PaperTypes.B4:case sap.galilei.ui.common.PaperTypes.letter:case sap.galilei.ui.common.PaperTypes.legal:case sap.galilei.ui.common.PaperTypes.ledger:this.paperType=sPaperType;oOptions=oOptions||sap.galilei.ui.common.PaperSizes[sPaperType];break;default:this.paperType=sap.galilei.ui.common.PaperTypes.custom;break}if(oOptions){this.set(oOptions)}}},getPageSize:function(sUnit,nPrecision){var nWidth,nHeight,nLeftMargin,nTopMargin,nRightMargin,nBottomMargin,oPage={};nWidth=this.pageWidth;nHeight=this.pageHeight;nLeftMargin=this.pageLeftMargin;nTopMargin=this.pageTopMargin;nRightMargin=this.pageRightMargin;nBottomMargin=this.pageBottomMargin;if(sUnit){switch(sUnit){case sap.galilei.ui.common.MeasureUnits.inch:nWidth=sap.galilei.ui.common.Measure.convertMeasure(nWidth,"mm","inch",nPrecision);nHeight=sap.galilei.ui.common.Measure.convertMeasure(nHeight,"mm","inch",nPrecision);nLeftMargin=sap.galilei.ui.common.Measure.convertMeasure(nLeftMargin,"mm","inch",nPrecision);nTopMargin=sap.galilei.ui.common.Measure.convertMeasure(nTopMargin,"mm","inch",nPrecision);nRightMargin=sap.galilei.ui.common.Measure.convertMeasure(nRightMargin,"mm","inch",nPrecision);nBottomMargin=sap.galilei.ui.common.Measure.convertMeasure(nBottomMargin,"mm","inch",nPrecision);break;case sap.galilei.ui.common.MeasureUnits.px:nWidth=sap.galilei.ui.common.Measure.measureToPixel(nWidth,"mm",true,nPrecision);nHeight=sap.galilei.ui.common.Measure.measureToPixel(nHeight,"mm",false,nPrecision);nLeftMargin=sap.galilei.ui.common.Measure.measureToPixel(nLeftMargin,"mm",true,nPrecision);nTopMargin=sap.galilei.ui.common.Measure.measureToPixel(nTopMargin,"mm",false,nPrecision);nRightMargin=sap.galilei.ui.common.Measure.measureToPixel(nRightMargin,"mm",true,nPrecision);nBottomMargin=sap.galilei.ui.common.Measure.measureToPixel(nBottomMargin,"mm",false,nPrecision);break}}oPage.pageWidth=nWidth;oPage.pageHeight=nHeight;oPage.pageLeftOffset=this.pageLeftOffsetPixels;oPage.pageTopOffset=this.pageTopOffsetPixels;oPage.pageLeftMargin=nLeftMargin;oPage.pageTopMargin=nTopMargin;oPage.pageRightMargin=nRightMargin;oPage.pageBottomMargin=nBottomMargin;oPage.pageOrientation=this.pageOrientation;oPage.pageScale=this.pageScale;return oPage},getUsedPages:function(oDiagramRect,bKeepPageOrigin){var oNewDiagramRect,oRect=new sap.galilei.ui.common.Rect(),oPage=this.getPageSize(sap.galilei.ui.common.MeasureUnits.px,0),nPageWidth=oPage.pageWidth,nPageHeight=oPage.pageHeight,nOffsetX=oPage.pageLeftOffset,nOffsetY=oPage.pageTopOffset,x2,y2,oPages={},i,j,x0,y0,nPageScale,nPageScale1,nPageScale2;if(oDiagramRect){bKeepPageOrigin=(bKeepPageOrigin===undefined)?true:bKeepPageOrigin;oNewDiagramRect=oDiagramRect.clone();if(bKeepPageOrigin){oNewDiagramRect.moveBy(-nOffsetX,-nOffsetY);oRect.x=Math.floor(oNewDiagramRect.x/nPageWidth)*nPageWidth;oRect.y=Math.floor(oNewDiagramRect.y/nPageHeight)*nPageHeight;x2=Math.floor((oNewDiagramRect.x+oNewDiagramRect.width-sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN)/nPageWidth)*nPageWidth+nPageWidth;y2=Math.floor((oNewDiagramRect.y+oNewDiagramRect.height-sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN)/nPageHeight)*nPageHeight+nPageHeight;oRect.width=x2-oRect.x;oRect.height=y2-oRect.y;oRect.moveBy(nOffsetX,nOffsetY)}else{oRect.x=oRect.y=0;x2=Math.floor((oNewDiagramRect.width-sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN)/nPageWidth)*nPageWidth+nPageWidth;y2=Math.floor((oNewDiagramRect.height-sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN)/nPageHeight)*nPageHeight+nPageHeight;oRect.width=x2-oRect.x;oRect.height=y2-oRect.y;oRect.x=-(oRect.width-oNewDiagramRect.width)/2;oRect.y=-(oRect.height-oNewDiagramRect.height)/2}}oPages.usedPagesRect=oRect;oPages.pageWidth=nPageWidth;oPages.pageHeight=nPageHeight;oPages.horizontalPages=Math.round(oRect.width/nPageWidth);oPages.verticalPages=Math.round(oRect.height/nPageHeight);oPages.totalPages=oPages.horizontalPages*oPages.verticalPages;nPageScale1=oNewDiagramRect.width/(nPageWidth*oPages.horizontalPages);nPageScale2=oNewDiagramRect.height/(nPageHeight*oPages.verticalPages);nPageScale=Math.min(nPageScale1,nPageScale2);oPages.pageScale=nPageScale;oPages.usedPages=[];for(j=0,y0=oRect.y;j<oPages.verticalPages;j++,y0+=nPageHeight){for(i=0,x0=oRect.x;i<oPages.horizontalPages;i++,x0+=nPageWidth){oPages.usedPages.push(new sap.galilei.ui.common.Rect(x0,y0,nPageWidth,nPageHeight))}}return oPages},getAllPagesRect:function(nHorzPages,nVertPages){var oRect=new sap.galilei.ui.common.Rect(),nWidth,nHeight,nLeft,nTop;if(nHorzPages!==undefined&&!isNaN(nHorzPages)&&nHorzPages>=0&&nVertPages!==undefined&&!isNaN(nVertPages)&&nVertPages>=0){nLeft=Math.floor((nHorzPages-1)/2);nTop=Math.floor((nVertPages-1)/2);if(nLeft<0){nLeft=0}if(nTop<0){nTop=0}nWidth=this.pageWidthPixels;nHeight=this.pageHeightPixels;oRect.x=-nWidth*nLeft+this.pageLeftOffsetPixels;oRect.y=-nHeight*nTop+this.pageTopOffsetPixels;oRect.width=nWidth*nHorzPages;oRect.height=nHeight*nVertPages}return oRect},fitToOnePage:function(oDiagramRect,bCanChangeOrientation){var oNewDiagramRect,nOldPageScale,oPageRect,oPageRect2,oFitRect,oFitRect2,nPageScale=1,nPageScale2=1,sOrientation=this.pageOrientation,oFitToOnePage={};if(oDiagramRect){oNewDiagramRect=oDiagramRect.clone();oNewDiagramRect.x=0;oNewDiagramRect.y=0;bCanChangeOrientation=bCanChangeOrientation!==undefined?bCanChangeOrientation:false;nOldPageScale=this.pageScale;this.pageScale=1;oPageRect=new sap.galilei.ui.common.Rect(0,0,this.pageWidthPixels,this.pageHeightPixels);oFitRect=oNewDiagramRect.resize(oPageRect.width,oPageRect.height,true,true,false,true);if(oNewDiagramRect.width!==0){nPageScale=oFitRect.width/oNewDiagramRect.width}else{if(oNewDiagramRect.height!==0){nPageScale=oFitRect.height/oNewDiagramRect.height}}if(bCanChangeOrientation){oPageRect2=new sap.galilei.ui.common.Rect(0,0,this.pageHeightPixels,this.pageWidthPixels);oFitRect2=oNewDiagramRect.resize(oPageRect2.width,oPageRect2.height,true,true,false,true);if(oNewDiagramRect.width!==0){nPageScale2=oFitRect2.width/oNewDiagramRect.width}else{if(oNewDiagramRect.height!==0){nPageScale2=oFitRect2.height/oNewDiagramRect.height}}if(nPageScale2>nPageScale){sOrientation=(sOrientation===sap.galilei.ui.common.PageOrientations.landscape)?sap.galilei.ui.common.PageOrientations.portrait:sap.galilei.ui.common.PageOrientations.landscape;nPageScale=nPageScale2;oPageRect=oPageRect2;oFitRect=oFitRect2}}if(nPageScale>1){nPageScale=1;oFitRect=oNewDiagramRect}oFitRect.x=Math.floor((oPageRect.width-oFitRect.width)/2);oFitRect.y=Math.floor((oPageRect.height-oFitRect.height)/2);this.pageScale=nOldPageScale}oFitToOnePage.pageOrientation=sOrientation;oFitToOnePage.pageScale=nPageScale;oFitToOnePage.pageWidthPixels=oPageRect.width;oFitToOnePage.pageHeightPixels=oPageRect.height;oFitToOnePage.diagramLeftOffset=oFitRect.x;oFitToOnePage.diagramTopOffset=oFitRect.y;oFitToOnePage.diagramWidth=oFitRect.width;oFitToOnePage.diagramHeight=oFitRect.height;oFitToOnePage.horizontalPages=1;oFitToOnePage.verticalPages=1;oFitToOnePage.totalPages=1;return oFitToOnePage},fitToPages:function(oDiagramRect,bCanChangeOrientation){var oNewDiagramRect,oOldPage,oFitToPages={},oUsedPages,oUsedPages2,i,j,x0,y0,offsetX,offsetY,nPageWidth,nPageHeight;if(oDiagramRect){oNewDiagramRect=oDiagramRect.clone();bCanChangeOrientation=bCanChangeOrientation!==undefined?bCanChangeOrientation:false;oOldPage=this.clone();this.pageScale=1;oFitToPages=this.fitToOnePage(oNewDiagramRect,bCanChangeOrientation);if(oFitToPages.pageScale<0.5){this.pageScale=0.5;offsetX=oDiagramRect.x-this.pageLeftOffsetPixels;offsetY=oDiagramRect.y-this.pageTopOffsetPixels;oNewDiagramRect.moveBy(-offsetX,-offsetY);oUsedPages=this.getUsedPages(oNewDiagramRect,false);if(bCanChangeOrientation){this.pageOrientation=(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait)?sap.galilei.ui.common.PageOrientations.landscape:sap.galilei.ui.common.PageOrientations.portrait;oUsedPages2=this.getUsedPages(oNewDiagramRect,false);if(oUsedPages2.totalPages<oUsedPages.totalPages||(oUsedPages2.totalPages===oUsedPages.totalPages&&oUsedPages2.pageScale>oUsedPages.pageScale)){oUsedPages=oUsedPages2}else{this.pageOrientation=oOldPage.pageOrientation}}this.paperType=sap.galilei.ui.common.PaperTypes.custom;this.paperWidth-=this.paperLeftMargin+this.paperRightMargin;this.paperHeight-=this.paperTopMargin+this.paperBottomMargin;this.paperLeftMargin=0;this.paperTopMargin=0;this.paperRightMargin=0;this.paperBottomMargin=0;if(this.pageOrientation===sap.galilei.ui.common.PageOrientations.portrait){this.paperWidth=this.paperWidth*oUsedPages.horizontalPages;this.paperHeight=this.paperHeight*oUsedPages.verticalPages}else{this.paperWidth=this.paperWidth*oUsedPages.verticalPages;this.paperHeight=this.paperHeight*oUsedPages.horizontalPages}oFitToPages=this.fitToOnePage(oNewDiagramRect,false);oFitToPages.horizontalPages=oUsedPages.horizontalPages;oFitToPages.verticalPages=oUsedPages.verticalPages;oFitToPages.totalPages=oUsedPages.totalPages}this.set(oOldPage);this.pageOrientation=oFitToPages.pageOrientation;this.pageScale=1;oFitToPages.pageWidthPixels=this.pageWidthPixels;oFitToPages.pageHeightPixels=this.pageHeightPixels;this.pageScale=oFitToPages.pageScale;nPageWidth=this.pageWidthPixels;nPageHeight=this.pageHeightPixels;oFitToPages.usedPages=[];for(j=0,y0=0;j<oFitToPages.verticalPages;j++,y0+=nPageHeight){for(i=0,x0=0;i<oFitToPages.horizontalPages;i++,x0+=nPageWidth){oFitToPages.usedPages.push(new sap.galilei.ui.common.Rect(x0,y0,nPageWidth,nPageHeight))}}this.set(oOldPage)}return oFitToPages}}})}());
(function(){namespace("sap.galilei.ui.common.svg");sap.galilei.ui.common.svg.Svg=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.svg.Svg",statics:{HIDDEN_SVG_ID:"__hiddenSvg__",HIDDEN_SVG_CLASS:"hiddenSvg",SVG_RECT_MARGIN:4,_svgHiddenNode:undefined,hiddenSvg:{get:function(){if(!this._svgHiddenNode){this._svgHiddenNode=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svgHiddenNode.setAttribute("id",this.HIDDEN_SVG_ID);this._svgHiddenNode.setAttribute("class",this.HIDDEN_SVG_CLASS);this._svgHiddenNode.setAttribute("width",0);this._svgHiddenNode.setAttribute("height",0);this._svgHiddenNode.setAttribute("visibility","hidden")}return this._svgHiddenNode}},_idsMap:undefined,serializeToXML:function(svgElement){var oSerializer,sSVG='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n';if(svgElement){if(window.XMLSerializer){try{oSerializer=new window.XMLSerializer();sSVG+=oSerializer.serializeToString(svgElement);sSVG=sap.galilei.ui.common.svg.Svg.removeInvalidCharacters(sSVG);sSVG=sap.galilei.ui.common.svg.Svg.removeEmptyNamepaces(sSVG);return sSVG}catch(e){console.log("XML Serialization error "+e)}}else{if(svgElement.xml){sSVG+=svgElement.xml;return sSVG}else{console.log("The browser does not support XMLSerializer.")}}}return undefined},removeInvalidCharacters:function(sSVG){var oExpr;if(sSVG){oExpr=new RegExp(/[^\u0009\u000A\u000D\u0020-\uD7FF\uE000-\uFFFD\u10000-\u10FFF]+/g);sSVG=sSVG.replace(oExpr,"")}return sSVG},removeEmptyNamepaces:function(sSVG){var oExpr,aMatches,sMatch,sNs,i;if(!sSVG){return sSVG}if(navigator.appVersion.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1){oExpr=new RegExp('transform="" requiredFeatures="" requiredExtensions="" systemLanguage=""',"g");sSVG=sSVG.replace(oExpr,"");oExpr=new RegExp('xmlns:([A-Z]|[a-z]|[0-9])+=\\"\\"',"g");aMatches=sSVG.match(oExpr);if(aMatches&&aMatches.length>0){for(i=0;i<aMatches.length;i++){sMatch=aMatches[i];oExpr=new RegExp(sMatch,"g");sSVG=sSVG.replace(oExpr,"");sNs=sMatch.substring(6,sMatch.length-3).trim();sMatch=" "+sNs+":";oExpr=new RegExp(sMatch,"g");sSVG=sSVG.replace(oExpr,"")}}}return sSVG},parseSVGContent:function(sSVG){var oParser;if(sSVG&&window.DOMParser){try{sSVG=sap.galilei.ui.common.svg.Svg.removeInvalidCharacters(sSVG);oParser=new DOMParser();return oParser.parseFromString(sSVG,"image/svg+xml")}catch(e){}}else{console.log("The browser does not support DOMParser.")}return undefined},convertSvgToDataUrl:function(sSVG){var sDataURL;if(sSVG){sDataURL="data:image/svg+xml;base64,"+sap.galilei.ui.common.Blob.encodeBase64Text(sSVG)}return sDataURL},replaceImageUrlToDataUrl:function(oSvgNode,fnSuccess){var sHref,sImageURL,oImage,nWidth,nHeight,sDataUrl,aNodes=[],nIndexNode;function findImageNodes(oNode){var index;if(oNode){if(oNode.nodeName==="image"){sHref=oNode.getAttribute("xlink:href")||oNode.getAttribute("href");if(sHref&&sHref.length>0){if(sHref.substring(0,1)!=="#"){aNodes.push(oNode)}}}for(index=0;index<oNode.childNodes.length;index++){findImageNodes(oNode.childNodes[index])}}}function downloadImage(){var oNode=aNodes[nIndexNode];sImageURL=oNode.getAttribute("xlink:href")||oNode.getAttribute("href");nWidth=oNode.getAttribute("width");nHeight=oNode.getAttribute("height");nWidth=parseInt(nWidth);nHeight=parseInt(nHeight);if(nWidth>0&&nHeight>0){oImage=new Image(nWidth,nHeight)}else{oImage=new Image()}oImage.onload=function(){try{if(nWidth===0){nWidth=oImage.width}if(nHeight===0){nHeight=oImage.height}sDataUrl=sap.galilei.ui.common.canvas.Canvas.convertImageToDataUrl(oImage,"image/png",{width:nWidth,height:nHeight});if(sDataUrl){if(oNode.getAttribute("xlink:href")){oNode.setAttribute("xlink:href",sDataUrl)}else{oNode.setAttribute("href",sDataUrl)}}}catch(e){}finally{nIndexNode++;if(nIndexNode===aNodes.length){if(fnSuccess){fnSuccess()}}else{downloadImage()}}};oImage.onerror=function(){nIndexNode++;if(nIndexNode===aNodes.length){if(fnSuccess){fnSuccess()}}else{downloadImage()}};oImage.src=sImageURL}if(oSvgNode){findImageNodes(oSvgNode)}if(aNodes.length>0){nIndexNode=0;downloadImage()}else{if(fnSuccess){fnSuccess()}}},resizeSVG:function(sSVG,width,height){var oRootNode,index,oNode,svgWidth,svgHeight;if(sSVG&&width!==undefined&&height!==undefined){oRootNode=sap.galilei.ui.common.svg.Svg.parseSVGContent(sSVG);if(oRootNode){for(index=0;index<oRootNode.childNodes.length;index++){oNode=oRootNode.childNodes[index];if(oNode.nodeName==="svg"){svgWidth=oNode.getAttribute("width");svgHeight=oNode.getAttribute("height");oNode.setAttribute("width",width);oNode.setAttribute("height",height);oNode.setAttribute("viewBox","0 0 "+svgWidth+" "+svgHeight);break}}return sap.galilei.ui.common.svg.Svg.serializeToXML(oRootNode)}}return sSVG},getCurrentScale:function(){var oSvg=sap.galilei.ui.common.svg.Svg.hiddenSvg,nScale;document.body.appendChild(oSvg);nScale=sap.galilei.ui.common.svg.Svg.hiddenSvg.currentScale;document.body.removeChild(oSvg);return nScale},_hideEmptyElements:function(oSvgParent,aNodes){if(oSvgParent&&aNodes){var index,oNode,bHide;for(index=0;index<oSvgParent.childNodes.length;index++){oNode=oSvgParent.childNodes[index];bHide=false;if(oNode.nodeName==="text"&&!oNode.textContent&&oNode.getAttribute("display")!=="none"){bHide=true}else{if((oNode.nodeName==="rect"||oNode.nodeName==="ellipse"||oNode.nodeName==="circle")&&oNode.getAttribute("width")==0&&oNode.getAttribute("height")==0&&oNode.getAttribute("display")!=="none"){bHide=true}}if(bHide){oNode.setAttribute("display","none");aNodes.push(oNode)}sap.galilei.ui.common.svg.Svg._hideEmptyElements(oNode,aNodes)}}return aNodes},_showEmptyElements:function(aNodes){if(aNodes){var index,oNode;for(index=0;index<aNodes.length;index++){oNode=aNodes[index];oNode.setAttribute("display","inline")}}},getChildNodesBBox:function(oSvgParentElement,bIncludeTransform,bExcludeEmptyText){var oViewBox,bFirst=true,i,oNode,oBbox,aEmptyNodes=[];bIncludeTransform=(bIncludeTransform===undefined)?true:bIncludeTransform;bExcludeEmptyText=(bExcludeEmptyText===undefined)?false:bExcludeEmptyText;if(oSvgParentElement){if(bExcludeEmptyText){aEmptyNodes=sap.galilei.ui.common.svg.Svg._hideEmptyElements(oSvgParentElement,aEmptyNodes)}for(i=0;i<oSvgParentElement.childNodes.length;i++){oNode=oSvgParentElement.childNodes[i];oBbox=sap.galilei.ui.common.svg.Svg.getBBox(oNode,bIncludeTransform,oSvgParentElement,bExcludeEmptyText);if(oBbox){if(bFirst){oViewBox=new sap.galilei.ui.common.Rect(oBbox);bFirst=false}else{oViewBox.unionRect(oBbox)}}}if(bExcludeEmptyText&&aEmptyNodes&&aEmptyNodes.length>0){sap.galilei.ui.common.svg.Svg._showEmptyElements(aEmptyNodes)}}return oViewBox},getBBox:function(oSvgElement,bIncludeTransform,oNearestViewport,bExcludeEmptyText){if(oSvgElement){var oBBoxElement,oBBox,aEmptyNodes=[],matrix,inverseMatrix,x,y,width,height;bIncludeTransform=(bIncludeTransform===undefined)?true:bIncludeTransform;bExcludeEmptyText=(bExcludeEmptyText===undefined)?true:bExcludeEmptyText;if(bExcludeEmptyText){aEmptyNodes=sap.galilei.ui.common.svg.Svg._hideEmptyElements(oSvgElement,aEmptyNodes)}if(oSvgElement.correspondingUseElement){oSvgElement=oSvgElement.correspondingUseElement}if(oSvgElement.nodeName[0]!=="#"){try{oBBox=oSvgElement.getBBox()}catch(e){}}if(oBBox){oBBoxElement=new sap.galilei.ui.common.Rect(oBBox);if(oBBoxElement.width===0){oBBoxElement.width=1}if(oBBoxElement.height===0){oBBoxElement.height=1}}if(bExcludeEmptyText&&aEmptyNodes&&aEmptyNodes.length>0){sap.galilei.ui.common.svg.Svg._showEmptyElements(aEmptyNodes)}if(oBBoxElement&&oSvgElement.nodeName==="text"){width=oSvgElement.getAttribute("galilei:width");if(width!=undefined){height=oSvgElement.getAttribute("galilei:height");x=oSvgElement.getAttribute("x");y=oSvgElement.getAttribute("y");if(x!=undefined&&y!=undefined&&height!=undefined){oBBoxElement.x=+x;oBBoxElement.y=+y;oBBoxElement.width=+width;oBBoxElement.height=+height}}}if(oBBoxElement&&bIncludeTransform){if(oNearestViewport){if(typeof oSvgElement.getTransformToElement==="function"){matrix=oSvgElement.getTransformToElement(oNearestViewport)}else{try{inverseMatrix=oNearestViewport.getScreenCTM();if(inverseMatrix){inverseMatrix=inverseMatrix.inverse()}if(inverseMatrix){matrix=inverseMatrix.multiply(oSvgElement.getScreenCTM())}}catch(e){console.log("getScreenCTM() is not supported. "+e)}}}else{try{matrix=oSvgElement.getCTM()}catch(e){console.log("Failed to retrieve transformation matrix for SVG element "+oSvgElement.className+oSvgElement.id+": "+e)}}if(matrix){oBBoxElement=oBBoxElement.matrixTransform(matrix)}}return oBBoxElement}return undefined},getIntersectionList:function(oRect,oSvgRootElement){var aNodeList=[];if(oRect&&oSvgRootElement){sap.galilei.ui.common.svg.Svg._getOneLevelIntersectionList(aNodeList,oRect,oSvgRootElement)}return aNodeList},appendText:function(d3SvgParent,text,x,y,width,height,sFontProps,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,nAngle,cx,cy,oAttributes){var d3SvgText;if(d3SvgParent&&text&&text.length>0){d3SvgText=d3SvgParent.append("svg:text");return sap.galilei.ui.common.svg.Svg.updateText(d3SvgText,text,x,y,width,height,sFontProps,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,nAngle,cx,cy,oAttributes)}return d3SvgText},updateText:function(d3SvgText,text,x,y,width,height,sFontProps,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,nAngle,cx,cy,oAttributes){if(d3SvgText){var svgText,d3SvgTextSelection,d3SvgTextSelectionAppend,oLayout,n,attr,tspan,x0,y0,totalWidth=0,totalHeight=0,node,nTotalNodes,nExistingNodes,nUpdateNodes,oFont,bRightToLeft=(typeof document!=="undefined"&&document.dir==="rtl"),dx;if(bRightToLeft){bEllipsis=false}if(d3SvgText.node){svgText=d3SvgText.node();d3SvgTextSelection=d3SvgText}else{if(d3SvgText.tween){svgText=d3SvgText[0][0].node;d3SvgTextSelection=d3.select(svgText)}}d3SvgTextSelectionAppend=d3SvgTextSelection;if(!d3SvgTextSelectionAppend.append&&d3SvgTextSelectionAppend.tween){svgText=d3SvgTextSelectionAppend[0][0];d3SvgTextSelectionAppend=d3.select(svgText)}if(svgText){text=text||"";if(x===undefined){x=0}x=+x;if(y===undefined){y=0}y=+y;if(width===undefined||width<=0){width=-1}width=+width;if(height===undefined||height<=0){height=-1}height=+height;if(nAngle===undefined){nAngle=0}nAngle=+nAngle;if(cx!==undefined){cx=+cx}if(cy!==undefined){cy=+cy}oAttributes=oAttributes||{};x0=x;y0=y;if(nAngle!==0&&(cx===undefined||cy===undefined)&&width!==-1&&height!==-1){cx=x+width/2;cy=y+height/2}oLayout=sap.galilei.ui.common.Text.layoutText(text,width,height,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,sFontProps);if(oLayout&&oLayout.lines.length>0){x0=x+oLayout.left;y0=y+oLayout.top;totalWidth=oLayout.totalWidth;totalHeight=oLayout.totalHeight;if(oLayout.lines.length===1){if(svgText.hasChildNodes()){for(n=svgText.childNodes.length-1;n>=0;--n){node=svgText.childNodes[n];if(node.nodeName==="tspan"){svgText.removeChild(node)}}}dx=bRightToLeft?oLayout.lineWidths[0]:0;d3SvgText.attr("x",x+oLayout.x[0]+dx).attr("y",y+oLayout.y[0]).text(oLayout.lines[0])}else{svgText.removeAttribute("text");svgText.setAttribute("x",x0);svgText.setAttribute("y",y0);nTotalNodes=oLayout.lines.length;nExistingNodes=svgText.childNodes.length;if(svgText.hasChildNodes()){node=svgText.childNodes[0];if(node.nodeName==="#text"){svgText.removeChild(node);nExistingNodes=0}}nUpdateNodes=Math.min(nTotalNodes,nExistingNodes);for(n=0;n<nUpdateNodes;n++){node=svgText.childNodes[n];dx=bRightToLeft?oLayout.lineWidths[n]:0;d3.select(node).attr("x",x+oLayout.x[n]+dx).attr("y",y+oLayout.y[n]).text(oLayout.lines[n])}for(n=nUpdateNodes;n<nTotalNodes;n++){dx=bRightToLeft?oLayout.lineWidths[n]:0;d3SvgTextSelectionAppend.append("svg:tspan").attr("x",x+oLayout.x[n]+dx).attr("y",y+oLayout.y[n]).text(oLayout.lines[n])}for(n=nExistingNodes-1;n>=nTotalNodes;n--){svgText.removeChild(svgText.childNodes[n])}}if(sFontProps&&(!oAttributes.style||oAttributes.style.indexOf("font")===-1)){oFont=sap.galilei.ui.common.Font.getCSSFontProperties(sFontProps);if(oFont){if(oFont.fontStyle&&oFont.fontStyle!=="normal"){oAttributes["font-style"]=oFont.fontStyle}if(oFont.fontVariant&&oFont.fontVariant!=="normal"){oAttributes["font-variant"]=oFont.fontVariant}if(oFont.fontWeight&&oFont.fontWeight!=="normal"){oAttributes["font-weight"]=oFont.fontWeight}if(oFont.fontSize){oAttributes["font-size"]=oFont.fontSize}if(oFont.fontFamily){oAttributes["font-family"]=oFont.fontFamily}}}for(attr in oAttributes){d3SvgText.attr(attr,oAttributes[attr])}if(nAngle!==0){d3SvgText.attr("transform","rotate("+nAngle+","+cx+","+cy+")")}}else{svgText.removeAttribute("text");svgText.setAttribute("x",x0);svgText.setAttribute("y",y0);if(svgText.hasChildNodes()){for(node=svgText.firstChild;node;node=svgText.firstChild){svgText.removeChild(node)}}}svgText.setAttribute("galilei:width",totalWidth);svgText.setAttribute("galilei:height",totalHeight)}}return d3SvgText},getUniqueId:function(sPrefix){if(sPrefix){var nId;if(!sap.galilei.ui.common._idsMap){sap.galilei.ui.common._idsMap={}}nId=sap.galilei.ui.common._idsMap[sPrefix];if(nId===undefined){nId=1}else{nId+=1}sap.galilei.ui.common._idsMap[sPrefix]=nId;return sPrefix+nId}return undefined},_getOneLevelIntersectionList:function(aNodeList,oRect,oSvgParentElement){var aSubNodeList=[],i,oNode,oBbox,oNodeRect=new sap.galilei.ui.common.Rect();for(i=0;i<oSvgParentElement.childNodes.length;i++){oNode=oSvgParentElement.childNodes[i];oBbox=sap.galilei.ui.common.svg.Svg.getBBox(oNode,true);if(oBbox){oNodeRect.set(oBbox);if(oNodeRect.isRectIntersectRect(oRect)){aNodeList.push(oNode);aSubNodeList.push(oNode)}}}if(aSubNodeList.length>0){for(i=0;i<aSubNodeList.length;i++){oNode=aSubNodeList[i];sap.galilei.ui.common.svg.Svg._getOneLevelIntersectionList(aNodeList,oRect,oNode)}}},hasClass:function(oElement,sClass){if(oElement&&oElement.correspondingUseElement){oElement=oElement.correspondingUseElement}if(oElement&&oElement.getAttribute){var aClassList,index,sOldClass;sOldClass=oElement.getAttribute("class");if(sOldClass){aClassList=sOldClass.split(/\s+/);if(aClassList&&aClassList.length>0&&sClass){for(index=0;index<aClassList.length;index++){if(aClassList[index]===sClass){return true}}}}}return false},addClass:function(oElement,sClass){if(oElement&&oElement.correspondingUseElement){oElement=oElement.correspondingUseElement}if(oElement&&oElement.getAttribute){var sOldClass=oElement.getAttribute("class"),sNewClass;if(!sOldClass||!sap.galilei.ui.common.svg.Svg.hasClass(oElement,sClass)){if(!sOldClass){sNewClass=sClass}else{sNewClass=sOldClass+" "+sClass}oElement.setAttribute("class",sNewClass);return sNewClass}}},setClasses:function(oElement,sClasses){if(oElement&&oElement.correspondingUseElement){oElement=oElement.correspondingUseElement}if(oElement&&oElement.getAttribute){oElement.setAttribute("class",sClasses)}},removeClass:function(oElement,sClass){if(oElement&&oElement.correspondingUseElement){oElement=oElement.correspondingUseElement}if(oElement&&oElement.getAttribute){var aClassList,index,sOldClass=oElement.getAttribute("class"),sNewClass;if(sOldClass){aClassList=sOldClass.split(/\s+/);if(aClassList&&aClassList.length>0&&sClass){for(index=0;index<aClassList.length;index++){if(aClassList[index]===sClass){aClassList.splice(index,1);if(aClassList.length>0){sNewClass=aClassList.join(" ");oElement.setAttribute("class",sNewClass)}else{if(sOldClass){oElement.removeAttribute("class")}}return sNewClass}}}}}}}})}());
(function(){sap.galilei.ui.common.svg.Viewer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.svg.Viewer",initialize:function(parentSelector,options){if(parentSelector){this.setParentNode(parentSelector);this.viewerNumber=sap.galilei.ui.common.svg.Viewer.getNextViewerNumber();if(options){this.set(options)}this.createSvg(options);if(options){this.set(options)}}else{throw"Error: The parent node CSS selector is not specified."}},statics:{VIEW_BORDER_WIDTH:1,VIEW_BORDER_COLOR:"#6283A7",VIEW_BORDER_STYLE:"solid",VIEW_BACKGROUND_COLOR:"#BFBFBF",VIEW_ZOOM_DURATION:500,VIEW_PAN_DURATION:200,VIEW_ZOOM_FACTOR_MIN:0.02,VIEW_ZOOM_FACTOR_MAX:50,VIEW_ZOOM_FACTOR:1.2,VIEW_PAN_OFFSET:40,PAGE_HORZ_NUMBER:21,PAGE_VERT_NUMBER:15,viewerCount:0,lastViewerNumber:0,getNextViewerNumber:function(){sap.galilei.ui.common.svg.Viewer.lastViewerNumber++;return sap.galilei.ui.common.svg.Viewer.lastViewerNumber},focusedElement:undefined,currentViewer:undefined,onElementFocus:function(oEvent){try{sap.galilei.ui.common.svg.Viewer.focusedElement=oEvent.target}catch(err){}},onElementBlur:function(oEvent){if(navigator.appVersion.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1){oEvent.stopImmediatePropagation();oEvent.preventDefault()}sap.galilei.ui.common.svg.Viewer.focusedElement=undefined},addEventHandlers:function(){if(sap.galilei.ui.common.svg.Viewer.viewerCount===0){document.addEventListener("focus",sap.galilei.ui.common.svg.Viewer.onElementFocus,true);document.addEventListener("blur",sap.galilei.ui.common.svg.Viewer.onElementBlur,true);++sap.galilei.ui.common.svg.Viewer.viewerCount}},removeEventHandlers:function(){if(sap.galilei.ui.common.svg.Viewer.viewerCount>0){--sap.galilei.ui.common.svg.Viewer.viewerCount;if(sap.galilei.ui.common.svg.Viewer.viewerCount===0){document.removeEventListener("focus",sap.galilei.ui.common.svg.Viewer.onElementFocus,true);document.removeEventListener("blur",sap.galilei.ui.common.svg.Viewer.onElementBlur,true)}}}},fields:{_parentSelector:undefined,_d3ParentNode:undefined,_d3SvgRoot:undefined,_d3SvgDefs:undefined,_d3ZoomPanel:undefined,_d3MousePanel:undefined,_d3DrawingSurface:undefined,_d3BackgroundPointerPanel:undefined,_zoomBehavior:undefined,_libraries:undefined,_lastZoomPan:undefined,_browserCurrentScale:1},properties:{d3ParentNode:{get:function(){return this._d3ParentNode}},parentNode:{get:function(){return(this.d3ParentNode)?this.d3ParentNode.node():undefined}},marginLeft:{get:function(){var oParentNode=this.parentNode,nMargin=0,style;while(oParentNode){style=window.getComputedStyle(oParentNode,null);if(style&&style.marginLeft){nMargin+=parseInt(style.marginLeft,10)}oParentNode=oParentNode.parentElement}return nMargin}},marginTop:{get:function(){var oParentNode=this.parentNode,nMargin=0,style;while(oParentNode){style=window.getComputedStyle(oParentNode,null);if(style&&style.marginTop){nMargin+=parseInt(style.marginTop,10)}oParentNode=oParentNode.parentElement}return nMargin}},viewerScrollLeft:{get:function(){var nOffset=0,oParentNode=this.parentNode;if(oParentNode){nOffset=oParentNode.scrollLeft}return nOffset}},viewerScrollTop:{get:function(){var nOffset=0,oParentNode=this.parentNode;if(oParentNode){nOffset=oParentNode.scrollTop}return nOffset}},parentOffsetLeft:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.offsetLeft){nOffset+=oParentNode.offsetLeft}oParentNode=oParentNode.offsetParent}return nOffset}},parentOffsetTop:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.offsetTop){nOffset+=oParentNode.offsetTop}oParentNode=oParentNode.offsetParent}return nOffset}},parentScrollLeft:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.tagName==="BODY"){break}if(oParentNode.scrollLeft){nOffset+=oParentNode.scrollLeft}oParentNode=oParentNode.parentElement}return nOffset}},parentScrollTop:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.tagName==="BODY"){break}if(oParentNode.scrollTop){nOffset+=oParentNode.scrollTop}oParentNode=oParentNode.parentElement}return nOffset}},bodyScrollLeft:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.tagName==="BODY"){nOffset+=oParentNode.scrollLeft;break}oParentNode=oParentNode.parentElement}return nOffset}},bodyScrollTop:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.tagName==="BODY"){nOffset+=oParentNode.scrollTop;break}oParentNode=oParentNode.parentElement}return nOffset}},viewerNumber:1,d3SvgRoot:{get:function(){return this._d3SvgRoot}},d3SvgDefs:{get:function(){return this._d3SvgDefs}},d3DrawingSurface:{get:function(){return this._d3DrawingSurface}},svgRoot:{get:function(){return(this.d3SvgRoot)?this.d3SvgRoot.node():undefined}},mainShapeLayer:undefined,d3MainShapeLayer:{get:function(){return(this.mainShapeLayer)?this.mainShapeLayer.d3Layer:undefined}},svgMainShapeLayer:{get:function(){return(this.mainShapeLayer)?this.d3MainShapeLayer.node():undefined}},shapeDecoratorLayer:undefined,d3ShapeDecoratorLayer:{get:function(){return(this.shapeDecoratorLayer)?this.shapeDecoratorLayer.d3Layer:undefined}},svgShapeDecoratorLayer:{get:function(){return(this.shapeDecoratorLayer)?this.shapeDecoratorLayer.node():undefined}},backgroundPointerPanelShape:undefined,layers:{type:"collection",objectClass:sap.galilei.ui.common.svg.Layer,writable:false,configurable:false},viewWidth:0,viewHeight:0,showViewBorder:{value:true,onChange:function(){this.updateViewBorder()}},viewBorderColor:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BORDER_COLOR",onChange:function(){this.updateViewBorder()}},viewBorderStyle:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BORDER_STYLE",onChange:function(){this.updateViewBorder()}},viewBorderWidth:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BORDER_WIDTH",onChange:function(){this.updateViewBorder()}},viewBackgroundFill:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BACKGROUND_COLOR",onChange:function(){this.updateViewBackground()}},enableAnimation:{field:"_enableAnimation",value:true,get:function(){return this._enableAnimation},set:function(bEnableAnimation){this._enableAnimation=bEnableAnimation}},zoomDuration:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_DURATION"},panDuration:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_PAN_DURATION"},zoomScale:{get:function(){return this._zoomBehavior?this._zoomBehavior.scale():this.oldZoomScale},set:function(value){if(this._zoomBehavior&&value!==undefined){this._zoomBehavior.scale(value)}}},zoomTranslate:{get:function(){return this._zoomBehavior?this._zoomBehavior.translate():this.oldZoomTranslate},set:function(value){if(this._zoomBehavior&&value!==undefined){this._zoomBehavior.translate(value)}}},oldZoomScale:1,oldZoomTranslate:[0,0],matrixClientToZoomView:{expression:"new sap.galilei.ui.common.Matrix()",writable:false,configurable:false},matrixZoomViewToClient:{expression:"new sap.galilei.ui.common.Matrix()",writable:false,configurable:false},page:{expression:"new sap.galilei.ui.common.Page()",onChange:function(){this.updatePageSize()}},paperType:{get:function(){return this.page.paperType},set:function(sPaperType){if(sPaperType&&sPaperType!==this.page.paperType){this.setPaperSize(sPaperType);this.updatePageSize()}}},pageWidth:{get:function(){return this.page.pageWidthPixels}},pageHeight:{get:function(){return this.page.pageHeightPixels}},pageLeftOffset:{get:function(){return this.page.pageLeftOffsetPixels}},pageTopOffset:{get:function(){return this.page.pageTopOffsetPixels}},pageOrientation:{get:function(){return this.page.pageOrientation},set:function(sOrientation){if(sOrientation!==this.page.pageOrientation&&(sOrientation===sap.galilei.ui.common.PageOrientations.portrait||sOrientation===sap.galilei.ui.common.PageOrientations.landscape)){this.page.pageOrientation=sOrientation;this.updatePageSize()}}},pageScale:{get:function(){return this.page.pageScale},set:function(nScale){if(nScale!==this.page.pageScale&&nScale!==undefined&&nScale!==0&&!isNaN(nScale)){this.page.pageScale=nScale;this.updatePageSize()}}},pageHorzNumber:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_HORZ_NUMBER",onChange:function(){this.updatePageSize()}},pageVertNumber:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_VERT_NUMBER",onChange:function(){this.updatePageSize()}},allPagesLeft:0,allPagesTop:0,allPagesWidth:0,allPagesHeight:0,libraries:{get:function(){if(!this._libraries){this._libraries=new sap.galilei.ui.common.library.LibraryManager(this)}return this._libraries}},enableZoomPan:true,hasFocus:{get:function(){var sTagName,sType;if(document.activeElement){sTagName=document.activeElement.tagName;sType=document.activeElement.type;if(sTagName==="TEXTAREA"||sTagName==="INPUT"){return false}sap.galilei.ui.common.svg.Viewer.focusedElement=undefined}return !sap.galilei.ui.common.svg.Viewer.focusedElement&&sap.galilei.ui.common.svg.Viewer.currentViewer===this}}},methods:{setParentNode:function(parentSelector){if(parentSelector){this._d3ParentNode=d3.select(parentSelector);if(!this._d3ParentNode){throw"Error: The parent node "+parentSelector+" cannot be found."}this._parentSelector=parentSelector;this.updateViewSize();this.updateViewBorder()}return this.parentNode},updateViewSize:function(){if(this.parentNode){this.viewWidth=this.parentNode.clientWidth;this.viewHeight=this.parentNode.clientHeight}this.matrixZoomViewToClient.setIdentity();this.matrixZoomViewToClient.translate(this.zoomTranslate[0],this.zoomTranslate[1]).scale(this.zoomScale);this.matrixClientToZoomView.set(this.matrixZoomViewToClient);this.matrixClientToZoomView.inverse();this._browserCurrentScale=sap.galilei.ui.common.svg.Svg.getCurrentScale()},updateViewBorder:function(){if(this.parentNode){if(this.showViewBorder){var sStyle=this.viewBorderWidth+"px "+this.viewBorderStyle+" "+this.viewBorderColor;this.parentNode.style.border=sStyle}else{this.parentNode.style.border="none"}}},getPaperSize:function(sUnit,nPrecision){return this.page.getPaperSize(sUnit,nPrecision)},setPaperSize:function(sPaperType,oOptions){this.page.setPaperSize(sPaperType,oOptions);this.updatePageSize()},getPageSize:function(sUnit,nPrecision){return this.page.getPageSize(sUnit,nPrecision)},updatePageSize:function(){var oAllPagesRect=this.page.getAllPagesRect(this.pageHorzNumber,this.pageVertNumber);if(oAllPagesRect){this.allPagesLeft=oAllPagesRect.x;this.allPagesTop=oAllPagesRect.y;this.allPagesWidth=oAllPagesRect.width;this.allPagesHeight=oAllPagesRect.height;this.notifyLayers("onUpdatePageSize")}},createSvg:function(options){var self=this,oParentNode;function onResizeParent(){self.onResize()}if(this._d3ParentNode&&!this.d3SvgRoot){this.updatePageSize();this.addSvgRoot();this.addZoomPanNodes();this.addDrawingSurface();this.addDrawingLayers();this.onResize();if(this.parentNode){oParentNode=this.parentNode;while(oParentNode){if(oParentNode.hasOwnProperty("onresize")){oParentNode.removeEventListener("resize",onResizeParent);oParentNode.addEventListener("resize",onResizeParent);break}oParentNode=oParentNode.parentNode}}window.removeEventListener("resize",onResizeParent);window.addEventListener("resize",onResizeParent);sap.galilei.ui.common.svg.Viewer.addEventHandlers();this.gotFocus()}return this.svgRoot},addSvgRoot:function(){if(!this.d3SvgRoot){this._d3SvgRoot=this._d3ParentNode.append("svg:svg").attr("id","svgRoot-"+this.viewerNumber).attr("class","svgRoot").attr("xmlns","http://www.w3.org/2000/svg").attr("width","100%").attr("height","100%");this.svgRoot.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");this.svgRoot.setAttribute("xmlns:galilei",sap.galilei.ui.common.NAMESPACE_GALILEI);if(d3.ns.prefix.galilei===undefined){d3.ns.prefix.galilei=sap.galilei.ui.common.NAMESPACE_GALILEI}this._d3SvgDefs=this.d3SvgRoot.append("svg:defs")}return this.d3SvgRoot},addZoomPanNodes:function(){var self=this;function onZoomBehavior(){self._onZoomBehaviorHandler()}this._zoomBehavior=d3.behavior.zoom().scaleExtent([sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MIN,sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MAX]).scale(1).on("zoom",onZoomBehavior);this._d3ZoomPanel=this.d3SvgRoot.append("svg:g").attr("id","svgZoomPanel-"+this.viewerNumber).attr("class","svgZoomPanel").call(this._zoomBehavior,this).on("dblclick.zoom",null);this._d3MousePanel=this._d3ZoomPanel.append("svg:rect").attr("id","svgMousePanel-"+this.viewerNumber).attr("class","sapGalileiViewBackground").attr("width","100%").attr("height","100%").attr("fill",this.viewBackgroundFill).attr("stroke","none")},addDrawingSurface:function(){if(!this._d3DrawingSurface){this._d3DrawingSurface=this._d3ZoomPanel.append("svg:g").attr("id","svgDrawingSurface-"+this.viewerNumber).attr("class","svgDrawingSurface")}},addDrawingLayers:function(){var self=this,index,options,oLayerClass,oLayer;for(index=0;index<sap.galilei.ui.common.svg.defaultLayers.length;++index){options=sap.galilei.ui.common.svg.defaultLayers[index];if(options){oLayerClass=options.layerClass;oLayer=new oLayerClass(this,options);if(oLayer){this.layers.add(oLayer);if(oLayer.isMainShapeLayer||(!this.mainShapeLayer&&oLayer.isShapeLayer&&oLayer.isVisible)){this.mainShapeLayer=oLayer}if(!this.shapeDecoratorLayer&&oLayer.isShapeLayer&&oLayer.isShapeDecoratorLayer&&oLayer.isVisible){this.shapeDecoratorLayer=oLayer}}}}oLayer=this.getLayerByName(sap.galilei.ui.common.svg.Layer.BACKGROUND_POINTER_LAYER);if(oLayer){this._d3BackgroundPointerPanel=oLayer.d3Layer.append("svg:rect").attr("id","svgPointerPanel-"+this.viewerNumber).attr("class","svgPointerPanel").attr("width","100%").attr("height","100%").attr("fill","white").attr("opacity","0").attr("stroke","none");this.backgroundPointerPanelShape=new sap.galilei.ui.common.shape.Rectangle();this.backgroundPointerPanelShape.d3Node=this._d3BackgroundPointerPanel;this.backgroundPointerPanelShape.retrieveDrawing(this);this.backgroundPointerPanelShape.on("pointerdown",function(oEvent){self.gotFocus(oEvent)});this.backgroundPointerPanelShape.on("pointerup",function(oEvent){})}else{console.log("Error: Cannot find background pointer capture panel")}},gotFocus:function(oEvent){if(sap.galilei.ui.common.svg.Viewer.focusedElement&&sap.galilei.ui.common.svg.Viewer.focusedElement.nodeName!=="BODY"&&sap.galilei.ui.common.svg.Viewer.focusedElement.blur){try{sap.galilei.ui.common.svg.Viewer.focusedElement.blur()}catch(err){console.log("Failed to blur:"+err)}}if(document.activeElement&&document.activeElement.nodeName!=="BODY"&&document.activeElement.blur){try{document.activeElement.blur()}catch(err){console.log("Failed to blur:"+err)}}sap.galilei.ui.common.svg.Viewer.focusedElement=undefined;sap.galilei.ui.common.svg.Viewer.currentViewer=this},dispose:function(){var oParentNode;if(sap.galilei.ui.common.svg.Viewer.currentViewer===this){sap.galilei.ui.common.svg.Viewer.currentViewer=undefined}if(this.d3SvgRoot){this.d3SvgRoot.remove()}this._parentSelector=undefined;this._d3ParentNode=undefined;this._d3SvgRoot=undefined;this._d3SvgDefs=undefined;this._zoomBehavior=undefined;this._d3ZoomPanel=undefined;this._d3MousePanel=undefined;this._d3DrawingSurface=undefined;this.layers.clear();this.mainShapeLayer=undefined;this.shapeDecoratorLayer=undefined;this._d3BackgroundPointerPanel=undefined;if(this.backgroundPointerPanelShape){this.backgroundPointerPanelShape.dispose();this.backgroundPointerPanelShape=undefined}if(this.libraries){this.libraries.clearCache();this._libraries=undefined}this.oldZoomScale=1;this.oldZoomTranslate=[0,0];sap.galilei.ui.common.svg.Viewer.removeEventHandlers()},getLayerByName:function(name){var index,layer;for(index=0;index<this.layers.length;++index){layer=this.layers[index];if(layer.name===name){return layer}}return undefined},getLayerByClass:function(sClassName){var index,layer;for(index=0;index<this.layers.length;++index){layer=this.layers[index];if(sap.galilei.core.isInstanceOf(layer,sClassName)){return layer}}return undefined},getShapeLayers:function(bIncludeHiddenLayers,bIncludeDecorators){var index,oLayer,aLayers=[];for(index=0;index<this.layers.length;++index){oLayer=this.layers[index];if(oLayer.isShapeLayer||oLayer.isShapeDecoratorLayer){if((bIncludeHiddenLayers||oLayer.isVisible)&&(bIncludeDecorators||!oLayer.isShapeDecoratorLayer)){aLayers.push(oLayer)}}}return aLayers},setMainShapeLayer:function(layer){if(layer){if((typeof layer)==="string"){layer=this.getLayerByName(layer)}if(layer&&sap.galilei.core.isInstanceOf(layer,"sap.galilei.ui.common.svg.Layer")&&layer.isShapeLayer){this.mainShapeLayer=layer}}return layer},showLayer:function(name,bUseAnimation){var layer=this.getLayerByName(name);if(layer){layer.show(bUseAnimation)}return layer},hideLayer:function(name,bUseAnimation){var layer=this.getLayerByName(name);if(layer){layer.hide(bUseAnimation)}return layer},notifyLayers:function(sEventHandlerName,options){var index,layer;for(index=0;index<this.layers.length;++index){layer=this.layers[index];if(layer[sEventHandlerName]&&(typeof layer[sEventHandlerName])==="function"){layer[sEventHandlerName].apply(layer,arguments)}}return this},findNodeById:function(id,d3Parent){if(id){var d3ParentNode=this.d3SvgRoot;if(d3Parent){d3ParentNode=d3Parent}if(d3ParentNode){return d3ParentNode.select("#"+id)}}return undefined},updateViewBackground:function(){if(this._d3MousePanel){this._d3MousePanel.attr("fill",this.viewBackgroundFill)}return this},substractBodyScroll:function(aPoint){if(aPoint){aPoint[0]-=this.bodyScrollLeft;aPoint[1]-=this.bodyScrollTop}return aPoint},addBodyScroll:function(aPoint){if(aPoint){aPoint[0]+=this.bodyScrollLeft;aPoint[1]+=this.bodyScrollTop}return aPoint},pagePointToClientPoint:function(aPoint,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll){var nOffsetX=0,nOffsetY=0;if(aPoint){if(bIncludeScroll){if(bIncludeAllParentScroll!==false){nOffsetX-=this.parentScrollLeft;nOffsetY-=this.parentScrollTop}else{nOffsetX-=this.viewerScrollLeft;nOffsetY-=this.viewerScrollTop}}if(bIncludeMargin||bIncludeMargin===undefined){nOffsetX+=this.parentOffsetLeft;nOffsetY+=this.parentOffsetTop}return[aPoint[0]-nOffsetX,aPoint[1]-nOffsetY]}return undefined},clientPointToPagePoint:function(aPoint,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll){var nOffsetX=0,nOffsetY=0;if(aPoint){if(bIncludeScroll){if(bIncludeAllParentScroll!==false){nOffsetX-=this.parentScrollLeft;nOffsetY-=this.parentScrollTop}else{nOffsetX-=this.viewerScrollLeft;nOffsetY-=this.viewerScrollTop}}if(bIncludeMargin||bIncludeMargin===undefined){nOffsetX+=this.parentOffsetLeft;nOffsetY+=this.parentOffsetTop}return[aPoint[0]+nOffsetX,aPoint[1]+nOffsetY]}return undefined},pagePointToViewPoint:function(aPoint,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(this.pagePointToClientPoint(aPoint,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll));oPt.matrixTransform(this.matrixClientToZoomView);return[oPt.x,oPt.y]}return undefined},viewPointToPagePoint:function(aPoint,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(aPoint[0],aPoint[1]);oPt.matrixTransform(this.matrixZoomViewToClient);return this.clientPointToPagePoint([oPt.x,oPt.y],bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll)}return undefined},pageDeltaToViewDelta:function(aDelta){if(aDelta){var oPt1=new sap.galilei.ui.common.Point(),oPt2=new sap.galilei.ui.common.Point();oPt1.set(0,0);oPt1.matrixTransform(this.matrixClientToZoomView);oPt2.set(aDelta[0],aDelta[1]);oPt2.matrixTransform(this.matrixClientToZoomView);return[oPt2.x-oPt1.x,oPt2.y-oPt1.y]}return undefined},viewDeltaToPageDelta:function(aDelta){if(aDelta){var oPt1=new sap.galilei.ui.common.Point(),oPt2=new sap.galilei.ui.common.Point();oPt1.set(0,0);oPt1.matrixTransform(this.matrixZoomViewToClient);oPt2.set(aDelta[0],aDelta[1]);oPt2.matrixTransform(this.matrixZoomViewToClient);return[oPt2.x-oPt1.x,oPt2.y-oPt1.y]}return undefined},clientPointToViewPoint:function(aPoint,bIncludeScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(aPoint[0],aPoint[1]);if(bIncludeScroll){oPt.x+=this.viewerScrollLeft;oPt.y+=this.viewerScrollTop}oPt.matrixTransform(this.matrixClientToZoomView);return[oPt.x,oPt.y]}return undefined},viewPointToClientPoint:function(aPoint,bIncludeScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(aPoint[0],aPoint[1]);oPt.matrixTransform(this.matrixZoomViewToClient);if(bIncludeScroll){oPt.x-=this.viewerScrollLeft;oPt.y-=this.viewerScrollTop}return[oPt.x,oPt.y]}return undefined},viewBBoxToClientBBox:function(oRect,bRounded,bIncludeScroll){var oNewRect;if(oRect){oNewRect=oRect.matrixTransform(this.matrixZoomViewToClient,bRounded,true);if(bIncludeScroll){oNewRect.moveBy(-this.viewerScrollLeft,-this.viewerScrollTop)}}return oNewRect},clientBBoxToViewBBox:function(oRect,bRounded,bIncludeScroll){var oNewRect;if(oRect){oNewRect=oRect.clone();if(bIncludeScroll){oNewRect.moveBy(this.viewerScrollLeft,this.viewerScrollTop)}oNewRect=oNewRect.matrixTransform(this.matrixClientToZoomView,bRounded,true)}return oNewRect},viewBBoxToPageBBox:function(oRect,bRounded,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll){if(oRect){var oNewRect=this.viewBBoxToClientBBox(oRect,bRounded,false);if(bIncludeScroll){if(bIncludeAllParentScroll!==false){oNewRect.x-=this.parentScrollLeft;oNewRect.y-=this.parentScrollTop}else{oNewRect.x-=this.viewerScrollLeft;oNewRect.y-=this.viewerScrollTop}}if(bIncludeMargin){oNewRect.x+=this.parentOffsetLeft;oNewRect.y+=this.parentOffsetTop}return oNewRect}return undefined},pageBBoxToViewBBox:function(oRect,bRounded,bIncludeScroll,bIncludeMargin,bIncludeAllParentScroll){if(oRect){var oNewRect=oRect.clone();if(bIncludeScroll){if(bIncludeAllParentScroll!==false){oNewRect.x+=this.parentScrollLeft;oNewRect.y+=this.parentScrollTop}else{oNewRect.x+=this.viewerScrollLeft;oNewRect.y+=this.viewerScrollTop}}if(bIncludeMargin||bIncludeMargin===undefined){oNewRect.x-=this.parentOffsetLeft;oNewRect.y-=this.parentOffsetTop}oNewRect=this.clientBBoxToViewBBox(oNewRect,bRounded,false);return oNewRect}return undefined},normalizePointerEvent:function(oEvent,bConvertToView){var aPoint,aStartPoint,aDelta,aPt,sEventType,bGesture=false;if(oEvent){sEventType=oEvent._type?oEvent._type:oEvent.type;if(bConvertToView&&oEvent.clientViewX!==undefined&&oEvent.clientViewY!==undefined){aPoint=[oEvent.clientViewX,oEvent.clientViewY];bConvertToView=false}else{if((oEvent._clientX!==undefined&&oEvent._clientY!==undefined)||(oEvent.clientX!==undefined&&oEvent.clientY!==undefined)){if(oEvent._clientX!==undefined&&oEvent._clientY!==undefined){aPt=[oEvent._clientX,oEvent._clientY]}else{aPt=[oEvent.clientX,oEvent.clientY]}if(sap.galilei.ui.common.isMouseEvent(sEventType)){aPt=this.addBodyScroll(aPt);aPoint=this.pagePointToClientPoint(aPt,true,true,true)}else{aPoint=aPt;bGesture=true}}else{if(sap.galilei.ui.common.isTouchEvent(sEventType)&&oEvent.touches&&oEvent.touches.length>0&&oEvent.touches[0].clientX!==undefined&&oEvent.touches[0].clientY!==undefined){oEvent.clientX=oEvent.touches[0].clientX;oEvent.clientY=oEvent.touches[0].clientY;aPoint=[oEvent.clientX,oEvent.clientY]}else{if(oEvent.gesture){bGesture=true;if(oEvent.gesture.center){aPt=[oEvent.gesture.center.pageX,oEvent.gesture.center.pageY];aPoint=this.pagePointToClientPoint(aPt,true,true);oEvent.clientX=aPoint[0];oEvent.clientY=aPoint[1]}else{if(oEvent.gesture.startEvent&&oEvent.gesture.startEvent.center){aPt=[oEvent.gesture.startEvent.center.pageX,oEvent.gesture.startEvent.center.pageY];aPoint=this.pagePointToClientPoint(aPt,true,true);oEvent.clientX=aPoint[0];oEvent.clientY=aPoint[1]}}}}}}if(oEvent.gesture){if(oEvent.gesture.startEvent&&oEvent.gesture.startEvent.center){aPt=[oEvent.gesture.startEvent.center.pageX,oEvent.gesture.startEvent.center.pageY];aStartPoint=this.pagePointToClientPoint(aPt,true,true)}if(oEvent.gesture.deltaX!==undefined&&oEvent.gesture.deltaY!==undefined){aDelta=[oEvent.gesture.deltaX,oEvent.gesture.deltaY]}}if(aPoint){if(bConvertToView||bConvertToView===undefined){aPoint=this.clientPointToViewPoint(aPoint,false)}oEvent.clientViewX=aPoint[0];oEvent.clientViewY=aPoint[1]}if(aStartPoint){if(bConvertToView||bConvertToView===undefined){aStartPoint=this.clientPointToViewPoint(aStartPoint,false)}oEvent.startClientViewX=aStartPoint[0];oEvent.startClientViewY=aStartPoint[1]}if(aDelta){if(bConvertToView||bConvertToView===undefined){aDelta=this.pageDeltaToViewDelta(aDelta)}oEvent.deltaClientViewX=aDelta[0];oEvent.deltaClientViewY=aDelta[1]}}return aPoint},getFontProperties:function(svgElement){var svgDrawingSurface=this._d3DrawingSurface?this._d3DrawingSurface.node():undefined;svgElement=svgElement||svgDrawingSurface;return sap.galilei.ui.common.Font.getFontProperties(svgElement)},zoomIn:function(){this.zoomToCenter(this.zoomScale*sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR);return this},zoomOut:function(){this.zoomToCenter(this.zoomScale/sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR);return this},zoomToPercentage:function(zoomPercentage){if(!isNaN(zoomPercentage)){zoomPercentage/=100;if(zoomPercentage>=sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MIN&&zoomPercentage<=sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MAX){this.zoomToCenter(zoomPercentage)}}return this},showActualSize:function(){this.zoomToCenter(1);return this},showInitialView:function(){this.zoomTo(1,[0,0]);return this},centerView:function(){var oRect=this.getGlobalViewRect(),ptCenter;if(oRect){ptCenter=oRect.getCenter();this.zoomToCenter(1,ptCenter[0],ptCenter[1])}return this},showGlobalView:function(){var oRect=this.getGlobalViewRect();if(oRect){this.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height)}return this},showInView:function(svgElement){var rect;if(svgElement){rect=svgElement.getBBox();this.zoomToRect(rect.x,rect.y,rect.width,rect.height)}return this},showAllPages:function(){var layer=this.getLayerByName(sap.galilei.ui.common.svg.PageLimitLayer.NAME),rect;if(layer){rect=layer.svgLayer.getBBox();this.zoomToRect(rect.x,rect.y,rect.width,rect.height)}return this},showUsedPages:function(){var rect=this.getUsedPagesRect();if(rect){this.zoomToRect(rect.x,rect.y,rect.width,rect.height)}return this},zoomToCenter:function(scale,x,y,bUseAnimation){var oldScale,translate,x0=this.viewWidth/2,y0=this.viewHeight/2,cx,cy,dx=0,dy=0;if(scale==undefined){scale=this.zoomScale}else{if(scale<sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MIN){scale=sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MIN}else{if(scale>sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MAX){scale=sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MAX}}}oldScale=this.zoomScale;translate=[this.zoomTranslate[0],this.zoomTranslate[1]];if(x==undefined){x=(x0-translate[0])/oldScale}if(y==undefined){y=(y0-translate[1])/oldScale}cx=x*oldScale+translate[0];cy=y*oldScale+translate[1];dx=scale*x;dy=scale*y;translate[0]=cx-dx+(x0-cx);translate[1]=cy-dy+(y0-cy);this.zoomScale=scale;this.zoomTranslate=[translate[0],translate[1]];return this.zoomTo(scale,translate,bUseAnimation)},zoomToRect:function(x,y,width,height,bPreserveZoomScale,bCenterInView){var scale=this.zoomScale,oldScale=this.zoomScale,scale2,oViewRect,cx,cy,oldCx,oldCy,aCenter,cx0,cy0,nViewWidth,nViewHeight,margin=10;if(x==undefined||y==undefined||width==undefined||height==undefined){return}if(width===0){width=1}if(height===0){height=1}if(bPreserveZoomScale===undefined){bPreserveZoomScale=false}if(bCenterInView===undefined){bCenterInView=true}oldScale=scale;if(!bPreserveZoomScale){scale=1;bCenterInView=true;if(width>this.viewWidth-margin-margin){scale=(this.viewWidth-margin-margin)/width}if(height>this.viewHeight-margin-margin){scale2=(this.viewHeight-margin-margin)/height;if(scale2<scale){scale=scale2}}}oViewRect=this.getViewRect();aCenter=oViewRect.getCenter();cx0=oldCx=aCenter[0];cy0=oldCy=aCenter[1];cx=x+width/2;cy=y+height/2;if(!bCenterInView){nViewWidth=oViewRect.width;nViewHeight=oViewRect.height;margin/=scale;if(bPreserveZoomScale&&width>this.viewWidth-margin){cx=cx0}else{if(cx-width/2-margin<cx0-nViewWidth/2){cx=cx0-(cx0-nViewWidth/2-cx+width/2+margin)}else{if(cx+width/2+margin>cx0+nViewWidth/2){cx=cx0+(cx+width/2-cx0-nViewWidth/2+margin)}else{cx=cx0}}}if(bPreserveZoomScale&&height>this.viewHeight-margin){cy=cy0}else{if(cy-height/2-margin<cy0-nViewHeight/2){cy=cy0-(cy0-nViewHeight/2-cy+height/2+margin)}else{if(cy+height/2+margin>cy0+nViewHeight/2){cy=cy0+(cy+height/2-cy0-nViewHeight/2+margin)}else{cy=cy0}}}}if(scale!==oldScale||cx!==oldCx||cy!==oldCy){return this.zoomToCenter(scale,cx,cy)}else{return this}},zoomTo:function(scale,translate,bUseAnimation){var self=this,oEvent={},nDuration=0;if(scale===undefined){scale=this.zoomScale}else{if(scale<sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MIN){scale=sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MIN}else{if(scale>sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MAX){scale=sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR_MAX}}}if(translate===undefined){translate=[this.zoomTranslate[0],this.zoomTranslate[1]]}if(scale===this.oldZoomScale&&translate[0]===this.oldZoomTranslate[0]&&translate[1]===this.oldZoomTranslate[1]){return this}if(bUseAnimation===undefined){bUseAnimation=this.enableAnimation}if(bUseAnimation){nDuration=this.getZoomPanDuration(scale,translate);if(nDuration>0){nDuration+=50}}this.zoomScale=scale;this.zoomTranslate=[translate[0],translate[1]];oEvent.scale=scale;oEvent.translate=[translate[0],translate[1]];oEvent.oldScale=this.oldZoomScale;oEvent.oldTranslate=[this.oldZoomTranslate[0],this.oldZoomTranslate[1]];oEvent.useAnimation=bUseAnimation;oEvent.animationDuration=nDuration;sap.galilei.core.Event.publish("viewer.zoompan.before",this,undefined,oEvent);this.notifyLayers("onPreZoomPan",scale,translate,false);if(this.onPreZoomPan){this.onPreZoomPan(this,scale,translate)}this.matrixZoomViewToClient.setIdentity();this.matrixZoomViewToClient.translate(translate[0],translate[1]).scale(scale);this.matrixClientToZoomView.set(this.matrixZoomViewToClient);this.matrixClientToZoomView.inverse();this.notifyLayers("onZoomPan",scale,translate,bUseAnimation);this._lastZoomPan=this._lastZoomPan||{};if(this._lastZoomPan._idTimeOutAfter){clearTimeout(this._lastZoomPan._idTimeOutAfter);this._lastZoomPan._idTimeOutAfter=undefined}this._lastZoomPan._event=oEvent;if(!this._fnNotifyAfterZoomPan){this._fnNotifyAfterZoomPan=jQuery.proxy(this._notifyAfterZoomPan,this)}if(bUseAnimation){this._lastZoomPan._idTimeOutAfter=setTimeout(this._fnNotifyAfterZoomPan,nDuration+33)}else{this._fnNotifyAfterZoomPan()}this.notifyLayers("onPostZoomPan",scale,translate,true);if(this.onPostZoomPan){this.onPostZoomPan(this,scale,translate)}this.oldZoomScale=scale;this.oldZoomTranslate=[translate[0],translate[1]];return this},panView:function(dx,dy){var translate;if(dx!=undefined&&dy!=undefined){translate=[this.zoomTranslate[0],this.zoomTranslate[1]];translate[0]+=dx;translate[1]+=dy;this.zoomTo(this.zoomScale,translate)}return this},panLeft:function(){return this.panView(sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET,0)},panRight:function(){return this.panView(-sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET,0)},panUp:function(){return this.panView(0,sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET)},panDown:function(){return this.panView(0,-sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET)},panPageLeft:function(){return this.panView(this.viewWidth/2,0)},panPageRight:function(){return this.panView(-this.viewWidth/2,0)},panPageUp:function(){return this.panView(0,this.viewHeight/2)},panPageDown:function(){return this.panView(0,-this.viewHeight/2)},getGlobalViewRect:function(bIncludeDecoratorLayers){var oViewBox,oBbox,index,oLayer;bIncludeDecoratorLayers=bIncludeDecoratorLayers!==undefined?bIncludeDecoratorLayers:false;for(index=0;index<this.layers.length;++index){oLayer=this.layers[index];if((oLayer.isShapeLayer||(bIncludeDecoratorLayers&&oLayer.isShapeDecoratorLayer))&&oLayer.isVisible){oBbox=oLayer.getGlobalViewRect();if(oBbox){if(!oViewBox){oViewBox=new sap.galilei.ui.common.Rect();oViewBox.set(oBbox)}else{oViewBox.unionRect(oBbox)}}}}return oViewBox},getUsedPagesRect:function(){var oRect=this.getGlobalViewRect()||(new sap.galilei.ui.common.Rect()),oUsedPages=this.page.getUsedPages(oRect);return oUsedPages&&oUsedPages.usedPagesRect},getViewRect:function(){var oRect=new sap.galilei.ui.common.Rect(0,0,this.viewWidth,this.viewHeight);return this.clientBBoxToViewBBox(oRect)},isRectInView:function(oRect){var oViewRect;if(oRect){oViewRect=this.getViewRect();return oViewRect.isRectInRect(oRect)}return false},isRectVisible:function(oRect){var oViewRect;if(oRect){oViewRect=this.getViewRect();return oViewRect.isRectIntersectRect(oRect)}return false},onResize:function(){this.updateViewSize();if(this.d3SvgRoot){this.d3SvgRoot.attr("width","100%").attr("height","100%")}if(this._d3MousePanel){this._d3MousePanel.attr("width","100%").attr("height","100%")}if(this._d3BackgroundPointerPanel){this._d3BackgroundPointerPanel.attr("width","100%").attr("height","100%")}if(this.backgroundPointerPanelShape){this.backgroundPointerPanelShape.width=this.viewWidth;this.backgroundPointerPanelShape.height=this.viewHeight}this.notifyLayers("onResize");return this},onPreZoomPan:undefined,onPostZoomPan:undefined,getZoomPanDuration:function(scale,translate){var duration=0;if(scale!==undefined&&!isNaN(scale)&&translate){if(this.oldZoomScale!==scale){duration=this.zoomDuration}else{if(this.oldZoomTranslate[0]!==translate[0]||this.oldZoomTranslate[1]!==translate[1]){duration=this.panDuration}}}return duration},getElementsByPoint:function(x,y,oRootElement,radius){var oRect,svgRoot=this.svgRoot,aNodeList,bSupportGetIntersectionList;if(svgRoot){oRootElement=oRootElement||svgRoot;if(navigator.appVersion.indexOf("MSIE 9")===-1&&(navigator.appVersion.indexOf("Safari")===-1||navigator.appVersion.indexOf("Chrome")>=0)&&svgRoot.getIntersectionList){bSupportGetIntersectionList=true;oRect=svgRoot.createSVGRect()}else{bSupportGetIntersectionList=false;oRect=new sap.galilei.ui.common.Rect()}if(oRect){if(radius===undefined||radius===0){radius=1}oRect.x=x-radius;oRect.y=y-radius;oRect.width=oRect.height=radius+radius;if(bSupportGetIntersectionList){aNodeList=svgRoot.getIntersectionList(oRect,oRootElement)}else{aNodeList=sap.galilei.ui.common.svg.Svg.getIntersectionList(oRect,oRootElement)}}return aNodeList}},_removeSVGNodes:function(oSvgNode){var index;if(oSvgNode&&oSvgNode.getAttribute&&oSvgNode.removeAttribute){if(oSvgNode.getAttribute("galilei:width")!=null){oSvgNode.removeAttribute("galilei:width")}if(oSvgNode.getAttribute("galilei:height")!=null){oSvgNode.removeAttribute("galilei:height")}if(oSvgNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"x0")!=null){oSvgNode.removeAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"x0")}if(oSvgNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"y0")!=null){oSvgNode.removeAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"y0")}if(oSvgNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex")!=null){oSvgNode.removeAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex")}}for(index=0;index<oSvgNode.childNodes.length;index++){this._removeSVGNodes(oSvgNode.childNodes[index])}},generateSVG:function(oOptions,fnSuccess){var self=this,bIncludeDecoratorLayers,oRect,viewX=0,viewY=0,viewWidth,viewHeight,offsetX=0,offsetY=0,oSvgRootClone,oSvgDefsClone,oSvgShapeLayerClone,oSvgLayersGroup,d3SvgLayersGroup,aLayers,nZoomScale=1,nClipWidth,nClipHeight,bReplaceImageURL,sTransformShapeLayers,sSVG;function generateLayerSVG(oLayer){if(oLayer&&oLayer.d3Layer){oSvgShapeLayerClone=oLayer.d3Layer.node().cloneNode(true);if(sTransformShapeLayers){oSvgShapeLayerClone.setAttributeNS(null,"transform",sTransformShapeLayers)}else{oSvgShapeLayerClone.removeAttribute("transform");if(oSvgShapeLayerClone.getAttribute("transform")){oSvgShapeLayerClone.setAttributeNS(null,"transform",null)}}self._removeSVGNodes(oSvgShapeLayerClone);oSvgLayersGroup.appendChild(oSvgShapeLayerClone)}}function addClipping(oSvgDefsClone,d3SvgLayersGroup){var d3Defs,d3ClipPath;if(oSvgDefsClone&&d3SvgLayersGroup){d3Defs=d3.select(oSvgDefsClone);d3ClipPath=d3Defs.append("svg:clipPath").attr("id","clipPathPage");d3ClipPath.append("svg:rect").attr("x",0).attr("y",0).attr("width",nClipWidth).attr("height",nClipHeight);d3SvgLayersGroup.attr("clip-path","url(#clipPathPage)")}}if(this.svgRoot&&this.svgRoot.cloneNode&&XMLSerializer){oOptions=oOptions||{};bIncludeDecoratorLayers=oOptions.includeDecoratorLayers;if(oOptions.zoomScale!==undefined&&oOptions.zoomScale!==0&&!isNaN(oOptions.zoomScale)){nZoomScale=oOptions.zoomScale}if(oOptions.offsetX!==undefined&&!isNaN(oOptions.offsetX)){offsetX=Math.floor(oOptions.offsetX/nZoomScale)}if(oOptions.offsetY!==undefined&&!isNaN(oOptions.offsetY)){offsetY=Math.floor(oOptions.offsetY/nZoomScale)}nClipWidth=oOptions.clipRectWidth;nClipHeight=oOptions.clipRectHeight;bReplaceImageURL=(oOptions.replaceImageURL!==undefined)?oOptions.replaceImageURL:false;oRect=this.getGlobalViewRect(bIncludeDecoratorLayers);if(!oRect){oRect=new sap.galilei.ui.common.Rect()}oRect.inflate(sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN,sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN);oSvgRootClone=this.svgRoot.cloneNode(false);viewWidth=(isNaN(nClipWidth))?oRect.width:nClipWidth;viewHeight=(isNaN(nClipHeight))?oRect.height:nClipHeight;oSvgRootClone.setAttribute("width",viewWidth);oSvgRootClone.setAttribute("height",viewHeight);oSvgRootClone.setAttribute("viewBox",viewX+" "+viewY+" "+viewWidth+" "+viewHeight);offsetX-=oRect.x;offsetY-=oRect.y;if(offsetX!==0||offsetY!==0||nZoomScale!=1){sTransformShapeLayers="";if(nZoomScale!=1){sTransformShapeLayers="scale("+nZoomScale+") "}if(offsetX!==0||offsetY!==0){sTransformShapeLayers+="translate("+offsetX+","+offsetY+")"}}oSvgDefsClone=this.d3SvgDefs.node().cloneNode(true);oSvgRootClone.appendChild(oSvgDefsClone);d3SvgLayersGroup=d3.select(oSvgRootClone).append("svg:g").attr("id","layersGroup");oSvgLayersGroup=d3SvgLayersGroup.node();aLayers=this.getShapeLayers(false,bIncludeDecoratorLayers);if(aLayers){aLayers.forEach(generateLayerSVG)}if(!isNaN(nClipWidth)&&!isNaN(nClipHeight)){addClipping(oSvgDefsClone,d3SvgLayersGroup)}if(bReplaceImageURL){sap.galilei.ui.common.svg.Svg.replaceImageUrlToDataUrl(oSvgRootClone,function(){sSVG=sap.galilei.ui.common.svg.Svg.serializeToXML(oSvgRootClone);if(oSvgRootClone.remove){oSvgRootClone.remove()}if(fnSuccess){fnSuccess(sSVG)}})}else{sSVG=sap.galilei.ui.common.svg.Svg.serializeToXML(oSvgRootClone);if(oSvgRootClone.remove){oSvgRootClone.remove()}}}return sSVG},generateSVGBlob:function(oOptions,fnSuccess){function convertToBlob(sSVG){var oBlob;if(sSVG&&Blob){oBlob=new Blob([sSVG],{type:"text/xml"})}return oBlob}oOptions=oOptions||{};if(oOptions.replaceImageURL){this.generateSVG(oOptions,function(sSVG){if(fnSuccess){fnSuccess(convertToBlob(sSVG))}})}else{return convertToBlob(this.generateSVG(oOptions))}return undefined},generateImageBase64:function(fnImageReady,sImageFormat,oOptions){function convertToBase64(sSVG){if(sSVG){sap.galilei.ui.common.Image.convertSVGToImageBase64(sSVG,fnImageReady,sImageFormat,oOptions)}else{if(fnImageReady){fnImageReady()}}}oOptions=oOptions||{};if(oOptions.replaceImageURL){this.generateSVG(oOptions,function(sSVG){convertToBase64(sSVG)})}else{convertToBase64(this.generateSVG(oOptions))}},generateImageBlob:function(fnImageReady,sImageFormat,oOptions){function convertToBlob(sSVG){if(sSVG){sap.galilei.ui.common.Image.convertSVGToImageBlob(sSVG,fnImageReady,sImageFormat,oOptions)}else{if(fnImageReady){fnImageReady()}}}oOptions=oOptions||{};if(oOptions.replaceImageURL){this.generateSVG(oOptions,function(sSVG){convertToBlob(sSVG)})}else{convertToBlob(this.generateSVG(oOptions))}},_zoomPanView:function(){this._lastZoomPan.idTimeOut=undefined;if(this.enableZoomPan&&!isNaN(this._lastZoomPan.scale)&&this._lastZoomPan.translate){this._onZoomPanHandler(this._lastZoomPan.scale,this._lastZoomPan.translate)}if(this._lastZoomPan.bNeedUpdate){this._lastZoomPan.bNeedUpdate=false;this._lastZoomPan.idTimeOut=setTimeout(this._fnZoomPanView,33)}},_onZoomBehaviorHandler:function(){var self=this;this._lastZoomPan=this._lastZoomPan||{};if(d3.event&&!isNaN(d3.event.scale)&&d3.event.translate&&(this._lastZoomPan.scale!==d3.event.scale||this._lastZoomPan.translate!=d3.event.translate)){this._lastZoomPan.scale=d3.event.scale;this._lastZoomPan.translate=d3.event.translate;if(this._lastZoomPan.idTimeOut){this._lastZoomPan.bNeedUpdate=true}else{if(!this._fnZoomPanView){this._fnZoomPanView=jQuery.proxy(this._zoomPanView,this)}this._lastZoomPan.idTimeOut=setTimeout(this._fnZoomPanView,33)}}},_notifyAfterZoomPan:function(){this._lastZoomPan._idTimeOutAfter=undefined;sap.galilei.core.Event.publish("viewer.zoompan.after",this,undefined,this._lastZoomPan._event);this.notifyLayers("onPostZoomPan",this.zoomScale,this.zoomTranslate,false);if(this.onPostZoomPan){this.onPostZoomPan(this,this.zoomScale,this.zoomTranslate)}},_onZoomPanHandler:function(scale,translate){var self=this,oEvent={},nDuration;if(scale===undefined){scale=this.zoomScale}if(translate===undefined){translate=[this.zoomTranslate[0],this.zoomTranslate[1]]}if(scale===this.oldZoomScale&&translate[0]===this.oldZoomTranslate[0]&&translate[1]===this.oldZoomTranslate[1]){return}nDuration=this.getZoomPanDuration(scale,translate);if(nDuration>0){nDuration+=50}oEvent.scale=scale;oEvent.translate=[translate[0],translate[1]];oEvent.oldScale=this.oldZoomScale;oEvent.oldTranslate=[this.oldZoomTranslate[0],this.oldZoomTranslate[1]];oEvent.useAnimation=false;oEvent.animationDuration=nDuration;sap.galilei.core.Event.publish("viewer.zoompan.before",this,undefined,oEvent);this.notifyLayers("onPreZoomPan",scale,translate,false);if(this.onPreZoomPan){this.onPreZoomPan(this,scale,translate)}this.matrixZoomViewToClient.setIdentity();this.matrixZoomViewToClient.translate(translate[0],translate[1]).scale(scale);this.matrixClientToZoomView.set(this.matrixZoomViewToClient);this.matrixClientToZoomView.inverse();this.notifyLayers("onZoomPan",scale,translate,false);this._lastZoomPan=this._lastZoomPan||{};if(this._lastZoomPan._idTimeOutAfter){clearTimeout(this._lastZoomPan._idTimeOutAfter);this._lastZoomPan._idTimeOutAfter=undefined}this._lastZoomPan._event=oEvent;if(!this._fnNotifyAfterZoomPan){this._fnNotifyAfterZoomPan=jQuery.proxy(this._notifyAfterZoomPan,this)}this._lastZoomPan._idTimeOutAfter=setTimeout(this._fnNotifyAfterZoomPan,nDuration+33);this.oldZoomScale=scale;this.oldZoomTranslate=[translate[0],translate[1]]}}})}());
(function(){sap.galilei.ui.common.svg.Layer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.svg.Layer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{viewer:undefined,name:undefined,d3DrawingSurface:{get:function(){return this.viewer?this.viewer.d3DrawingSurface:undefined}},d3Layer:undefined,svgLayer:{get:function(){if(this.d3Layer){return this.d3Layer.node()}}},animationDuration:500,isVisible:true,isDisableKeyboardEvents:false},methods:{add:undefined,remove:function(bUseAnimation){if(this.d3Layer&&this.d3DrawingSurface){this.d3Layer.hide(bUseAnimation);this.d3Layer.remove()}},show:function(bUseAnimation){if(this.d3Layer){this.isVisible=true;var selection;if(bUseAnimation===false){selection=this.d3Layer}else{selection=this.d3Layer.transition().duration(this.animationDuration)}selection.attr("opacity",1)}return this.d3Layer},hide:function(bUseAnimation){if(this.d3Layer){this.isVisible=false;var selection;if(bUseAnimation===false){selection=this.d3Layer}else{selection=this.d3Layer.transition().duration(this.animationDuration)}selection.attr("opacity",0)}return this.d3Layer},onResize:undefined,onUpdatePageSize:undefined,onZoomPan:undefined,onZoomPanUpdate:undefined},statics:{BACKGROUND_POINTER_LAYER:"svgBackgroundPointerPanelLayer",FIXED_LAYER:"svgFixedLayer",GEOMETRIC_ZOOM_LAYER:"svgGeometricZoomLayer",GRID_LAYER:"svgGridLayer",PAGE_BACKGROUND_LAYER:"svgPageBackgroundLayer",PAGE_LIMIT_LAYER:"svgPageLimitLayer",SEMANTIC_ZOOM_LAYER:"svgSemanticZoomLayer",SHAPE_LAYER:"svgShapeLayer",MAIN_SHAPE_LAYER:"svgMainShapeLayer",SHAPE_DECORATOR_LAYER:"svgShapeDecoratorLayer",ZOOM_TOOL_LAYER:"svgZoomToolLayer",FOREGROUND_POINTER_LAYER:"svgForegroundPointerPanelLayer"}})}());(function(){var oProps={defaultLayers:{field:"_defaultLayers",get:function(){if(!this._defaultLayers){this._defaultLayers=[{layerClass:sap.galilei.ui.common.svg.PageBackgroundLayer},{layerClass:sap.galilei.ui.common.svg.PageLimitLayer},{layerClass:sap.galilei.ui.common.svg.GridLayer},{layerClass:sap.galilei.ui.common.svg.FixedLayer,id:sap.galilei.ui.common.svg.Layer.BACKGROUND_POINTER_LAYER,name:sap.galilei.ui.common.svg.Layer.BACKGROUND_POINTER_LAYER},{layerClass:sap.galilei.ui.common.svg.ShapeLayer,id:sap.galilei.ui.common.svg.Layer.MAIN_SHAPE_LAYER,name:sap.galilei.ui.common.svg.Layer.MAIN_SHAPE_LAYER,isMainShapeLayer:true},{layerClass:sap.galilei.ui.common.svg.ShapeLayer,id:sap.galilei.ui.common.svg.Layer.SHAPE_DECORATOR_LAYER,name:sap.galilei.ui.common.svg.Layer.SHAPE_DECORATOR_LAYER,isShapeDecoratorLayer:true},{layerClass:sap.galilei.ui.common.svg.SemanticZoomLayer},{layerClass:sap.galilei.ui.common.svg.ZoomToolLayer,id:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER,name:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER},{layerClass:sap.galilei.ui.common.svg.FixedLayer,id:sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER,name:sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER}]}return this._defaultLayers},set:function(value){if(value){this._defaultLayers=value}},configurable:true}};sap.galilei.core.extend(sap.galilei.ui.common.svg,sap.galilei.core.ClassDefinitionBuilder.transformValueProperties({},oProps))}());
(function(){sap.galilei.ui.common.svg.GeometricZoomLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.Layer,fullClassName:"sap.galilei.ui.common.svg.GeometricZoomLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,id:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,domClass:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER},methods:{add:function(){if(!this.d3Layer&&this.viewer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},onZoomPan:function(eventName,scale,translate,bUseAnimation){var selection=this.d3Layer,duration=0;if(bUseAnimation){if(this.viewer.oldZoomScale!==scale){duration=this.viewer.zoomDuration}else{if(this.viewer.oldZoomTranslate[0]!==translate[0]||this.viewer.oldZoomTranslate[1]!==translate[1]){duration=this.viewer.panDuration}}if(duration!==0){selection=this.d3Layer.transition().duration(duration).ease("linear")}}selection.attr("transform","translate("+translate+") scale("+scale+")")}},statics:{ID:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,NAME:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER}})}());
(function(){sap.galilei.ui.common.svg.FixedLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.Layer,fullClassName:"sap.galilei.ui.common.svg.FixedLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,id:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,domClass:sap.galilei.ui.common.svg.Layer.FIXED_LAYER},methods:{add:function(){if(!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:g").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},onResize:function(sEventHandlerName){this.d3Layer.attr("width",this.viewer.viewWidth).attr("height",this.viewer.viewHeight)}},statics:{ID:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,NAME:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.FIXED_LAYER}})}());
namespace("sap.galilei.ui.common.style");
(function(){sap.galilei.ui.common.style.Filter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Filter",properties:{id:{get:function(){if(this._id==undefined){sap.galilei.ui.common.style.Filter.lastFilterNumber++;this._id="filter-"+sap.galilei.ui.common.style.Filter.lastFilterNumber}return this._id},set:function(sId){if(sId!=undefined){this._id=sId}}},url:{get:function(){return"url(#"+this.id+")"}},d3Node:undefined},methods:{create:function(oViewer){var d3Filter;if(oViewer&&oViewer.d3SvgDefs&&this.id){this.remove(oViewer);this.d3Node=oViewer.d3SvgDefs.append("svg:filter").attr("id",this.id);this.update(oViewer)}else{this.d3Node=undefined}return this.d3Node},update:function(oViewer){return this.d3Node},find:function(oViewer){var d3FilterNode;if(oViewer){d3FilterNode=oViewer.findNodeById(this.id,oViewer.d3SvgDefs);if(d3FilterNode){this.d3Node=d3FilterNode}}return this.d3Node},remove:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){this.d3Node.remove()}this.d3Node=undefined}}},statics:{lastFilterNumber:0}});sap.galilei.ui.common.style.getFilter=function(sFilterId){var oFilter;if(sFilterId&&sap.galilei.ui.common.style.FilterRegistry){oFilter=sap.galilei.ui.common.style.FilterRegistry.get(sFilterId)}return oFilter};sap.galilei.ui.common.style.addFilter=function(sFilterId,oFilter){if(sFilterId&&oFilter&&sap.galilei.ui.common.style.FilterRegistry){sap.galilei.ui.common.style.FilterRegistry.add(sFilterId,oFilter)}};sap.galilei.ui.common.style.removeFilter=function(sFilterId){if(sFilterId&&sap.galilei.ui.common.style.FilterRegistry){sap.galilei.ui.common.style.FilterRegistry.remove(sFilterId)}};sap.galilei.ui.common.style.FilterRegistry=new sap.galilei.core.DefaultLookupClass()}());
(function(){sap.galilei.ui.common.style.Color=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Color",initialize:function(){this.set.apply(this,arguments)},properties:{r:0,g:0,b:0,isGray:{get:function(){return this.r===this.g&&this.r==this.b&&this.r!==0&&this.r!==255}}},methods:{set:function(){var nValue,oColor;if(arguments.length===3){nValue=+arguments[0];if(nValue>255){nValue=255}if(nValue<0){nValue=0}this.r=nValue;nValue=+arguments[1];if(nValue>255){nValue=255}if(nValue<0){nValue=0}this.g=nValue;nValue=+arguments[2];if(nValue>255){nValue=255}if(nValue<0){nValue=0}this.b=nValue}else{if(arguments.length===1){oColor=d3.rgb(arguments[0]);this.r=oColor.r;this.g=oColor.g;this.b=oColor.b}}return this},getHSL:function(){var oHsl=d3.hsl(this.toString());return{h:oHsl.h,s:oHsl.s,l:oHsl.l}},setHSL:function(h,s,l){var oHsl=d3.hsl(h,s,l),oColor=d3.rgb(oHsl.toString());this.r=oColor.r;this.g=oColor.g;this.b=oColor.b;return this},grayScale:function(){var oHsl=this.getHSL();return this.setHSL(oHsl.h,0,oHsl.l)},brighter:function(nPercent){var oHsl=this.getHSL(),nRange;if(nPercent===undefined){nPercent=0.1}if(nPercent<0){nPercent=0}if(nPercent>1){nPercent=1}nRange=1-oHsl.l;if(nRange!==0){oHsl.l+=nRange*nPercent;this.setHSL(oHsl.h,oHsl.s,oHsl.l)}return this},darker:function(nPercent){var oHsl=this.getHSL(),nRange;if(nPercent===undefined){nPercent=0.1}if(nPercent<0){nPercent=0}if(nPercent>1){nPercent=1}nRange=oHsl.l;if(nRange!==0){oHsl.l-=nRange*nPercent;this.setHSL(oHsl.h,oHsl.s,oHsl.l)}return this},toString:function(){var oColor=d3.rgb(this.r,this.g,this.b);return oColor.toString()}},statics:{navy:"#001F3F",blue:"#0074D9",aqua:"#7FDBFF",teal:"#39CCCC",olive:"#3D9970",lightgreen:"#2ECC40",green:"#23992E",darkgreen:"#17661F",lime:"#01FF70",yellow:"#FFDC00",orange:"#FF9900",red:"#FF4136",maroon:"#85144B",fuchsia:"#F012BE",purple:"#B10DC9",white:"#FFFFFF",silver:"#DDDDDD",gray:"#AAAAAA",black:"#111111",getGrayScale:function(sColor){var oColor=new sap.galilei.ui.common.style.Color(sColor);return oColor.grayScale().toString()},getBrighterColor:function(sColor,nPercent){var oColor=new sap.galilei.ui.common.style.Color(sColor);return oColor.brighter(nPercent).toString()},getDarkerColor:function(sColor,nPercent){var oColor=new sap.galilei.ui.common.style.Color(sColor);return oColor.darker(nPercent).toString()}}})}());
(function(){sap.galilei.ui.common.style.ColorScaleFilter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.ColorScaleFilter",parent:sap.galilei.ui.common.style.Filter,properties:{darkColor:{field:"_darkColor",value:"black",get:function(){return this._darkColor||"black"},set:function(sColor){this._darkColor=sColor}},lightColor:{field:"_lightColor",value:"white",get:function(){return this._lightColor||"white"},set:function(sColor){this._lightColor=sColor}},opacity:1},methods:{update:function(oViewer){var oColor,sColorMatrixValues,nRedScale1,nGreenScale1,nBlueScale1,nRedScale2,nGreenScale2,nBlueScale2,oTableFilter;if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){oColor=new sap.galilei.ui.common.style.Color(this.darkColor);nRedScale1=oColor.r/255;nGreenScale1=oColor.g/255;nBlueScale1=oColor.b/255;oColor.set(this.lightColor);nRedScale2=oColor.r/255;nGreenScale2=oColor.g/255;nBlueScale2=oColor.b/255;sColorMatrixValues="0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 "+this.opacity+" 0";this.d3Node.append("svg:feColorMatrix").attr("type","matrix").attr("result","grayScaleResult").attr("values",sColorMatrixValues);oTableFilter=this.d3Node.append("svg:feComponentTransfer").attr("color-interpolation-filters","sRGB").attr("in","grayScaleResult");oTableFilter.append("svg:feFuncR").attr("type","table").attr("tableValues",""+nRedScale1+" "+nRedScale2);oTableFilter.append("svg:feFuncG").attr("type","table").attr("tableValues",""+nGreenScale1+" "+nGreenScale2);oTableFilter.append("svg:feFuncB").attr("type","table").attr("tableValues",""+nBlueScale1+" "+nBlueScale2)}}return this.d3Node}}})}());
(function(){sap.galilei.ui.common.style.DropShadow=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.DropShadow",parent:sap.galilei.ui.common.style.Filter,properties:{x:-0.2,y:-0.2,width:2,height:2,color:"black",opacity:0.4,size:2,dx:2,dy:2},methods:{update:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){var d3Color=d3.rgb(this.color),sColorMatrixValues="0 0 0 "+d3Color.r/256+" 0 0 0 0 "+d3Color.g/256+" 0 0 0 0 "+d3Color.b/256+" 0 0 0 0 "+this.opacity+" 0",sOffsetOut=sap.galilei.ui.common.svg.Svg.getUniqueId("offsetOut"),sColorMatrixOut=sap.galilei.ui.common.svg.Svg.getUniqueId("colorMatrixOut"),sGaussianBlurOut=sap.galilei.ui.common.svg.Svg.getUniqueId("gaussianBlurOut");this.d3Node.attr("x",this.x).attr("y",this.y).attr("width",this.width).attr("height",this.height);this.d3Node.append("svg:feOffset").attr("result",sOffsetOut).attr("in","SourceAlpha").attr("dx",this.dx).attr("dy",this.dy);this.d3Node.append("svg:feColorMatrix").attr("result",sColorMatrixOut).attr("in",sOffsetOut).attr("type","matrix").attr("values",sColorMatrixValues);this.d3Node.append("svg:feGaussianBlur").attr("result",sGaussianBlurOut).attr("in",sColorMatrixOut).attr("stdDeviation",this.size);this.d3Node.append("svg:feBlend").attr("in","SourceGraphic").attr("in2",sGaussianBlurOut).attr("mode","normal")}}return this.d3Node}}})}());
(function(){sap.galilei.ui.common.style.Glow=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Glow",parent:sap.galilei.ui.common.style.Filter,properties:{x:-0.3,y:-0.3,width:1.6,height:1.6,color:"black",opacity:1,size:2},methods:{update:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){var sFloodColor=sap.galilei.ui.common.svg.Svg.getUniqueId("floodColorOut"),sMorphologyOut=sap.galilei.ui.common.svg.Svg.getUniqueId("morphologyOut"),sColorMatrixOut=sap.galilei.ui.common.svg.Svg.getUniqueId("colorMatrixOut"),sCompositeOut=sap.galilei.ui.common.svg.Svg.getUniqueId("compositeOut"),sGaussianBlurOut=sap.galilei.ui.common.svg.Svg.getUniqueId("gaussianBlurOut"),sColorMatrixValues;this.d3Node.attr("x",this.x).attr("y",this.y).attr("width",this.width).attr("height",this.height);this.d3Node.append("svg:feFlood").attr("flood-color",this.color).attr("result",sFloodColor);this.d3Node.append("svg:feMorphology").attr("result",sMorphologyOut).attr("in","SourceGraphic").attr("operator","dilate").attr("radius",this.size);sColorMatrixValues="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 "+this.opacity+" 0";this.d3Node.append("svg:feColorMatrix").attr("result",sColorMatrixOut).attr("in",sMorphologyOut).attr("type","matrix").attr("values",sColorMatrixValues);this.d3Node.append("svg:feComposite").attr("result",sCompositeOut).attr("in",sFloodColor).attr("in2",sColorMatrixOut).attr("operator","in");this.d3Node.append("svg:feGaussianBlur").attr("result",sGaussianBlurOut).attr("in",sCompositeOut).attr("stdDeviation",this.size);this.d3Node.append("svg:feBlend").attr("in","SourceGraphic").attr("in2",sGaussianBlurOut).attr("mode","normal")}}return this.d3Node}}})}());
(function(){sap.galilei.ui.common.style.Gradient=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Gradient",properties:{id:{get:function(){if(this._id==undefined){sap.galilei.ui.common.style.Gradient.lastGradientNumber++;this._id="gradient-"+sap.galilei.ui.common.style.Gradient.lastGradientNumber}return this._id},set:function(sId){if(sId!=undefined){this._id=sId}}},url:{get:function(){return"url(#"+this.id+")"}},d3Node:undefined,stops:[{offset:"0%",color:"white",opacity:1},{offset:"100%",color:"black",opacity:1}]},methods:{createGradient:function(oViewer){return this.d3Node},updateGradient:function(oViewer){return this.d3Node},findGradient:function(oViewer){if(oViewer){var d3Gradient=oViewer.findNodeById(this.id,oViewer.d3SvgDefs);if(d3Gradient){this.d3Node=d3Gradient}}return this.d3Node},removeGradient:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGradient(oViewer)}if(this.d3Node){this.d3Node.remove()}this.d3Node=undefined}}},statics:{lastGradientNumber:0}});sap.galilei.ui.common.style.LinearGradient=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.LinearGradient",parent:sap.galilei.ui.common.style.Gradient,properties:{x1:"0%",y1:"0%",x2:"0%",y2:"100%",orientation:{get:function(){if(this.x1==="0%"&&this.y1==="0%"&&this.x2==="100%"&&this.y2==="0%"){return sap.galilei.ui.common.LinearGradientOrientations.leftToRight}else{if(this.x1==="0%"&&this.y1==="0%"&&this.x2==="0%"&&this.y2==="100%"){return sap.galilei.ui.common.LinearGradientOrientations.topToBottom}else{if(this.x1==="0%"&&this.y1==="0%"&&this.x2==="100%"&&this.y2==="100%"){return sap.galilei.ui.common.LinearGradientOrientations.leftTopToRightBottom}else{if(this.x1==="100%"&&this.y1==="0%"&&this.x2==="0%"&&this.y2==="100%"){return sap.galilei.ui.common.LinearGradientOrientations.rightTopToLeftBottom}}}}return undefined},set:function(value){switch(value){case sap.galilei.ui.common.LinearGradientOrientations.leftToRight:this.x1="0%";this.y1="0%";this.x2="100%";this.y2="0%";break;case sap.galilei.ui.common.LinearGradientOrientations.topToBottom:this.x1="0%";this.y1="0%";this.x2="0%";this.y2="100%";break;case sap.galilei.ui.common.LinearGradientOrientations.leftTopToRightBottom:this.x1="0%";this.y1="0%";this.x2="100%";this.y2="100%";break;case sap.galilei.ui.common.LinearGradientOrientations.rightTopToLeftBottom:this.x1="100%";this.y1="0%";this.x2="0%";this.y2="100%";break}}}},methods:{createGradient:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id&&this.stops&&this.stops.length>0){var d3Gradient;d3Gradient=this.findGradient(oViewer);if(d3Gradient){d3Gradient.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:linearGradient").attr("id",this.id);this.updateGradient(oViewer)}return this.d3Node},updateGradient:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGradient(oViewer)}if(this.d3Node){this.d3Node.attr("x1",this.x1).attr("y1",this.y1).attr("x2",this.x2).attr("y2",this.y2).attr("gradientUnits","objectBoundingBox");var svgGradient=this.d3Node.node(),index,svgNode,oStop;for(index=svgGradient.childNodes.length-1;index>=0;index--){svgNode=svgGradient.childNodes[index];svgGradient.removeChild(svgNode)}for(index=0;index<this.stops.length;index++){oStop=this.stops[index];this.d3Node.append("svg:stop").attr("offset",oStop.offset).attr("stop-color",oStop.color).attr("stop-opacity",oStop.opacity)}}}return this.d3Node}}});sap.galilei.ui.common.style.RadialGradient=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.RadialGradient",parent:sap.galilei.ui.common.style.Gradient,properties:{cx:"50%",cy:"50%",r:"50%",fx:{field:"_fx",get:function(){return(this._fx!==undefined)?this._fx:this.cx},set:function(value){this._fx=value}},fy:{field:"_fy",get:function(){return(this._fy!==undefined)?this._fy:this.cy},set:function(value){this._fy=value}}},methods:{createGradient:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id&&this.stops&&this.stops.length>0){var d3Gradient;d3Gradient=this.findGradient(oViewer);if(d3Gradient){d3Gradient.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:radialGradient").attr("id",this.id);this.updateGradient(oViewer)}return this.d3Node},updateGradient:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGradient(oViewer)}if(this.d3Node){this.d3Node.attr("cx",this.cx).attr("cy",this.cy).attr("r",this.r).attr("fx",this.fx).attr("fy",this.fy).attr("gradientUnits","objectBoundingBox");var svgGradient=this.d3Node.node(),index,svgNode,oStop;for(index=svgGradient.childNodes.length-1;index>=0;index--){svgNode=svgGradient.childNodes[index];svgGradient.removeChild(svgNode)}for(index=0;index<this.stops.length;index++){oStop=this.stops[index];this.d3Node.append("svg:stop").attr("offset",oStop.offset).attr("stop-color",oStop.color).attr("stop-opacity",oStop.opacity)}}}return this.d3Node}}});sap.galilei.ui.common.style.getGradient=function(sGradientId){var oGradient;if(sGradientId&&sap.galilei.ui.common.style.GradientRegistry){oGradient=sap.galilei.ui.common.style.GradientRegistry.get(sGradientId)}return oGradient};sap.galilei.ui.common.style.addGradient=function(sGradientId,oGradient){if(sGradientId&&oGradient&&sap.galilei.ui.common.style.GradientRegistry){sap.galilei.ui.common.style.GradientRegistry.add(sGradientId,oGradient)}};sap.galilei.ui.common.style.removeGradient=function(sGradientId){if(sGradientId&&sap.galilei.ui.common.style.GradientRegistry){sap.galilei.ui.common.style.GradientRegistry.remove(sGradientId)}};sap.galilei.ui.common.style.GradientRegistry=new sap.galilei.core.DefaultLookupClass()}());
(function(){sap.galilei.ui.common.style.GrayScaleFilter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.GrayScaleFilter",parent:sap.galilei.ui.common.style.Filter,properties:{opacity:1},methods:{update:function(oViewer){var sColorMatrixValues;if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){sColorMatrixValues="0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 "+this.opacity+" 0";this.d3Node.append("svg:feColorMatrix").attr("type","matrix").attr("values",sColorMatrixValues)}}return this.d3Node}}})}());
(function(){sap.galilei.ui.common.style.StyleSheet=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.StyleSheet",properties:{name:undefined,parentName:undefined,isShared:false,stroke:undefined,strokeWidth:undefined,strokeDashArray:undefined,strokeOpacity:undefined,fill:undefined,fillOpacity:undefined,opacity:undefined,filter:undefined,customCSS:undefined},methods:{generateCssStyleString:function(){var sStyle="";if(this.stroke!==undefined){sStyle+="stroke:"+this.stroke+";"}if(this.strokeWidth!==undefined){sStyle+="stroke-width:"+this.strokeWidth+";"}if(this.strokeDashArray!==undefined){sStyle+="stroke-dasharray:"+this.strokeDashArray+";"}if(this.strokeOpacity!==undefined){sStyle+="stroke-opacity:"+this.strokeOpacity+";"}if(this.fill!==undefined){sStyle+="fill:"+this.fill+";"}if(this.fillOpacity!==undefined){sStyle+="fill-opacity:"+this.fillOpacity+";"}if(this.opacity!==undefined){sStyle+="opacity:"+this.opacity+";"}if(this.filter!==undefined){sStyle+="filter:"+this.filter+";"}if(this.customCSS!==undefined){sStyle+=this.customCSS}if(sStyle.length>0){return sStyle}return undefined},clone:function(){var oNewStyleSheet;oNewStyleSheet=new sap.galilei.ui.common.style.StyleSheet();sap.galilei.core.copyProperties(oNewStyleSheet,this);return oNewStyleSheet}},statics:{isSupportedProperty:function(sName){switch(sName){case"stroke":case"stroke-width":case"strokeWidth":case"stroke-dasharray":case"strokeDashArray":case"stroke-opacity":case"strokeOpacity":case"fill":case"fill-opacity":case"fillOpacity":case"opacity":case"filter":return true}return false},parse:function(sStyle){var aStyleEntries,i,max,aStyleEntry,sName,sValue,sStyleName,sEntry,oStyleProperties={};if(sStyle){i=sStyle.indexOf("{");if(i!==-1){sStyleName=sStyle.substring(0,i).trim();sStyle=sStyle.substring(i+1);i=sStyle.lastIndexOf("}");if(i!==-1){sStyle=sStyle.substring(0,i)}}aStyleEntries=sStyle.split(";");if(aStyleEntries&&aStyleEntries.length>0){for(i=0,max=aStyleEntries.length;i<max;i++){sEntry=aStyleEntries[i].trim();if(sEntry){aStyleEntry=sEntry.split(":");if(aStyleEntry&&aStyleEntry.length===2){sName=aStyleEntry[0].trim();sValue=aStyleEntry[1].trim();if(sName!==undefined&&sValue!==undefined){oStyleProperties[sName]=sValue}}}}}}return{name:sStyleName,properties:oStyleProperties}},getDocumentCSSStyleRuleInfo:function(sSelector){var oStyleRuleInfo,index,max,oStyleSheet,index2,max2,oStyleRule;if((typeof document!=="undefined")&&sSelector!==undefined){for(index=0,max=document.styleSheets.length;index<max;index++){oStyleSheet=document.styleSheets[index];for(index2=0,max2=oStyleSheet.cssRules.length;index2<max2;index2++){oStyleRule=oStyleSheet.cssRules[index2];if(oStyleRule.type===CSSRule.STYLE_RULE&&oStyleRule.selectorText===sSelector){oStyleRuleInfo={styleSheet:oStyleSheet,styleSheetIndex:index,styleRule:oStyleRule,styleRuleIndex:index2}}}}}return oStyleRuleInfo},getDocumentCSSText:function(sSelector){var oStyleRuleInfo=this.getDocumentCSSStyleRuleInfo(sSelector);if(oStyleRuleInfo!==undefined){return oStyleRuleInfo.styleRule.cssText}return undefined},addDocumentCSSStyleRule:function(sSelector,sCSSStyle,nIndex){var oStyleRuleInfo,oStyleSheet;if((typeof document!=="undefined")&&sSelector!==undefined&&sCSSStyle!==undefined){try{oStyleRuleInfo=this.getDocumentCSSStyleRuleInfo(sSelector);if(oStyleRuleInfo!==undefined){oStyleSheet=oStyleRuleInfo.styleSheet;nIndex=oStyleRuleInfo.styleRuleIndex;oStyleSheet.removeRule(nIndex)}else{oStyleSheet=document.styleSheets[document.styleSheets.length-1];if(nIndex===undefined||nIndex<0||nIndex>oStyleSheet.cssRules.length){nIndex=oStyleSheet.cssRules.length}}if(oStyleSheet.addRule instanceof Function){oStyleSheet.addRule(sSelector,sCSSStyle,nIndex)}else{if(oStyleSheet.insertRule instanceof Function){oStyleSheet.insertRule(sSelector+"{"+sCSSStyle+"}",nIndex)}}}catch(e){}}},removeDocumentCSSStyleRule:function(sSelector){var oStyleRuleInfo=this.getDocumentCSSStyleRuleInfo(sSelector);if(oStyleRuleInfo!==undefined){oStyleRuleInfo.styleSheet.removeRule(oStyleRuleInfo.styleRuleIndex)}}}})}());
(function(){namespace("sap.galilei.ui.common.binding");sap.galilei.ui.common.binding.Binding=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.binding.Binding",properties:{objectContext:undefined,propertyName:undefined,path:undefined,shape:undefined},methods:{getObjectAndPropertyName:function(){var aParts,oObject,index,sPath,sBindingPath,bRelative=true;if(this.objectContext&&this.path){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>1){for(index=0;index<aParts.length-1;index++){sPath=aParts[index];if(oObject){oObject=oObject[sPath]}sBindingPath=aParts[aParts.length-1]}}return{object:oObject,propertyName:sBindingPath}}},getObjectProperty:function(){var oInfo,oObject,sBindingPath;if(this.objectContext&&this.path){oInfo=this.getObjectAndPropertyName();if(oInfo){oObject=oInfo.object;sBindingPath=oInfo.propertyName}else{return undefined}return oObject[sBindingPath]}return undefined},setObjectProperty:function(vValue){var oInfo=this.getObjectAndPropertyName(),oObject,sPropertyName;if(oInfo){oObject=oInfo.object;sPropertyName=oInfo.propertyName;oObject[sPropertyName]=vValue}},getTargetProperty:function(){if(this.shape&&this.propertyName){return this.shape[this.propertyName]}return undefined},setTargetProperty:function(vValue){if(this.shape&&this.propertyName&&sap.galilei.core.hasProperty(this.shape,this.propertyName)){this.shape[this.propertyName]=vValue}},removeBinding:function(){if(this.shape&&this.propertyName){this.shape.unbindProperty(this.propertyName)}},dispose:function(){this.removeBinding()}},statics:{isPropertyBinding:function(vValue){var sProperty;if(vValue){switch(typeof vValue){case"string":vValue=vValue.trim();if(vValue.length>2&&vValue[0]==="{"&&vValue[vValue.length-1]==="}"){return true}break;case"object":for(sProperty in vValue){switch(sProperty){case"path":case"formatter":case"type":break;default:return false}}return true}}return false},isAggregationBinding:function(vValue){var sProperty,bAggregation=false;if(vValue){if(typeof vValue==="object"){for(sProperty in vValue){switch(sProperty){case"path":case"template":if(sProperty==="template"){bAggregation=true}break;default:return false}}return bAggregation}}return false},isBindingExpression:function(vValue){return this.isPropertyBinding(vValue)||this.isAggregationBinding(vValue)},parseBinding:function(vValue){var sBindingPath,sFormatter,aPart,oBinding={},sProperty,bAggregation=false;if(vValue){switch(typeof vValue){case"string":vValue=vValue.trim();if(vValue.length>2&&vValue[0]==="{"&&vValue[vValue.length-1]==="}"){sBindingPath=vValue.slice(1,vValue.length-1);aPart=sBindingPath.split(":");if(aPart.length>1){sBindingPath=aPart[0].trim();sFormatter=aPart[1].trim()}}return new sap.galilei.ui.common.binding.PropertyBinding({path:sBindingPath,formatter:sFormatter});case"object":for(sProperty in vValue){switch(sProperty){case"path":case"formatter":case"type":case"template":oBinding[sProperty]=vValue[sProperty];if(sProperty==="template"){bAggregation=true}break}}if(bAggregation){return new sap.galilei.ui.common.binding.AggregationBinding(vValue)}else{return new sap.galilei.ui.common.binding.PropertyBinding(vValue)}}}return undefined}}})}());
(function(){sap.galilei.ui.common.binding.AggregationBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.Binding,fullClassName:"sap.galilei.ui.common.binding.AggregationBinding",properties:{template:undefined}})}());
(function(){sap.galilei.ui.common.binding.ItemContext=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.binding.ItemContext",properties:{parentShape:undefined,itemsPropertyName:undefined,itemIndex:undefined},methods:{getObjectContext:function(){var oObjectContext;if(this.parentShape&&this.itemsPropertyName&&!isNaN(this.itemIndex)){oObjectContext=this.parentShape.getPropertyValue(this.itemsPropertyName);if(oObjectContext&&oObjectContext.length>0&&this.itemIndex>=0&&this.itemIndex<oObjectContext.length){if(oObjectContext instanceof Array){oObjectContext=oObjectContext[this.itemIndex]}else{if(oObjectContext.get){oObjectContext=oObjectContext.get(this.itemIndex)}}}}return oObjectContext}}})}());
(function(){sap.galilei.ui.common.binding.PropertyBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.Binding,fullClassName:"sap.galilei.ui.common.binding.PropertyBinding",properties:{formatter:undefined},methods:{getObjectProperty:function(){var oInfo,oObject,sBindingPath,oFormatterContext,oFormatter,vValue,sValue;if(this.objectContext&&(this.path||this.formatter)){oInfo=this.getObjectAndPropertyName();if(oInfo){oObject=oInfo.object;sBindingPath=oInfo.propertyName}else{return undefined}oFormatter=this.formatter;if(oFormatter){vValue=oObject&&sBindingPath&&oObject[sBindingPath];if(typeof oFormatter==="function"){oFormatterContext=this.objectContext;return oFormatter.call(oFormatterContext,vValue,oObject)}else{if((typeof oFormatter==="object")&&sBindingPath){if(vValue){sValue=vValue.toString();if(oFormatter.hasOwnProperty(sValue)){return oFormatter[sValue]}}if(oFormatter.hasOwnProperty("DEFAULT")){return oFormatter.DEFAULT}return undefined}}}else{if(oObject&&sBindingPath){if(typeof(oObject.getFormattedValue)==="function"){return oObject.getFormattedValue(sBindingPath)}else{return oObject[sBindingPath]}}}}return undefined}}})}());
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.ShapeStates={NORMAL:0,RESIZABLE:1,ROTABLE:2,PRESERVEASPECT:4,ADJUSTTOCONTENT:8,MODIFIABLE:16,COMPOSITE:32,GROUP:64,TRANSPARENT:128,DISABLED:256,DEFAULT:0};nsShape.Shape=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.shape.Shape",statics:{propertiesMap:{id:"id",domClass:"class",stroke:"stroke",strokeWidth:"stroke-width",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeDashArray:"stroke-dasharray",strokeOpacity:"stroke-opacity",fill:"fill",fillOpacity:"fill-opacity",opacity:"opacity",filter:"filter",cssStyle:"style",cursor:"cursor",transform:"transform",isVisible:"display",zindex:"galilei:data-zindex",focusable:"focusable",tabindex:"tabindex",tooltip:"title",desc:"desc",ariaLabel:"aria-label",role:"role",automationId:"sap-automation"},DEFAULT_CONTENT_PADDING:4,nextId:0,getNextId:function(){return ++nsShape.Shape.nextId},convertToNode:function(oViewer,oShape,sShapeProp,sNodeProp,vValue){if(oViewer&&oShape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"isVisible":if(vValue==true){vValue="inline"}else{if(vValue==false){vValue="none"}else{vValue=undefined}}break;case"fill":case"fillOpacity":if(oShape.isTransparent==true){vValue=undefined}break}}return vValue},convertFromNode:function(oViewer,oShape,sNodeProp,sShapeProp,vValue){if(oViewer&&oShape&&sShapeProp&&sNodeProp){switch(sNodeProp){case"visibility":vValue=(vValue==="visible");break;case"fill":if(vValue==="none"){oShape.isTransparent=true}break}}return vValue},updateDrawing:function(oViewer,oShape,oTransition,oPropertyMap,fnConvertToNode,aAttributes){var d3Node,d3NodeOrTransition,oSubNode,sProp,sNodeProp,vValue,sOldStyle;if(oShape&&oShape.isDrawn&&!oShape.isDisableDrawing&&oPropertyMap){d3Node=d3NodeOrTransition=oShape.d3Node;if(d3Node){if(oTransition){d3NodeOrTransition=oTransition}for(sProp in oPropertyMap){if(!nsShape.Shape.isPropertySupported(aAttributes,sProp)){continue}vValue=oShape[sProp];sNodeProp=oPropertyMap[sProp];if(fnConvertToNode){vValue=fnConvertToNode(oViewer,oShape,sProp,sNodeProp,vValue)}if(vValue!=undefined){if(sNodeProp==="xlink:href"||sNodeProp==="href"){d3Node.attr(sNodeProp,vValue)}else{if(sNodeProp==="style"&&oTransition){nsShape.Shape.updateStyle(oViewer,oShape,oTransition,vValue)}else{if(sNodeProp==="title"||sNodeProp==="desc"){oSubNode=d3Node.select(sNodeProp);if(!oSubNode.node()){oSubNode=d3Node.append("svg:"+sNodeProp)}oSubNode.text(vValue)}else{if(d3NodeOrTransition){d3NodeOrTransition.attr(sNodeProp,vValue)}else{d3Node.attr(sNodeProp,vValue)}}}}}else{if(sNodeProp==="style"){sOldStyle=d3Node.attr(sNodeProp);if(sOldStyle!=undefined){nsShape.Shape.removeStyle(oViewer,oShape,oTransition,sOldStyle)}}else{if(sNodeProp!=="transform"&&sNodeProp!=="d"){if(d3Node.attr(sNodeProp)!=undefined){if(d3NodeOrTransition){d3NodeOrTransition.attr(sNodeProp,vValue)}else{d3Node.attr(sNodeProp,vValue)}}}}}}}}return d3Node},updateStyle:function(oViewer,oShape,oTransition,sStyle){var d3NodeOrTransition,oStyle,sProperty;if(oShape&&oShape.isDrawn&&sStyle){d3NodeOrTransition=oShape.d3Node;if(oTransition){d3NodeOrTransition=oTransition}oStyle=nsCommon.style.StyleSheet.parse(sStyle);if(oStyle&&oStyle.properties){for(sProperty in oStyle.properties){if(oStyle.properties.hasOwnProperty(sProperty)){d3NodeOrTransition.style(sProperty,oStyle.properties[sProperty])}}}}},removeStyle:function(oViewer,oShape,oTransition,sOldStyle){var d3NodeOrTransition,oStyle,sProperty;if(oShape&&oShape.isDrawn&&sOldStyle){d3NodeOrTransition=oShape.d3Node;if(oTransition){d3NodeOrTransition=oTransition}oStyle=nsCommon.style.StyleSheet.parse(sOldStyle);if(oStyle&&oStyle.properties){for(sProperty in oStyle.properties){if(oStyle.properties.hasOwnProperty(sProperty)&&nsCommon.style.StyleSheet.isSupportedProperty(sProperty)){d3NodeOrTransition.style(sProperty,null)}}}}},retrieveDrawing:function(oViewer,oShape,d3Node,oPropertyMap,fnConvertFromNode,aAttributes){var sProp,sNodeProp,vValue;if(oShape&&oPropertyMap){d3Node=d3Node||oShape.d3Node;if(d3Node){for(sProp in oPropertyMap){sNodeProp=oPropertyMap[sProp];if(!nsShape.Shape.isPropertySupported(aAttributes,sNodeProp)){continue}vValue=d3Node.attr(sNodeProp);if(vValue!==undefined){if(fnConvertFromNode){vValue=fnConvertFromNode(oViewer,oShape,sNodeProp,sProp,vValue)}if(vValue!==undefined){oShape[sProp]=vValue}}}}}return d3Node},isPropertySupported:function(aAttributes,sPropName){var index,sAttr;if(sPropName){if(aAttributes===undefined||aAttributes.length===0){return true}for(index=0;index<aAttributes.length;index++){sAttr=aAttributes[index];if(sAttr===sPropName){return true}}}return false},grayOutHighlightFilter:function(oShape,oStyleSheet){var bEmpty=true;if(oShape){if(!oStyleSheet){oStyleSheet=new nsCommon.style.StyleSheet()}if(oShape.isSupportFill){if((oShape.fill&&oShape.fill!=="none")||sap.galilei.core.getClassName(oShape)==="sap.galilei.ui.common.shape.Shape"||oShape.highlighterStyleSheet&&oShape.highlighterStyleSheet.fill&&oShape.highlighterStyleSheet.fill!=="none"){oStyleSheet.fill=nsCommon.style.Color.getGrayScale((oShape.fill=="none"?undefined:oShape.fill)||"#EEEEEE");bEmpty=false}}if(oShape.isSupportStroke){if((oShape.stroke&&oShape.stroke!=="none")||sap.galilei.core.getClassName(oShape)==="sap.galilei.ui.common.shape.Shape"||oShape.highlighterStyleSheet&&oShape.highlighterStyleSheet.stroke&&oShape.highlighterStyleSheet.stroke!=="none"){oStyleSheet.stroke=nsCommon.style.Color.getGrayScale((oShape.stroke=="none"?undefined:oShape.stroke)||"#000000");oStyleSheet.strokeWidth=oShape.strokeWidth;bEmpty=false}}oStyleSheet.opacity=0.6}return oStyleSheet},emptyHandler:function(oEvent){if(oEvent){oEvent.stopImmediatePropagation();oEvent.preventDefault()}}},fields:{_isCreatingNode:false},properties:{name:{value:"Shape",writable:false,configurable:false},category:{value:"Internal",writable:false,configurable:false},d3Node:undefined,svgNode:{get:function(){return this.d3Node&&this.d3Node.node()},set:function(svgNodeSelector){if(svgNodeSelector){this.d3Node=d3.select(svgNodeSelector)}else{this.d3Node=undefined}}},shapeId:{get:function(){if(this._shapeId===undefined){this._shapeId=nsShape.Shape.getNextId()}return this._shapeId}},id:undefined,domClass:undefined,x:{field:"_x",get:function(){return this.getFieldOrBindValue("x")},set:function(nValue){this.setFieldOrBindValue("x",sap.galilei.core.validateNumeric(nValue,this._x,true))}},y:{field:"_y",get:function(){return this.getFieldOrBindValue("y")},set:function(nValue){this.setFieldOrBindValue("y",sap.galilei.core.validateNumeric(nValue,this._y,true))}},width:{field:"_width",get:function(){return this.getFieldOrBindValue("width")},set:function(nValue){this.setFieldOrBindValue("width",sap.galilei.core.validateNumeric(nValue,this._width,true))}},height:{field:"_height",get:function(){return this.getFieldOrBindValue("height")},set:function(nValue){this.setFieldOrBindValue("height",sap.galilei.core.validateNumeric(nValue,this._height,true))}},angle:{field:"_angle",get:function(){return this.getFieldOrBindValue("angle")},set:function(nValue){this.setFieldOrBindValue("angle",sap.galilei.core.validateNumeric(nValue,this._angle,true))}},stroke:{field:"_stroke",get:function(){return this.getFieldOrBindValue("stroke")},set:function(vValue){this.setFieldOrBindValue("stroke",vValue)}},strokeWidth:{field:"_strokeWidth",get:function(){return this.getFieldOrBindValue("strokeWidth")},set:function(nValue){this.setFieldOrBindValue("strokeWidth",sap.galilei.core.validateNumeric(nValue,this._strokeWidth,true))}},strokeLineCap:{field:"_strokeLineCap",value:nsCommon.LineCap.DEFAULT,get:function(){return this.getFieldOrBindValue("strokeLineCap")},set:function(nValue){this.setFieldOrBindValue("strokeLineCap",nValue)}},strokeLineJoin:{field:"_strokeLineJoin",value:nsCommon.LineJoin.DEFAULT,get:function(){return this.getFieldOrBindValue("strokeLineJoin")},set:function(nValue){this.setFieldOrBindValue("strokeLineJoin",nValue)}},strokeDashArray:{field:"_strokeDashArray",value:nsCommon.DashStyle.DEFAULT,get:function(){return this.getFieldOrBindValue("strokeDashArray")},set:function(sValue){if(sValue===undefined&&this._strokeDashArray!==undefined&&this.isDrawn){sValue=null}this.setFieldOrBindValue("strokeDashArray",sValue)}},strokeOpacity:{field:"_strokeOpacity",get:function(){return this.getFieldOrBindValue("strokeOpacity")},set:function(nValue){this.setFieldOrBindValue("strokeOpacity",sap.galilei.core.validateNumeric(nValue,this._strokeOpacity,true))}},fill:{field:"_fill",get:function(){return this.getFieldOrBindValue("fill")},set:function(vValue){this.setFieldOrBindValue("fill",vValue)}},fillOpacity:{field:"_fillOpacity",get:function(){return this.getFieldOrBindValue("fillOpacity")},set:function(nValue){this.setFieldOrBindValue("fillOpacity",sap.galilei.core.validateNumeric(nValue,this._fillOpacity,true))}},opacity:{field:"_opacity",get:function(){return this.getFieldOrBindValue("opacity")},set:function(nValue){this.setFieldOrBindValue("opacity",sap.galilei.core.validateNumeric(nValue,this._opacity,true))}},filter:undefined,highlighterStyleSheet:undefined,styleSheet:undefined,cssStyle:{field:"_cssStyle",get:function(){var sStyle=this.generateCssStyleString();if(sStyle){return sStyle}else{return this.getFieldOrBindValue("cssStyle")}},set:function(sCssString){this.setFieldOrBindValue("cssStyle",sCssString)}},cursor:undefined,minWidth:{field:"_minWidth",get:function(){return this.getFieldOrBindValue("minWidth")},set:function(nValue){this.setFieldOrBindValue("minWidth",sap.galilei.core.validateNumeric(nValue,this._minWidth,true))}},minHeight:{field:"_minHeight",get:function(){return this.getFieldOrBindValue("minHeight")},set:function(nValue){this.setFieldOrBindValue("minHeight",sap.galilei.core.validateNumeric(nValue,this._minHeight,true))}},maxWidth:{field:"_maxWidth",get:function(){return this.getFieldOrBindValue("maxWidth")},set:function(nValue){this.setFieldOrBindValue("maxWidth",sap.galilei.core.validateNumeric(nValue,this._maxWidth,true))}},maxHeight:{field:"_maxHeight",get:function(){return this.getFieldOrBindValue("maxHeight")},set:function(nValue){this.setFieldOrBindValue("maxHeight",sap.galilei.core.validateNumeric(nValue,this._maxHeight,true))}},defaultWidth:{field:"_defaultWidth",get:function(){return this.getFieldOrBindValue("defaultWidth")},set:function(nValue){this.setFieldOrBindValue("defaultWidth",sap.galilei.core.validateNumeric(nValue,this._defaultWidth,true))}},defaultHeight:{field:"_defaultHeight",get:function(){return this.getFieldOrBindValue("defaultHeight")},set:function(nValue){this.setFieldOrBindValue("defaultHeight",sap.galilei.core.validateNumeric(nValue,this._defaultHeight,true))}},marginLeft:{field:"_marginLeft",value:0,get:function(){return this.getFieldOrBindValue("marginLeft")},set:function(nValue){this.setFieldOrBindValue("marginLeft",sap.galilei.core.validateNumeric(nValue,this._marginLeft))}},marginTop:{field:"_marginTop",value:0,get:function(){return this.getFieldOrBindValue("marginTop")},set:function(nValue){this.setFieldOrBindValue("marginTop",sap.galilei.core.validateNumeric(nValue,this._marginTop))}},marginRight:{field:"_marginRight",value:0,get:function(){return this.getFieldOrBindValue("marginRight")},set:function(nValue){this.setFieldOrBindValue("marginRight",sap.galilei.core.validateNumeric(nValue,this._marginRight))}},marginBottom:{field:"_marginBottom",value:0,get:function(){return this.getFieldOrBindValue("marginBottom")},set:function(nValue){this.setFieldOrBindValue("marginBottom",sap.galilei.core.validateNumeric(nValue,this._marginBottom))}},margin:{get:function(){return this.marginLeft+","+this.marginTop+","+this.marginRight+","+this.marginBottom},set:function(value){var aParams=arguments,index;if(arguments.length===1&&(typeof value)==="string"){aParams=value.split(",")}if(aParams){for(index=0;index<aParams.length;index++){if(typeof aParams[index]==="string"){aParams[index]=+aParams[index].trimLeft().trimRight()}}if(aParams.length===1){this.marginLeft=this.marginTop=this.marginRight=this.marginBottom=+aParams[0]}else{if(aParams.length===2){this.marginLeft=this.marginRight=+aParams[0];this.marginTop=this.marginBottom=+aParams[1]}else{if(aParams.length===4){this.marginLeft=+aParams[0];this.marginRight=+aParams[1];this.marginTop=+aParams[2];this.marginBottom=+aParams[3]}}}}}},paddingLeft:{field:"_paddingLeft",value:0,get:function(){return this.getFieldOrBindValue("paddingLeft")},set:function(nValue){this.setFieldOrBindValue("paddingLeft",sap.galilei.core.validateNumeric(nValue,this._paddingLeft))}},paddingTop:{field:"_paddingTop",value:0,get:function(){return this.getFieldOrBindValue("paddingTop")},set:function(nValue){this.setFieldOrBindValue("paddingTop",sap.galilei.core.validateNumeric(nValue,this._paddingTop))}},paddingRight:{field:"_paddingRight",value:0,get:function(){return this.getFieldOrBindValue("paddingRight")},set:function(nValue){this.setFieldOrBindValue("paddingRight",sap.galilei.core.validateNumeric(nValue,this._paddingRight))}},paddingBottom:{field:"_paddingBottom",value:0,get:function(){return this.getFieldOrBindValue("paddingBottom")},set:function(nValue){this.setFieldOrBindValue("paddingBottom",sap.galilei.core.validateNumeric(nValue,this._paddingBottom))}},padding:{get:function(){return this.paddingLeft+","+this.paddingTop+","+this.paddingRight+","+this.paddingBottom},set:function(value){var aParams=arguments,index;if(arguments.length===1&&(typeof value)==="string"){aParams=value.split(",")}if(aParams){for(index=0;index<aParams.length;index++){if(typeof aParams[index]==="string"){aParams[index]=+aParams[index].trimLeft().trimRight()}}if(aParams.length===1){this.paddingLeft=this.paddingTop=this.paddingRight=this.paddingBottom=+aParams[0]}else{if(aParams.length===2){this.paddingLeft=this.paddingRight=+aParams[0];this.paddingTop=this.paddingBottom=+aParams[1]}else{if(aParams.length===4){this.paddingLeft=+aParams[0];this.paddingRight=+aParams[1];this.paddingTop=+aParams[2];this.paddingBottom=+aParams[3]}}}}}},horizontalAlignment:{field:"_horizontalAlignment",get:function(){return this.getFieldOrBindValue("horizontalAlignment")},set:function(nValue){this.setFieldOrBindValue("horizontalAlignment",nValue)}},verticalAlignment:{field:"_verticalAlignment",get:function(){return this.getFieldOrBindValue("verticalAlignment")},set:function(nValue){this.setFieldOrBindValue("verticalAlignment",nValue)}},dockPosition:{field:"_dockPosition",get:function(){return this.getFieldOrBindValue("dockPosition")},set:function(nValue){this.setFieldOrBindValue("dockPosition",nValue)}},contentBoxLeft:{field:"_contentBoxLeft",value:0,writable:false,configurable:false,get:function(){return this._contentBoxLeft}},contentBoxTop:{field:"_contentBoxTop",value:0,writable:false,configurable:false,get:function(){return this._contentBoxTop}},contentBoxRight:{field:"_contentBoxRight",value:0,writable:false,configurable:false,get:function(){return this._contentBoxRight}},contentBoxBottom:{field:"_contentBoxBottom",value:0,writable:false,configurable:false,get:function(){return this._contentBoxBottom}},transform:undefined,isResizable:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.RESIZABLE,value:nsShape.ShapeStates.RESIZABLE},isRotable:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.ROTABLE,value:nsShape.ShapeStates.ROTABLE},isPreserveAspect:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.PRESERVEASPECT,value:nsShape.ShapeStates.NORMAL},isAdjustToContent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.ADJUSTTOCONTENT,value:nsShape.ShapeStates.NORMAL},isModifiable:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.MODIFIABLE,value:nsShape.ShapeStates.MODIFIABLE},isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.COMPOSITE,value:nsShape.ShapeStates.NORMAL},isGroup:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.GROUP,value:nsShape.ShapeStates.NORMAL},isTransparent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.TRANSPARENT,value:nsShape.ShapeStates.NORMAL},isDisableDrawing:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.DISABLED,value:nsShape.ShapeStates.NORMAL},isSupportStroke:true,isSupportFill:true,isVisible:{field:"_isVisible",get:function(){return this.getFieldOrBindValue("isVisible")},set:function(vValue){this.setFieldOrBindValue("isVisible",vValue)}},isDrawn:{get:function(){return this.d3Node!==undefined&&this.d3Node.node()!=undefined}},isHidden:{get:function(){return this.d3Node&&(this.d3Node.attr("display")==="none"||this.d3Node.attr("opacity")===0)}},isSubShape:{get:function(){return this.parentShape!==undefined}},isAnchor:false,isDisableContextMenu:false,parentShape:undefined,shapes:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.shape.Shape",writable:false},subShapeIndex:0,objectContext:undefined,bindings:undefined,eventHandlers:undefined,events:undefined,zindex:undefined,tooltip:{field:"_tooltip",get:function(){return this.getFieldOrBindValue("tooltip")},set:function(vValue){this.setFieldOrBindValue("tooltip",vValue)}},desc:{field:"_desc",get:function(){return this.getFieldOrBindValue("desc")},set:function(vValue){this.setFieldOrBindValue("desc",vValue)}},ariaLabel:{field:"_ariaLabel",get:function(){return this.getFieldOrBindValue("ariaLabel")},set:function(vValue){this.setFieldOrBindValue("ariaLabel",vValue)}},role:{field:"_role",get:function(){return this.getFieldOrBindValue("role")},set:function(vValue){this.setFieldOrBindValue("role",vValue)}},automationId:{field:"_automationId",get:function(){return this.getFieldOrBindValue("automationId")},set:function(vValue){this.setFieldOrBindValue("automationId",vValue)}}},methods:{hasClass:function(sClass){var sOldClass=this.domClass,aClassList,index;if(sOldClass){aClassList=sOldClass.split(/\s+/);if(aClassList&&aClassList.length>0&&sClass){for(index=0;index<aClassList.length;index++){if(aClassList[index]===sClass){return true}}}}return false},addClass:function(sClass){var sOldClass=this.domClass,sNewClass;if(!sOldClass||!this.hasClass(sClass)){if(!sOldClass){sNewClass=sClass}else{sNewClass=sOldClass+" "+sClass}this.domClass=sNewClass;return sNewClass}},removeClass:function(sClass){var sOldClass=this.domClass,aClassList,index,sNewClass;if(sOldClass){aClassList=sOldClass.split(/\s+/);if(aClassList&&aClassList.length>0&&sClass){for(index=0;index<aClassList.length;index++){if(aClassList[index]===sClass){aClassList.splice(index,1);if(aClassList.length>0){sNewClass=aClassList.join(" ");this.domClass=sNewClass}else{if(sOldClass){this.domClass=undefined}}return sNewClass}}}}},getFieldOrBindValue:function(sPropertyName){var sFieldName,oBinding,vValue;if(sPropertyName){oBinding=sPropertyName&&this.getBinding(sPropertyName);if(oBinding){return this.getPropertyValue(sPropertyName)}sFieldName="_"+sPropertyName;vValue=this[sFieldName];if(vValue!==undefined){if(typeof vValue==="function"){vValue=vValue.call(this)}return vValue}}return undefined},setFieldOrBindValue:function(sPropertyName,vValue,bConvertToString){var sFieldName;if(sPropertyName){sFieldName="_"+sPropertyName;if(vValue!==undefined){if(!this.bindProperty(sPropertyName,vValue)){this[sFieldName]=(bConvertToString&&vValue.toString)?vValue.toString():vValue}}else{this[sFieldName]=undefined}}},matchCondition:function(vFilter){var sPropertyName;if(typeof vFilter==="function"){return vFilter(this)}else{if(vFilter!==undefined){for(sPropertyName in vFilter){if(vFilter.hasOwnProperty(sPropertyName)){if(sap.galilei.core.getValueFromQualifiedPath(this,sPropertyName)!=vFilter[sPropertyName]){return false}}}}}return true},selectShape:function(vFilter){var oAllMatchingShapes=this.selectAllShapes(vFilter,true);return oAllMatchingShapes.length>0?oAllMatchingShapes[0]:undefined},_selectAllSubShapes:function(aResult,oShape,vFilter,bBreakOnFirstShapeFound){var index,max,oSubShape,bFound=false;for(index=0,max=oShape.shapes.length;index<max;++index){oSubShape=oShape.shapes[index];if(oSubShape.matchCondition(vFilter)){aResult.push(oSubShape);bFound=true;if(bBreakOnFirstShapeFound){break}}bFound=bFound||this._selectAllSubShapes(aResult,oSubShape,vFilter,bBreakOnFirstShapeFound);if(bFound&&bBreakOnFirstShapeFound){break}}return bFound},selectAllShapes:function(vFilter,bBreakOnFirstShapeFound){var aResult=[];if(this.matchCondition(vFilter)){aResult.push(this);if(bBreakOnFirstShapeFound){return aResult}}this._selectAllSubShapes(aResult,this,vFilter,bBreakOnFirstShapeFound);return aResult},createNode:function(sNode,oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var d3Parent;if(sNode&&oViewer){if(!d3ParentNode){d3Parent=oViewer.d3MainShapeLayer}else{d3Parent=d3ParentNode}if(!this.d3Node){if(insertBeforeSelector){this.d3Node=d3Parent.insert(sNode,insertBeforeSelector)}else{this.d3Node=d3Parent.append(sNode)}if(oTransitionDef){this.d3Node.attr("opacity",0);if(this.opacity===undefined){this.opacity=1}}this.registerEventHandlers()}this._isCreatingNode=true;this.updateDrawing(oViewer,oTransitionDef);this._isCreatingNode=false}return this.d3Node},findNode:function(oViewer,nodeSelector){if(oViewer&&nodeSelector){this.d3Node=d3.select(nodeSelector,oViewer.d3MainShapeLayer)}return this.d3Node},_removeOneNode:function(oShape,oViewer,oTransitionDef){if(oShape){if(oShape.isComposite){oShape.removeAllSubShapes(oViewer,oTransitionDef)}oShape.unbindAll();oShape.unregisterEventHandlers();oShape.highlighterStyleSheet=undefined;if(oShape.d3Node){oShape.d3Node.remove();oShape.d3Node=undefined}}},removeNode:function(oViewer,oTransitionDef){var self=this;if(oViewer&&oTransitionDef){this.hide(oViewer,oTransitionDef);setTimeout(function(){self._removeOneNode(self)},oTransitionDef.duration)}else{this._removeOneNode(this)}},defaultRemove:function(oViewer,oTransitionDef){this.removeNode(oViewer,oTransitionDef)},remove:function(oViewer,oTransitionDef){this.defaultRemove(oViewer,oTransitionDef)},createContent:function(oViewer,oTransitionDef){var index,oSubShape;for(index=0;index<this.shapes.length;index++){oSubShape=this.shapes[index];oSubShape.createContent(oViewer,oTransitionDef)}},updateContent:function(oViewer,oTransitionDef){var index,oSubShape;for(index=0;index<this.shapes.length;index++){oSubShape=this.shapes[index];oSubShape.updateContent(oViewer,oTransitionDef)}},addSubShape:function(oSubShape,oViewer,oTransitionDef,bUpdateDrawing){this.insertSubShape(-1,oSubShape,oViewer,oTransitionDef,bUpdateDrawing)},insertSubShape:function(index,oSubShape,oViewer,oTransitionDef,bUpdateDrawing){if(oSubShape&&this.isComposite&&this.shapes.indexOf(oSubShape)===-1){if(index===undefined||index<0||index>=this.shapes.length){index=-1}this.shapes.insert(index,oSubShape);oSubShape.parentShape=this;if(index===-1){oSubShape.subShapeIndex=this.shapes.length-1}else{this.updateSubShapeIndex()}if(bUpdateDrawing!==false&&this.isDrawn&&oViewer){this.updateDrawing(oViewer,oTransitionDef)}}},moveSubShape:function(fromIndex,toIndex,oViewer,oTransitionDef,bUpdateDrawing){var nLength=this.shapes.length;if(this.isComposite&&nLength>1&&fromIndex>=0&&fromIndex<nLength&&((toIndex>=0&&toIndex<nLength)||toIndex===-1)){this.shapes.move(fromIndex,toIndex);this.updateSubShapeIndex();if(bUpdateDrawing!==false&&this.isDrawn&&oViewer){this.updateDrawing(oViewer,oTransitionDef)}}},moveSubShapeTo:function(oSubShape,toIndex,oViewer,oTransitionDef,bUpdateDrawing){var nLength=this.shapes.length,fromIndex;if(oSubShape&&this.isComposite&&this.shapes.length>1&&((toIndex>=0&&toIndex<nLength)||toIndex===-1)){fromIndex=this.shapes.indexOf(oSubShape);if(fromIndex!==-1){this.moveSubShape(fromIndex,toIndex,oViewer,oTransitionDef,bUpdateDrawing)}}},removeSubShape:function(oSubShape,oViewer,oTransitionDef,bUpdateDrawing){var index;if(oSubShape&&this.shapes.length>0){index=this.shapes.indexOf(oSubShape);if(index!==-1){this.removeSubShapeAt(index,oViewer,oTransitionDef,bUpdateDrawing)}}},removeSubShapeAt:function(index,oViewer,oTransitionDef,bUpdateDrawing){var oSubShape;if(index>=0&&index<this.shapes.length){oSubShape=this.shapes[index];this.shapes.removeAt(index);oSubShape.parentShape=undefined;this.updateSubShapeIndex();oSubShape.remove(oViewer,oTransitionDef);if(bUpdateDrawing!==false&&oViewer&&this.isDrawn){this.updateDrawing(oViewer,oTransitionDef)}}},removeAllSubShapes:function(oViewer,oTransitionDef,bUpdateDrawing){var index;if(this.shapes.length>0){for(index=this.shapes.length-1;index>=0;index--){this.removeSubShapeAt(index,oViewer,oTransitionDef,false)}this.shapes.clear();if(bUpdateDrawing!==false&&oViewer&&this.isDrawn){this.updateDrawing(oViewer,oTransitionDef)}}},showAllSubShapes:function(oViewer,oTransitionDef,bUpdateDrawing){var index;if(this.shapes.length>0){for(index=0;index<this.shapes.length;index++){this.shapes[index].show(oViewer,oTransitionDef);this.shapes[index].showAllSubShapes(oViewer,oTransitionDef,false)}if(bUpdateDrawing!==false&&oViewer&&this.isDrawn){this.updateDrawing(oViewer,oTransitionDef)}}},hideAllSubShapes:function(oViewer,oTransitionDef,bUpdateDrawing){var index;if(this.shapes.length>0){for(index=0;index<this.shapes.length;index++){this.shapes[index].hide(oViewer,oTransitionDef);this.shapes[index].hideAllSubShapes(oViewer,oTransitionDef,false)}if(bUpdateDrawing!==false&&oViewer&&this.isDrawn){this.updateDrawing(oViewer,oTransitionDef)}}},updateSubShapeIndex:function(){var index,oSubShape;if(this.shapes.length>0){for(index=0;index<this.shapes.length;index++){oSubShape=this.shapes[index];oSubShape.subShapeIndex=index}}},getAnchors:function(){return this.selectAllShapes({isAnchor:true})},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return undefined},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);return this.d3Node},show:function(oViewer,oTransitionDef){var self=this;if(this.isDrawn&&oViewer&&((this._oldOpacity!==undefined&&this.opacity!==this._oldOpacity)||(this._oldOpacity===undefined&&this.opacity!==1)||this.d3Node.attr("display")=="none")){this.opacity=(this._oldOpacity!==undefined&&this._oldOpacity>0)?this._oldOpacity:1;delete this._oldOpacity;this.updateDrawing(oViewer,oTransitionDef,["opacity"]);this.isVisible=true;if(oTransitionDef){setTimeout(function(){if(self.isDrawn&&self.d3Node){self.d3Node.attr("display","inline")}},oTransitionDef.duration)}else{if(this.isDrawn&&this.d3Node){this.d3Node.attr("display","inline")}}}},hide:function(oViewer,oTransitionDef){var self=this;if(this.isDrawn&&oViewer&&(this.opacity===undefined||this.opacity>0||this.d3Node.attr("display")=="inline")){this._oldOpacity=this.opacity;this.opacity=0;this.updateDrawing(oViewer,oTransitionDef,["opacity"]);this.isVisible=false;if(oTransitionDef){setTimeout(function(){if(self.d3Node){self.d3Node.attr("display","none")}},oTransitionDef.duration)}else{if(this.d3Node){this.d3Node.attr("display","none")}}}},retrieveDrawing:function(viewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(viewer,nodeSelector)}nsShape.Shape.retrieveDrawing(viewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);return this.d3Node},setAllProperties:function(oProperties){var index,shape;if(oProperties){this.set(oProperties);if(this.isComposite){for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.setAllProperties(oProperties)}}}},generateCssStyleString:function(){if(this.highlighterStyleSheet){return this.highlighterStyleSheet.generateCssStyleString()}else{if(this.styleSheet){return this.styleSheet.generateCssStyleString()}}return undefined},highlight:function(oStyleSheet,fnStyleSheetFilter,bCascade,oViewer,oTransitionDefinition){var oNewStyleSheet,bChanged=false,bUpdate=false,i,sFilter;if(!oStyleSheet){return false}oStyleSheet=oStyleSheet.clone();if(sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Group")){if(oStyleSheet.filter){sFilter=oStyleSheet.filter;oNewStyleSheet=new nsCommon.style.StyleSheet({filter:sFilter});oStyleSheet.filter=undefined;bChanged=(this.highlighterStyleSheet||oNewStyleSheet)!==undefined;bUpdate=bChanged;this.highlighterStyleSheet=oNewStyleSheet}}else{if(!sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Image")&&!sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Text")){if(fnStyleSheetFilter){oNewStyleSheet=fnStyleSheetFilter(this,oStyleSheet)}else{oNewStyleSheet=oStyleSheet.clone();if(!this.isSupportStroke){oNewStyleSheet.stroke=undefined;oNewStyleSheet.strokeWidth=undefined;oNewStyleSheet.strokeDashArray=undefined;oNewStyleSheet.strokeOpacity=undefined}if(!this.isSupportFill){oNewStyleSheet.fill=undefined;oNewStyleSheet.fillOpacity=undefined}}bChanged=(this.highlighterStyleSheet||oNewStyleSheet)!==undefined;bUpdate=bChanged;this.highlighterStyleSheet=oNewStyleSheet}else{if(sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Image")){if(fnStyleSheetFilter){oNewStyleSheet=fnStyleSheetFilter(this,oStyleSheet)}else{oNewStyleSheet=oStyleSheet.clone()}bChanged=(this.highlighterStyleSheet||oNewStyleSheet)!==undefined;this.highlighterStyleSheet=oNewStyleSheet;this._updateSvgStyleProperty(this.svgNode,"cssStyle","style",false,oViewer)}else{if(sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Text")){if(fnStyleSheetFilter){oNewStyleSheet=fnStyleSheetFilter(this,oStyleSheet)}else{oNewStyleSheet=oStyleSheet.clone()}if(oNewStyleSheet){oNewStyleSheet.fill=undefined;oNewStyleSheet.stroke=undefined;oNewStyleSheet.strokeWidth=undefined}bChanged=(this.highlighterStyleSheet||oNewStyleSheet)!==undefined;this.highlighterStyleSheet=oNewStyleSheet;this.updateDrawing(oViewer,oTransitionDefinition,["cssStyle"])}}}}if(this.isComposite&&bCascade){for(i=0;i<this.shapes.length;i++){bChanged|=this.shapes[i].highlight(oStyleSheet,fnStyleSheetFilter,bCascade,oViewer,oTransitionDefinition)}}if(oViewer&&bUpdate){if(sap.galilei.core.getClassName(this)==="sap.galilei.ui.common.shape.Shape"){if(this.svgNode){this._updateSvgStyleProperty(this.svgNode,"cssStyle","style",this.svgNode.nodeName==="a"?true:false,oViewer)}}else{this.updateDrawing(oViewer,oTransitionDefinition,["cssStyle"])}}if(sFilter){oStyleSheet.filter=sFilter}return bChanged},unhighlight:function(bCascade,oViewer,oTransitionDefinition){var bChanged=false,bUpdate=false,i;bUpdate=bChanged=(this.highlighterStyleSheet!==undefined);this.highlighterStyleSheet=undefined;if(this.isComposite&&bCascade){for(i=0;i<this.shapes.length;i++){bChanged|=this.shapes[i].unhighlight(bCascade,oViewer,oTransitionDefinition)}}if(oViewer&&bUpdate){if(sap.galilei.core.getClassName(this)==="sap.galilei.ui.common.shape.Shape"||sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Image")){this._updateSvgStyleProperty(this.svgNode,"cssStyle","style",false,oViewer)}else{this.updateDrawing(oViewer,oTransitionDefinition,["cssStyle"])}}return bChanged},grayOut:function(bCascade,oViewer,oTransitionDefinition){var oStyleSheet=new nsCommon.style.StyleSheet();return this.highlight(oStyleSheet,nsShape.Shape.grayOutHighlightFilter,bCascade,oViewer,oTransitionDefinition)},getGrayScaleFilter:function(oViewer){var oGrayScaleFilterNode,oGrayScaleFilter,sGrayScaleFilterId="grayScaleFilter";if(oViewer){oGrayScaleFilterNode=d3.select("#"+sGrayScaleFilterId);if(!oGrayScaleFilterNode.node()){oGrayScaleFilter=new nsCommon.style.GrayScaleFilter({id:sGrayScaleFilterId});oGrayScaleFilter.create(oViewer);oGrayScaleFilterNode=d3.select("#"+sGrayScaleFilterId)}return{id:sGrayScaleFilterId,filter:oGrayScaleFilter,node:oGrayScaleFilterNode}}},getColorScaleFilter:function(oViewer,sDarkColor,sLightColor){var oColorScaleFilterNode,oColorScaleFilter,oColor,sColorFilterId;if(oViewer){if(sDarkColor){oColor=new nsCommon.style.Color(sDarkColor)}if(!sDarkColor||oColor.isGray){return this.getGrayScaleFilter(oViewer)}}if(oViewer&&sDarkColor&&sLightColor){sColorFilterId=oColor.toString();sColorFilterId="colorScaleFilter"+sColorFilterId.replace("#","-");oColorScaleFilterNode=d3.select("#"+sColorFilterId);if(!oColorScaleFilterNode.node()){oColorScaleFilter=new nsCommon.style.ColorScaleFilter({id:sColorFilterId,darkColor:sDarkColor,lightColor:sLightColor});oColorScaleFilter.create(oViewer);oColorScaleFilterNode=d3.select("#"+sColorFilterId)}return{id:sColorFilterId,filter:oColorScaleFilter,node:oColorScaleFilterNode}}return undefined},_findNodeById:function(oRootNode,sId){var index,max,oChildNode;if(oRootNode){for(index=0,max=oRootNode.childNodes.length;index<max;index++){oChildNode=oRootNode.childNodes[index];if(oChildNode.id==sId){return oChildNode}}for(index=0,max=oRootNode.childNodes.length;index<max;index++){oChildNode=oRootNode.childNodes[index];oChildNode=this._findNodeById(oChildNode,sId);if(oChildNode){return oChildNode}}}return undefined},_isImageNode:function(oSvgNode,oViewer){var sHref,oDefsNode,oChildNode,index,max;if(oSvgNode&&oViewer){if(oSvgNode.nodeName==="image"||oSvgNode.nodeName==="use"){sHref=oSvgNode.getAttribute("xlink:href")||oSvgNode.getAttribute("href");if(sHref&&sHref.length>0){if(sHref[0]==="#"){sHref=sHref.substring(1);oDefsNode=this._findNodeById(oViewer.d3SvgDefs.node(),sHref);if(oDefsNode){return this._isImageNode(oDefsNode,oViewer)}else{return false}}return nsCommon.Image.isImageURL(sHref)}}else{if(oSvgNode.nodeName==="g"){for(index=0,max=oSvgNode.childNodes.length;index<max;index++){oChildNode=oSvgNode.childNodes[index];if(this._isImageNode(oChildNode,oViewer)){return true}}}}}return false},_updateSvgStyleProperty:function(oSvgNode,sShapeProperty,sSvgProperty,bCascade,oViewer,oTransitionDefinition){var vValue,d3Node,oTransitionOrD3Node,oStyle,sProperty,index,max,oChildNode,oFilter;if(oSvgNode&&sShapeProperty&&sSvgProperty){vValue=this[sShapeProperty];d3Node=d3.select(oSvgNode);if(oTransitionDefinition){oTransitionOrD3Node=oTransitionDefinition.getTransition(d3Node)}else{oTransitionOrD3Node=d3Node}if(sSvgProperty==="style"){if(oSvgNode.nodeName!=="a"&&oSvgNode.nodeName!=="#text"&&oSvgNode.nodeName!=="text"&&oSvgNode.nodeName!=="image"&&oSvgNode.nodeName!=="use"){oStyle=nsCommon.style.StyleSheet.parse(vValue);if(oStyle&&oStyle.properties){for(sProperty in oStyle.properties){if(oStyle.properties.hasOwnProperty(sProperty)){if((oSvgNode.nodeName==="polyline"||oSvgNode.nodeName==="line")&&sProperty.substring(0,4)==="fill"){continue}oTransitionOrD3Node.style(sProperty,oStyle.properties[sProperty])}}}}else{if(this._isImageNode(oSvgNode,oViewer)){this._isUseFilter=false;if(this.highlighterStyleSheet){oFilter=this.getColorScaleFilter(oViewer,this.highlighterStyleSheet.stroke,this.highlighterStyleSheet.fill);if(oFilter&&oFilter.id){oTransitionOrD3Node.attr("filter","url(#"+oFilter.id+")");this._isUseFilter=true}}if(!this._isUseFilter){oTransitionOrD3Node.attr("filter",null)}}}}else{oTransitionOrD3Node.attr(sSvgProperty,vValue)}if(bCascade!==false){if(oSvgNode.nodeName!=="defs"&&oSvgNode.nodeName!=="#text"&&oSvgNode.nodeName!=="text"&&oSvgNode.nodeName!=="image"){for(index=0,max=oSvgNode.childNodes.length;index<max;index++){oChildNode=oSvgNode.childNodes[index];this._updateSvgStyleProperty(oChildNode,sShapeProperty,sSvgProperty,bCascade,oViewer,oTransitionDefinition)}}}}},getTransition:function(oTransitionDef){if(oTransitionDef){return oTransitionDef.getTransition(this)}return undefined},defaultGetBBox:function(){var oRect,oChildrenRect=this.getChildrenBBox();if(!isNaN(this.x)&&!isNaN(this.y)&&!isNaN(this.width)&&!isNaN(this.height)){oRect=new nsCommon.Rect(this.x,this.y,this.width,this.height);if(oChildrenRect){oRect.unionRect(oChildrenRect)}}else{if(oChildrenRect){oRect=oChildrenRect}else{oRect=new nsCommon.Rect(this.x,this.y,!isNaN(this.width)?this.width:0,!isNaN(this.height)?this.height:0)}}return oRect},getBBox:function(){return this.defaultGetBBox()},defaultSetBBox:function(x,y,width,height){var oRect;if(arguments.length===1){oRect=arguments[0];this.x=oRect.x;this.y=oRect.y;this.width=oRect.width;this.height=oRect.height}else{if(arguments.length===4){this.x=x;this.y=y;this.width=width;this.height=height}}},setBBox:function(x,y,width,height){this.defaultSetBBox.apply(this,arguments)},getChildrenBBox:function(){if(this.isComposite){var index,oShape,oRect,oTotalRect,bFirst=true;for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];if(oShape.isVisible!==false){oRect=oShape.getBBox();if(oRect){if(bFirst){oTotalRect=new nsCommon.Rect(oRect);bFirst=false}else{oTotalRect.unionRect(oRect)}}}}return oTotalRect}else{return undefined}},getSvgBBox:function(bIncludeTransform,oNearestViewport){if(this.d3Node){var svgNearestViewport;if(oNearestViewport&&oNearestViewport.d3Node){svgNearestViewport=oNearestViewport.d3Node.node()}return nsCommon.svg.Svg.getBBox(this.d3Node.node(),bIncludeTransform,svgNearestViewport)}return this.getBBox()},getDefaultContentBox:function(sLayoutMode,bRelative,bIncludeStroke){var oRect=this.getBBox(),contentBoxLeft=isNaN(this.contentBoxLeft)?0:this.contentBoxLeft,contentBoxTop=isNaN(this.contentBoxTop)?0:this.contentBoxTop,contentBoxRight=isNaN(this.contentBoxRight)?0:this.contentBoxRight,contentBoxBottom=isNaN(this.contentBoxBottom)?0:this.contentBoxBottom,nMinWidth=96,nDelta;if(oRect){if(sLayoutMode===nsCommon.ShapeLayoutModes.icon){oRect.moveBy(0,oRect.height+nsShape.Shape.DEFAULT_CONTENT_PADDING);if(oRect.width<nMinWidth){nDelta=(nMinWidth-oRect.width)/2;oRect.inflate(nDelta,0,nDelta,0)}}if(bRelative){oRect.x=oRect.y=0}if(bIncludeStroke&&!isNaN(this.strokeWidth)){contentBoxLeft+=this.strokeWidth/2;contentBoxRight+=this.strokeWidth/2;contentBoxTop+=this.strokeWidth/2;contentBoxBottom+=this.strokeWidth/2}oRect.inflate(-contentBoxLeft,-contentBoxTop,-contentBoxRight,-contentBoxBottom)}return oRect},getContentBox:function(sLayoutMode,bRelative,bIncludeStroke){return this.getDefaultContentBox(sLayoutMode,bRelative,bIncludeStroke)},getMainShapeBox:function(oContentRect,bRelative){var oRect=new nsCommon.Rect(),paddingLeft=isNaN(this.paddingLeft)?0:this.paddingLeft,paddingTop=isNaN(this.paddingTop)?0:this.paddingTop,paddingRight=isNaN(this.paddingRight)?0:this.paddingRight,paddingBottom=isNaN(this.paddingBottom)?0:this.paddingBottom;if(oContentRect){oRect.set(oContentRect);if(paddingLeft===0&&paddingTop===0&&paddingRight===0&&paddingBottom===0){paddingLeft=paddingTop=paddingRight=paddingBottom=nsShape.Shape.DEFAULT_CONTENT_PADDING}oRect.inflate(paddingLeft,paddingTop,paddingRight,paddingBottom);if(bRelative){oRect.x=oRect.y=0}}return oRect},getCenter:function(){var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){var aCenter=this.getCenter();if(aCenter){this.moveBy(x-aCenter[0],y-aCenter[1])}},layout:function(oLayoutRect,bUpdateShape){var outputLayoutRect=new nsCommon.Rect();outputLayoutRect.set(this.getBBox());if(oLayoutRect&&!isNaN(oLayoutRect.x)&&!isNaN(oLayoutRect.y)){outputLayoutRect.x=oLayoutRect.x;outputLayoutRect.y=oLayoutRect.y}this.layoutRect=new nsCommon.Rect(outputLayoutRect);return outputLayoutRect},checkLayoutRect:function(layoutRect){if(layoutRect){var width=layoutRect.width,height=layoutRect.height,i;if(this.minWidth!==undefined&&!isNaN(this.minWidth)&&this.minWidth!==0){width=Math.max(width,this.minWidth)}if(this.minHeight!==undefined&&!isNaN(this.minHeight)&&this.minHeight!==0){height=Math.max(height,this.minHeight)}if(this.maxWidth!==undefined&&!isNaN(this.maxWidth)&&this.maxWidth!==0){width=Math.min(width,this.maxWidth)}if(this.maxHeight!==undefined&&!isNaN(this.maxHeight)&&this.maxHeight!==0){height=Math.min(height,this.maxHeight)}layoutRect.width=width;layoutRect.height=height;if(this.isComposite){for(i=0;i<this.shapes.length;i++){layoutRect=this.shapes[i].checkLayoutRect(layoutRect)}}}return layoutRect},getIntersection:function(oSegment,oParentBBox,bIncludeStrokeWidth){if(oSegment){var index,shape,aPoint,oRect;if(this.isComposite){for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];aPoint=shape.getIntersection(oSegment,oParentBBox,bIncludeStrokeWidth);if(aPoint){return aPoint}}}else{oRect=this.getBBox();if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}if(bIncludeStrokeWidth!==false){oRect=this.inflateStrokeWidth(oRect)}else{oRect.inflate(-1,-1)}return nsCommon.geometry.intersectSegmentRoundedRectangle(oSegment,oRect,0,0)}}return undefined},inflateStrokeWidth:function(oBBox){if(oBBox){var nStrokeWidth=+this.strokeWidth;if(nStrokeWidth===undefined||isNaN(nStrokeWidth)){nStrokeWidth=0}nStrokeWidth/=2;return oBBox.inflate(nStrokeWidth,nStrokeWidth,true)}return oBBox},isPointInShape:function(vPoint,oParentBBox){if(vPoint){var index,oShape,oRect;if(this.isComposite){for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];if(oShape.isPointInShape(vPoint,oParentBBox)){return true}}}else{oRect=this.getBBox();if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return oRect.isPointInRect(vPoint)}}return false},isPointOnBorder:function(vPoint,oParentBBox,nRadius){if(vPoint){var index,oShape,oInnerRect,oOuterRect;if(nRadius===undefined){nRadius=1}if(this.isComposite){for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];if(oShape.isPointOnBorder(vPoint,oParentBBox,nRadius)){return true}}}else{oInnerRect=this.getBBox();oOuterRect=this.getBBox();if(oParentBBox){oInnerRect=oInnerRect.clone();oOuterRect=oOuterRect.clone();oInnerRect.moveBy(oParentBBox.x-oInnerRect.x,oParentBBox.y-oInnerRect.y);oOuterRect.moveBy(oParentBBox.x-oOuterRect.x,oParentBBox.y-oOuterRect.y)}oInnerRect.inflate(-nRadius,-nRadius);oOuterRect.inflate(nRadius,nRadius);return oOuterRect.isPointInRect(vPoint)&&!oInnerRect.isPointInRect(vPoint)}}return false},getClosestPointOnBorder:function(vPoint,oBoundaryRect,oParentBBox){var aPoint,aClosestPoint,index,oShape,oRect;if(vPoint){aPoint=nsCommon.Point.getPointArray(vPoint);if(this.isComposite){for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];aClosestPoint=oShape.getClosestPointOnBorder(aPoint,oBoundaryRect,oParentBBox);if(aClosestPoint){break}}}else{if(oBoundaryRect){oRect=oBoundaryRect}else{oRect=this.getBBox()}if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}aClosestPoint=oRect.getClosestPointOnBorder(aPoint)}}return aClosestPoint},moveTo:function(x,y){var dx=0,dy=0;if(x!==undefined&&this.x!==undefined){dx=x-this.x}if(y!==undefined&&this.y!==undefined){dy=y-this.y}if(dx!==0||dy!==0){this.moveBy(dx,dy)}else{if(this.x===undefined){this.x=x}if(this.y===undefined){this.y=y}}},defaultMoveBy:function(dx,dy){if(dx===undefined||isNaN(dx)){dx=0}if(dy===undefined||isNaN(dy)){dy=0}if(dx!==0&&this.x!==undefined){this.x+=dx}if(dy!==0&&this.y!==undefined){this.y+=dy}if(this.isComposite){this.moveChildrenBy(dx,dy)}},moveBy:function(dx,dy){this.defaultMoveBy(dx,dy)},moveChildrenBy:function(dx,dy){if(this.isComposite){var index,shape;if(dx===undefined){dx=0}if(dy===undefined){dy=0}if(dx!==0||dy!==0){for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.moveBy(dx,dy)}}}},bindProperty:function(sProperty,vBindingExpression,oContext){var oBindings,sPropertyName,oBinding;if(arguments.length===1&&(typeof arguments)==="object"){oBindings=arguments[0];for(sPropertyName in oBindings){oBinding=this.bindProperty(sPropertyName,oBindings[sPropertyName])}}else{if(sProperty&&vBindingExpression&&nsCommon.binding.Binding.isBindingExpression(vBindingExpression)){oBinding=nsCommon.binding.Binding.parseBinding(vBindingExpression);if(oBinding){oBinding.propertyName=sProperty;oBinding.shape=this;oBinding.objectContext=oContext;if(!this.bindings){this.bindings={}}this.bindings[sProperty]=oBinding}}}return oBinding},getBinding:function(sProperty){var vValue;if(sProperty&&this.bindings&&this.bindings.hasOwnProperty(sProperty)){return this.bindings[sProperty]}return undefined},getPropertyValue:function(sProperty){var oBinding,oObjectContext,vValue;oBinding=sProperty&&this.getBinding(sProperty);if(oBinding&&oBinding.getObjectProperty){oObjectContext=oBinding.objectContext;oBinding.objectContext=oBinding.objectContext||this.getObjectContext();vValue=oBinding.getObjectProperty();oBinding.objectContext=oObjectContext;return vValue}return undefined},unbindProperty:function(sProperty){var oBinding;if(sProperty){if(this.bindings){oBinding=this.bindings[sProperty];if(oBinding){delete this.bindings[sProperty];oBinding.shape=undefined}if(oBinding.dispose){oBinding.dispose()}if(!sap.galilei.core.hasObjects(this.bindings)){this.bindings=undefined}}}},unbindAll:function(){var sProperty,oBinding;if(this.bindings){for(sProperty in this.bindings){oBinding=this.bindings[sProperty];if(oBinding.dispose){oBinding.dispose()}}this.bindings=undefined}},defaultGetObjectContext:function(){if(this.objectContext){return this.objectContext}if(this.parentShape){return this._getParentObjectContext()}return undefined},getObjectContext:function(){return this.defaultGetObjectContext()},_getParentObjectContext:function(){var oObjectContext,oItemContext;if(this.parentShape){oObjectContext=this.parentShape.getObjectContext();if(oObjectContext){oItemContext=this.itemContext;if(oItemContext){oObjectContext=oItemContext.getObjectContext()}}}return oObjectContext},on:function(sEventName,fnEventHandler,oScope){if(sEventName){var oEventHandler,aEventArgs=Array.prototype.slice.call(arguments,3),aEventHandlers,oExistingEventHandler;this.eventHandlers=this.eventHandlers||{};aEventHandlers=this.eventHandlers[sEventName]||[];if(fnEventHandler){if(typeof fnEventHandler==="function"){oEventHandler={callback:fnEventHandler};if(oScope){oEventHandler.scope=oScope}if(aEventArgs&&aEventArgs.length>0){oEventHandler["arguments"]=aEventArgs}}}if(oEventHandler){if(this.eventHandlers[sEventName]){oExistingEventHandler=this.findEventHandler(sEventName,fnEventHandler,oScope);if(oExistingEventHandler){oExistingEventHandler["arguments"]=aEventArgs}else{aEventHandlers.push(oEventHandler)}}else{this.eventHandlers[sEventName]=[oEventHandler]}this.registerEventHandler(sEventName,oEventHandler)}}return this},off:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=aEventHandlers.length-1;index>=0;index--){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){this.unregisterEventHandler(sEventName,oEventHandler);this.eventHandlers[sEventName].splice(index,1);if(this.eventHandlers[sEventName].length===0){delete this.eventHandlers[sEventName];if(!sap.galilei.core.hasObjects(this.eventHandlers)){this.eventHandlers=undefined;if(this._hammer){delete this._hammer}}}}}}return this},onEvents:function(oEvents,oScope){var sEvent,aEventParams,aEventArgs;if(oEvents){if(arguments.length>2){aEventArgs=Array.prototype.slice.call(arguments,2)}for(sEvent in oEvents){if(oEvents.hasOwnProperty(sEvent)){aEventParams=[];aEventParams.push(sEvent);aEventParams.push(oEvents[sEvent]);aEventParams.push(oScope);if(aEventArgs){aEventParams=aEventParams.concat(aEventArgs)}this.on.apply(this,aEventParams)}}}return this},findEventHandler:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&fnEventHandler){var aEventHandlers=this.eventHandlers[sEventName],oEventHandler,index;if(aEventHandlers){for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if((!fnEventHandler||oEventHandler.callback===fnEventHandler)&&(!oScope||oEventHandler.scope===oScope)){return oEventHandler}}}}return undefined},enableEventHandler:function(sEventName,fnEventHandler,oScope,bEnable){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){if(!bEnable){oEventHandler.disabled=true}else{if(oEventHandler.disabled){delete oEventHandler.disabled}}}}}return this},registerEventHandler:function(sEventName,oEventHandler){if(sEventName&&oEventHandler){var self=this,oScope=oEventHandler.scope,fnEventHandler=oEventHandler.callback,aEventArgs=oEventHandler["arguments"],aCustomEventArgs,aDeviceEvents,fnInternalEventHandler,index;if(!oScope){oScope=self}fnInternalEventHandler=oEventHandler.registeredEventHandler;if(!fnInternalEventHandler){fnInternalEventHandler=function internalEventHandler(oEvent){var aArgs=[],bDisabled=oEventHandler.disabled;if(!bDisabled&&fnEventHandler&&oEvent&&oEvent.type){oEvent.sourceShape=self;aArgs.push(oEvent);if(aEventArgs&&aEventArgs.length>0){aArgs=aArgs.concat(aEventArgs)}if(aArgs.length>=3&&aArgs[1]!==undefined&&aArgs[1].isSymbol&&aArgs[2]!==undefined&&aArgs[2].diagram!==undefined&&aArgs[1].diagram!==aArgs[2].diagram){return}fnEventHandler.apply(oScope,aArgs)}}}if(fnEventHandler&&this.isDrawn&&this.d3Node){if(nsCommon.isMouseEvent(sEventName)||nsCommon.isTouchEvent(sEventName)||nsCommon.isKeyEvent(sEventName)||nsCommon.isDragDropEvent(sEventName)||nsCommon.isDOMEvent(sEventName)){if(nsCommon.isDragDropEvent(sEventName)){sEventName=sEventName.slice(nsCommon.DRAGDROP_EVENT_PREFIX.length)}this.d3Node.node().addEventListener(sEventName,fnInternalEventHandler,false);if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}}else{if(nsCommon.isPointerEvent(sEventName)){aDeviceEvents=nsCommon.PointerEventsMap[sEventName];if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}for(index=0;index<aDeviceEvents.length;index++){this.registerEventHandler(aDeviceEvents[index],oEventHandler)}}else{if(nsCommon.isGestureEvent(sEventName)){if(!this._hammer){this._hammer=Hammer(this.d3Node.node())}this._hammer.on(sEventName,fnInternalEventHandler);if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}}else{aCustomEventArgs=[sEventName,fnInternalEventHandler];if(aEventArgs&&aEventArgs.length>0){aCustomEventArgs.push(undefined);aCustomEventArgs=aCustomEventArgs.concat(aEventArgs)}sap.galilei.core.Event.subscribe.apply(undefined,aCustomEventArgs);if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}}}}}}return this},unregisterEventHandler:function(sEventName,oEventHandler){if(sEventName&&oEventHandler){var fnEventHandler,aDeviceEvents,index;if(oEventHandler.registeredEventHandler){fnEventHandler=oEventHandler.registeredEventHandler}else{fnEventHandler=oEventHandler.callback}if(nsCommon.isMouseEvent(sEventName)||nsCommon.isTouchEvent(sEventName)||nsCommon.isKeyEvent(sEventName)||nsCommon.isDragDropEvent(sEventName)||nsCommon.isDOMEvent(sEventName)){if(nsCommon.isDragDropEvent(sEventName)){sEventName=sEventName.slice(nsCommon.DRAGDROP_EVENT_PREFIX.length)}if(this.isDrawn){this.d3Node.node().removeEventListener(sEventName,fnEventHandler,false)}}else{if(nsCommon.isPointerEvent(sEventName)){aDeviceEvents=nsCommon.PointerEventsMap[sEventName];for(index=0;index<aDeviceEvents.length;index++){this.unregisterEventHandler(aDeviceEvents[index],oEventHandler)}}else{if(nsCommon.isGestureEvent(sEventName)){if(this._hammer){this._hammer.off(sEventName,fnEventHandler)}}else{sap.galilei.core.Event.unSubscribeCallback(sEventName,fnEventHandler,oEventHandler.scope)}}}}return this},registerEventHandlers:function(){var sEventName,aEventHandlers,index;if(this.eventHandlers){for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.registerEventHandler(sEventName,aEventHandlers[index])}}}if(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1){if(this.isDisableContextMenu&&!this.findEventHandler(nsCommon.DOMEvents.contextmenu)){this.registerEventHandler(nsCommon.DOMEvents.contextmenu,{callback:nsShape.Shape.emptyHandler})}}return this},unregisterEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.unregisterEventHandler(sEventName,aEventHandlers[index])}}delete this.eventHandlers;if(this._hammer){this._hammer=undefined}}return this},insertBefore:function(oShape){if(this.d3Node&&oShape&&oShape.d3Node){var oThisNode=this.d3Node.node(),oNode=oShape.d3Node.node(),oParentNode=oThisNode.parentNode;if(oThisNode&&oNode&&oThisNode!==oNode){if(!oParentNode||oParentNode!==oNode.parentNode){throw"We basically adjust shape order within same parent."}oParentNode.insertBefore(oNode,oThisNode.nextSibling)}}},insertAfter:function(oShape){if(this.d3Node&&oShape&&oShape.d3Node){var oThisNode=this.d3Node.node(),oNode=oShape.d3Node.node(),oParentNode=oThisNode.parentNode;if(oThisNode&&oNode&&oThisNode!==oNode){if(!oParentNode||oParentNode!==oNode.parentNode){throw"We basically adjust shape order within same parent."}oParentNode.insertBefore(oThisNode,oNode.nextSibling)}}},isPrecedingTo:function(oShape){var oThisNode,oNode,oParentNode,i;if(this.d3Node&&oShape&&oShape.d3Node){oThisNode=this.d3Node.node();oNode=oShape.d3Node.node();oParentNode=oThisNode.parentNode;if(oThisNode&&oNode&&oThisNode!==oNode){if(!oParentNode||oParentNode!==oNode.parentNode){throw"We basically adjust shape order within same parent."}for(i=0;i<oParentNode.childNodes.length;i++){if(oThisNode===oParentNode.childNodes[i]){return true}if(oNode===oParentNode.childNodes[i]){return false}}return false}}return false},defaultDispose:function(){this.remove()},dispose:function(){this.defaultDispose()}}});nsShape.defineShape=function(oShapeDef){var ShapeClass,sShapeName;if(oShapeDef){sShapeName=oShapeDef.shapeName;oShapeDef=nsShape.transformShapeDef(oShapeDef);ShapeClass=sap.galilei.core.defineClass(oShapeDef);if(sShapeName){nsShape.ShapeRegistry.registerShape(sShapeName,ShapeClass)}}return ShapeClass};nsShape.transformShapeDef=function(oShapeDef){oShapeDef=oShapeDef||{};var parent=oShapeDef.parent,sShapeName=oShapeDef.shapeName,sShapeCategory=oShapeDef.shapeCategory,properties=oShapeDef.properties;if(!parent){parent=nsShape.Shape}properties=properties||{};if(sShapeName){properties.name={value:sShapeName,writable:false,configurable:false};delete oShapeDef.shapeName}if(sShapeCategory){properties.category={value:sShapeCategory,writable:false,configurable:false};delete oShapeDef.shapeCategory}oShapeDef.parent=parent;oShapeDef.properties=properties;return oShapeDef}});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.ShapeRegistry=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.shape.ShapeRegistry",statics:{_shapesMap:undefined,shapesMap:{get:function(){if(!nsShape.ShapeRegistry._shapesMap){nsShape.ShapeRegistry._shapesMap=new sap.galilei.core.DefaultLookupClass()}return nsShape.ShapeRegistry._shapesMap}},registerShape:function(sShape,ShapeClass){if(sShape&&ShapeClass){nsShape.ShapeRegistry.shapesMap.add(sShape,ShapeClass)}},unregisterShape:function(sShape){if(sShape){nsShape.ShapeRegistry.shapesMap.remove(sShape)}},findShape:function(sShape){if(sShape){return nsShape.ShapeRegistry.shapesMap.get(sShape)}return undefined},createShape:function(sShape,oParam){if(sShape){var ShapeClass=nsShape.ShapeRegistry.findShape(sShape);if(ShapeClass){return new ShapeClass(oParam)}}return undefined},cloneShape:function(oShape){if(oShape){var sProperty,vValue,oParam={},aExcluded=["_shapes","_bindings","_isDrawn","_parentShape"],oCloneShape;for(sProperty in oShape){if(oShape.hasOwnProperty(sProperty)&&aExcluded.indexOf(sProperty)===-1){vValue=oShape[sProperty];if(vValue instanceof sap.galilei.ui.common.Points){oParam[sProperty]=vValue.clone()}else{oParam[sProperty]=oShape[sProperty]}}}oCloneShape=nsShape.ShapeRegistry.createShape(oShape.name,oParam);oCloneShape.d3Node=undefined;oCloneShape.eventHandlers=undefined;if(oShape.shapes.length>0){this.cloneSubShapes(oCloneShape,oShape)}return oCloneShape}return undefined},cloneSubShapes:function(oCloneShape,oShape){if(oCloneShape&&oShape){var iShape,oCloneSubShape;for(iShape=0;iShape<oShape.shapes.length;iShape++){oCloneSubShape=this.cloneShape(oShape.shapes[iShape]);if(oCloneSubShape){oCloneShape.addSubShape(oCloneSubShape)}}}return oCloneShape}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.ShapeSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.shape.ShapeSerializer",statics:{load:function(aShapeComposition){if(aShapeComposition){if(sap.galilei.core.isInstanceOf(aShapeComposition,"Array")){return this.loadSubShapes(undefined,aShapeComposition)}else{if(sap.galilei.core.isInstanceOf(aShapeComposition,"Object")){return this.loadOneShape(undefined,aShapeComposition)}}}return undefined},loadOneShape:function(oParentShape,oShapeComposition){if(oShapeComposition&&sap.galilei.core.isInstanceOf(oShapeComposition,"Object")){var oShapeParams,sProperty,vValue,oBindings,ShapeClass,aShapes,oShape;oShapeParams={};for(sProperty in oShapeComposition){vValue=oShapeComposition[sProperty];if(sProperty==="shape"){ShapeClass=nsShape.ShapeRegistry.findShape(vValue)}else{if(sProperty==="shapes"){aShapes=vValue}else{if(sProperty==="bindings"){continue}else{if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){if(!oBindings){oBindings={}}oBindings[sProperty]=vValue}else{oShapeParams[sProperty]=vValue}}}}}if(ShapeClass){oShape=new ShapeClass(oShapeParams);if(oShape){if(oParentShape){if(oParentShape.isComposite){oParentShape.addSubShape(oShape)}}else{oParentShape=oShape}if(oBindings){oShape.bindProperty(oBindings)}if(aShapes&&oShape.isComposite){if(sap.galilei.core.isInstanceOf(aShapes,"Array")){this.loadSubShapes(oShape,aShapes)}else{if(sap.galilei.core.isInstanceOf(aShapes,"Object")){this.loadOneShape(oShape,aShapes)}}}}}return oShape}return undefined},loadSubShapes:function(oParentShape,aShapeComposition){if(aShapeComposition&&sap.galilei.core.isInstanceOf(aShapeComposition,"Array")){if(!oParentShape){oParentShape=new nsShape.Group()}if(oParentShape.isComposite){var iShape,oShapeDef;for(iShape=0;iShape<aShapeComposition.length;++iShape){oShapeDef=aShapeComposition[iShape];this.loadOneShape(oParentShape,oShapeDef)}}}return oParentShape}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Line=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Line",shapeName:"Line",shapeCategory:"Standard",statics:{propertiesMap:{x1:"x1",y1:"y1",x2:"x2",y2:"y2"}},properties:{isSupportFill:false,x1:{field:"_x1",value:0,get:function(){return this._x1},set:function(nValue){this._x1=sap.galilei.core.validateNumeric(nValue,this._x1);if(this.orientation===nsCommon.Orientation.vertical){this._x2=this._x1}}},y1:{field:"_y1",value:0,get:function(){return this._y1},set:function(nValue){this._y1=sap.galilei.core.validateNumeric(nValue,this._y1);if(this.orientation===nsCommon.Orientation.horizontal){this._y2=this._y1}}},x2:{field:"_x2",value:0,get:function(){return this._x2},set:function(nValue){this._x2=sap.galilei.core.validateNumeric(nValue,this._x2);if(this.orientation===nsCommon.Orientation.vertical){this._x1=this._x2}}},y2:{field:"_y2",value:0,get:function(){return this._y2},set:function(nValue){this._y2=sap.galilei.core.validateNumeric(nValue,this._y2);if(this.orientation===nsCommon.Orientation.horizontal){this._y1=this._y2}}},orientation:{field:"_orientation",value:undefined,get:function(){return this._orientation},set:function(value){if(this._orientation!==value){this._orientation=value;if(this._orientation===nsCommon.Orientation.horizontal){this._y2=this._y1}else{if(this._orientation===nsCommon.Orientation.vertical){this._x2=this._x1}}}}},x:{get:function(){if(this.x1!==undefined&&this.x2!==undefined){return Math.min(this.x1,this.x2)}else{if(this.x1!==undefined){return this.x1}else{if(this.x2!==undefined){return this.x2}}}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.x1!==undefined&&this.x2!==undefined&&nValue!==undefined){var x=Math.min(this.x1,this.x2),dx=nValue-x;if(!isNaN(dx)&&dx!==0){this.moveBy(dx,0)}}}},y:{get:function(){if(this.y1!==undefined&&this.y2!==undefined){return Math.min(this.y1,this.y2)}else{if(this.y1!==undefined){return this.y1}else{if(this.y2!==undefined){return this.y2}}}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.y1!==undefined&&this.y2!==undefined&&nValue!==undefined){var y=Math.min(this.y1,this.y2),dy=nValue-y;if(!isNaN(dy)&&dy!==0){this.moveBy(0,dy)}}}},width:{get:function(){if(this.x1!==undefined&&this.x2!==undefined){return Math.abs(this.x2-this.x1)}else{return 0}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.x1!==undefined&&this.x2!==undefined&&nValue!==undefined){if(this.orientation===nsCommon.Orientation.vertical){nValue=0}else{nValue=Math.abs(nValue)}if(this.x2>=this.x1){this.x2=this.x1+nValue}else{this.x1=this.x2+nValue}}}},height:{get:function(){if(this.y1!==undefined&&this.y2!==undefined){return Math.abs(this.y2-this.y1)}else{return 0}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.y1!==undefined&&this.y2!==undefined&&nValue!==undefined){if(this.orientation===nsCommon.Orientation.horizontal){nValue=0}else{nValue=Math.abs(nValue)}if(this.y2>=this.y1){this.y2=this.y1+nValue}else{this.y1=this.y2+nValue}}}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:line",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Line.propertiesMap,nsShape.Line.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Line.propertiesMap,nsShape.Line.convertFromNode,aAttributes);return this.d3Node},getBBox:function(){var rect;if(this.x1!=undefined&&this.y1!=undefined&&this.x2!=undefined&&this.y2!=undefined){rect=new nsCommon.Rect(new nsCommon.Point(this.x1,this.y1),new nsCommon.Point(this.x2,this.y2))}else{rect=new nsCommon.Rect()}return rect},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this._x1+=dx;this._x2+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this._y1+=dy;this._y2+=dy}}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Rectangle=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Rectangle",shapeName:"Rectangle",shapeCategory:"Standard",statics:{propertiesMap:{x:"x",y:"y",width:"width",height:"height"}},properties:{x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},isPositionUndefined:function(){return isNaN(this.x)||isNaN(this.y)},isSizeUndefined:function(){return isNaN(this.width)||isNaN(this.height)},isUndefined:function(){return this.isPositionUndefined()||this.isSizeUndefined()}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:rect",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Rectangle.propertiesMap,nsShape.Rectangle.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Rectangle.propertiesMap,nsShape.Rectangle.convertFromNode,aAttributes);return this.d3Node}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Path=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Path",shapeName:"Path",shapeCategory:"Standard",statics:{propertiesMap:{path:"d",pathTransform:"transform",markerStart:"marker-start",markerMiddle:"marker-mid",markerEnd:"marker-end"},convertToNode:function(oViewer,oShape,sShapeProp,sNodeProp,vValue){if(oViewer&&oShape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"markerStart":if(oShape.markerStart){vValue=oViewer.libraries.getMarkerUrl(oShape.markerStart,oShape.stroke)}else{vValue=undefined}break;case"markerMiddle":if(oShape.markerMiddle){vValue=oViewer.libraries.getMarkerUrl(oShape.markerMiddle,oShape.stroke)}else{vValue=undefined}break;case"markerEnd":if(oShape.markerEnd){vValue=oViewer.libraries.getMarkerUrl(oShape.markerEnd,oShape.stroke)}else{vValue=undefined}break}}return vValue}},properties:{x:{field:"_x",get:function(){if(!isNaN(this._x)){return this._x}return 0},set:function(x){this._x=x}},y:{field:"_y",get:function(){if(!isNaN(this._y)){return this._y}return 0},set:function(y){this._y=y}},path:{field:"_path",get:function(){if(this._path){return this._path}return this.generatePath()},set:function(sPath){this._path=sPath}},isEnableTranslate:true,isEnableScale:false,isEnableTransform:{get:function(){return this.isEnableTranslate||this.isEnableScale},set:function(bEnabled){this.isEnableTranslate=this.isEnableScale=bEnabled}},pathTransform:{get:function(){var sTransform,sTranslate,oBBox,scaleX=1,scaleY=1,dx=this._x,dy=this._y;if(this.isEnableTransform){oBBox=this.getSvgBBox(false)}if(this.isEnableScale&&oBBox&&oBBox.width!==0&&oBBox.height!==0&&(oBBox.width!==this.width||oBBox.height!==this.height)&&!isNaN(this.width)&&!isNaN(this.height)){scaleX=this.width/oBBox.width;scaleY=this.height/oBBox.height;if(scaleX!==0&&scaleY!==0&&!(scaleX===1&&scaleY===1)){if(scaleX!==scaleY){sTransform="scale("+scaleX+","+scaleY+")"}else{sTransform="scale("+scaleX+")"}}}if(this.isEnableTranslate&&!isNaN(dx)&&!isNaN(dy)){if(this.isEnableScale){if(scaleX!==0){dx/=scaleX}if(scaleY!==0){dy/=scaleY}}if(oBBox){dx-=oBBox.x;dy-=oBBox.y}if(dx!==0||dy!==0){sTranslate="translate("+dx+","+dy+")";if(!sTransform){sTransform=sTranslate}else{sTransform+=sTranslate}}}return sTransform}},markerStart:undefined,markerEnd:undefined,markerMiddle:undefined},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:path",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},generatePath:function(){return undefined},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,self=this,bFixIE=false,sMarkerStart,sMarkerMiddle,sMarkerEnd,sMarkerStartUrl,sMarkerMiddleUrl,sMarkerEndUrl,sColor,delay=15;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);if(this.d3Node&&(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1)&&(this.markerStart||this.markerMiddle||this.markerEnd)){bFixIE=true;sMarkerStart=this.markerStart;sMarkerMiddle=this.markerMiddle;sMarkerEnd=this.markerEnd;this.markerStart=undefined;this.markerMiddle=undefined;this.markerEnd=undefined;sColor=this.stroke;if(sMarkerStart){sMarkerStartUrl=this.d3Node.attr("marker-start");this.d3Node.attr("marker-start",null)}if(sMarkerMiddle){sMarkerMiddleUrl=this.d3Node.attr("marker-mid");this.d3Node.attr("marker-mid",null)}if(sMarkerEnd){sMarkerEndUrl=this.d3Node.attr("marker-end");this.d3Node.attr("marker-end",null)}}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Path.propertiesMap,nsShape.Path.convertToNode,aAttributes);if(this.d3Node&&bFixIE){this.markerStart=sMarkerStart;this.markerMiddle=sMarkerMiddle;this.markerEnd=sMarkerEnd;if(oTransitionDef){delay=oTransitionDef.duration}setTimeout(function(){if(sMarkerStart){if(!sMarkerStartUrl){sMarkerStartUrl=oViewer.libraries.getMarkerUrl(sMarkerStart,sColor)}self.d3Node.attr("marker-start",sMarkerStartUrl)}if(sMarkerMiddle){if(!sMarkerMiddleUrl){sMarkerMiddleUrl=oViewer.libraries.getMarkerUrl(sMarkerMiddle,sColor)}self.d3Node.attr("marker-mid",sMarkerMiddleUrl)}if(sMarkerEnd){if(!sMarkerEndUrl){sMarkerEndUrl=oViewer.libraries.getMarkerUrl(sMarkerEnd,sColor)}self.d3Node.attr("marker-end",sMarkerEndUrl)}},delay)}return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Path.propertiesMap,nsShape.Path.convertFromNode,aAttributes);return this.d3Node},_getPolygonPoints:function(){var sPath=this.path,oPolylineData,oPoints;if(sPath){oPolylineData=nsCommon.Path.getPolylineFromPath(sPath);if(oPolylineData){oPoints=new nsCommon.Points();oPoints.addArray(oPolylineData.points)}}return oPoints},getBBox:function(){var oPoints,oRect=this.defaultGetBBox();if(this.isEnableTransform){if(oRect&&!oRect.isUndefined){return oRect}}oPoints=this._getPolygonPoints();if(oPoints){if(this.isEnableTranslate&&oRect&&!oRect.isPositionUndefined){oPoints.moveBy(oRect.x,oRect.y)}if(this.isEnableScale&&oRect&&!oRect.isSizeUndefined){}return oPoints.getBBox()}return oRect},getIntersection:function(oSegment,oParentBBox,bIncludeStrokeWidth){var oPoints,oRect;if(oSegment){oPoints=this._getPolygonPoints();if(oPoints){if(oParentBBox){oRect=this.getBBox();if(oRect){oPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}}}return nsCommon.geometry.intersectSegmentPolygon(oSegment,oPoints)}return undefined},isPointInShape:function(vPoint,oParentBBox){var oPoints,oRect;if(vPoint){oPoints=this._getPolygonPoints();if(oPoints){if(oParentBBox){oRect=this.getBBox();if(oRect){oPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}}return nsCommon.geometry.isPointInPolygon(vPoint,oPoints)}}return false}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Group=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Group",shapeName:"Group",shapeCategory:"Standard",statics:{propertiesMap:{groupTransform:"transform"}},properties:{isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.COMPOSITE,value:nsShape.ShapeStates.COMPOSITE,writable:false,configurable:false},isGroup:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.GROUP,value:nsShape.ShapeStates.GROUP,writable:false,configurable:false},isSupportStroke:false,isSupportFill:false,x:{get:function(){var oRect;if(this._x!==undefined){return this._x}else{if(this.shapes.length>0){oRect=this.getChildrenBBox();if(oRect){return oRect.x}}}return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x,true)}},y:{get:function(){var oRect;if(this._y!==undefined){return this._y}else{if(this.shapes.length>0){oRect=this.getChildrenBBox();if(oRect){return oRect.y}}}return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y,true)}},width:{get:function(){var oRect;if(this._width!==undefined){return this._width}else{if(this.shapes.length>0){oRect=this.getChildrenBBox();if(oRect){return oRect.width}}}return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width,true)}},height:{get:function(){var oRect;if(this._height!==undefined){return this._height}else{if(this.shapes.length>0){oRect=this.getChildrenBBox();if(oRect){return oRect.height}}}return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height,true)}},isEnableTranslate:false,isEnableScale:false,isEnableTransform:{get:function(){return this.isEnableTranslate||this.isEnableScale},set:function(bEnabled){this.isEnableTranslate=this.isEnableScale=bEnabled}},groupTransform:{field:"_groupTransform",get:function(){var sTransform,sTranslate,oBBox;if(this.isEnableScale&&!isNaN(this._width)&&!isNaN(this._height)){oBBox=this.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0&&(oBBox.width!==this._width||oBBox.height!==this._height)){sTransform="scale("+this._width/oBBox.width+","+this._height/oBBox.height+")"}}if(this.isEnableTranslate&&!isNaN(this._x)&&!isNaN(this._y)&&(this._groupTransform!==undefined||this._x!==0||this._y!==0)){sTranslate="translate("+this._x+","+this._y+")";if(!sTransform){sTransform=sTranslate}else{sTransform+=sTranslate}}this._groupTransform=sTransform;return sTransform}},focusable:false,tabindex:{get:function(){return this._tabindex},set:function(nValue){this._tabindex=sap.galilei.core.validateNumeric(nValue,this._tabindex,true)}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var index,shape;this.createNode("svg:g",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];if(!shape.isDrawn){shape.draw(oViewer,this.d3Node,oTransitionDef)}else{shape.updateDrawing(oViewer,oTransitionDef)}}return this.d3Node},updateDrawingGroup:function(oViewer,oTransitionDef,aAttributes){var oTransition,index,shape;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];if(shape.isDrawn){shape.updateDrawing(oViewer,oTransitionDef,aAttributes)}else{if(!this._isCreatingNode){shape.draw(oViewer,this.d3Node,oTransitionDef)}}}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Group.propertiesMap,nsShape.Group.convertToNode,aAttributes);return this.d3Node},updateDrawing:function(oViewer,oTransitionDef,aAttributes){this.updateDrawingGroup(oViewer,oTransitionDef,aAttributes)},layout:function(layoutRect,bUpdateShape){var index,shape,rect,outputLayoutRect=new nsCommon.Rect();for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];rect=shape.layout(layoutRect,bUpdateShape);if(index===0){outputLayoutRect.set(rect)}else{outputLayoutRect.unionRect(rect)}}this.layoutRect=outputLayoutRect;return outputLayoutRect},getBBox:function(){var oRect,oChildrenRect=this.getChildrenBBox();if(oChildrenRect){oRect=oChildrenRect;if(!isNaN(this.x)&&!isNaN(this.y)&&this.isEnableTranslate){oRect.moveBy(this.x,this.y)}}else{oRect=new nsCommon.Rect(this.x,this.y,!isNaN(this.width)?this.width:0,!isNaN(this.height)?this.height:0)}return oRect}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Stack=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Stack",shapeName:"Stack",shapeCategory:"Internal",properties:{isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.COMPOSITE,value:nsShape.ShapeStates.COMPOSITE,writable:false,configurable:false},isTransparent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.TRANSPARENT,value:nsShape.ShapeStates.TRANSPARENT,writable:false,configurable:false},isSupportStroke:false,isSupportFill:false,isDrawn:false,x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},orientation:nsCommon.Orientation.vertical,innerPadding:{field:"_innerPadding",value:2,get:function(){return this._innerPadding},set:function(nValue){this._innerPadding=sap.galilei.core.validateNumeric(nValue,this._innerPadding)}},innerAlignment:undefined,contentPosition:undefined,contentSize:undefined,contentLayoutRect:{field:"_contentLayoutRect",get:function(){return this._contentLayoutRect}},contentMarginTop:undefined,contentMarginBottom:undefined,contentMarginLeft:undefined,contentMarginRight:undefined,contentMargin:{get:function(){if((this.contentMarginLeft===this.contentMarginTop)&&(this.contentMarginBottom===this.contentMarginRight)&&(this.contentMarginLeft===this.contentMarginRight)){return this.contentMarginLeft}return undefined},set:function(margin){this.contentMarginLeft=this.contentMarginTop=this.contentMarginBottom=this.contentMarginRight=margin}}},methods:{remove:function(oViewer,oTransitionDef){this.defaultRemove(oViewer,oTransitionDef);this.isDrawn=false},defaultDraw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var d3Parent,index,oShape;if(oViewer){if(!d3ParentNode){d3Parent=oViewer.d3MainShapeLayer}else{d3Parent=d3ParentNode}}if(isNaN(this.x)){this.x=0}if(isNaN(this.y)){this.y=0}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oShape.draw(oViewer,d3Parent,oTransitionDef)}this.isDrawn=true;return d3ParentNode},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.defaultDraw(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},defaultUpdateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,index,oShape;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];if(oShape.isDrawn){oShape.updateDrawing(oViewer,oTransitionDef,aAttributes)}else{oShape.draw(oViewer,undefined,oTransitionDef)}}return this.d3Node},updateDrawing:function(oViewer,oTransitionDef,aAttributes){return this.defaultUpdateDrawing(oViewer,oTransitionDef,aAttributes)},defaultLayout:function(oLayoutRect,bUpdateShape){var self=this,oOutputLayoutRect=new nsCommon.Rect(),x,y,width,height,left,top,right,bottom,paddingLeft,paddingTop,paddingRight,paddingBottom,innerPadding,innerWidth,innerHeight,minWidth,minHeight,maxWidth,maxHeight,aVisibleShapes=[],nVisibleShapes=0,maxInnerWidth=0,maxInnerHeight=0,totalWidth=0,totalHeight=0,x0,y0,index,oShape,oRect,oChildRect=new nsCommon.Rect(),shapeX,shapeY,shapeWidth,shapeHeight,nAdjust=0,nAdjustSize=0,offset=0,dSize=0,contentX,contentY,contentWidth,contentHeight,contentMarginLeft,contentMarginTop,contentMarginRight,contentMarginBottom,contentSize,bHasContent=false,contentPosition,oPreviousShape,oNextShape,bChangeWidth=false,bChangeHeight=false;for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];if(oShape.isVisible!==false){aVisibleShapes.push(oShape);nVisibleShapes++}}if(oLayoutRect){x=oLayoutRect.x;y=oLayoutRect.y;if(isNaN(x)){x=this.x}if(isNaN(y)){y=this.y}if(!isNaN(oLayoutRect.width)&&oLayoutRect.width!=0){width=oLayoutRect.width}if(!isNaN(oLayoutRect.height)&&oLayoutRect.height!=0){height=oLayoutRect.height}}else{x=this.x;y=this.y}x=sap.galilei.core.validateNumeric(x,0);y=sap.galilei.core.validateNumeric(y,0);width=sap.galilei.core.validateNumeric(width);height=sap.galilei.core.validateNumeric(height);oOutputLayoutRect.set(x,y,width,height);if(bUpdateShape&&!this.layoutRect){this.layoutRect=oOutputLayoutRect.clone()}paddingLeft=this.paddingLeft;paddingTop=this.paddingTop;paddingRight=this.paddingRight;paddingBottom=this.paddingBottom;innerPadding=this.innerPadding;paddingLeft=sap.galilei.core.validateNumeric(paddingLeft,0);paddingTop=sap.galilei.core.validateNumeric(paddingTop,0);paddingRight=sap.galilei.core.validateNumeric(paddingRight,0);paddingBottom=sap.galilei.core.validateNumeric(paddingBottom,0);innerPadding=sap.galilei.core.validateNumeric(innerPadding,0);innerWidth=width;innerHeight=height;left=x;top=y;right=x;bottom=y;left+=paddingLeft;top+=paddingTop;minWidth=sap.galilei.core.validateNumeric(this.minWidth,0);minHeight=sap.galilei.core.validateNumeric(this.minHeight,0);maxWidth=sap.galilei.core.validateNumeric(this.maxWidth,0);maxHeight=sap.galilei.core.validateNumeric(this.maxHeight,0);if(!isNaN(width)&&width!==0){innerWidth=width-paddingLeft-paddingRight}if(!isNaN(height)&&height!==0){innerHeight=height-paddingTop-paddingBottom}if(!isNaN(innerWidth)&&innerWidth!==0){if(minWidth>0&&innerWidth<minWidth){innerWidth=minWidth}if(maxWidth>0&&innerWidth>maxWidth){innerWidth=maxWidth}width=innerWidth+paddingLeft+paddingRight;right=left+innerWidth}if(!isNaN(innerHeight)&&innerHeight!==0){if(minHeight>0&&innerHeight<minHeight){innerHeight=minHeight}if(maxHeight>0&&innerHeight>maxHeight){innerHeight=maxHeight}height=innerHeight+paddingTop+paddingBottom;bottom=top+innerHeight}function isVariableSizeShape(oShape){if(oShape){if(self.orientation===nsCommon.Orientation.vertical){return(oShape.verticalAlignment===nsCommon.VerticalAlignment.height)||(oShape.verticalAlignment===nsCommon.VerticalAlignment.height&&!isNaN(innerHeight)&&innerHeight!==0)}else{return(oShape.horizontalAlignment===nsCommon.HorizontalAlignment.width)||(oShape.horizontalAlignment===nsCommon.HorizontalAlignment.center&&!isNaN(innerWidth)&&innerWidth!==0)}}return false}function isResizableShape(oShape){if(oShape){return sap.galilei.core.isInstanceOf(oShape,"sap.galilei.ui.common.shape.Text")}return false}function measureShapesSize(aShapes,oOptions){var bUpdateShape,bNeedLayout,index,nShapes,aVariableSizeShapes=[],aResizableShapes=[],nTotalWidth=0,nTotalHeight=0,nAvailableWidth,nAvailableHeight,nLayoutWidth,nLayoutHeight,nReduceSize,nDelta,oLayoutRect=new nsCommon.Rect();function layoutShape(oShape,oLayoutRect,bNeedLayout,sOrientation){var oRect;if(oShape){if(bNeedLayout||!oShape.layoutRect){oRect=oShape.layout(oLayoutRect,false)}else{oRect=oShape.layoutRect}if(sOrientation===nsCommon.Orientation.vertical){nTotalHeight+=oShape.marginTop+oRect.height+oShape.marginBottom;if(!(oShape instanceof nsShape.Separator)){maxInnerWidth=Math.max(maxInnerWidth,oRect.width)}}else{nTotalWidth+=oShape.marginLeft+oRect.width+oShape.marginRight;if(!(oShape instanceof nsShape.Separator)){maxInnerHeight=Math.max(maxInnerHeight,oRect.height)}}}return oRect}if(aShapes&&aShapes.length>0){oOptions=oOptions||{};bUpdateShape=oOptions.updateShape;bNeedLayout=oOptions.needLayout;if(self.orientation===nsCommon.Orientation.vertical){nTotalHeight+=innerPadding*(aShapes.length-1)}else{nTotalWidth+=innerPadding*(aShapes.length-1)}for(index=0,nShapes=aShapes.length;index<nShapes;index++){oShape=aShapes[index];shapeX=sap.galilei.core.validateNumeric(oShape.x,0);shapeY=sap.galilei.core.validateNumeric(oShape.y,0);if(self.orientation===nsCommon.Orientation.vertical){nLayoutWidth=innerWidth;nLayoutHeight=undefined}else{nLayoutWidth=undefined;nLayoutHeight=innerHeight}oLayoutRect.set(shapeX,shapeY,nLayoutWidth,nLayoutHeight);if(!isVariableSizeShape(oShape)){oRect=layoutShape(oShape,oLayoutRect,!bUpdateShape||bNeedLayout,self.orientation);if(isResizableShape(oShape)){aResizableShapes.push(oShape)}}else{aVariableSizeShapes.push(oShape)}}if(aVariableSizeShapes.length>0){if(self.orientation===nsCommon.Orientation.vertical){nAvailableWidth=innerWidth;if(!isNaN(innerHeight)&&innerHeight!==0){nAvailableHeight=(innerHeight-nTotalHeight)/aVariableSizeShapes.length;if(nAvailableHeight<0){nAvailableHeight=0}}}else{if(!isNaN(innerWidth)&&innerWidth!==0){nAvailableWidth=((innerWidth-nTotalWidth)/aVariableSizeShapes.length);if(nAvailableWidth<0){nAvailableWidth=0}}nAvailableHeight=innerHeight}for(index=0,nShapes=aVariableSizeShapes.length;index<nShapes;index++){oShape=aVariableSizeShapes[index];shapeX=sap.galilei.core.validateNumeric(oShape.x,0);shapeY=sap.galilei.core.validateNumeric(oShape.y,0);oLayoutRect.set(shapeX,shapeY,nAvailableWidth,nAvailableHeight);oRect=layoutShape(oShape,oLayoutRect,!bUpdateShape||bNeedLayout,self.orientation)}}if(aResizableShapes.length>0){nReduceSize=0;if(self.orientation===nsCommon.Orientation.vertical){if(nTotalHeight>innerHeight){nReduceSize=(nTotalHeight-innerHeight)}}else{if(nTotalWidth>innerWidth){nReduceSize=(nTotalWidth-innerWidth)/aResizableShapes.length}}if(nReduceSize!==0){for(nShapes=aResizableShapes.length,index=nShapes-1;index>=0;index--){oShape=aResizableShapes[index];shapeX=sap.galilei.core.validateNumeric(oShape.x,0);shapeY=sap.galilei.core.validateNumeric(oShape.y,0);oLayoutRect=oShape.layoutRect.clone();nDelta=nReduceSize;if(self.orientation===nsCommon.Orientation.vertical){if(nReduceSize>0){nDelta=nReduceSize;if(oLayoutRect.height<nDelta){nDelta=oLayoutRect.height}if(nDelta>0){oLayoutRect.width=innerWidth;oLayoutRect.height-=nDelta;nReduceSize-=nDelta;nTotalHeight-=nDelta;oRect=layoutShape(oShape,oLayoutRect,true,self.orientation);if(!(oShape instanceof nsShape.Separator)){maxInnerWidth=Math.max(maxInnerWidth,oRect.width)}}}}else{oLayoutRect.width-=nDelta;if(oLayoutRect.width<0){oLayoutRect.width=0;nDelta=0}oLayoutRect.height=innerHeight;oRect=layoutShape(oShape,oLayoutRect,true,self.orientation);nTotalWidth-=nDelta;if(!(oShape instanceof nsShape.Separator)){maxInnerHeight=Math.max(maxInnerHeight,oRect.height)}}}}}}}measureShapesSize(aVisibleShapes,{updateShape:bUpdateShape,needLayout:(!bUpdateShape)||(this.layoutRect&&(this.layoutRect.width!==width||this.layoutRect.height!==height))});x0=left;y0=top;for(index=0;index<nVisibleShapes;++index){oShape=aVisibleShapes[index];oRect=undefined;shapeX=sap.galilei.core.validateNumeric(oShape.x,0);shapeY=sap.galilei.core.validateNumeric(oShape.y,0);if(this.orientation===nsCommon.Orientation.vertical){if(!oShape.isComposite){shapeY=y0+oShape.marginTop}}else{if(!oShape.isComposite){shapeX=x0+oShape.marginLeft}}shapeWidth=oShape.width;shapeHeight=oShape.height;if(oShape instanceof nsShape.Text){if(isNaN(shapeWidth)){shapeWidth=oShape.textWidth}if(isNaN(shapeHeight)){shapeHeight=oShape.textHeight}}shapeWidth=sap.galilei.core.validateNumeric(shapeWidth,0);shapeHeight=sap.galilei.core.validateNumeric(shapeHeight,0);if(!bUpdateShape){oRect=oShape.layoutRect}else{oRect=oShape.layoutRect;if(this.orientation===nsCommon.Orientation.vertical){if(oShape.isComposite||isNaN(innerWidth)||innerWidth===0){oChildRect.set(shapeX,shapeY,innerWidth,undefined)}else{oChildRect.set(shapeX,shapeY,innerWidth,oRect.height)}}else{if(oShape.isComposite||isNaN(innerHeight)||innerHeight===0){oChildRect.set(shapeX,shapeY,undefined,innerHeight)}else{oChildRect.set(shapeX,shapeY,oRect.width,innerHeight)}}oRect=oShape.layout(oChildRect,true)}if(!(oShape instanceof nsShape.Separator)){oRect.inflate(oShape.marginLeft,oShape.marginTop,oShape.marginRight,oShape.marginBottom)}if(this.orientation===nsCommon.Orientation.vertical){if(oShape.isComposite){shapeY=y0+oShape.marginTop}y0+=oRect.height;totalHeight+=oRect.height;if(oShape instanceof nsShape.Separator){y0+=paddingTop;if(index<nVisibleShapes-1){totalHeight+=paddingTop}}else{if(index<nVisibleShapes-1&&(aVisibleShapes[index+1] instanceof nsShape.Separator)){y0+=paddingBottom;if(index<nVisibleShapes-1){totalHeight+=paddingBottom}}else{y0+=innerPadding;if(index<nVisibleShapes-1){totalHeight+=innerPadding}}}}else{if(oShape.isComposite){shapeX=x0+oShape.marginLeft}x0+=oRect.width;totalWidth+=oRect.width;if(oShape instanceof nsShape.Separator){x0+=paddingLeft;if(index<nVisibleShapes-1){totalWidth+=paddingLeft}}else{if(index<nVisibleShapes-1&&(aVisibleShapes[index+1] instanceof nsShape.Separator)){x0+=paddingRight;if(index<nVisibleShapes-1){totalWidth+=paddingRight}}else{x0+=innerPadding;if(index<nVisibleShapes-1){totalWidth+=innerPadding}}}}if(bUpdateShape){oShape.moveTo(shapeX,shapeY)}if(this.orientation===nsCommon.Orientation.vertical){totalWidth=Math.max(totalWidth,oRect.width)}else{totalHeight=Math.max(totalHeight,oRect.height)}}if(innerWidth===undefined||innerWidth===0){innerWidth=totalWidth}if(innerHeight===undefined||innerHeight===0){innerHeight=totalHeight}if(minWidth>0&&innerWidth<minWidth){innerWidth=minWidth}if(minHeight>0&&innerHeight<minHeight){innerHeight=minHeight}if(maxWidth>0&&innerWidth>maxWidth){innerWidth=maxWidth}if(maxHeight>0&&innerHeight>maxHeight){innerHeight=maxHeight}right=left+innerWidth;bottom=top+innerHeight;if(bUpdateShape){bHasContent=this.contentPosition!==undefined;contentPosition=this.contentPosition>nVisibleShapes?nVisibleShapes:this.contentPosition;if(bHasContent){contentMarginLeft=sap.galilei.core.validateNumeric(this.contentMarginLeft,0);contentMarginTop=sap.galilei.core.validateNumeric(this.contentMarginTop,0);contentMarginRight=sap.galilei.core.validateNumeric(this.contentMarginRight,0);contentMarginBottom=sap.galilei.core.validateNumeric(this.contentMarginBottom,0);contentSize=sap.galilei.core.validateNumeric(this.contentSize,1);if(contentPosition<nVisibleShapes){oNextShape=aVisibleShapes[contentPosition]}if(contentPosition>=1&&contentPosition-1<nVisibleShapes){oPreviousShape=aVisibleShapes[contentPosition-1]}}if(this.orientation===nsCommon.Orientation.vertical){for(index=0;index<nVisibleShapes;++index){oShape=aVisibleShapes[index];shapeX=sap.galilei.core.validateNumeric(oShape.x,0);shapeY=sap.galilei.core.validateNumeric(oShape.y,0);bChangeWidth=false;shapeWidth=oShape.layoutRect.width;if(shapeWidth!==undefined&&shapeWidth>innerWidth-oShape.marginLeft-oShape.marginRight){bChangeWidth=true;shapeWidth=innerWidth-oShape.marginLeft-oShape.marginRight;if(shapeWidth<0){shapeWidth=0}}if(oShape instanceof nsShape.Image&&oShape.useReference===true){shapeWidth=oShape.width}else{if(oShape instanceof nsShape.Text&&!oShape.isIconFont){bChangeWidth=true}}if(oShape instanceof nsShape.Separator){bChangeWidth=true;shapeX=x;shapeWidth=width}else{switch(oShape.horizontalAlignment){case nsCommon.HorizontalAlignment.right:shapeX=right-shapeWidth-oShape.marginRight;break;case nsCommon.HorizontalAlignment.center:shapeX=left+Math.round((innerWidth-shapeWidth)/2);break;case nsCommon.HorizontalAlignment.width:shapeX=left+oShape.marginLeft;shapeWidth=innerWidth-oShape.marginLeft-oShape.marginRight;bChangeWidth=true;break;default:shapeX=left+oShape.marginLeft;break}}oShape.moveTo(shapeX,shapeY);if(shapeWidth!==undefined&&bChangeWidth){oShape.width=shapeWidth;oShape.layoutRect.width=shapeWidth}if(oShape.verticalAlignment===nsCommon.VerticalAlignment.height&&oShape.layoutRect.height!==0){++nAdjust;nAdjustSize+=oShape.layoutRect.height}}if(bHasContent){contentX=left+contentMarginLeft;contentWidth=innerWidth-contentMarginLeft-contentMarginRight;contentHeight=contentSize;nAdjust++;nAdjustSize+=contentSize;totalHeight+=contentSize;if(oNextShape){totalHeight+=(oNextShape instanceof nsShape.Separator)?paddingBottom:innerPadding}}if(innerHeight!==totalHeight||bHasContent){if(nAdjust===0&&innerHeight>totalHeight){switch(this.innerAlignment){case nsCommon.VerticalAlignment.bottom:offset=innerHeight-totalHeight;break;case nsCommon.VerticalAlignment.middle:offset=Math.floor((innerHeight-totalHeight)/2);break;case nsCommon.VerticalAlignment.height:offset=Math.floor((innerHeight-totalHeight)/(nVisibleShapes+1));dSize=offset;break;default:offset=0;break}}if(offset>0||nAdjust>0){for(index=0;index<nVisibleShapes;++index){oShape=aVisibleShapes[index];shapeX=oShape.x;shapeY=oShape.y;if(nAdjust===0){shapeY+=offset;offset+=dSize}else{shapeY+=offset;if(oShape.verticalAlignment===nsCommon.VerticalAlignment.height){if(nAdjustSize>0){dSize=Math.floor((innerHeight-totalHeight)*oShape.layoutRect.height/nAdjustSize);oShape.height+=dSize;oShape.layoutRect.height+=dSize;offset+=dSize}}}oShape.moveTo(shapeX,shapeY)}if(bHasContent){if(oNextShape){contentY=oNextShape.y-oNextShape.marginTop+contentMarginTop}else{if(oPreviousShape){contentY=oPreviousShape.y+oPreviousShape.height+oPreviousShape.marginBottom+innerPadding+contentMarginTop}else{contentY=top+contentMarginTop}}if(nAdjustSize>0){contentHeight+=Math.floor((innerHeight-totalHeight)*contentSize/nAdjustSize)-contentMarginTop-contentMarginBottom}if(contentHeight<0){contentHeight=0}offset=contentHeight+contentMarginTop+contentMarginBottom;if(oNextShape){offset+=oNextShape instanceof nsShape.Separator?paddingBottom:innerPadding}for(index=contentPosition;index<nVisibleShapes;index++){oShape=aVisibleShapes[index];oShape.moveBy(0,offset)}this._contentLayoutRect=new nsCommon.Rect(contentX,contentY,contentWidth,contentHeight)}}}}else{for(index=0;index<nVisibleShapes;++index){oShape=aVisibleShapes[index];shapeX=sap.galilei.core.validateNumeric(oShape.x,0);shapeY=sap.galilei.core.validateNumeric(oShape.y,0);bChangeHeight=false;shapeHeight=oShape.layoutRect.height;if(shapeHeight>innerHeight-oShape.marginTop-oShape.marginBottom){bChangeHeight=true;shapeHeight=innerHeight-oShape.marginTop-oShape.marginBottom;if(shapeHeight<0){shapeHeight=0}}if(oShape instanceof nsShape.Image&&oShape.useReference===true){shapeHeight=oShape.height}else{if(oShape instanceof nsShape.Text&&!oShape.isIconFont){bChangeHeight=true}}if(oShape instanceof nsShape.Separator){bChangeHeight=true;shapeY=y;shapeHeight=height}else{switch(oShape.verticalAlignment){case nsCommon.VerticalAlignment.bottom:shapeY=bottom-shapeHeight-oShape.marginBottom;break;case nsCommon.VerticalAlignment.middle:shapeY=top+Math.round((innerHeight-shapeHeight)/2);break;case nsCommon.VerticalAlignment.height:shapeY=top+oShape.marginTop;shapeHeight=innerHeight-oShape.marginTop-oShape.marginBottom;bChangeHeight=true;break;default:shapeY=top+oShape.marginTop;break}}oShape.moveTo(shapeX,shapeY);if(shapeHeight!==undefined&&bChangeHeight){oShape.height=shapeHeight;oShape.layoutRect.height=shapeHeight}if(oShape.horizontalAlignment===nsCommon.HorizontalAlignment.width&&oShape.layoutRect.width!==0){++nAdjust;nAdjustSize+=oShape.layoutRect.width}}if(bHasContent){contentY=top+contentMarginTop;contentHeight=innerHeight-contentMarginTop-contentMarginBottom;contentWidth=contentSize;nAdjust++;nAdjustSize+=contentSize;totalWidth+=contentSize;if(oNextShape){totalWidth+=(oNextShape instanceof nsShape.Separator)?paddingRight:innerPadding}}if(innerWidth!==totalWidth||bHasContent){if(nAdjust===0&&innerWidth>totalWidth){switch(this.innerAlignment){case nsCommon.HorizontalAlignment.right:offset=innerWidth-totalWidth;break;case nsCommon.HorizontalAlignment.center:offset=Math.floor((innerWidth-totalWidth)/2);break;case nsCommon.HorizontalAlignment.width:offset=Math.floor((innerWidth-totalWidth)/(nVisibleShapes+1));dSize=offset;break;default:offset=0;break}}if(offset>0||nAdjust>0){for(index=0;index<nVisibleShapes;++index){oShape=aVisibleShapes[index];shapeX=oShape.x;shapeY=oShape.y;if(nAdjust===0){shapeX+=offset;offset+=dSize}else{shapeX+=offset;if(oShape.horizontalAlignment===nsCommon.HorizontalAlignment.width){if(nAdjustSize>0){dSize=Math.floor((innerWidth-totalWidth)*oShape.layoutRect.width/nAdjustSize);oShape.width+=dSize;oShape.layoutRect.width+=dSize;offset+=dSize}}}oShape.moveTo(shapeX,shapeY)}if(bHasContent){if(oNextShape){contentX=oNextShape.x-oNextShape.marginLeft+contentMarginLeft}else{if(oPreviousShape){contentX=oPreviousShape.x+oPreviousShape.width+oPreviousShape.marginRight+innerPadding+contentMarginLeft}else{contentX=left+contentMarginLeft}}if(nAdjustSize>0){contentWidth+=Math.floor((innerWidth-totalWidth)*contentSize/nAdjustSize)-contentMarginLeft-contentMarginRight}if(contentWidth<0){contentWidth=0}offset=contentWidth+contentMarginLeft+contentMarginRight;if(oNextShape){offset+=oNextShape instanceof nsShape.Separator?paddingRight:innerPadding}for(index=contentPosition;index<nVisibleShapes;index++){oShape=aVisibleShapes[index];oShape.moveBy(offset,0)}this._contentLayoutRect=new nsCommon.Rect(contentX,contentY,contentWidth,contentHeight)}}}}}oOutputLayoutRect.width=innerWidth+paddingLeft+paddingRight;oOutputLayoutRect.height=innerHeight+paddingTop+paddingBottom;if(bUpdateShape){this.width=oOutputLayoutRect.width;this.height=oOutputLayoutRect.height}this.layoutRect=new nsCommon.Rect(oOutputLayoutRect);return oOutputLayoutRect},layout:function(oLayoutRect,bUpdateShape){return this.defaultLayout(oLayoutRect,bUpdateShape)}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Text=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Text",shapeName:"Text",shapeCategory:"Standard",statics:{propertiesMap:{dx:"dx",dy:"dy",textDecoration:"text-decoration"}},properties:{isIconFont:false,x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},dx:{field:"_dx",get:function(){return this._dx},set:function(nValue){this._dx=sap.galilei.core.validateNumeric(nValue,this._dx,true)}},dy:{field:"_dy",get:function(){return this._dy},set:function(nValue){this._dy=sap.galilei.core.validateNumeric(nValue,this._dy,true)}},text:{field:"_text",get:function(){return this.getFieldOrBindValue("text")},set:function(vValue){this.setFieldOrBindValue("text",vValue,true)}},enableInPlaceEditing:true,font:{field:"_font",get:function(){var oStyle;if(this._font){return this._font}oStyle={fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight};return nsCommon.Font.getFontPropertiesFromStyle(oStyle)},set:function(sFont){this._font=sFont}},fontFamily:undefined,fontSize:undefined,fontStyle:undefined,fontVariant:undefined,fontWeight:undefined,textDecoration:undefined,horizontalAlignment:{expression:"sap.galilei.ui.common.HorizontalAlignment.left"},verticalAlignment:{expression:"sap.galilei.ui.common.VerticalAlignment.top"},isWordWrap:false,isEllipsis:false,cx:{field:"_cx",get:function(){return this._cx},set:function(nValue){this._cx=sap.galilei.core.validateNumeric(nValue,this._cx,true)}},cy:{field:"_cy",get:function(){return this._cy},set:function(nValue){this._cy=sap.galilei.core.validateNumeric(nValue,this._cy,true)}},textWidth:{field:"_textWidth",get:function(){return this._textWidth},set:function(nValue){this._textWidth=sap.galilei.core.validateNumeric(nValue,this._textWidth,true)}},textHeight:{field:"_textHeight",get:function(){return this._textHeight},set:function(nValue){this._textHeight=sap.galilei.core.validateNumeric(nValue,this._textHeight,true)}},cursor:"default"},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:text",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,d3Node=this.d3Node,sText=this.text===undefined?"":this.text,x=this.x,y=this.y,width=this.width,height=this.height,cx=this.cx,cy=this.cy,oPoints,oRect,matrix;if(x!==undefined){x=+x}if(y!==undefined){y=+y}if(this.layoutRect){if(width===undefined){width=this.layoutRect.width}if(height===undefined){height=this.layoutRect.height}}if(width!==undefined){width=+width;if(this.isIconFont){width+=1+(width/16)*0.5}}if(height!==undefined){height=+height}if(cx!==undefined){cx=+cx}if(cy!==undefined){cy=+cy}if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);if(this.d3Node&&sText!==undefined){if(typeof sText!=="string"){sText=sText.toString()}if(oTransition){d3Node=oTransition}if(!isNaN(this.angle)&&this.angle!==0){if((isNaN(width)||width===0)&&!isNaN(this.textWidth)){width=this.textWidth}if((isNaN(height)||height===0)&&!isNaN(this.textHeight)){height=this.textHeight}oPoints=new nsCommon.Points();oPoints.points=[[x,y],[x+width,y],[x+width,y+height],[x,y+height]];matrix=new nsCommon.Matrix();cx=x+width/2;cy=y+height/2;matrix.rotate(-this.angle,cx,cy);oPoints.matrixTransform(matrix);oRect=oPoints.getBBox();x=oRect.left;y=oRect.top;width=oRect.width;height=oRect.height}sText=sText.trimLeft();sText=sText.trimRight();nsCommon.svg.Svg.updateText(d3Node,sText,x,y,width,height,this.font,this.horizontalAlignment,this.verticalAlignment,this.isWordWrap,this.isEllipsis,this.angle,cx,cy);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Text.propertiesMap,nsShape.Text.convertToNode,aAttributes)}return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);if(this.d3Node){var svgText=this.d3Node.node(),n,node,text="",x,y,width,height;if(svgText){for(n=0;n<svgText.childNodes.length;n++){node=svgText.childNodes[n];if(n===0){text=node.textContent}else{text+="\r\n"+node.textContent}}this.text=text;x=svgText.getAttributeNS(null,"x");y=svgText.getAttributeNS(null,"y");width=svgText.getAttributeNS(nsCommon.NAMESPACE_GALILEI,"width");height=svgText.getAttributeNS(nsCommon.NAMESPACE_GALILEI,"height");if(x!==undefined){this.x=+x}if(y!==undefined){this.y=+y}if(width!==undefined){this.width=+width;this.textWidth=+width}if(height!==undefined){this.height=+height;this.textHeight=+height}}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Text.propertiesMap,nsShape.Text.convertFromNode,aAttributes)}return this.d3Node},layout:function(oLayoutRect,bUpdateShape){var oOutputLayoutRect=new nsCommon.Rect(),oTextLayoutRect,sText=this.text,x=this.x,y=this.y,width=this.width,height=this.height,oPoints,oMatrix,oRect,cx,cy;if(x!==undefined){x=+x}if(y!==undefined){y=+y}if(width!==undefined){width=+width;if(this.isIconFont){width+=1+(width/16)*0.5}}if(height!==undefined){height=+height}if(oLayoutRect){x=sap.galilei.core.validateNumeric(oLayoutRect.x,x);y=sap.galilei.core.validateNumeric(oLayoutRect.y,y);width=oLayoutRect.width;height=oLayoutRect.height}if(this.angle&&this.angle!==0){if(x!==undefined&&y!==undefined){if((isNaN(width)||width===0)){if(!isNaN(this.textWidth)&&this.textWidth!==0){width=this.textWidth}else{width=100000}}if((isNaN(height)||height===0)){if(!isNaN(this.textHeight)&&this.textHeight!==0){height=this.textHeight}else{height=100000}}cx=x;cy=y;oMatrix=new nsCommon.Matrix();oMatrix.rotate(-this.angle,cx,cy);oPoints=new nsCommon.Points();oPoints.points=[[x,y],[x+width,y],[x+width,y+height],[x,y+height]];oPoints.matrixTransform(oMatrix);oRect=oPoints.getBBox();width=oRect.width;height=oRect.height}else{if(this.textWidth!==undefined){width=this.textWidth}if(this.textHeight!==undefined){height=this.textHeight}}}if(sText&&(typeof sText!=="string")){sText=sText.toString()}oTextLayoutRect=nsCommon.Text.layoutText(sText,width,height,this.horizontalAlignment,this.verticalAlignment,this.isWordWrap,this.isEllipsis,this.font);oOutputLayoutRect.width=oTextLayoutRect.totalWidth>16?oTextLayoutRect.totalWidth+2:oTextLayoutRect.totalWidth;oOutputLayoutRect.height=oTextLayoutRect.totalHeight;if(this.angle&&this.angle!==0&&oMatrix){oMatrix.inverse();oPoints.points=[[oOutputLayoutRect.left,oOutputLayoutRect.top],[oOutputLayoutRect.left+oOutputLayoutRect.width,oOutputLayoutRect.top],[oOutputLayoutRect.left+oOutputLayoutRect.width,oOutputLayoutRect.top+oOutputLayoutRect.height],[oOutputLayoutRect.left,oOutputLayoutRect.top+oOutputLayoutRect.height]];oPoints.matrixTransform(oMatrix);oOutputLayoutRect=oPoints.getBBox()}if(oLayoutRect){oOutputLayoutRect.x=oLayoutRect.x;oOutputLayoutRect.y=oLayoutRect.y}else{oOutputLayoutRect.x=x;oOutputLayoutRect.y=y}this.layoutRect=oOutputLayoutRect;this.textWidth=oTextLayoutRect.totalWidth;this.textHeight=oTextLayoutRect.totalHeight;if(bUpdateShape&&!this.isIconFont){this.width=oOutputLayoutRect.width;this.height=oOutputLayoutRect.height}return oOutputLayoutRect}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Circle=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Circle",shapeName:"Circle",shapeCategory:"Standard",statics:{propertiesMap:{cx:"cx",cy:"cy",r:"r"}},properties:{cx:{field:"_cx",get:function(){return this._cx},set:function(nValue){this._cx=sap.galilei.core.validateNumeric(nValue,this._cx,true);this._x=undefined}},cy:{field:"_cy",get:function(){return this._cy},set:function(nValue){this._cy=sap.galilei.core.validateNumeric(nValue,this._cy,true);this._y=undefined}},r:{field:"_r",get:function(){return this._r},set:function(nValue){this._r=sap.galilei.core.validateNumeric(nValue,this._r,true)}},x:{get:function(){if(this.cx!==undefined&&this.r!==undefined){return this.cx-this.r}else{return this._x}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.r!==undefined){this.cx=nValue+this.r}else{this._x=nValue}}},y:{get:function(){if(this.cy!==undefined&&this.r!==undefined){return this.cy-this.r}else{return this._y}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.r!==undefined){this.cy=nValue+this.r}else{this._y=nValue}}},width:{get:function(){if(this.r!==undefined){return this.r*2}else{return this._width}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var x=this.x,y=this.y;nValue=Math.abs(nValue);this.r=nValue/2;this.cx=x+this.r;this.cy=y+this.r}else{this._width=nValue;this._height=nValue}}},height:{get:function(){if(this.r!==undefined){return this.r*2}else{return this._height}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var x=this.x,y=this.y;nValue=Math.abs(nValue);this.r=nValue/2;this.cx=x+this.r;this.cy=y+this.r}else{this._width=nValue;this._height=nValue}}},contentBoxLeft:{configurable:false,get:function(){return this.r*0.297}},contentBoxTop:{configurable:false,get:function(){return this.r*0.297}},contentBoxRight:{configurable:false,get:function(){return this.r*0.297}},contentBoxBottom:{configurable:false,get:function(){return this.r*0.297}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:circle",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,x0=this.x,y0=this.y,width0=this.width,height0=this.height;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);if(this.cx===undefined||this.cy===undefined){if(x0!==undefined&&y0!==undefined&&width0!==undefined&&height0!==undefined){this.cx=x0+width0/2;this.cy=y0+height0/2}}if(this.r===undefined){if(width0!==undefined&&height0!==undefined){this.r=Math.min(width0/2,height0/2)}}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Circle.propertiesMap,nsShape.Circle.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Circle.propertiesMap,nsShape.Circle.convertFromNode,aAttributes);return this.d3Node},getCenter:function(){if(this.cx!==undefined&&this.cy!==undefined){return[this.cx,this.cy]}var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){this.cx=x;this.cy=y},setBBox:function(x,y,width,height){var oRect;if(arguments.length===1){oRect=arguments[0];x=oRect.x;y=oRect.y;width=oRect.width;height=oRect.height}else{if(arguments.length!==4){return}}width=Math.abs(width);height=Math.abs(height);this.cx=x+width/2;this.cy=y+height/2;this.r=Math.min(width,height)/2},getIntersection:function(oSegment,oParentBBox,bIncludeStrokeWidth){if(oSegment){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}if(bIncludeStrokeWidth!==false){oRect=this.inflateStrokeWidth(oRect)}else{oRect.inflate(-1,-1)}return nsCommon.geometry.intersectSegmentEllipse(oSegment,oRect)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return nsCommon.geometry.isPointInEllipse(oPoint,oRect)}return false}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.ContentGroup=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.ContentGroup",shapeName:"ContentGroup",shapeCategory:"Internal",parent:nsShape.Group,properties:{mainShape:undefined,boundaryShape:{get:function(){if(this.mainShape){return this.mainShape.isComposite&&this.mainShape.shapes[0]?this.mainShape.shapes[0]:this.mainShape}return undefined}},contentShape:undefined,displayMode:nsCommon.ShapeLayoutModes.detail,isEnableTranslate:true,isAdjustToContent:true},methods:{layout:function(layoutRect,bUpdateShape){var rect,contentRect=new nsCommon.Rect(),outputLayoutRect=new nsCommon.Rect(),oMatrix,newRect,index,shape,r;if(this.mainShape){if(this.isAdjustToContent&&!bUpdateShape){if(this.displayMode!==nsCommon.ShapeLayoutModes.icon&&this.contentShape){contentRect.set(layoutRect);rect=this.contentShape.layout(contentRect,bUpdateShape);rect=this.contentShape.checkLayoutRect(rect);rect=this.boundaryShape.getMainShapeBox(rect,true);rect=this.boundaryShape.checkLayoutRect(rect);outputLayoutRect.set(rect)}else{contentRect.set(layoutRect);rect=this.boundaryShape.getBBox();rect=this.boundaryShape.checkLayoutRect(rect);outputLayoutRect.set(rect)}}else{rect=this.mainShape.layout(layoutRect,bUpdateShape);rect.width=layoutRect.width;rect.height=layoutRect.height;if(!bUpdateShape){rect=this.boundaryShape.checkLayoutRect(rect)}if(bUpdateShape){oMatrix=new nsCommon.Matrix();r=this.boundaryShape.getBBox();oMatrix.transformRectangles(this.boundaryShape.getBBox(),layoutRect);this.mainShape.setBBox(layoutRect);if(this.mainShape.isComposite){for(index=0;index<this.mainShape.shapes.length;++index){shape=this.mainShape.shapes[index];if(shape.isResizable!==false){newRect=shape.getBBox();newRect.matrixTransform(oMatrix,false);shape.setBBox(layoutRect)}}}}outputLayoutRect.set(rect);if(this.contentShape){contentRect=this.boundaryShape.getContentBox(this.displayMode);if(!bUpdateShape){contentRect=this.contentShape.checkLayoutRect(contentRect)}rect=this.contentShape.layout(contentRect,bUpdateShape);if(this.displayMode!==nsCommon.ShapeLayoutModes.icon){outputLayoutRect.unionRect(rect)}}}}this.layoutRect=outputLayoutRect;return outputLayoutRect}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Ellipse=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Ellipse",shapeName:"Ellipse",shapeCategory:"Standard",statics:{propertiesMap:{cx:"cx",cy:"cy",rx:"rx",ry:"ry"}},properties:{cx:{field:"_cx",get:function(){return this._cx},set:function(nValue){this._cx=sap.galilei.core.validateNumeric(nValue,this._cx,true)}},cy:{field:"_cy",get:function(){return this._cy},set:function(nValue){this._cy=sap.galilei.core.validateNumeric(nValue,this._cy,true)}},rx:{field:"_rx",get:function(){return this._rx},set:function(nValue){this._rx=sap.galilei.core.validateNumeric(nValue,this._rx,true)}},ry:{field:"_ry",get:function(){return this._ry},set:function(nValue){this._ry=sap.galilei.core.validateNumeric(nValue,this._ry,true)}},x:{get:function(){if(this.cx!==undefined&&this.rx!==undefined){return this.cx-this.rx}else{return this._x}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.rx!==undefined){this.cx=nValue+this.rx}else{this._x=nValue}}},y:{get:function(){if(this.cy!==undefined&&this.ry!==undefined){return this.cy-this.ry}else{return this._y}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.ry!==undefined){this.cy=nValue+this.ry}else{this._y=nValue}}},width:{get:function(){if(this.rx!==undefined){return this.rx*2}else{return this._width}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var x=this.x;nValue=Math.abs(nValue);this.rx=nValue/2;this.cx=x+this.rx}else{this._width=nValue}}},height:{get:function(){if(this.ry!==undefined){return this.ry*2}else{return this._height}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var y=this.y;nValue=Math.abs(nValue);this.ry=nValue/2;this.cy=y+this.ry}else{this._height=nValue}}},contentBoxLeft:{configurable:false,get:function(){return this.rx*0.297}},contentBoxTop:{configurable:false,get:function(){return this.ry*0.297}},contentBoxRight:{configurable:false,get:function(){return this.rx*0.297}},contentBoxBottom:{configurable:false,get:function(){return this.ry*0.297}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:ellipse",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,x0=this.x,y0=this.y,width0=this.width,height0=this.height;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);if(this.cx===undefined||this.cy===undefined){if(x0!==undefined&&y0!==undefined&&width0!==undefined&&height0!==undefined){this.cx=x0+width0/2;this.cy=y0+height0/2}}if(this.rx===undefined||this.ry===undefined){if(x0!==undefined&&y0!==undefined&&width0!==undefined&&height0!==undefined){this.rx=width0/2;this.ry=height0/2}}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Ellipse.propertiesMap,nsShape.Ellipse.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Ellipse.propertiesMap,nsShape.Ellipse.convertFromNode,aAttributes);return this.d3Node},getCenter:function(){if(this.cx!==undefined&&this.cy!==undefined){return[this.cx,this.cy]}var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){this.cx=x;this.cy=y},setBBox:function(x,y,width,height){var oRect;if(arguments.length===1){oRect=arguments[0];x=oRect.x;y=oRect.y;width=oRect.width;height=oRect.height}else{if(arguments.length!==4){return}}width=Math.abs(width);height=Math.abs(height);this.cx=x+width/2;this.cy=y+height/2;this.rx=width/2;this.ry=height/2},getIntersection:function(oSegment,oParentBBox,bIncludeStrokeWidth){if(oSegment){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}if(bIncludeStrokeWidth!==false){oRect=this.inflateStrokeWidth(oRect)}else{oRect.inflate(-1,-1)}return nsCommon.geometry.intersectSegmentEllipse(oSegment,oRect)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return nsCommon.geometry.isPointInEllipse(oPoint,oRect)}return false}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.IconFont=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.IconFont",parent:nsShape.Text,shapeName:"IconFont",shapeCategory:"Standard",fields:{_collectionName:undefined,_iconName:undefined},properties:{isIconFont:true,src:{field:"_src",get:function(){return this.getFieldOrBindValue("_src")},set:function(vValue){this.setFieldOrBindValue("_src",vValue,true);this._parseIconURI()}},size:{value:16,get:function(){return this._size},set:function(vSize){if(vSize!=undefined){if(typeof(vSize)==="string"&&vSize.indexOf("px")!==-1){vSize=vSize.substring(0,vSize.length-2)}vSize=+vSize;if(this.width!==vSize||this.width+"px"==this.fontSize){this._width=vSize}if(this.height!==vSize||this.height+"px"==this.fontSize){this._height=vSize}vSize=""+vSize+"px";this.fontSize=vSize}}},fontSize:"16px",width:{field:"_width",value:16,get:function(){return this._width},set:function(nWidth){this._width=nWidth;if(this.size!==nWidth){this.size=nWidth}}},height:{field:"_height",value:16,get:function(){return this._height},set:function(nHeight){this._height=nHeight;if(this.size!==nHeight){this.size=nHeight}}}},methods:{_parseIconURI:function(){var sSrc=this.src,index,sCollectionAndIconName,oIconInfo;if(sSrc){if(sSrc.substring(0,11)==="sap-icon://"){index=sSrc.indexOf(":");sCollectionAndIconName=sSrc.slice(index+3);index=sCollectionAndIconName.indexOf("/");if(index!==-1){this._collectionName=sCollectionAndIconName.slice(0,index);this._iconName=sCollectionAndIconName.slice(index+1)}else{this._iconName=sCollectionAndIconName}if(this._iconName){oIconInfo=sap.galilei.ui.common.IconPool.getIconInfo(this._iconName,this._collectionName);if(oIconInfo){this.fontFamily=oIconInfo.fontFamily;this.text=this._makeChar(oIconInfo.content)}}}else{console.log("Icon font URI "+sSrc+" is not supported.")}}},_makeChar:function(sCode){return String.fromCharCode(typeof sCode==="number"?sCode:parseInt(sCode,16))}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Image=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Image",shapeName:"Image",shapeCategory:"Standard",statics:{propertiesMap:{x:"x",y:"y",width:"width",height:"height",href:"xlink:href"},convertToNode:function(viewer,shape,sShapeProp,sNodeProp,vValue){var sHRef,value;if(viewer&&shape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"href":sHRef=shape.href||"#Icons.invisible-icon";if(sHRef&&sHRef.length>0&&sHRef[0]==="#"){try{value=viewer.libraries.getShapeUrl(sHRef.substr(1))}catch(e){return vValue}vValue=value}break}}return vValue}},properties:{isSupportStroke:false,isSupportFill:false,x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){if(this.href&&this.isVisible!==false){return this._width}return 0},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){if(this.href&&this.isVisible!==false){return this._height}return 0},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},useReference:false,href:{field:"_href",get:function(){return this.getFieldOrBindValue("href")},set:function(vValue){this.setFieldOrBindValue("href",vValue)}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var svgTag="svg:image";if(this.useReference||(this.href!=undefined&&this.href.length>0&&this.href[0]==="#")){this.useReference=true;svgTag="svg:use"}return this.createNode(svgTag,oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}if(this.width!==Math.abs(this.width)){this.width=Math.abs(this.width)}if(this.height!==Math.abs(this.height)){this.height=Math.abs(this.height)}if(this.href&&aAttributes){if(aAttributes.indexOf("width")===-1){aAttributes.push("width")}if(aAttributes.indexOf("height")===-1){aAttributes.push("height")}}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Image.propertiesMap,nsShape.Image.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Image.propertiesMap,nsShape.Image.convertFromNode,aAttributes);return this.d3Node}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.List=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.List",shapeName:"List",shapeCategory:"Internal",parent:nsShape.Stack,fields:{_dataItems:undefined,_needRefresh:true},properties:{orientation:{get:function(){return nsCommon.Orientation.vertical}},rowMarginLeft:4,rowMarginRight:4,rowMarginTop:4,rowMarginBottom:4,rowPadding:0,objectContext:{onChange:function(newValue,oldValue){this._items=undefined;this._dataItems=undefined;this._needRefresh=true}},items:{get:function(){if(this._items){return this._items}return this.getPropertyValue("items")},set:function(vValue){if(vValue!==undefined){if(!this.bindProperty("items",vValue)){this._items=vValue}}else{this._items=undefined}},onChange:function(newValue,oldValue){this._dataItems=undefined;this._needRefresh=true}},isCollapsed:false,totalItems:{get:function(){var aDataItems=this.getItems();if(!this.isCollapsed&&aDataItems){return aDataItems.length}return 0}},itemTemplate:{onChange:function(newValue,oldValue){this._needRefresh=true}},firstItem:{field:"_firstItem",value:0,get:function(){if(!this.isCollapsed&&this._firstItem>=0&&this._firstItem<this.totalItems){return this._firstItem}return 0},set:function(nFirst){if(!isNaN(nFirst)&&nFirst!==this._firstItem&&nFirst>=0){this._firstItem=nFirst;this._needRefresh=true}}},lastItem:{get:function(){var nFirst=this.firstItem,nMax=this.totalItems;if(!this.isCollapsed){if(!isNaN(this.maximumItems)&&this.maximumItems>0){nMax=Math.min(nMax,this.maximumItems)}if(nMax>0){nMax--}return nFirst+nMax}return 0}},maximumItems:{value:10,onChange:function(newValue,oldValue){this._needRefresh=true}}},methods:{getItems:function(){if(!this._dataItems){this._dataItems=this.items}return this._dataItems},defaultCreateItemShape:function(index,oItem,vItemTemplate,sItemsPropertyName){var oItemShape;if(oItem&&vItemTemplate){if(typeof vItemTemplate==="function"){vItemTemplate=vItemTemplate.call(undefined,this,index,oItem)}oItemShape=nsShape.ShapeSerializer.load(vItemTemplate);if(oItemShape){oItemShape.itemContext=new nsCommon.binding.ItemContext({parentShape:this,itemsPropertyName:sItemsPropertyName,itemIndex:index});oItemShape.objectContext=oItem}}return oItemShape},createItemShape:function(index,oItem,vItemTemplate,sItemsPropertyName){return this.defaultCreateItemShape(index,oItem,vItemTemplate,sItemsPropertyName)},createItemShapes:function(oViewer,oTransitionDef){this._items=undefined;this._dataItems=undefined;var sItemsPropertyName="items",oBinding=this.getBinding(sItemsPropertyName),aItems=this.getItems(),index,nFirstItem=this.firstItem,nLastItem=this.lastItem,oItem,oItemShape;if(oBinding&&oBinding.template){if(aItems&&aItems.length>0){this.removeAllSubShapes(oViewer,oTransitionDef);for(index=nFirstItem;index<=nLastItem;index++){if(aItems instanceof Array){oItem=aItems[index]}else{if(aItems.get){oItem=aItems.get(index)}}oItemShape=this.createItemShape(index,oItem,oBinding.template,sItemsPropertyName);if(oItemShape){this.addSubShape(oItemShape)}}}}this._needRefresh=false},updateItemShapes:function(oViewer,oTransitionDef){this._items=undefined;this._dataItems=undefined;var self=this,aOldItemShapes=[],sItemsPropertyName="items",oBinding=this.getBinding(sItemsPropertyName),aItems=this.getItems(),index,nFirstItem=this.firstItem,nLastItem=this.lastItem,oItem,oItemShape;function getOldItemShapes(){var i;for(i=0;i<self.shapes.length;i++){aOldItemShapes.push(self.shapes[i])}}function findItemShape(oItem){var i,oOldItemShape;for(i=0;i<aOldItemShapes.length;i++){oOldItemShape=aOldItemShapes[i];if(oOldItemShape.objectContext===oItem){if(oOldItemShape.itemContext){oOldItemShape.itemContext.itemIndex=i}aOldItemShapes.splice(i,1);return oOldItemShape}}return undefined}function removeOldItemShapes(){var i,oOldItemShape;for(i=0;i<aOldItemShapes.length;i++){oOldItemShape=aOldItemShapes[i];oOldItemShape.remove(oViewer,oTransitionDef)}}getOldItemShapes();this.shapes.clear();if(oBinding&&oBinding.template){if(aItems&&aItems.length>0){for(index=nFirstItem;index<=nLastItem;index++){if(aItems instanceof Array){oItem=aItems[index]}else{if(aItems.get){oItem=aItems.get(index)}}oItemShape=findItemShape(oItem);if(!oItemShape){oItemShape=this.createItemShape(index,oItem,oBinding.template,sItemsPropertyName)}if(oItemShape){this.addSubShape(oItemShape)}}}}removeOldItemShapes();this._needRefresh=false},createContent:function(oViewer,oTransitionDef){this.createItemShapes(oViewer,oTransitionDef);this.layoutItems()},updateContent:function(oViewer,oTransitionDef){this.updateItemShapes(oViewer,oTransitionDef);this.layoutItems()},_getListLayoutOptions:function(){var oOptions={};oOptions.paddingLeft=this.paddingLeft;oOptions.paddingTop=this.paddingTop;oOptions.paddingRight=this.paddingRight;oOptions.paddingBottom=this.paddingBottom;oOptions.rowMarginLeft=this.rowMarginLeft;oOptions.rowMarginTop=this.rowMarginTop;oOptions.rowMarginRight=this.rowMarginRight;oOptions.rowMarginBottom=this.rowMarginBottom;oOptions.columnInnerPadding=this.columnPadding;oOptions.rowInnerPadding=this.rowPadding;oOptions=nsShape.List.checkLayoutOptions(oOptions);return oOptions},_getLayoutOptions:function(){return this._getListLayoutOptions()},layoutItems:function(){var oLayoutRect=this.getBBox(),oOptions=this._getLayoutOptions();oLayoutRect.width-=oOptions.paddingLeft+oOptions.paddingRight;oLayoutRect.height=undefined;oLayoutRect=this.layout(oLayoutRect,false);oLayoutRect=this.layout(oLayoutRect,true);this.width=oLayoutRect.width+oOptions.paddingLeft+oOptions.paddingRight;this.height=oLayoutRect.height+oOptions.paddingTop+oOptions.paddingBottom},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var oLayoutRect=this.getBBox(),d3Node;this.layoutItems();d3Node=this.defaultDraw(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector);return d3Node},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oLayoutRect=this.getBBox(),d3Node;this.layoutItems();d3Node=this.defaultUpdateDrawing(oViewer,oTransitionDef,aAttributes);return d3Node}},statics:{checkLayoutOptions:function(oOptions){oOptions=oOptions||{};if(isNaN(oOptions.paddingLeft)){oOptions.paddingLeft=0}if(isNaN(oOptions.paddingTop)){oOptions.paddingTop=0}if(isNaN(oOptions.paddingRight)){oOptions.paddingRight=0}if(isNaN(oOptions.paddingBottom)){oOptions.paddingBottom=0}if(isNaN(oOptions.rowMarginLeft)){oOptions.rowMarginLeft=4}if(isNaN(oOptions.rowMarginTop)){oOptions.rowMarginTop=4}if(isNaN(oOptions.rowMarginRight)){oOptions.rowMarginRight=4}if(isNaN(oOptions.rowMarginBottom)){oOptions.rowMarginBottom=4}if(isNaN(oOptions.rowInnerPadding)){oOptions.rowInnerPadding=0}return oOptions}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Panel=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Panel",shapeName:"Panel",shapeCategory:"Internal",properties:{isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.COMPOSITE,value:nsShape.ShapeStates.COMPOSITE,writable:false,configurable:false},isTransparent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:nsShape.ShapeStates.TRANSPARENT,value:nsShape.ShapeStates.TRANSPARENT,writable:false,configurable:false},isFixedDocking:false,x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},innerPadding:{field:"_innerPadding",value:0,get:function(){return this._innerPadding},set:function(nValue){this._innerPadding=sap.galilei.core.validateNumeric(nValue,this._innerPadding)}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var d3Parent,index,shape;if(oViewer){if(!d3ParentNode){d3Parent=oViewer.d3MainShapeLayer}else{d3Parent=d3ParentNode}}for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.draw(oViewer,d3Parent,oTransitionDef)}return d3ParentNode},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,index,shape;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];if(shape.isDrawn){shape.updateDrawing(oViewer,oTransitionDef,aAttributes)}else{shape.draw(oViewer,undefined,oTransitionDef)}}return this.d3Node},layout:function(layoutRect,bUpdateShape){var outputLayoutRect=new nsCommon.Rect(),x,y,width,height;if(layoutRect){x=layoutRect.x;y=layoutRect.y;if(x===undefined){x=this.x}if(y===undefined){y=this.y}if(layoutRect.width!==undefined&&layoutRect.width!==0){width=layoutRect.width}if(layoutRect.height!==undefined&&layoutRect.height!==0){height=layoutRect.height}}else{x=this.x;y=this.y}outputLayoutRect.set(x,y,width,height);return nsShape.Panel.layout(this,this.shapes,outputLayoutRect,bUpdateShape)}},statics:{layout:function(oPanelShape,cShapes,layoutRect,bUpdateShape){var outputLayoutRect=new nsCommon.Rect(),x,y,width,height,index,shape,shapeX,shapeY,shapeWidth,shapeHeight,left,top,right,bottom,paddingLeft=0,paddingTop=0,paddingRight=0,paddingBottom=0,sHorzAlignment,sVertAlignment,childRect=new nsCommon.Rect(),innerWidth,innerHeight,innerLeft,innerTop,innerRight,innerBottom,nLeftSize=0,nTopSize=0,nRightSize=0,nBottomSize=0;if(cShapes&&layoutRect){x=layoutRect.x;y=layoutRect.y;width=layoutRect.width;height=layoutRect.height;x=sap.galilei.core.validateNumeric(x,0);y=sap.galilei.core.validateNumeric(y,0);width=sap.galilei.core.validateNumeric(width);height=sap.galilei.core.validateNumeric(height);if(bUpdateShape&&oPanelShape){oPanelShape.width=width;oPanelShape.height=height}outputLayoutRect.set(x,y,width,height);left=x;top=y;right=x+width;bottom=y+height;innerWidth=width;innerHeight=height;if(oPanelShape){paddingLeft=oPanelShape.paddingLeft;paddingTop=oPanelShape.paddingTop;paddingRight=oPanelShape.paddingRight;paddingBottom=oPanelShape.paddingBottom;paddingLeft=sap.galilei.core.validateNumeric(paddingLeft,0);paddingTop=sap.galilei.core.validateNumeric(paddingTop,0);paddingRight=sap.galilei.core.validateNumeric(paddingRight,0);paddingBottom=sap.galilei.core.validateNumeric(paddingBottom,0)}left+=paddingLeft;top+=paddingTop;if(width!==undefined&&width!==0){innerWidth=width-paddingLeft-paddingRight;right=left+innerWidth}if(height!==undefined&&height!==0){innerHeight=height-paddingTop-paddingBottom;bottom=top+innerHeight}innerLeft=left;innerTop=top;innerRight=right;innerBottom=bottom;for(index=0;index<cShapes.length;++index){shape=cShapes[index];shapeX=shape.x;shapeY=shape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(!bUpdateShape){childRect.set(shapeX,shapeY,width,height);shape.layout(childRect,false)}else{if(oPanelShape&&oPanelShape.layoutRect&&(oPanelShape.layoutRect.width!==width||oPanelShape.layoutRect.height!==height)){childRect.set(shapeX,shapeY,innerWidth-shape.marginRight,innerHeight-shape.marginBottom);shape.layout(childRect,false)}}}if(bUpdateShape){for(index=0;index<cShapes.length;++index){shape=cShapes[index];shapeX=shape.x;shapeY=shape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(shape.layoutRect){shapeWidth=shape.layoutRect.width;shapeHeight=shape.layoutRect.height}else{shapeWidth=shape.width;shapeHeight=shape.height}sHorzAlignment=shape.horizontalAlignment;sVertAlignment=shape.verticalAlignment;switch(shape.dockPosition){case nsCommon.DockPosition.topLeft:if(oPanelShape&&!oPanelShape.isFixedDocking){nTopSize=Math.max(nTopSize,shape.marginTop+shapeHeight+shape.marginBottom);nLeftSize=Math.max(nLeftSize,shape.marginLeft+shapeWidth+shape.marginRight)}sVertAlignment=nsCommon.VerticalAlignment.top;sHorzAlignment=nsCommon.HorizontalAlignment.left;break;case nsCommon.DockPosition.top:if(oPanelShape&&!oPanelShape.isFixedDocking){nTopSize=Math.max(nTopSize,shape.marginTop+shapeHeight+shape.marginBottom)}sVertAlignment=nsCommon.VerticalAlignment.top;if(!sHorzAlignment){sHorzAlignment=nsCommon.HorizontalAlignment.center}break;case nsCommon.DockPosition.topRight:if(oPanelShape&&!oPanelShape.isFixedDocking){nTopSize=Math.max(nTopSize,shape.marginTop+shapeHeight+shape.marginBottom);nRightSize=Math.max(nRightSize,shape.marginLeft+shapeWidth+shape.marginRight)}sVertAlignment=nsCommon.VerticalAlignment.top;sHorzAlignment=nsCommon.HorizontalAlignment.right;break;case nsCommon.DockPosition.right:if(oPanelShape&&!oPanelShape.isFixedDocking){nRightSize=Math.max(nRightSize,shape.marginLeft+shapeWidth+shape.marginRight)}sHorzAlignment=nsCommon.HorizontalAlignment.right;if(!sVertAlignment){sVertAlignment=nsCommon.VerticalAlignment.middle}break;case nsCommon.DockPosition.bottomRight:if(oPanelShape&&!oPanelShape.isFixedDocking){nBottomSize=Math.max(nBottomSize,shape.marginTop+shapeHeight+shape.marginBottom);nRightSize=Math.max(nRightSize,shape.marginLeft+shapeWidth+shape.marginRight)}sVertAlignment=nsCommon.VerticalAlignment.bottom;sHorzAlignment=nsCommon.HorizontalAlignment.right;break;case nsCommon.DockPosition.bottom:if(oPanelShape&&!oPanelShape.isFixedDocking){nBottomSize=Math.max(nBottomSize,shape.marginTop+shapeHeight+shape.marginBottom)}sVertAlignment=nsCommon.VerticalAlignment.bottom;if(!sHorzAlignment){sHorzAlignment=nsCommon.HorizontalAlignment.center}break;case nsCommon.DockPosition.bottomLeft:if(oPanelShape&&!oPanelShape.isFixedDocking){nBottomSize=Math.max(nBottomSize,shape.marginTop+shapeHeight+shape.marginBottom);nLeftSize=Math.max(nLeftSize,shape.marginLeft+shapeWidth+shape.marginRight)}sVertAlignment=nsCommon.VerticalAlignment.bottom;sHorzAlignment=nsCommon.HorizontalAlignment.left;break;case nsCommon.DockPosition.left:if(oPanelShape&&!oPanelShape.isFixedDocking){nLeftSize=Math.max(nLeftSize,shape.marginLeft+shapeWidth+shape.marginRight)}sHorzAlignment=nsCommon.HorizontalAlignment.left;if(!sVertAlignment){sVertAlignment=nsCommon.VerticalAlignment.middle}break}switch(sHorzAlignment){case nsCommon.HorizontalAlignment.right:shapeX=right-shapeWidth-shape.marginRight;break;case nsCommon.HorizontalAlignment.left:shapeX=left+shape.marginLeft;break}switch(sVertAlignment){case nsCommon.VerticalAlignment.bottom:shapeY=bottom-shapeHeight-shape.marginBottom;break;case nsCommon.VerticalAlignment.top:shapeY=top+shape.marginTop;break}if(shapeX!==shape.x||shapeY!==shape.y){shape.moveTo(shapeX,shapeY)}}if(oPanelShape&&!oPanelShape.isFixedDocking){innerLeft+=nLeftSize;innerTop+=nTopSize;innerRight-=nRightSize;innerBottom-=nBottomSize}innerWidth=innerRight-innerLeft;innerHeight=innerBottom-innerTop;for(index=0;index<cShapes.length;++index){shape=cShapes[index];shapeX=shape.x;shapeY=shape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(shape.layoutRect){shapeWidth=shape.layoutRect.width;shapeHeight=shape.layoutRect.height}else{shapeWidth=shape.width;shapeHeight=shape.height}sHorzAlignment=shape.horizontalAlignment;sVertAlignment=shape.verticalAlignment;switch(shape.dockPosition){case nsCommon.DockPosition.top:if(!sHorzAlignment){sHorzAlignment=nsCommon.HorizontalAlignment.center}break;case nsCommon.DockPosition.right:if(!sVertAlignment){sVertAlignment=nsCommon.VerticalAlignment.middle}break;case nsCommon.DockPosition.bottom:if(!sHorzAlignment){sHorzAlignment=nsCommon.HorizontalAlignment.center}break;case nsCommon.DockPosition.left:if(!sVertAlignment){sVertAlignment=nsCommon.VerticalAlignment.middle}break;case nsCommon.DockPosition.center:sHorzAlignment=nsCommon.HorizontalAlignment.center;sVertAlignment=nsCommon.VerticalAlignment.middle;break;case nsCommon.DockPosition.width:if(!sHorzAlignment){sHorzAlignment=nsCommon.HorizontalAlignment.width}break;case nsCommon.DockPosition.height:if(!sVertAlignment){sVertAlignment=nsCommon.VerticalAlignment.height}break;case nsCommon.DockPosition.maximize:if(!sHorzAlignment){sHorzAlignment=nsCommon.HorizontalAlignment.width}if(!sVertAlignment){sVertAlignment=nsCommon.VerticalAlignment.height}break}switch(sHorzAlignment){case nsCommon.HorizontalAlignment.center:shapeX=innerLeft+Math.round((innerWidth-shapeWidth)/2)+shape.marginLeft;break;case nsCommon.HorizontalAlignment.width:shapeX=innerLeft+shape.marginLeft;shapeWidth=innerWidth-shape.marginLeft-shape.marginRight;break}switch(sVertAlignment){case nsCommon.VerticalAlignment.middle:shapeY=innerTop+Math.round((innerHeight-shapeHeight)/2)+shape.marginTop;break;case nsCommon.VerticalAlignment.height:shapeY=innerTop+shape.marginTop;shapeHeight=innerHeight-shape.marginTop-shape.marginBottom;break}if(shapeX!==shape.x||shapeY!==shape.y){shape.moveTo(shapeX,shapeY)}if(shapeWidth!==undefined){if(shape.width!==shapeWidth){shape.width=shapeWidth}if(shape.layoutRect){shape.layoutRect.width=shapeWidth}}if(shapeHeight!==undefined){if(shape.height!==shapeHeight){shape.height=shapeHeight}if(shape.layoutRect){shape.layoutRect.height=shapeHeight}}}}if(oPanelShape){oPanelShape.layoutRect=new nsCommon.Rect(outputLayoutRect)}}return outputLayoutRect}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Polygon=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Polygon",shapeName:"Polygon",shapeCategory:"Standard",statics:{propertiesMap:{points:"d"},convertToNode:function(viewer,shape,sShapeProp,sNodeProp,vValue){if(viewer&&shape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"points":if(shape.path){vValue=shape.path}else{vValue=shape.generatePath()}break}}return vValue}},properties:{isGeneratePoints:false,points:{field:"_points",get:function(){if(!this._points){this._points=new nsCommon.Points()}return this._points},set:function(value){if(sap.galilei.core.isInstanceOf(value,nsCommon.Points)){this._points=value}else{if((value instanceof Array)||(typeof value==="string")){this.points.points=value}}}},lineStyle:nsCommon.LineStyle.DEFAULT,roundedCornerSize:{field:"_roundedCornerSize",value:nsCommon.Path.ROUNDED_CORNER_SIZE,get:function(){return this._roundedCornerSize},set:function(nValue){this._roundedCornerSize=sap.galilei.core.validateNumeric(nValue,this._roundedCornerSize)}},x:{field:"_x",get:function(){var oRect;if(!isNaN(this._x)){return this._x}if(!this.isGeneratePoints){oRect=this.getBBox();if(oRect){return oRect.x}}return 0},set:function(nValue){var x;nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;if(!this.isGeneratePoints){x=+this.x}this._x=nValue;if(!this.isGeneratePoints){if(x!==undefined&&!isNaN(x)&&nValue!==x){this.moveBy(nValue-x,0)}}}}},y:{field:"_y",get:function(){var oRect;if(!isNaN(this._y)){return this._y}if(!this.isGeneratePoints){oRect=this.getBBox();if(oRect){return oRect.y}}return 0},set:function(nValue){var y;nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;if(!this.isGeneratePoints){y=+this.y}this._y=nValue;if(!this.isGeneratePoints){if(y!==undefined&&!isNaN(y)&&nValue!==y){this.moveBy(0,nValue-y)}}}}},width:{field:"_width",get:function(){var oRect;if(!isNaN(this._width)){return this._width}if(!this.isGeneratePoints){oRect=this.getBBox();if(oRect){return oRect.width}}return 0},set:function(nValue){var oldRect,newRect,oMatrix;nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;if(!this.isGeneratePoints){oldRect=this.getBBox()}this._width=nValue;if(!this.isGeneratePoints){if(oldRect&&nValue!==oldRect.width){newRect=oldRect.clone();newRect.width=nValue;oMatrix=new nsCommon.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}}},height:{field:"_height",get:function(){var oRect;if(!isNaN(this._height)){return this._height}if(!this.isGeneratePoints){oRect=this.getBBox();if(oRect){return oRect.height}}return 0},set:function(nValue){var oldRect,newRect,oMatrix;nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;if(!this.isGeneratePoints){oldRect=this.getBBox()}this._height=nValue;if(!this.isGeneratePoints){if(oldRect&&nValue!==oldRect.height){newRect=oldRect.clone();newRect.height=nValue;oMatrix=new nsCommon.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:path",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},generatePath:function(){var sPath;switch(this.lineStyle){case nsCommon.LineStyle.rounded:sPath=nsCommon.Path.generateRoundedPath(this.points,this.roundedCornerSize,true);break;case nsCommon.LineStyle.bezier:sPath=nsCommon.Path.generateQuadraticBezierFromPoints(this.points,true);break;case nsCommon.LineStyle.halfBezier:sPath=nsCommon.Path.generateHalfCubicBezierFromPoints(this.points,true);break;default:sPath=nsCommon.Path.generatePolylinePath(this.points,true);break}return sPath},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Polygon.propertiesMap,nsShape.Polygon.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Polygon.propertiesMap,nsShape.Polygon.convertFromNode,aAttributes);return this.d3Node},flipHorizontal:function(){if(!this.isGeneratePoints){this.points.flipHorizontal()}},flipVertical:function(){if(!this.isGeneratePoints){this.points.flipVertical()}},getBBox:function(){if(!this.isGeneratePoints){return this.points.getBBox()}else{return this.defaultGetBBox()}},getIntersection:function(oSegment,oParentBBox){if(oSegment){var oRect=this.getBBox(),oPoints=this.points;if(oParentBBox){oPoints=this.points.clone();oPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}return nsCommon.geometry.intersectSegmentPolygon(oSegment,oPoints)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox(),oPoints=this.points;if(oParentBBox){oPoints=this.points.clone();oPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}return nsCommon.geometry.isPointInPolygon(oPoint,oPoints)}return false},moveBy:function(dx,dy){if(!this.isGeneratePoints){this.points.moveBy(dx,dy)}else{this.defaultMoveBy(dx,dy)}}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Polyline=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Polyline",shapeName:"Polyline",shapeCategory:"Standard",statics:{propertiesMap:{points:"d",markerStart:"marker-start",markerMiddle:"marker-mid",markerEnd:"marker-end"},convertToNode:function(oViewer,oShape,sShapeProp,sNodeProp,vValue){if(oViewer&&oShape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"points":if(oShape.path){vValue=oShape.path}else{vValue=oShape.generatePath()}break;case"markerStart":if(oShape.markerStart){vValue=oViewer.libraries.getMarkerUrl(oShape.markerStart,oShape.stroke)}else{vValue=undefined}break;case"markerMiddle":if(oShape.markerMiddle){vValue=oViewer.libraries.getMarkerUrl(oShape.markerMiddle,oShape.stroke)}else{vValue=undefined}break;case"markerEnd":if(oShape.markerEnd){vValue=oViewer.libraries.getMarkerUrl(oShape.markerEnd,oShape.stroke)}else{vValue=undefined}break}}return vValue}},properties:{points:{field:"_points",get:function(){if(!this._points){this._points=new nsCommon.Points()}return this._points},set:function(value){if(sap.galilei.core.isInstanceOf(value,nsCommon.Points)){this._points=value}else{if((value instanceof Array)||(typeof value==="string")){this.points.points=value}}}},lineStyle:{field:"_lineStyle",value:nsCommon.LineStyle.DEFAULT,get:function(){return this.getFieldOrBindValue("lineStyle")},set:function(nValue){this.setFieldOrBindValue("lineStyle",nValue)}},layoutStyle:{field:"_layoutStyle",value:nsCommon.LayoutStyle.DEFAULT,get:function(){return this.getFieldOrBindValue("layoutStyle")},set:function(nValue){this.setFieldOrBindValue("layoutStyle",nValue)}},roundedCornerSize:{field:"_roundedCornerSize",value:nsCommon.Path.ROUNDED_CORNER_SIZE,get:function(){return this._roundedCornerSize},set:function(nValue){this._roundedCornerSize=sap.galilei.core.validateNumeric(nValue,this._roundedCornerSize)}},fill:{value:"none",writable:false},isSupportFill:false,x:{get:function(){var rect=this.getBBox();return rect.x},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var x=+this.x;if(x!==undefined&&!isNaN(x)&&nValue!==x){this.moveBy(nValue-x,0)}}}},y:{get:function(){var rect=this.getBBox();return rect.y},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var y=+this.y;if(y!==undefined&&!isNaN(y)&&nValue!==y){this.moveBy(0,nValue-y)}}}},width:{get:function(){var rect=this.getBBox();return rect.width},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var oldRect=this.getBBox(),newRect,oMatrix;if(oldRect&&nValue!==oldRect.width){newRect=oldRect.clone();newRect.width=nValue;oMatrix=new nsCommon.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}},height:{get:function(){var rect=this.getBBox();return rect.height},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var oldRect=this.getBBox(),newRect,oMatrix;if(oldRect&&nValue!==oldRect.height){newRect=oldRect.clone();newRect.height=nValue;oMatrix=new nsCommon.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}},markerStart:undefined,markerEnd:undefined,markerMiddle:undefined},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:path",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},generatePath:function(){var sPath;switch(this.lineStyle){case nsCommon.LineStyle.rounded:sPath=nsCommon.Path.generateRoundedPath(this.points,this.roundedCornerSize);break;case nsCommon.LineStyle.bezier:sPath=nsCommon.Path.generateQuadraticBezierFromPoints(this.points);break;case nsCommon.LineStyle.halfBezier:sPath=nsCommon.Path.generateHalfCubicBezierFromPoints(this.points);break;case nsCommon.LineStyle.streight:sPath=nsCommon.Path.generateStreightLineFromPoints(this.points);break;case nsCommon.LineStyle.horzDiagonalBezier:case nsCommon.LineStyle.vertDiagonalBezier:sPath=nsCommon.Path.generateDiagonalBezierFromPoints(this.points,(this.lineStyle===nsCommon.LineStyle.horzDiagonalBezier));break;case nsCommon.LineStyle.horzDiagonal:case nsCommon.LineStyle.vertDiagonal:sPath=nsCommon.Path.generateDiagonalFromPoints(this.points,(this.lineStyle===nsCommon.LineStyle.horzDiagonal));break;default:sPath=nsCommon.Path.generatePolylinePath(this.points);break}return sPath},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,self=this,bFixIE=false,sMarkerStart,sMarkerMiddle,sMarkerEnd,sMarkerStartUrl,sMarkerMiddleUrl,sMarkerEndUrl,sColor,delay=15;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);if(this.d3Node&&(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("rv:11.0")!==-1)&&(this.markerStart||this.markerMiddle||this.markerEnd)){bFixIE=true;sMarkerStart=this.markerStart;sMarkerMiddle=this.markerMiddle;sMarkerEnd=this.markerEnd;sColor=this.stroke;this.markerStart=undefined;this.markerMiddle=undefined;this.markerEnd=undefined;if(sMarkerStart){sMarkerStartUrl=this.d3Node.attr("marker-start");this.d3Node.attr("marker-start",null)}if(sMarkerMiddle){sMarkerMiddleUrl=this.d3Node.attr("marker-mid");this.d3Node.attr("marker-mid",null)}if(sMarkerEnd){sMarkerEndUrl=this.d3Node.attr("marker-end");this.d3Node.attr("marker-end",null)}}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Polyline.propertiesMap,nsShape.Polyline.convertToNode,aAttributes);if(this.d3Node&&bFixIE){this.markerStart=sMarkerStart;this.markerMiddle=sMarkerMiddle;this.markerEnd=sMarkerEnd;if(oTransitionDef){delay=oTransitionDef.duration}setTimeout(function(){if(sMarkerStart){if(!sMarkerStartUrl){sMarkerStartUrl=oViewer.libraries.getMarkerUrl(sMarkerStart,sColor)}if(self.d3Node&&sMarkerStartUrl){self.d3Node.attr("marker-start",sMarkerStartUrl)}}if(sMarkerMiddle){if(!sMarkerMiddleUrl){sMarkerMiddleUrl=oViewer.libraries.getMarkerUrl(sMarkerMiddle,sColor)}if(self.d3Node&&sMarkerMiddleUrl){self.d3Node.attr("marker-mid",sMarkerMiddleUrl)}}if(sMarkerEnd){if(!sMarkerEndUrl){sMarkerEndUrl=oViewer.libraries.getMarkerUrl(sMarkerEnd,sColor)}if(self.d3Node&&sMarkerEndUrl){self.d3Node.attr("marker-end",sMarkerEndUrl)}}},delay)}return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Shape.propertiesMap,nsShape.Shape.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(oViewer,this,this.d3Node,nsShape.Polyline.propertiesMap,nsShape.Polyline.convertFromNode,aAttributes);return this.d3Node},getBBox:function(){return this.points.getBBox()},isHorizontal:function(nDelta){return this.points.isHorizontal(nDelta)},isVertical:function(nDelta){return this.points.isVertical(nDelta)},isPointOnBorder:function(vPoint,oParentBBox,nRadius){var oRect,aPoints,bResult=false;if(vPoint){oRect=this.getBBox();aPoints=this.points;if(oParentBBox&&aPoints&&aPoints.clone){aPoints=aPoints.clone();aPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}if(aPoints&&aPoints.length>=2){switch(this.lineStyle){case nsCommon.LineStyle.bezier:bResult=nsCommon.geometry.isPointOnBezier(vPoint,aPoints,false,nRadius);break;case nsCommon.LineStyle.halfBezier:bResult=nsCommon.geometry.isPointOnPolyline(vPoint,aPoints,nRadius);break;case nsCommon.LineStyle.horzDiagonalBezier:bResult=nsCommon.geometry.isPointOnDiagonalBezier(vPoint,aPoints,true,nRadius);break;case nsCommon.LineStyle.vertDiagonalBezier:bResult=nsCommon.geometry.isPointOnDiagonalBezier(vPoint,aPoints,false,nRadius);break;case nsCommon.LineStyle.rounded:case nsCommon.LineStyle.streight:case nsCommon.LineStyle.horzDiagonal:case nsCommon.LineStyle.vertDiagonal:case nsCommon.LineStyle.orthogonal:case nsCommon.LineStyle.normal:bResult=nsCommon.geometry.isPointOnPolyline(vPoint,aPoints,nRadius);break}}}return bResult},flipHorizontal:function(){this.points.flipHorizontal()},flipVertical:function(){this.points.flipVertical()},moveBy:function(dx,dy){return this.points.moveBy(dx,dy)}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.RoundedRectangle=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.RoundedRectangle",parent:nsShape.Rectangle,shapeName:"RoundedRectangle",shapeCategory:"Standard",statics:{propertiesMap:{rx:"rx",ry:"ry"}},properties:{rx:{field:"_rx",get:function(){if(this._rx!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRx(this._rx)}if(this._ry===undefined){return this.getDefaultR()}return this.getDefaultRx()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._rx,true);nValue=this.checkRx(nValue);this._rx=nValue}},ry:{field:"_ry",get:function(){if(this._ry!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRy(this._ry)}if(this._rx===undefined){return this.getDefaultR()}return this.getDefaultRy()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._ry,true);nValue=this.checkRy(nValue);this._ry=nValue}},r:{get:function(){var rx=this.rx,ry=this.ry;if(rx!==undefined&&ry!==undefined&&!isNaN(rx)&&!isNaN(ry)){return Math.min(rx,ry)}return rx!==undefined?rx:ry},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);this.rx=nValue;this.ry=nValue}},contentBoxLeft:{configurable:false,get:function(){return Math.round(this.rx*0.297)}},contentBoxTop:{configurable:false,get:function(){return Math.round(this.ry*0.297)}},contentBoxRight:{configurable:false,get:function(){return Math.round(this.rx*0.297)}},contentBoxBottom:{configurable:false,get:function(){return Math.round(this.ry*0.297)}}},methods:{checkRx:function(rx){if(rx!==undefined&&!isNaN(rx)){rx=+rx;if(rx<0){rx=0}if(this.width!==undefined&&this.width!==0&&!isNaN(this.width)&&rx>this.width/2){rx=Math.floor(this.width/2)}}else{rx=undefined}return rx},checkRy:function(ry){if(ry!==undefined&&!isNaN(ry)){ry=+ry;if(ry<0){ry=0}if(this.height!==undefined&&this.height!==0&&!isNaN(this.height)&&ry>this.height/2){ry=Math.floor(this.height/2)}}else{ry=undefined}return ry},checkR:function(rx,ry){rx=this.checkRx(rx);ry=this.checkRy(ry);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},getDefaultRx:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){rx=nsCommon.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(rx===undefined){rx=nsCommon.geometry.getDefaultRoundedRectangleRx(this.width)}}return rx},getDefaultRy:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){ry=nsCommon.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(ry===undefined){ry=nsCommon.geometry.getDefaultRoundedRectangleRy(this.height)}}return ry},getDefaultR:function(){var rx=this.getDefaultRx(),ry=this.getDefaultRy();if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Shape.propertiesMap,nsShape.Shape.convertToNode,aAttributes);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.Rectangle.propertiesMap,nsShape.Rectangle.convertToNode,aAttributes);nsShape.Shape.updateDrawing(oViewer,this,oTransition,nsShape.RoundedRectangle.propertiesMap,nsShape.RoundedRectangle.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(viewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(viewer,nodeSelector)}nsShape.Shape.retrieveDrawing(viewer,this,this.d3Node,nsShape.Rectangle.propertiesMap,nsShape.Rectangle.convertFromNode,aAttributes);nsShape.Shape.retrieveDrawing(viewer,this,this.d3Node,nsShape.RoundedRectangle.propertiesMap,nsShape.RoundedRectangle.convertFromNode,aAttributes);return this.d3Node},getIntersection:function(oSegment,oParentBBox,bIncludeStrokeWidth){if(oSegment){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}if(bIncludeStrokeWidth!==false){oRect=this.inflateStrokeWidth(oRect)}else{oRect.inflate(-1,-1)}return nsCommon.geometry.intersectSegmentRoundedRectangle(oSegment,oRect,this.rx,this.ry)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox();if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return nsCommon.geometry.isPointInRoundedRectangle(oPoint,oRect,this.rx,this.ry)}return false},isPointOnBorder:function(vPoint,oParentBBox,nRadius){if(vPoint){var oInnerRect,oOuterRect;if(nRadius===undefined){nRadius=1}oInnerRect=this.getBBox();oOuterRect=this.getBBox();if(oParentBBox){oInnerRect=oInnerRect.clone();oOuterRect=oOuterRect.clone();oInnerRect.moveBy(oParentBBox.x-oInnerRect.x,oParentBBox.y-oInnerRect.y);oOuterRect.moveBy(oParentBBox.x-oOuterRect.x,oParentBBox.y-oOuterRect.y)}oInnerRect.inflate(-nRadius,-nRadius);oOuterRect.inflate(nRadius,nRadius);return nsCommon.geometry.isPointInRoundedRectangle(vPoint,oOuterRect,this.rx,this.ry)&&!nsCommon.geometry.isPointInRoundedRectangle(vPoint,oInnerRect,this.rx,this.ry)}return false},getClosestPointOnBorder:function(vPoint,oBoundaryRect,oParentBBox){var aPoint,aClosestPoint,oRect,oSegment;if(vPoint){aPoint=nsCommon.Point.getPointArray(vPoint);if(oBoundaryRect){oRect=oBoundaryRect}else{oRect=this.getBBox()}if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}aClosestPoint=oRect.getClosestPointOnBorder(aPoint);if(!nsCommon.geometry.isPointInRoundedRectangle(aClosestPoint,oRect,this.rx,this.ry)){oSegment=new nsCommon.Segment(aClosestPoint,oRect.getCenter());aClosestPoint=nsCommon.geometry.intersectSegmentRoundedRectangle(oSegment,oRect,this.rx,this.ry)}}return aClosestPoint}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Separator=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Separator",parent:nsShape.Line,shapeName:"Separator",shapeCategory:"Standard",properties:{orientation:{field:"_orientation",value:nsCommon.Orientation.horizontal,get:function(){return this._orientation},set:function(value){if(this._orientation!==value){this._orientation=value;if(this._orientation===nsCommon.Orientation.horizontal){this._y2=this._y1}else{if(this._orientation===nsCommon.Orientation.vertical){this._x2=this._x1}}}}}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Table=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Table",shapeName:"Table",shapeCategory:"Standard",parent:nsShape.List,properties:{columnPadding:4},methods:{_getLayoutOptions:function(){var oOptions=this._getListLayoutOptions();oOptions.columnInnerPadding=this.columnPadding;oOptions=nsShape.Table.checkLayoutOptions(oOptions);return oOptions},computeSize:function(){var oOptions=this._getLayoutOptions();return nsShape.Table.computeSize(this.getColumns(),this.shapes,oOptions)},layoutRows:function(oSize){var oOptions=this._getLayoutOptions();nsShape.Table.layoutRows(oSize,0,this.getColumns(),this.shapes,oOptions)},getColumns:function(){var oBinding=this.getBinding("items"),vItemTemplate;vItemTemplate=oBinding&&oBinding.template;if(typeof vItemTemplate==="function"){vItemTemplate=vItemTemplate.call(undefined,this)}return vItemTemplate},createRow:function(indexItem,oItem,aColumns){var index,oColumn,oRowShape,oParam,oCellShape,x;if(oItem&&aColumns){oRowShape=new nsShape.Group();x=this.x;for(index=0;index<aColumns.length;index++){oColumn=aColumns[index];oParam={};sap.galilei.core.copyProperties(oParam,oColumn);oCellShape=nsShape.ShapeSerializer.load(oParam);if(oCellShape){oRowShape.addSubShape(oCellShape);x+=oParam.width}}}return oRowShape},defaultCreateItemShape:function(index,oItem,vItemTemplate,sItemsPropertyName){var oItemShape;if(oItem&&vItemTemplate){if(typeof vItemTemplate==="function"){vItemTemplate=vItemTemplate.call(undefined,this,index,oItem)}oItemShape=this.createRow(index,oItem,vItemTemplate);if(oItemShape){oItemShape.itemContext=new nsCommon.binding.ItemContext({parentShape:this,itemsPropertyName:sItemsPropertyName,itemIndex:index});oItemShape.objectContext=oItem}}return oItemShape},layout:function(oLayoutRect,bUpdateShape){var oSize;oSize=this.computeSize();if(oSize){if(bUpdateShape){this.layoutRows(oSize)}oLayoutRect.width=oSize.width;oLayoutRect.height=oSize.height}return this.defaultLayout(oLayoutRect,bUpdateShape)}},statics:{checkLayoutOptions:function(oOptions){oOptions=nsShape.List.checkLayoutOptions(oOptions);if(isNaN(oOptions.columnInnerPadding)){oOptions.columnInnerPadding=4}return oOptions},computeSize:function(aColumns,aRowShapes,oOptions){var indexColumn,maxColumn,oColumn,indexRow,maxRow,oRowShape,oCellShape,oLayoutRect,nMaxColumnWidth,nTotalWidth=0,nTotalHeight=0,nPaddingLeft,nPaddingTop,nPaddingRight,nPaddingBottom,nRowMarginLeft,nRowMarginTop,nRowMarginRight,nRowMarginBottom,nColumnInnerPadding,nRowInnerPadding,oSize={columns:[],rows:[],x:0,y:0,width:0,height:0};if(aColumns&&aRowShapes){oOptions=nsShape.Table.checkLayoutOptions(oOptions);nPaddingLeft=oOptions.paddingLeft;nPaddingTop=oOptions.paddingTop;nPaddingRight=oOptions.paddingRight;nPaddingBottom=oOptions.paddingBottom;nRowMarginLeft=oOptions.rowMarginLeft;nRowMarginTop=oOptions.rowMarginTop;nRowMarginRight=oOptions.rowMarginRight;nRowMarginBottom=oOptions.rowMarginBottom;nColumnInnerPadding=oOptions.columnInnerPadding;nRowInnerPadding=oOptions.rowInnerPadding;for(indexColumn=0,maxColumn=aColumns.length;indexColumn<maxColumn;indexColumn++){oSize.columns.push({width:0})}for(indexRow=0,maxRow=aRowShapes.length;indexRow<maxRow;indexRow++){oSize.rows.push({height:0})}for(indexColumn=0;indexColumn<maxColumn;indexColumn++){oColumn=aColumns[indexColumn];nMaxColumnWidth=0;for(indexRow=0;indexRow<maxRow;indexRow++){oRowShape=aRowShapes[indexRow];if(oRowShape.contentShape){oRowShape=oRowShape.contentShape}oCellShape=oRowShape.shapes[indexColumn];if(oCellShape){oLayoutRect=oCellShape.getBBox();oLayoutRect.width=undefined;oLayoutRect.height=undefined;oLayoutRect=oCellShape.layout(oLayoutRect,false);nMaxColumnWidth=Math.max(nMaxColumnWidth,oLayoutRect.width);oSize.rows[indexRow].height=Math.max(oSize.rows[indexRow].height,oLayoutRect.height)}}oSize.columns[indexColumn].width=nMaxColumnWidth;if(nMaxColumnWidth>0){if(!isNaN(oColumn.marginLeft)){nMaxColumnWidth+=oColumn.marginLeft}if(!isNaN(oColumn.marginRight)){nMaxColumnWidth+=oColumn.marginRight}if(indexColumn>0){nMaxColumnWidth+=nColumnInnerPadding}}nTotalWidth+=nMaxColumnWidth}nTotalWidth+=nPaddingLeft+nPaddingRight+nRowMarginLeft+nRowMarginRight;for(indexRow=0;indexRow<maxRow;indexRow++){nTotalHeight+=oSize.rows[indexRow].height;if(indexRow>0){nTotalHeight+=nRowInnerPadding}}nTotalHeight+=nPaddingTop+nPaddingBottom+nRowMarginTop+nRowMarginBottom;oSize.x=nPaddingLeft;oSize.y=nPaddingTop;oSize.width=nTotalWidth;oSize.height=nTotalHeight}return oSize},layoutRows:function(oSize,x0,aColumns,aRowShapes,oOptions){var indexColumn,maxColumn,oColumn,indexRow,maxRow,oMainShape,oRowShape,oCellShape,oLayoutRect,nColumnWidth,nRowHeight,nPaddingLeft,nPaddingTop,nPaddingRight,nPaddingBottom,nRowMarginLeft,nRowMarginTop,nRowMarginRight,nRowMarginBottom,nColumnInnerPadding,nRowInnerPadding,x;if(oSize&&aColumns&&aRowShapes){oOptions=nsShape.Table.checkLayoutOptions(oOptions);nPaddingLeft=oOptions.paddingLeft;nPaddingTop=oOptions.paddingTop;nPaddingRight=oOptions.paddingRight;nPaddingBottom=oOptions.paddingBottom;nRowMarginLeft=oOptions.rowMarginLeft;nRowMarginTop=oOptions.rowMarginTop;nRowMarginRight=oOptions.rowMarginRight;nRowMarginBottom=oOptions.rowMarginBottom;nColumnInnerPadding=oOptions.columnInnerPadding;nRowInnerPadding=oOptions.rowInnerPadding;for(indexRow=0,maxRow=aRowShapes.length;indexRow<maxRow;indexRow++){oRowShape=aRowShapes[indexRow];if(oRowShape.boundaryShape){oMainShape=oRowShape.boundaryShape}if(oRowShape.contentShape){oRowShape=oRowShape.contentShape}nRowHeight=oSize.rows[indexRow].height;x=x0;x+=nPaddingLeft+nRowMarginLeft;for(indexColumn=0,maxColumn=aColumns.length;indexColumn<maxColumn;indexColumn++){oColumn=aColumns[indexColumn];nColumnWidth=oSize.columns[indexColumn].width;oCellShape=oRowShape.shapes[indexColumn];if(oCellShape){if(nColumnWidth>0&&!isNaN(oColumn.marginLeft)){x+=oColumn.marginLeft}oLayoutRect=oCellShape.getBBox();oCellShape.x=x;oLayoutRect.x=x;oLayoutRect.width=nColumnWidth;oLayoutRect.height=nRowHeight;oLayoutRect=oCellShape.layout(oLayoutRect,true);oCellShape.x=x;if(oMainShape){oMainShape.x=x0;oMainShape.height=nRowHeight}x+=nColumnWidth;if(nColumnWidth>0){if(!isNaN(oColumn.marginRight)){x+=oColumn.marginRight}if(indexColumn!==maxColumn-1){x+=nColumnInnerPadding}}}}x+=nPaddingRight+nRowMarginRight;if(oMainShape){oMainShape.width=x-x0}}}}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.CalloutDirection={left:"left",top:"top",right:"right",bottom:"bottom"};nsShape.Callout=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Callout",parent:nsShape.Path,shapeName:"Callout",shapeCategory:"Basic",properties:{rx:{field:"_rx",get:function(){if(this._rx!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRx(this._rx)}if(this._ry===undefined){return this.getDefaultR()}return this.getDefaultRx()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._rx,true);nValue=this.checkRx(nValue);this._rx=nValue}},ry:{field:"_ry",get:function(){if(this._ry!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRy(this._ry)}if(this._rx===undefined){return this.getDefaultR()}return this.getDefaultRy()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._ry,true);nValue=this.checkRy(nValue);this._ry=nValue}},r:{get:function(){var rx=this.rx,ry=this.ry;if(rx!==undefined&&ry!==undefined&&!isNaN(rx)&&!isNaN(ry)){return Math.min(rx,ry)}return rx!==undefined?rx:ry},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);this.rx=nValue;this.ry=nValue}},arrowLength:{get:function(){var nArrowLength=this._arrowLength;if(nArrowLength!==undefined){return nArrowLength}if(this.arrowDirection===nsShape.CalloutDirection.top||this.arrowDirection===nsShape.CalloutDirection.bottom){nArrowLength=this.height/3;if(nArrowLength>16){nArrowLength=16}}else{nArrowLength=this.width/3;if(nArrowLength>16){nArrowLength=16}}return nArrowLength},set:function(nArrowLength){this._arrowLength=nArrowLength}},arrowWidth:undefined,arrowBaseOffset:0,arrowOffset:0,arrowDirection:nsShape.CalloutDirection.bottom,strokeLineJoin:nsCommon.LineJoin.round,isEnableTranslate:true,isEnableScale:false,contentBoxLeft:{configurable:false,get:function(){var nPadding=Math.round(this.rx*0.297);if(this.arrowDirection===nsShape.CalloutDirection.left){nPadding+=this.arrowLength}return nPadding}},contentBoxTop:{configurable:false,get:function(){var nPadding=Math.round(this.ry*0.297);if(this.arrowDirection===nsShape.CalloutDirection.top){nPadding+=this.arrowLength}return nPadding}},contentBoxRight:{configurable:false,get:function(){var nPadding=Math.round(this.rx*0.297);if(this.arrowDirection===nsShape.CalloutDirection.right){nPadding+=this.arrowLength}return nPadding}},contentBoxBottom:{configurable:false,get:function(){var nPadding=Math.round(this.ry*0.297);if(this.arrowDirection===nsShape.CalloutDirection.bottom){nPadding+=this.arrowLength}return nPadding}}},methods:{checkRx:function(rx){if(rx!==undefined&&!isNaN(rx)){rx=+rx;if(rx<0){rx=0}if(this.width!==undefined&&this.width!==0&&!isNaN(this.width)&&rx>this.width/2){rx=Math.floor(this.width/2)}}else{rx=undefined}return rx},checkRy:function(ry){if(ry!==undefined&&!isNaN(ry)){ry=+ry;if(ry<0){ry=0}if(this.height!==undefined&&this.height!==0&&!isNaN(this.height)&&ry>this.height/2){ry=Math.floor(this.height/2)}}else{ry=undefined}return ry},checkR:function(rx,ry){rx=this.checkRx(rx);ry=this.checkRy(ry);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},getDefaultRx:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){rx=nsCommon.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(rx===undefined){rx=nsCommon.geometry.getDefaultRoundedRectangleRx(this.width)}}return rx},getDefaultRy:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){ry=nsCommon.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(ry===undefined){ry=nsCommon.geometry.getDefaultRoundedRectangleRy(this.height)}}return ry},getDefaultR:function(){var rx=this.getDefaultRx(),ry=this.getDefaultRy();if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},generatePath:function(){var x=this.x,y=this.y,width=this.width,height=this.height,rx=this.rx,ry=this.ry,nArrowLength=this.arrowLength,nArrowWidth=this.arrowWidth,nArrowBaseOffset=this.arrowBaseOffset,nArrowOffset=this.arrowOffset,x2,y2,xA,xB,xC,yA,yB,yC,sPath;if(x!==undefined&&y!==undefined&&width!==undefined&&height!==undefined&&rx!==undefined&&ry!==undefined){if(this.arrowDirection===nsShape.CalloutDirection.top||this.arrowDirection===nsShape.CalloutDirection.bottom){height=height-nArrowLength;if(this.arrowDirection===nsShape.CalloutDirection.top){y+=nArrowLength}}else{width=width-nArrowLength;if(this.arrowDirection===nsShape.CalloutDirection.left){x+=nArrowLength}}if(nArrowWidth===undefined){if(this.arrowDirection===nsShape.CalloutDirection.top||this.arrowDirection===nsShape.CalloutDirection.bottom){nArrowWidth=width/4}else{nArrowWidth=height/4}}if(nArrowWidth>16){nArrowWidth=16}x2=x+width;y2=y+height;if(this.arrowDirection===nsShape.CalloutDirection.top||this.arrowDirection===nsShape.CalloutDirection.bottom){xA=(x+width/2)+nArrowBaseOffset-nArrowWidth/2;if(xA<x+rx){nArrowBaseOffset+=(x+rx)-xA;xA=x+rx}xB=(x+width/2)+nArrowBaseOffset+nArrowWidth/2;if(xB>x2-rx){nArrowBaseOffset-=xB-(x2-rx);xB=x2-rx}xC=(x+width/2)+nArrowOffset}else{yA=(y+height/2)+nArrowBaseOffset-nArrowWidth/2;if(yA<y+ry){nArrowBaseOffset+=(y+ry)-yA;yA=y+ry}yB=(y+height/2)+nArrowBaseOffset+nArrowWidth/2;if(yB>y2-ry){nArrowBaseOffset-=yB-(y2-ry);yB=y2-ry}yC=(y+height/2)+nArrowOffset}sPath="M"+nsCommon.Path.generatePoint([x+rx,y]);if(this.arrowDirection===nsShape.CalloutDirection.top){sPath+=" L"+nsCommon.Path.generatePoint([xA,y]);sPath+=" L"+nsCommon.Path.generatePoint([xC,y-nArrowLength]);sPath+=" L"+nsCommon.Path.generatePoint([xB,y])}sPath+=" L"+nsCommon.Path.generatePoint([x2-rx,y]);sPath+=" Q"+nsCommon.Path.generatePoint([x2,y])+" "+nsCommon.Path.generatePoint([x2,y+ry]);if(this.arrowDirection===nsShape.CalloutDirection.right){sPath+=" L"+nsCommon.Path.generatePoint([x2,yA]);sPath+=" L"+nsCommon.Path.generatePoint([x2+nArrowLength,yC]);sPath+=" L"+nsCommon.Path.generatePoint([x2,yB])}sPath+=" L"+nsCommon.Path.generatePoint([x2,y2-ry]);sPath+=" Q"+nsCommon.Path.generatePoint([x2,y2])+" "+nsCommon.Path.generatePoint([x2-rx,y2]);if(this.arrowDirection===nsShape.CalloutDirection.bottom){sPath+=" L"+nsCommon.Path.generatePoint([xB,y2]);sPath+=" L"+nsCommon.Path.generatePoint([xC,y2+nArrowLength]);sPath+=" L"+nsCommon.Path.generatePoint([xA,y2])}sPath+=" L"+nsCommon.Path.generatePoint([x+rx,y2]);sPath+=" Q"+nsCommon.Path.generatePoint([x,y2])+" "+nsCommon.Path.generatePoint([x,y2-ry]);if(this.arrowDirection===nsShape.CalloutDirection.left){sPath+=" L"+nsCommon.Path.generatePoint([x,yB]);sPath+=" L"+nsCommon.Path.generatePoint([x-nArrowLength,yC]);sPath+=" L"+nsCommon.Path.generatePoint([x,yA])}sPath+=" L"+nsCommon.Path.generatePoint([x,y+ry]);sPath+=" Q"+nsCommon.Path.generatePoint([x,y])+" "+nsCommon.Path.generatePoint([x+rx,y]);sPath+=" Z"}return sPath}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Diamond=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Diamond",parent:nsShape.Polygon,shapeName:"Diamond",shapeCategory:"Basic",properties:{isEnableTranslate:false,isEnableScale:false,strokeLineJoin:nsCommon.LineJoin.round,isGeneratePoints:{value:true,writable:false,configurable:false},points:{get:function(){var aPoint,sRect;if(!this._points){this._points=new nsCommon.Points()}else{this._points.clear()}if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){sRect=new nsCommon.Rect(this.x,this.y,this.width,this.height);this._points.push(sRect.getPoint(nsCommon.DockPosition.left));this._points.push(sRect.getPoint(nsCommon.DockPosition.top));this._points.push(sRect.getPoint(nsCommon.DockPosition.right));this._points.push(sRect.getPoint(nsCommon.DockPosition.bottom));this._points.close()}return this._points}}},methods:{getContentBox:function(sLayoutMode,bRelative,bIncludeStroke){var oRect=this.getBBox(),dx=this.width/4,dy=this.height/4,paddingLeft=0,paddingTop=0,paddingRight=0,paddingBottom=0;if(bRelative){oRect.x=oRect.y=0}if(bIncludeStroke&&!isNaN(this.strokeWidth)){dx+=this.strokeWidth/2;dy+=this.strokeWidth/2}paddingLeft+=dx;paddingRight+=dx;paddingTop+=dy;paddingBottom+=dy;oRect.inflate(-paddingLeft,-paddingTop,-paddingRight,-paddingBottom);return oRect}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.File=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.File",parent:nsShape.Path,shapeName:"File",shapeCategory:"Basic",properties:{isEnableTranslate:true,isEnableScale:false,cornerPercent:{get:function(){if(this._cornerPercent!==undefined){return this._cornerPercent}return nsShape.File.CORNER_PERCENT},set:function(nCornerPercent){this._cornerPercent=nCornerPercent}},cornerSize:{get:function(){if(this._cornerSize!==undefined){return this._cornerSize}return Math.floor(Math.min(this.width,this.height)*nsShape.File.CORNER_PERCENT)},set:function(nCornerSize){this._cornerSize=nCornerSize}},contentBoxRight:{configurable:false,get:function(){return this.cornerSize}}},methods:{generatePath:function(){var sRect,aPoint,sPath,dx;if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){sRect=new nsCommon.Rect(this.x,this.y,this.width,this.height);dx=this.cornerSize;aPoint=sRect.getPoint(nsCommon.DockPosition.topLeft);sPath="M"+nsCommon.Path.generatePoint(aPoint);aPoint=sRect.getPoint(nsCommon.DockPosition.topRight);aPoint[0]-=dx;sPath+=" L"+nsCommon.Path.generatePoint(aPoint);aPoint[0]+=dx;aPoint[1]+=dx;sPath+=" L"+nsCommon.Path.generatePoint(aPoint);aPoint=sRect.getPoint(nsCommon.DockPosition.bottomRight);sPath+=" L"+nsCommon.Path.generatePoint(aPoint);sPath+=" L"+nsCommon.Path.generatePoint(sRect.getPoint(nsCommon.DockPosition.bottomLeft));aPoint=sRect.getPoint(nsCommon.DockPosition.topLeft);sPath+=" L"+nsCommon.Path.generatePoint(aPoint)+" Z";aPoint=sRect.getPoint(nsCommon.DockPosition.topRight);aPoint[0]-=dx;sPath+=" M"+nsCommon.Path.generatePoint(aPoint);aPoint[1]+=dx;sPath+=" L"+nsCommon.Path.generatePoint(aPoint);aPoint[0]+=dx;sPath+=" L"+nsCommon.Path.generatePoint(aPoint)}return sPath}},statics:{CORNER_PERCENT:0.25}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Package=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Package",parent:nsShape.Path,shapeName:"Package",shapeCategory:"Basic",properties:{isEnableTranslate:true,isEnableScale:false,headWidthPercent:{get:function(){if(this._headWidthPercent!==undefined){return this._headWidthPercent}return nsShape.Package.HEAD_WIDTH_PERCENT},set:function(nHeadWidthPercent){this._headWidthPercent=nHeadWidthPercent}},headHeight:{get:function(){if(this._headHeight!==undefined){return this._headHeight}return nsShape.Package.HEAD_HEIGHT},set:function(nHeadHeight){this._headHeight=nHeadHeight}},contentBoxTop:{get:function(){return this.headHeight}}},methods:{generatePath:function(){var sRect,aPoint,sPath,dx,dy;if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){sRect=new nsCommon.Rect(this.x,this.y,this.width,this.height);dx=this.width*nsShape.Package.HEAD_WIDTH_PERCENT;dy=this.headHeight;aPoint=sRect.getPoint(nsCommon.DockPosition.topLeft);sPath="M"+nsCommon.Path.generatePoint(aPoint);aPoint[0]+=dx;sPath+=" L"+nsCommon.Path.generatePoint(aPoint);aPoint[1]+=dy;sPath+=" L"+nsCommon.Path.generatePoint(aPoint);aPoint=sRect.getPoint(nsCommon.DockPosition.topRight);aPoint[1]+=dy;sPath+=" L"+nsCommon.Path.generatePoint(aPoint);sPath+=" L"+nsCommon.Path.generatePoint(sRect.getPoint(nsCommon.DockPosition.bottomRight));sPath+=" L"+nsCommon.Path.generatePoint(sRect.getPoint(nsCommon.DockPosition.bottomLeft));aPoint=sRect.getPoint(nsCommon.DockPosition.topLeft);sPath+=" L"+nsCommon.Path.generatePoint(aPoint)+" Z";aPoint[1]+=dy;sPath+=" M"+nsCommon.Path.generatePoint(aPoint);aPoint[0]+=dx;sPath+=" L"+nsCommon.Path.generatePoint(aPoint)}return sPath}},statics:{HEAD_WIDTH_PERCENT:0.4,HEAD_HEIGHT:10}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.Process=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Process",parent:nsShape.Polygon,shapeName:"Process",shapeCategory:"Basic",properties:{isEnableTranslate:false,isEnableScale:false,arrowLengthPercent:{field:"_arrowLengthPercent",get:function(){return(this._arrowLengthPercent===undefined)?nsShape.Process.ARROW_LENGTH_PERCENT:this._arrowLengthPercent},set:function(nLength){this._arrowLengthPercent=nLength}},arrowLength:{get:function(){return nsShape.Process.getArrowLength(this.width,this.height,this.arrowLengthPercent)}},horizontalOffset:{get:function(){if(this._horizontalOffset===undefined){return(this.arrowLength!==undefined)?(nsShape.Process.HORIZONTAL_OFFSET-this.arrowLength):nsShape.Process.HORIZONTAL_OFFSET}return this._horizontalOffset},set:function(nOffset){this._horizontalOffset=nOffset}},isFlatTail:false,isFlatNose:false,strokeLineJoin:nsCommon.LineJoin.round,isGeneratePoints:{value:true,writable:false,configurable:false},points:{field:"_points",get:function(){var aPoint,sRect,nLength;if(!this._points){this._points=new nsCommon.Points()}else{this._points.clear()}if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){sRect=new nsCommon.Rect(this.x,this.y,this.width,this.height);nLength=this.arrowLength;this._points.push(sRect.getPoint(nsCommon.DockPosition.topLeft));aPoint=sRect.getPoint(nsCommon.DockPosition.topRight);if(!this.isFlatNose){aPoint[0]-=nLength}this._points.push(aPoint);if(!this.isFlatNose){this._points.push(sRect.getPoint(nsCommon.DockPosition.right))}aPoint=sRect.getPoint(nsCommon.DockPosition.bottomRight);if(!this.isFlatNose){aPoint[0]-=nLength}this._points.push(aPoint);this._points.push(sRect.getPoint(nsCommon.DockPosition.bottomLeft));if(!this.isFlatTail){aPoint=sRect.getPoint(nsCommon.DockPosition.left);aPoint[0]+=nLength;this._points.push(aPoint)}this._points.close()}return this._points}}},methods:{getContentBox:function(sLayoutMode,bRelative,bIncludeStroke){var oRect=this.getBBox(),paddingLeft=0,paddingTop=0,paddingRight=0,paddingBottom=0;if(bRelative){oRect.x=oRect.y=0}if(!this.isFlatNose||!this.isFlatTail){if(!this.isFlatTail){paddingLeft+=this.arrowLength+1}if(!this.isFlatNose){paddingRight+=this.arrowLength+1;paddingTop=paddingBottom=1}}if(bIncludeStroke&&!isNaN(this.strokeWidth)){paddingLeft+=this.strokeWidth/2;paddingRight+=this.strokeWidth/2;paddingTop+=this.strokeWidth/2;paddingBottom+=this.strokeWidth/2}oRect.inflate(-paddingLeft,-paddingTop,-paddingRight,-paddingBottom);return oRect}},statics:{ARROW_LENGTH_PERCENT:0.288675,HORIZONTAL_OFFSET:8,getArrowLength:function(width,height,nArrowLengthPercent){var nLength=0;if(nArrowLengthPercent===undefined){nArrowLengthPercent=nsShape.Process.ARROW_LENGTH_PERCENT}if(height!==undefined){nLength=nArrowLengthPercent*height;if(width!==undefined&&nLength>width){nLength=Math.max(width-4,4)}}return nLength}}})});
namespace("sap.galilei.ui.common.shape",function(nsShape){var nsCommon=sap.galilei.ui.common;nsShape.RoundedSide={left:"left",top:"top",right:"right",bottom:"bottom"};nsShape.RoundedSameSideRectangle=nsShape.defineShape({fullClassName:"sap.galilei.ui.common.shape.RoundedSameSideRectangle",parent:nsShape.Path,shapeName:"RoundedSameSideRectangle",shapeCategory:"Basic",properties:{roundedSide:{get:function(){if(this._roundedSide!==undefined){return this._roundedSide}return nsShape.RoundedSameSideRectangle.ROUNDED_SIDE},set:function(sRoundedSide){this._roundedSide=sRoundedSide}},rx:{field:"_rx",get:function(){if(this._rx!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRx(this._rx)}if(this._ry===undefined){return this.getDefaultR()}return this.getDefaultRx()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._rx,true);nValue=this.checkRx(nValue);this._rx=nValue}},ry:{field:"_ry",get:function(){if(this._ry!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRy(this._ry)}if(this._rx===undefined){return this.getDefaultR()}return this.getDefaultRy()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._ry,true);nValue=this.checkRy(nValue);this._ry=nValue}},r:{get:function(){var rx=this.rx,ry=this.ry;if(rx!==undefined&&ry!==undefined&&!isNaN(rx)&&!isNaN(ry)){return Math.min(rx,ry)}return rx!==undefined?rx:ry},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);this.rx=nValue;this.ry=nValue}},contentBoxLeft:{configurable:false,get:function(){if(this.roundedSide===nsShape.RoundedSide.left){return Math.round(this.rx*0.297)}return 0}},contentBoxTop:{configurable:false,get:function(){if(this.roundedSide===nsShape.RoundedSide.top){return Math.round(this.ry*0.297)}return 0}},contentBoxRight:{configurable:false,get:function(){if(this.roundedSide===nsShape.RoundedSide.right){return Math.round(this.rx*0.297)}return 0}},contentBoxBottom:{configurable:false,get:function(){if(this.roundedSide===nsShape.RoundedSide.right){return Math.round(this.ry*0.297)}return 0}}},methods:{checkRx:function(rx){if(rx!==undefined&&!isNaN(rx)){rx=+rx;if(rx<0){rx=0}if(this.width!==undefined&&this.width!==0&&!isNaN(this.width)&&rx>this.width/2){rx=Math.floor(this.width/2)}}else{rx=undefined}return rx},checkRy:function(ry){if(ry!==undefined&&!isNaN(ry)){ry=+ry;if(ry<0){ry=0}if(this.height!==undefined&&this.height!==0&&!isNaN(this.height)&&ry>this.height/2){ry=Math.floor(this.height/2)}}else{ry=undefined}return ry},checkR:function(rx,ry){rx=this.checkRx(rx);ry=this.checkRy(ry);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},getDefaultRx:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){rx=nsCommon.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(rx===undefined){rx=nsCommon.geometry.getDefaultRoundedRectangleRx(this.width)}}return rx},getDefaultRy:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){ry=nsCommon.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(ry===undefined){ry=nsCommon.geometry.getDefaultRoundedRectangleRy(this.height)}}return ry},getDefaultR:function(){var rx=this.getDefaultRx(),ry=this.getDefaultRy();if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},generatePath:function(){var x1=this.x,y1=this.y,width=this.width,height=this.height,rx=this.rx,ry=this.ry,x2,y2,sPath="";if(x1!==undefined&&y1!==undefined&&width!==undefined&&height!==undefined&&rx!==undefined&&ry!==undefined){x2=x1+width;y2=y1+height;if(this.roundedSide===nsShape.RoundedSide.left||this.roundedSide===nsShape.RoundedSide.top){sPath="M"+nsCommon.Path.generatePoint([x1,y1+ry]);sPath+=" Q"+nsCommon.Path.generatePoint([x1,y1])+" "+nsCommon.Path.generatePoint([x1+rx,y1])}else{sPath="M"+nsCommon.Path.generatePoint([x1,y1])}if(this.roundedSide===nsShape.RoundedSide.top||this.roundedSide===nsShape.RoundedSide.right){sPath+=" L"+nsCommon.Path.generatePoint([x2-rx,y1]);sPath+=" Q"+nsCommon.Path.generatePoint([x2,y1])+" "+nsCommon.Path.generatePoint([x2,y1+ry])}else{sPath+=" L"+nsCommon.Path.generatePoint([x2,y1])}if(this.roundedSide===nsShape.RoundedSide.right||this.roundedSide===nsShape.RoundedSide.bottom){sPath+=" L"+nsCommon.Path.generatePoint([x2,y2-ry]);sPath+=" Q"+nsCommon.Path.generatePoint([x2,y2])+" "+nsCommon.Path.generatePoint([x2-rx,y2])}else{sPath+=" L"+nsCommon.Path.generatePoint([x2,y2])}if(this.roundedSide===nsShape.RoundedSide.bottom||this.roundedSide===nsShape.RoundedSide.left){sPath+=" L"+nsCommon.Path.generatePoint([x1+rx,y2]);sPath+=" Q"+nsCommon.Path.generatePoint([x1,y2])+" "+nsCommon.Path.generatePoint([x1,y2-ry])}else{sPath+=" L"+nsCommon.Path.generatePoint([x1,y2])}if(this.roundedSide===nsShape.RoundedSide.left||this.roundedSide===nsShape.RoundedSide.top){sPath+=" L"+nsCommon.Path.generatePoint([x1,y1+ry])}else{sPath+=" L"+nsCommon.Path.generatePoint([x1,y1])}sPath+=" Z"}return sPath}},statics:{ROUNDED_SIDE:nsShape.RoundedSide.top}})});
namespace("sap.galilei.ui.common.library");
(function(){sap.galilei.ui.common.library.defineLibrary=function(oLibraryDef){var sName=oLibraryDef.libraryName,oStatics=oLibraryDef.statics||{},oLibraryClass;if(!sName){throw'The library name "libraryName" is mandatory for defining a new library.'}if(sap.galilei.ui.common.library.LibraryManager.hasLibrary(sName)){throw'The library "'+sName+'" already exists.'}delete oLibraryDef.libraryName;if(!oStatics._markerDefinitions){oStatics._markerDefinitions={}}if(!oStatics.addMarker){oStatics.addMarker=function(sName,oMarkerDef){if(sName&&oMarkerDef){this._markerDefinitions[sName]=oMarkerDef}}}if(!oStatics.getMarkerDefinition){oStatics.getMarkerDefinition=function(sLibraryName,sName,oViewer){if(sName){var oMarkerDef=this._markerDefinitions[sName];if((typeof oMarkerDef)==="function"){oMarkerDef=oMarkerDef.call(this,sLibraryName,sName,oViewer)}return oMarkerDef}return undefined}}if(!oStatics._shapeDefinitions){oStatics._shapeDefinitions={}}if(!oStatics.addShape){oStatics.addShape=function(sName,oShapeDef){if(sName&&oShapeDef){this._shapeDefinitions[sName]=oShapeDef}}}if(!oStatics.getShapeDefinition){oStatics.getShapeDefinition=function(sLibraryName,sName,oViewer){if(sName){var oShapeDef=this._shapeDefinitions[sName];if((typeof oShapeDef)==="function"){oShapeDef=oShapeDef.call(this,sLibraryName,sName,oViewer)}return oShapeDef}return undefined}}if(!oStatics._filterDefinitions){oStatics._filterDefinitions={}}if(!oStatics.addFilter){oStatics.addFilter=function(sName,oFilterDef){if(sName&&oFilterDef){this._filterDefinitions[sName]=oFilterDef}}}if(!oStatics.registerFilter){oStatics.registerFilter=function(sLibraryName,sName,oViewer){if(sLibraryName&&sName&&oViewer){var oFilterDef=this._filterDefinitions[sName];if((typeof oFilterDef)==="function"){return oFilterDef.call(this,sLibraryName,sName,oViewer)}}return undefined}}if(!oStatics._gradientDefinitions){oStatics._gradientDefinitions={}}if(!oStatics.addGradient){oStatics.addGradient=function(sName,oGradientDef){if(sName&&oGradientDef){this._gradientDefinitions[sName]=oGradientDef}}}if(!oStatics.registerGradient){oStatics.registerGradient=function(sLibraryName,sName,oViewer){if(sLibraryName&&sName&&oViewer){var oGradientDef=this._gradientDefinitions[sName];if((typeof oGradientDef)==="function"){return oGradientDef.call(this,sLibraryName,sName,oViewer)}}return undefined}}oLibraryDef.statics=oStatics;oLibraryClass=sap.galilei.core.defineClass(oLibraryDef);sap.galilei.ui.common.library.LibraryManager.registerLibrary(sName,oLibraryClass);return oLibraryClass};sap.galilei.ui.common.library.LibraryManager=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.library.LibraryManager",initialize:function(oViewer){if(!oViewer){throw"The library manager must be associated with a SVG viewer."}this._viewer=oViewer},fields:{_markers:{},_shapes:{},_filters:{},_gradients:{},_viewer:undefined},statics:{_libraries:{},registerLibrary:function(sLibraryName,oLibraryClass){if(sLibraryName&&oLibraryClass){if(oLibraryClass.onInitialize){oLibraryClass.onInitialize()}sap.galilei.ui.common.library.LibraryManager._libraries[sLibraryName]=oLibraryClass}},getLibrary:function(sLibraryName){if(sLibraryName){return sap.galilei.ui.common.library.LibraryManager._libraries[sLibraryName]}return undefined},hasLibrary:function(sLibraryName){return sap.galilei.ui.common.library.LibraryManager.getLibrary(sLibraryName)!==undefined}},methods:{getMarkerId:function(sLibraryName,sName,sStrokeColor){var sId;if(sLibraryName&&sName){sId=sLibraryName+"."+sName;sStrokeColor=(sStrokeColor==="none")?undefined:sStrokeColor;if(sStrokeColor){if(sStrokeColor[0]==="#"){sStrokeColor=sStrokeColor.substring(1)}sId+="-"+sStrokeColor.toLowerCase()}}return sId},registerMarker:function(sLibraryName,sName,sStrokeColor){var sId=this.getMarkerId(sLibraryName,sName,sStrokeColor),sClassName,oDef,d3Marker,oShape,d3Shape,sProp,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries;if(this._markers.hasOwnProperty(sId)){return true}sStrokeColor=(sStrokeColor==="none")?undefined:sStrokeColor;if(oLibraries[sLibraryName]){oDef=oLibraries[sLibraryName].getMarkerDefinition(sLibraryName,sName,this._viewer)}if(oDef){d3Marker=this._viewer.d3SvgDefs.append("svg:marker");d3Marker.attr("id",sId);if(sLibraryName&&sName){sClassName=sLibraryName+sName;d3Marker.attr("class",sClassName)}for(sProp in oDef){if(sProp==="shapeDef"){oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(oDef[sProp]);if(sStrokeColor){this.replaceMarkerColor(oShape,sStrokeColor)}d3Shape=oShape.draw(this._viewer,d3Marker)}else{d3Marker.attr(sProp,oDef[sProp])}}if(d3Shape){this._markers[sId]={d3Node:d3Marker,url:"url(#"+sId+")"};return true}}return false},replaceMarkerColor:function(oShape,sColor){var index,max;if(oShape&&sColor){if(oShape.fill&&oShape.fill!=="none"&&oShape.stroke&&oShape.stroke!=="none"){oShape.stroke=sColor;if(oShape.fill===oShape.stroke){oShape.fill=sColor}}else{if(oShape.fill&&oShape.fill!=="none"){oShape.fill=sColor}else{if(oShape.stroke&&oShape.stroke!=="none"){oShape.stroke=sColor}}}if(oShape.isComposite){for(index=0,max=oShape.shapes.length;index<max;index++){this.replaceMarkerColor(oShape.shapes[index],sColor)}}}},registerShape:function(sLibraryName,sName){var sId=sLibraryName+"."+sName,oDef,d3Shape,oShape,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries;if(this._shapes.hasOwnProperty(sId)){return true}if(oLibraries[sLibraryName]){oDef=oLibraries[sLibraryName].getShapeDefinition(sLibraryName,sName,this._viewer)}if(oDef){oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(oDef);if(oShape){oShape.id=sId;d3Shape=oShape.draw(this._viewer,this._viewer.d3SvgDefs);this._shapes[sId]={d3Node:d3Shape,url:"#"+sId};return true}}return false},registerFilter:function(sLibraryName,sName){var sId=sLibraryName+"."+sName,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries,d3Node;if(this._filters.hasOwnProperty(sId)){return true}if(oLibraries[sLibraryName]){d3Node=oLibraries[sLibraryName].registerFilter(sLibraryName,sName,this._viewer);if(d3Node){this._filters[sId]={d3Node:d3Node,url:"url(#"+sId+")"};return true}}return false},registerGradient:function(sLibraryName,sName){var sId=sLibraryName+"."+sName,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries,d3Node;if(this._gradients.hasOwnProperty(sId)){return true}if(oLibraries[sLibraryName]){d3Node=oLibraries[sLibraryName].registerGradient(sLibraryName,sName,this._viewer);if(d3Node){this._gradients[sId]={d3Node:d3Node,url:"url(#"+sId+")"};return true}}return false},getMarkerUrl:function(sId,sStrokeColor){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The marker id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];sId=this.getMarkerId(sLibraryName,sName,sStrokeColor);if(!this._markers.hasOwnProperty(sId)){if(!this.registerMarker(sLibraryName,sName,sStrokeColor)){return undefined}}return this._markers[sId].url},getShapeUrl:function(sId){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The shape id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];if(!this._shapes.hasOwnProperty(sId)){if(!this.registerShape(sLibraryName,sName)){return undefined}}return this._shapes[sId].url},getFilterUrl:function(sId){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The filter id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];if(!this._filters.hasOwnProperty(sId)){if(!this.registerFilter(sLibraryName,sName)){return undefined}}return this._filters[sId].url},getGradientUrl:function(sId){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The gradient id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];if(!this._gradients.hasOwnProperty(sId)){if(!this.registerGradient(sLibraryName,sName)){return undefined}}return this._gradients[sId].url},clearCache:function(){this._markers={};this._shapes={};this._filters={};this._gradients={};this._viewer=undefined}}})}());
(function(){sap.galilei.ui.common.library.ArrowLibrary=sap.galilei.ui.common.library.defineLibrary({fullClassName:"sap.galilei.ui.common.library.ArrowLibrary",libraryName:"Arrows",statics:{onInitialize:function(){this.addMarker("FilledEnd",{markerUnits:"userSpaceOnUse",refX:14,refY:5,markerWidth:14,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 0 0 L 14 5 L 0 10 z",fill:"black",stroke:"none"}});this.addShape("FilledMiddle",{shape:"Path",path:"M -7 -5 L 7 0 L -7 5 z",fill:"black",stroke:"none",strokeWidth:1});this.addMarker("FilledStart",{markerUnits:"userSpaceOnUse",refX:0,refY:5,markerWidth:14,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 0 5 L 14 0 L 14 10 z",fill:"black",stroke:"none"}});this.addMarker("LineEnd",{markerUnits:"userSpaceOnUse",refX:13,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 1 1 L 13 7 L 1 13",fill:"none",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("LineStart",{markerUnits:"userSpaceOnUse",refX:0,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 13 1 L 1 7 L 13 13",fill:"none",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("CircleEnd",{markerUnits:"userSpaceOnUse",refX:13,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Circle",r:5,cx:7,cy:7,fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addShape("CircleMiddle",{shape:"Circle",r:5,cx:0,cy:0,fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"});this.addMarker("CircleStart",{markerUnits:"userSpaceOnUse",refX:0,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Circle",r:5,cx:7,cy:7,fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("WhiteFilledEnd",{markerUnits:"userSpaceOnUse",refX:13,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 1 1 L 13 7 L 1 13 L 1 1 z",fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("WhiteFilledStart",{markerUnits:"userSpaceOnUse",refX:0,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 13 1 L 1 7 L 13 13 L 13 1 z",fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("DiamondStart",{markerUnits:"userSpaceOnUse",refX:0,refY:5.5,markerWidth:16,markerHeight:11,orient:"auto",shapeDef:{shape:"Path",path:"M 0 5.5 L 8 0.5 L 16 5.5 L 8 10.5 z",fill:"white",strokeWidth:1,stroke:"black"}});this.addMarker("SlashStart",{markerUnits:"userSpaceOnUse",refX:0,refY:5,markerWidth:16,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 3 0 L 13 10",fill:"white",strokeWidth:1,stroke:"black"}});this.addMarker("MediumStart",{markerUnits:"userSpaceOnUse",refX:0.5,refY:5,markerWidth:16,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 15,1 l -14,4 l 14,4",fill:"none",stroke:"black",strokeLineCap:sap.galilei.ui.common.LineCap.round,strokeLineJoin:sap.galilei.ui.common.LineJoin.round,strokeDashArray:"1000,1"}});this.addMarker("MediumEnd",{markerUnits:"userSpaceOnUse",refX:15.5,refY:5,markerWidth:16,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 1,1 l 14,4 l -14,4",fill:"none",stroke:"black",strokeLineCap:sap.galilei.ui.common.LineCap.round,strokeLineJoin:sap.galilei.ui.common.LineJoin.round,strokeDashArray:"1000,1"}})}}})}());
(function(){sap.galilei.ui.common.library.IconLibrary=sap.galilei.ui.common.library.defineLibrary({fullClassName:"sap.galilei.ui.common.library.IconLibrary",libraryName:"Icons",statics:{onInitialize:function(){this.addShape("invisible-icon",function(sLibraryName,sName,oViewer){return{shape:"Rectangle",x:0,y:0,width:0,height:0,opacity:0}});this.addShape("handle-selection",function(sLibraryName,sName,oViewer){var sShadowUrl;return{shape:"Badge",x:-6,y:-6,width:12,height:12,outerOffset:1,filter:sShadowUrl,innerFill:"#0099EB"}});this.addFilter("shadow-smallBadge",function(sLibraryName,sName,oViewer){if(sLibraryName&&sName&&oViewer){var sIdShadowFilter=sLibraryName+"."+sName,dropShadowFilter;dropShadowFilter=new sap.galilei.ui.common.style.DropShadow({id:sIdShadowFilter,opacity:"0.4",dx:0,dy:0});return dropShadowFilter.create(oViewer)}return undefined})}}})}());
(function(){namespace("sap.galilei.ui.common.graph");sap.galilei.ui.common.graph.Graph=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.Graph",properties:{isDirected:true,isSupportMultiEdges:false,isSupportSubGraph:false,isDoubleTree:false,layouter:undefined,layouterOptions:undefined,width:0,height:0,fixedNode:undefined,nodes:{field:"_nodes",get:function(){if(!this._nodes){this._nodes=new sap.galilei.core.DefaultCollectionClass()}return this._nodes}},nodesMap:{field:"_nodesMap",get:function(){if(!this._nodesMap){this._nodesMap={}}return this._nodesMap}},edges:{field:"_edges",get:function(){if(!this._edges){this._edges=new sap.galilei.core.DefaultCollectionClass()}return this._edges}},edgesMap:{field:"_edgesMap",get:function(){if(!this._edgesMap){this._edgesMap={}}return this._edgesMap}}},methods:{setNode:function(sNodeId,oNodeDef){var oNode;if(sNodeId){oNodeDef=oNodeDef||{width:32,height:32};oNodeDef.parent=this;oNodeDef.id=sNodeId;if(oNodeDef.x!==undefined){oNodeDef.x0=oNodeDef.x}if(oNodeDef.y!==undefined){oNodeDef.y0=oNodeDef.y}if(oNodeDef.width!==undefined){oNodeDef.width0=oNodeDef.width}if(oNodeDef.height!==undefined){oNodeDef.height0=oNodeDef.height}oNode=new sap.galilei.ui.common.graph.Node();sap.galilei.core.copyProperties(oNode,oNodeDef,true);this.nodes.add(oNode);this.nodesMap[sNodeId]=oNode}return oNode},hasNode:function(sNodeId){return(this.getNode(sNodeId)!==undefined)},getNode:function(sNodeId){var oNode;if(sNodeId){oNode=this.nodesMap[sNodeId]}return oNode},removeNode:function(sNodeId){var oNode,aEdges,index,max,oEdge;if(typeof sNodeId==="string"){oNode=this.getNode(sNodeId)}else{if(sap.galilei.core.isInstanceOf(sNodeId,"sap.galilei.ui.common.graph.Node")){oNode=sNodeId;sNodeId=oNode.id}}if(oNode){aEdges=this.getNodeEdges(sNodeId);if(aEdges){for(index=0,max=aEdges.length;index<max;index++){oEdge=aEdges[index];this.removeEdge(oEdge)}}this.nodes.remove(oNode);delete this.nodesMap[sNodeId]}return this},hasPredecessors:function(sNodeId){var index,max,oEdge,oNode;if(this.isDirected){for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.target==sNodeId){oNode=this.getNode(oEdge.source);if(oNode){return true}}}}return false},hasSuccessors:function(sNodeId){var index,max,oEdge,oNode;if(this.isDirected){for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.source==sNodeId){oNode=this.getNode(oEdge.target);if(oNode){return true}}}}return false},hasNeighbors:function(sNodeId){var index,max,oEdge,oNode;for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.source==sNodeId||oEdge.target==sNodeId){oNode=this.getNode(oEdge.source==sNodeId?oEdge.target:oEdge.source);if(oNode){return true}}}return false},getRootNodes:function(){var aNodes,index,max,oEdge,oNode;if(this.isDirected){for(index=0,max=this.nodes.length;index<max;index++){oNode=this.nodes[index];if(!oNode.hasPredecessors()){aNodes=aNodes||[];aNodes.push(oNode)}}}return aNodes},getPredecessors:function(sNodeId){var aNodes,index,max,oEdge,oNode;if(this.isDirected){for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.target==sNodeId){oNode=this.getNode(oEdge.source);if(oNode){aNodes=aNodes||[];if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}}}}}return aNodes},getSuccessors:function(sNodeId){var aNodes,index,max,oEdge,oNode;if(this.isDirected){for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.source==sNodeId){oNode=this.getNode(oEdge.target);if(oNode){aNodes=aNodes||[];if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}}}}}return aNodes},getAllPredecessors:function(sNodeId,aOutputNodes){var aNodes=aOutputNodes||[],aDirectNodes,index,max,oNode;if(this.isDirected){aDirectNodes=this.getPredecessors(sNodeId);if(aDirectNodes){for(index=0,max=aDirectNodes.length;index<max;index++){oNode=aDirectNodes[index];if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}this.getAllPredecessors(oNode.id,aNodes)}}}return aNodes},getAllSuccessors:function(sNodeId,aOutputNodes){var aNodes=aOutputNodes||[],aDirectNodes,index,max,oNode;if(this.isDirected){aDirectNodes=this.getSuccessors(sNodeId);if(aDirectNodes){for(index=0,max=aDirectNodes.length;index<max;index++){oNode=aDirectNodes[index];if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}this.getAllSuccessors(oNode.id,aNodes)}}}return aNodes},getNeighbors:function(sNodeId){var aNodes,index,max,oEdge,oNode;for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.source==sNodeId||oEdge.target==sNodeId){oNode=this.getNode(oEdge.source==sNodeId?oEdge.target:oEdge.source);if(oNode){aNodes=aNodes||[];if(aNodes.indexOf(oNode)===-1){aNodes.push(oNode)}}}}return aNodes},getInEdges:function(sNodeId,sSourceNodeId){var aEdges,index,max,oEdge;if(this.isDirected){for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.target==sNodeId&&(!sSourceNodeId||oEdge.source==sSourceNodeId)){aEdges=aEdges||[];if(aEdges.indexOf(oEdge)===-1){aEdges.push(oEdge)}}}}return aEdges},getOutEdges:function(sNodeId,sTargetNodeId){var aEdges,index,max,oEdge;if(this.isDirected){for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if(oEdge.source==sNodeId&&(!sTargetNodeId||oEdge.target==sTargetNodeId)){aEdges=aEdges||[];if(aEdges.indexOf(oEdge)===-1){aEdges.push(oEdge)}}}}return aEdges},getNodeEdges:function(sNodeId,sOppositeNodeId){var aEdges,index,max,oEdge;for(index=0,max=this.edges.length;index<max;index++){oEdge=this.edges[index];if((oEdge.source==sNodeId&&(!sOppositeNodeId||oEdge.target==sOppositeNodeId))||(oEdge.target==sNodeId&&(!sOppositeNodeId||oEdge.source==sOppositeNodeId))){aEdges=aEdges||[];if(aEdges.indexOf(oEdge)===-1){aEdges.push(oEdge)}}}return aEdges},getEdgeId:function(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName){var sNewEdgeId=sEdgeId;if(!sNewEdgeId){if(sSourceNodeId&&sTargetNodeId){sNewEdgeId=sSourceNodeId+"_"+sTargetNodeId;if(sEdgeName){sNewEdgeId+="_"+sEdgeName}}}return sNewEdgeId},setEdge:function(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName,oEdgeDef){var oEdge;if(sSourceNodeId&&sTargetNodeId&&this.hasNode(sSourceNodeId)&&this.hasNode(sTargetNodeId)){sEdgeId=this.getEdgeId(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName);oEdgeDef=oEdgeDef||{};oEdgeDef.graph=this;oEdgeDef.id=sEdgeId;oEdgeDef.source=sSourceNodeId;oEdgeDef.target=sTargetNodeId;if(oEdgeDef.points&&oEdgeDef.points.clone){oEdgeDef.points0=oEdgeDef.points.clone()}oEdge=new sap.galilei.ui.common.graph.Edge();sap.galilei.core.copyProperties(oEdge,oEdgeDef,true);this.edges.add(oEdge);this.edgesMap[sEdgeId]=oEdge}return oEdge},hasEdge:function(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName){return(this.getEdge(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName)!==undefined)},getEdge:function(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName){var oEdge;sEdgeId=this.getEdgeId(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName);if(sEdgeId){oEdge=this.edgesMap[sEdgeId]}return oEdge},removeEdge:function(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName){var oEdge;if(typeof sEdgeId==="string"){sEdgeId=this.getEdgeId(sEdgeId,sSourceNodeId,sTargetNodeId,sEdgeName);oEdge=this.getEdge(sEdgeId)}else{if(sap.galilei.core.isInstanceOf(sEdgeId,"sap.galilei.ui.common.graph.Edge")){oEdge=sEdgeId;sEdgeId=oEdge.id}}if(oEdge){this.edges.remove(oEdge);delete this.edgesMap[sEdgeId]}return this},computeSuccessorNodeLevel:function(oNode,oRootNode){var nLevel,aNodes,index,max,oPredecessorNode;if(this.isDirected&&oNode){nLevel=oNode.level;if(nLevel===undefined){nLevel=0;aNodes=this.getPredecessors(oNode.id);if(aNodes&&aNodes.length>0){for(index=0,max=aNodes.length;index<max;index++){oPredecessorNode=aNodes[index];if(oRootNode&&oPredecessorNode===oRootNode){nLevel=Math.max(nLevel,oRootNode.level)}else{nLevel=Math.max(nLevel,this.computeSuccessorNodeLevel(oPredecessorNode,oRootNode))}}if(oNode.level===undefined){nLevel++}}oNode.level=nLevel}}return nLevel},computePredecessorNodeLevel:function(oNode,oRootNode){var nLevel,aNodes,index,max,oSuccessorNode;if(this.isDirected&&oNode){nLevel=oNode.level;if(nLevel===undefined){nLevel=0;aNodes=this.getSuccessors(oNode.id);if(aNodes&&aNodes.length>0){for(index=0,max=aNodes.length;index<max;index++){oSuccessorNode=aNodes[index];if(oRootNode&&oSuccessorNode===oRootNode){nLevel=Math.min(nLevel,oRootNode.level)}else{nLevel=Math.min(nLevel,this.computePredecessorNodeLevel(oSuccessorNode,oRootNode))}}if(oNode.level===undefined){nLevel--}}oNode.level=nLevel}}return nLevel},computeNodesLevel:function(){var index,max,oNode,aNodes;if(this.isDirected){if(this.isDoubleTree&&this.fixedNode){this.fixedNode.level=0;aNodes=[];this.getAllSuccessors(this.fixedNode.id,aNodes);for(index=0,max=aNodes.length;index<max;index++){oNode=aNodes[index];this.computeSuccessorNodeLevel(oNode,this.fixedNode)}aNodes=[];this.getAllPredecessors(this.fixedNode.id,aNodes);for(index=0,max=aNodes.length;index<max;index++){oNode=aNodes[index];this.computePredecessorNodeLevel(oNode,this.fixedNode)}}else{for(index=0,max=this.nodes.length;index<max;index++){oNode=this.nodes[index];this.computeSuccessorNodeLevel(oNode)}}}},getBBox:function(){var index,max,oGraphBBox,oBBox;for(index=0,max=this.nodes.length;index<max;index++){oBBox=this.nodes[index].getBBox();if(oBBox){if(!oGraphBBox){oGraphBBox=oBBox}else{oGraphBBox.unionRect(oBBox)}}}for(index=0,max=this.edges.length;index<max;index++){oBBox=this.edges[index].getBBox();if(oBBox){if(!oGraphBBox){oGraphBBox=oBBox}else{oGraphBBox.unionRect(oBBox)}}}return oGraphBBox},moveBy:function(dx,dy){var index,max;if(!isNaN(dx)&&!isNaN(dy)&&(dx!==0||dy!==0)){for(index=0,max=this.nodes.length;index<max;index++){this.nodes[index].moveBy(dx,dy,false)}for(index=0,max=this.edges.length;index<max;index++){this.edges[index].moveBy(dx,dy,true)}}},dispose:function(){this.nodes.clear();this.edges.clear();this._nodesMap=undefined;this._edgesMap=undefined}}})}());
(function(){sap.galilei.ui.common.graph.GraphAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.GraphAdapter",properties:{graph:undefined,customGraph:undefined,isDirected:true,isSupportMultiEdges:false,isSupportSubGraph:false},methods:{getOrCreateGraph:function(){if(!this.customGraph){this.customGraph=this.createGraph()}return this.customGraph},createGraph:function(){return this.customGraph},removeGraph:function(){this.customGraph=undefined},convertGraphFrom:function(oGraph){var oCustomGraph=this.getOrCreateGraph(),index;oGraph=oGraph||this.graph;this.graph=oGraph;if(oGraph&&oCustomGraph){for(index=0;index<oGraph.nodes.length;index++){this.convertNodeFrom(oGraph.nodes[index])}for(index=0;index<oGraph.edges.length;index++){this.convertEdgeFrom(oGraph.edges[index])}}},convertNodeFrom:function(oNode){},convertEdgeFrom:function(oEdge){},updateGraphTo:function(){},updateNodeTo:function(oNode,oInternalNode){},updateEdgeTo:function(oEdge,oInternalEdge){}}})}());
(function(){sap.galilei.ui.common.graph.DagreGraphAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.DagreGraphAdapter",parent:sap.galilei.ui.common.graph.GraphAdapter,methods:{createGraph:function(){function emptyLabel(){return{}}if((typeof dagre!=="undefined")&&dagre.graphlib&&dagre.graphlib.Graph){this.customGraph=new dagre.graphlib.Graph({directed:this.isDirected,multigraph:this.isSupportMultiEdges,compound:this.isSupportSubGraph});this.customGraph.setGraph({});this.customGraph.setDefaultNodeLabel(emptyLabel);this.customGraph.setDefaultEdgeLabel(emptyLabel)}return this.customGraph},convertNodeFrom:function(oNode){var oGraph=this.graph,oCustomGraph=this.getOrCreateGraph(),oInternalNode={};if(oGraph&&oCustomGraph&&oNode){sap.galilei.core.copyProperties(oInternalNode,oNode,true);oCustomGraph.setNode(oNode.id,oInternalNode)}},convertEdgeFrom:function(oEdge){var oGraph=this.graph,oCustomGraph=this.getOrCreateGraph(),oInternalEdge={};if(oGraph&&oCustomGraph&&oEdge){sap.galilei.core.copyProperties(oInternalEdge,oEdge,true);oCustomGraph.setEdge(oEdge.source,oEdge.target,oInternalEdge,this.isSupportMultiEdges?oEdge.id:undefined)}},updateGraphTo:function(){var self=this,oGraph=this.graph,oCustomGraph=this.customGraph;if(oGraph&&oCustomGraph){oGraph.width=oCustomGraph.graph().width;oGraph.height=oCustomGraph.graph().height;if(oCustomGraph.nodes()){oCustomGraph.nodes().forEach(function(sNodeId){var oInternalNode=oCustomGraph.node(sNodeId),oNode=oInternalNode&&oGraph.getNode(sNodeId);if(oNode&&oInternalNode){self.updateNodeTo(oNode,oInternalNode)}})}if(oCustomGraph.edges()){oCustomGraph.edges().forEach(function(oEdgeId){var oInternalEdge=oCustomGraph.edge(oEdgeId),oEdge=oInternalEdge&&oGraph.getEdge(oInternalEdge.id);if(oEdge&&oInternalEdge){self.updateEdgeTo(oEdge,oInternalEdge,oEdgeId)}})}}},updateNodeTo:function(oNode,oInternalNode){if(oNode&&oInternalNode){oNode.x=oInternalNode.x;oNode.y=oInternalNode.y}},updateEdgeTo:function(oEdge,oInternalEdge,oEdgeId){if(oEdge&&oInternalEdge&&oInternalEdge.points){oEdge.points=this.convertEdgePoints(oInternalEdge.points);if(oEdgeId&&oEdgeId.v==oInternalEdge.target){oEdge.points.reverse()}}},convertEdgePoints:function(aEdgePoints){var index,oPoint,aPoints=new sap.galilei.ui.common.Points();if(aEdgePoints){for(index=0;index<aEdgePoints.length;index++){oPoint=aEdgePoints[index];aPoints.push([oPoint.x,oPoint.y])}}return aPoints}}})}());
(function(){sap.galilei.ui.common.graph.Edge=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.Edge",fields:{graph:undefined,id:undefined,source:undefined,target:undefined,label:undefined,points:undefined},properties:{sourceNode:{get:function(){return this.graph&&this.graph.getNode(this.source)}},targetNode:{get:function(){return this.graph&&this.graph.getNode(this.target)}}},methods:{getBBox:function(){return this.points&&this.points.getBBox()},moveBy:function(dx,dy,bMoveExtremities){var index,max,oPoint;if(this.points&&!isNaN(dx)&&!isNaN(dy)&&(dx!==0||dy!==0)){for(index=0,max=this.points.length;index<max;index++){if(bMoveExtremities===false&&(index===0||index===this.points.length-1)){continue}oPoint=this.points[index];oPoint[0]+=dx;oPoint[1]+=dy}}}}})}());
(function(){sap.galilei.ui.common.graph.GraphBuilder=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.GraphBuilder",properties:{graph:undefined},methods:{checkOptions:function(oGraphOptions){return true},createGraph:function(oGraphOptions){this.graph=new sap.galilei.ui.common.graph.Graph(oGraphOptions);return this.graph},buildGraph:function(oGraphOptions){oGraphOptions=oGraphOptions||{};if(oGraphOptions){if(this.checkOptions(oGraphOptions)){if(this.createGraph(oGraphOptions)){this.setGraphNodes(oGraphOptions);this.setGraphEdges(oGraphOptions)}}}return this.graph},setGraphNodes:function(oGraphOptions){},setGraphEdges:function(oGraphOptions){},defaultDispose:function(){if(this.graph){this.graph=undefined}},dispose:function(){this.defaultDispose()}}})}());
(function(){sap.galilei.ui.common.graph.GraphRenderer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.GraphRenderer",properties:{graph:undefined},methods:{createDiagram:function(oGraph,oDiagramOptions){if(!oGraph){return}oDiagramOptions=oDiagramOptions||{};this.graph=oGraph}}})}());
(function(){sap.galilei.ui.common.graph.KlayGraphAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.KlayGraphAdapter",parent:sap.galilei.ui.common.graph.GraphAdapter,methods:{createGraph:function(){this.customGraph={id:"graph_root",properties:{},children:[],edges:[]};return this.customGraph},convertNodeFrom:function(oNode){var oGraph=this.graph,oCustomGraph=this.getOrCreateGraph(),oInternalNode={};if(oGraph&&oCustomGraph&&oNode){oInternalNode.id=oNode.id;oInternalNode.width=oNode.width;oInternalNode.height=oNode.height;if(!isNaN(oNode.x)){oInternalNode.x=oNode.x-oNode.width/2}if(!isNaN(oNode.y)){oInternalNode.y=oNode.y-oNode.height/2}oCustomGraph.children.push(oInternalNode)}},convertEdgeFrom:function(oEdge){var oGraph=this.graph,oCustomGraph=this.getOrCreateGraph(),oInternalEdge={};if(oGraph&&oCustomGraph&&oEdge){oInternalEdge.id=oEdge.id;oInternalEdge.source=oEdge.source;oInternalEdge.target=oEdge.target;oCustomGraph.edges.push(oEdge)}},updateGraphTo:function(){var oGraph=this.graph,oCustomGraph=this.customGraph,index,oNode,oEdge,oInternalNode,oInternalEdge;if(oGraph&&oCustomGraph){oGraph.width=oCustomGraph.width;oGraph.height=oCustomGraph.height;if(oCustomGraph.children){for(index=0;index<oCustomGraph.children.length;index++){oInternalNode=oCustomGraph.children[index];oNode=oGraph.getNode(oInternalNode.id);this.updateNodeTo(oNode,oInternalNode)}}if(oCustomGraph.edges){for(index=0;index<oCustomGraph.edges.length;index++){oInternalEdge=oCustomGraph.edges[index];oEdge=oGraph.getEdge(oInternalEdge.id);this.updateEdgeTo(oEdge,oInternalEdge)}}}},updateNodeTo:function(oNode,oInternalNode){if(oNode&&oInternalNode){oNode.x=oInternalNode.x+oInternalNode.width/2;oNode.y=oInternalNode.y+oInternalNode.height/2}},updateEdgeTo:function(oEdge,oInternalEdge){var aPoints=[];if(oEdge&&oInternalEdge){if(oInternalEdge.sourcePoint){aPoints.push(oInternalEdge.sourcePoint)}if(oInternalEdge.bendPoints){aPoints=aPoints.concat(oInternalEdge.bendPoints)}if(oInternalEdge.targetPoint){aPoints.push(oInternalEdge.targetPoint)}if(aPoints.length>0){oEdge.points=this.convertEdgePoints(aPoints)}}},convertEdgePoints:function(aEdgePoints){var index,oPoint,aPoints=new sap.galilei.ui.common.Points();if(aEdgePoints){for(index=0;index<aEdgePoints.length;index++){oPoint=aEdgePoints[index];aPoints.push([oPoint.x,oPoint.y])}}return aPoints}}})}());
(function(){sap.galilei.ui.common.graph.Node=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.graph.Node",fields:{id:undefined,x:undefined,y:undefined,width:undefined,height:undefined,left:{get:function(){if(!isNaN(this.x)&&!isNaN(this.width)){return this.x-this.width/2}return undefined},set:function(left){if(!isNaN(left)&&!isNaN(this.width)){this.x=left+this.width/2}}},top:{get:function(){if(!isNaN(this.y)&&!isNaN(this.height)){return this.y-this.height/2}return undefined},set:function(top){if(!isNaN(top)&&!isNaN(this.height)){this.y=top+this.height/2}}},level:undefined,label:undefined,parent:undefined},properties:{graph:{get:function(){var oGraph=this.parent;while(oGraph&&oGraph.parent){oGraph=oGraph.parent}return oGraph}},nodes:{field:"_nodes",get:function(){if(!this._nodes){this._nodes=new sap.galilei.core.DefaultCollectionClass()}return this._nodes}}},methods:{hasPredecessors:function(){var oGraph=this.graph;return oGraph?oGraph.hasPredecessors(this.id):false},hasSuccessors:function(sNodeId){var oGraph=this.graph;return oGraph?oGraph.hasSuccessors(this.id):false},hasNeighbors:function(){var oGraph=this.graph;return oGraph?oGraph.hasNeighbors(this.id):false},getPredecessors:function(){var oGraph=this.graph;return oGraph&&oGraph.getPredecessors(this.id)},getSuccessors:function(){var oGraph=this.graph;return oGraph&&oGraph.getSuccessors(this.id)},getNeighbors:function(){var oGraph=this.graph;return oGraph&&oGraph.getNeighbors(this.id)},getInEdges:function(sSourceNodeId){var oGraph=this.graph;return oGraph&&oGraph.getInEdges(this.id,sSourceNodeId)},getOutEdges:function(sTargetNodeId){var oGraph=this.graph;return oGraph&&oGraph.getOutEdges(this.id,sTargetNodeId)},getEdges:function(sOppositeNodeId){var oGraph=this.graph;return oGraph&&oGraph.getNodeEdges(this.id,sOppositeNodeId)},getBBox:function(){if(!isNaN(this.x)&&!isNaN(this.y)&&!isNaN(this.width)&&!isNaN(this.height)){return new sap.galilei.ui.common.Rect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}return undefined},moveBy:function(dx,dy,bMoveNodeEdges){if(!isNaN(dx)&&!isNaN(dy)&&(dx!==0||dy!==0)&&!isNaN(this.x)&&!isNaN(this.y)){this.x+=dx;this.y+=dy;if(bMoveNodeEdges){this.moveEdgesBy(dx,dy)}}},moveEdgesBy:function(dx,dy){var aEdges,index,max,oEdge,oPoint;if(!isNaN(dx)&&!isNaN(dy)&&(dx!==0||dy!==0)){aEdges=this.getEdges();if(aEdges){for(index=0,max=aEdges.length;index<max;index++){oEdge=aEdges[index];if(oEdge&&oEdge.points){if(oEdge.source==this.id){oPoint=oEdge.points[0];oPoint[0]+=dx;oPoint[1]+=dy}if(oEdge.target==this.id&&oEdge.points.length>1){oPoint=oEdge.points[oEdge.points.length-1];oPoint[0]+=dx;oPoint[1]+=dy}}}}}}}})}());
(function(){namespace("sap.galilei.ui.common.layout");sap.galilei.ui.common.layout.getAttachBBox=function(vAttachValue){var oBBox;if(vAttachValue){if(sap.galilei.core.isInstanceOf(vAttachValue,"sap.galilei.ui.common.shape.Shape")){oBBox=vAttachValue.getBBox().clone()}else{if(sap.galilei.core.isInstanceOf(vAttachValue,"sap.galilei.ui.common.Rect")){oBBox=vAttachValue.clone()}else{if(sap.galilei.core.isInstanceOf(vAttachValue,"sap.galilei.ui.common.Point")){oBBox=new sap.galilei.ui.common.Rect(vAttachValue.x,vAttachValue.y,0,0)}else{if((vAttachValue instanceof Array)&&vAttachValue.length>=2){oBBox=new sap.galilei.ui.common.Rect(vAttachValue[0],vAttachValue[1],0,0)}}}}}return oBBox};sap.galilei.ui.common.layout.getRelativePosition=function(oOptions){var oAttachBBox,aAttachPosition,oAlignBBox,aAlignPosition,nOffsetX,nOffsetY,aAttachPoint,aAlignPoint,oRect=new sap.galilei.ui.common.Rect(),nDeltaX,nDeltaY;if(oOptions){oAttachBBox=oOptions.attachBBox;aAttachPosition=oOptions.attachPosition;oAlignBBox=oOptions.alignBBox;aAlignPosition=oOptions.alignPosition;nOffsetX=oOptions.offsetX;nOffsetY=oOptions.offsetY;if(oAttachBBox&&oAlignBBox){aAttachPosition=aAttachPosition||sap.galilei.ui.common.DockPosition.topLeft;aAlignPosition=aAlignPosition||sap.galilei.ui.common.DockPosition.bottomLeft;if(nOffsetX===undefined){nOffsetX=0}if(nOffsetY===undefined){nOffsetY=0}aAttachPoint=oAttachBBox.getPoint(aAttachPosition);aAlignPoint=oAlignBBox.getPoint(aAlignPosition);nDeltaX=aAttachPoint[0]-aAlignPoint[0]+nOffsetX;nDeltaY=aAttachPoint[1]-aAlignPoint[1]+nOffsetY;oRect=oAlignBBox.clone();oRect.moveBy(nDeltaX,nDeltaY)}}return oRect}}());
(function(){sap.galilei.ui.common.layout.LayouterRegistry=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.LayouterRegistry",statics:{layoutersMap:{field:"_layoutersMap",get:function(){if(!sap.galilei.ui.common.layout.LayouterRegistry._layoutersMap){sap.galilei.ui.common.layout.LayouterRegistry._layoutersMap=new sap.galilei.core.DefaultLookupClass()}return sap.galilei.ui.common.layout.LayouterRegistry._layoutersMap}},registerLayouter:function(sLayouter,LayouterClass){if(sLayouter&&LayouterClass){sap.galilei.ui.common.layout.LayouterRegistry.layoutersMap.add(sLayouter,LayouterClass)}},unregisterLayouter:function(sLayouter){if(sLayouter){sap.galilei.ui.common.layout.LayouterRegistry.layoutersMap.remove(sLayouter)}},findLayouter:function(sLayouter){if(sLayouter){return sap.galilei.ui.common.layout.LayouterRegistry.layoutersMap.get(sLayouter)}return undefined},createNewInstance:function(sLayouter,oParam){if(sLayouter){var LayouterClass=sap.galilei.ui.common.layout.LayouterRegistry.findLayouter(sLayouter);if(LayouterClass){return new LayouterClass(oParam)}}return undefined}}})}());
(function(){sap.galilei.ui.common.layout.Layouter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.Layouter",properties:{options:undefined,graphAdapter:undefined,internalGraph:{get:function(){return this.graphAdapter&&this.graphAdapter.getOrCreateGraph()}}},methods:{checkOptions:function(oOptions){this.options=oOptions;return true},layoutGraph:function(oGraph,fnSuccess,fnError){throw"layoutGraph() is not implemented."}},statics:{LAYOUTER_NAME:"Unkownn"}})}());
(function(){sap.galilei.ui.common.layout.DagreLayouter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.DagreLayouter",parent:sap.galilei.ui.common.layout.Layouter,methods:{checkOptions:function(oOptions){oOptions=oOptions||{};if(oOptions.isDirected){oOptions.layout=oOptions.layout||{};if(!oOptions.layout.rankdir){oOptions.layout.rankdir="LR"}}this.options=oOptions;return true},setLayoutOptions:function(){if(this.internalGraph){if(this.options.layout.align!==undefined){this.internalGraph.graph().align=this.options.layout.align}if(!isNaN(this.options.layout.nodesep)){this.internalGraph.graph().nodesep=this.options.layout.nodesep}if(!isNaN(this.options.layout.edgesep)){this.internalGraph.graph().edgesep=this.options.layout.edgesep}if(!isNaN(this.options.layout.ranksep)){this.internalGraph.graph().ranksep=this.options.layout.ranksep}if(!isNaN(this.options.layout.marginx)){this.internalGraph.graph().marginx=this.options.layout.marginx}if(!isNaN(this.options.layout.marginy)){this.internalGraph.graph().marginy=this.options.layout.marginy}}},layoutGraph:function(oGraph,fnSuccess,fnError){function onError(sError){sError=(sError&&sError.message)||(sError&&sError.text)||sError;if(fnError){fnError(sError)}}if(oGraph&&(typeof dagre!=="undefined")){this.graphAdapter=new sap.galilei.ui.common.graph.DagreGraphAdapter(this.options);this.setLayoutOptions();try{this.graphAdapter.convertGraphFrom(oGraph);dagre.layout(this.internalGraph);this.graphAdapter.updateGraphTo();if(fnSuccess){fnSuccess(oGraph)}}catch(e){onError(e)}}else{onError(oGraph?"Cannot find dagre.js.":"The graph is not defined.")}}},statics:{LAYOUTER_NAME:"Dagre"}});sap.galilei.ui.common.layout.LayouterRegistry.registerLayouter(sap.galilei.ui.common.layout.DagreLayouter.LAYOUTER_NAME,sap.galilei.ui.common.layout.DagreLayouter)}());
(function(){sap.galilei.ui.common.layout.DirectedLayouter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.DirectedLayouter",parent:sap.galilei.ui.common.layout.DagreLayouter,methods:{checkOptions:function(oOptions){oOptions=oOptions||{};oOptions.isDirected=true;oOptions.layout=oOptions.layout||{};if(!oOptions.layout.rankdir){oOptions.layout.rankdir="LR"}this.options=oOptions;return true}},statics:{LAYOUTER_NAME:"Directed"}});sap.galilei.ui.common.layout.LayouterRegistry.registerLayouter(sap.galilei.ui.common.layout.DirectedLayouter.LAYOUTER_NAME,sap.galilei.ui.common.layout.DirectedLayouter)}());
(function(){sap.galilei.ui.common.layout.DEFAULT_LAYOUTER="Layered";sap.galilei.ui.common.layout.GraphAutoLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.GraphAutoLayout",initialize:function(oOptions){this.options=oOptions},properties:{layout:undefined,layouterName:{get:function(){var slayouterName;if(this.layout){slayouterName=this.layout.name}slayouterName=slayouterName||sap.galilei.ui.common.layout.DEFAULT_LAYOUTER;return slayouterName}},graphBuilderClassName:undefined,graphUpdaterClassName:undefined,options:{field:"_options",get:function(){if(!this._options){this._options={}}return this._options},set:function(oOptions){var oNewOptions={};if(this._options){sap.galilei.core.copyProperties(oNewOptions,this._options)}oOptions=oOptions||{};sap.galilei.core.copyProperties(oNewOptions,oOptions);this.set(oNewOptions);this._removeAutoLayoutOptions(oNewOptions);this._options=oNewOptions}},graph:undefined,initialGraphBBox:undefined,graphBBox:undefined,animationDuration:1000,layouterInstance:{field:"_layouterInstance",get:function(){if(!this._layouterInstance){this._layouterInstance=this.createLayouter()}return this._layouterInstance}},graphBuilderInstance:{field:"_graphBuilderInstance",get:function(){if(!this._graphBuilderInstance){this._graphBuilderInstance=this.createGraphBuilder()}return this._graphBuilderInstance}},graphUpdaterInstance:{field:"_graphUpdaterInstance",get:function(){if(!this._graphUpdaterInstance){this._graphUpdaterInstance=this.createGraphUpdater()}return this._graphUpdaterInstance}},transitionDefinition:{field:"_transitionDefinition",get:function(){if(!this._transitionDefinition&&this.animationDuration>0){this._transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.animationDuration})}return this._transitionDefinition}}},methods:{_defaultRemoveAutoLayoutOptions:function(oOptions){var aProperties=["layouter","options","graphBuilderClassName","graphUpdaterClassName","graph","animationDuration","transitionDefinition"],index;if(oOptions){for(index=0;index<aProperties.length;index++){delete oOptions[aProperties[index]]}}},_removeAutoLayoutOptions:function(oOptions){this._defaultRemoveAutoLayoutOptions(oOptions)},defaultCheckOptions:function(){var oLayouter=this.layouterInstance,oGraphBuilder=this.graphBuilderInstance,oGraphUpdater=this.graphUpdaterInstance;return(!oLayouter||(oLayouter&&oLayouter.checkOptions(this.options)))&&(!oGraphBuilder||(oGraphBuilder&&oGraphBuilder.checkOptions(this.options)))&&(!oGraphUpdater||(oGraphUpdater&&oGraphUpdater.checkOptions(this.options)))},checkOptions:function(){return this.defaultCheckOptions()},createGraphBuilder:function(){var oGraphBuilder;if(this.graphBuilderClassName){oGraphBuilder=sap.galilei.core.createNewInstance(this.graphBuilderClassName,this.options);if(!oGraphBuilder){throw"Cannot find the graph builder "+this.graphBuilderClassName+"."}}return oGraphBuilder},createLayouter:function(){var sLayouterName,oLayouterOptions={},oLayouter;sLayouterName=this.layouterName;if(this.options){sap.galilei.core.copyProperties(oLayouterOptions,this.options)}if(this.layout){sap.galilei.core.copyProperties(oLayouterOptions,this.layout)}if(sLayouterName){oLayouter=sap.galilei.ui.common.layout.LayouterRegistry.createNewInstance(sLayouterName,oLayouterOptions);if(!oLayouter){throw"Cannot find the layouter "+sLayouterName+"."}}return oLayouter},createGraphUpdater:function(){var oUpdater;if(this.graphUpdaterClassName){oUpdater=sap.galilei.core.createNewInstance(this.graphUpdaterClassName,this.options);if(!oUpdater){throw"Cannot find the graph updater "+this.graphUpdaterClassName+"."}}return oUpdater},getOrBuildGraph:function(){var oGraph,oGraphBuilder;if(this.graph){oGraph=this.graph}else{if(this.checkOptions()){oGraphBuilder=this.graphBuilderInstance;if(oGraphBuilder){this.graph=oGraph=oGraphBuilder.buildGraph(this.options)}}}return oGraph},layoutGraph:function(fnSuccess,fnError){var self=this,oLayouter;if(this.graph){oLayouter=this.layouterInstance;if(oLayouter){if(this.options.onPreLayoutGraph){this.options.onPreLayoutGraph(this)}oLayouter.layoutGraph(this.graph,function(oGraph){self.moveGraph();if(self.options.onPostLayoutGraph){self.options.onPostLayoutGraph(self)}if(fnSuccess){fnSuccess(self,oGraph)}},function(sError){if(fnError){fnError(sError)}});return}else{if(fnError){fnError("Cannot create layouter"+(self.layouterName?" "+self.layouterName:"")+".")}return}}else{if(fnError){fnError("Tha graph is not defined.")}}},getGraphInitialBBox:function(){if(this.graph){this.initialGraphBBox=this.graph.getBBox()}return this.initialGraphBBox},getGraphBBox:function(){if(this.graph){this.graphBBox=this.graph.getBBox()}return this.graphBBox},defaultDispose:function(){this.graph=undefined;this.initialGraphBBox=undefined;this.graphBBox=undefined;if(this.graphBuilderInstance){this.graphBuilderInstance.dispose()}if(this.graphUpdaterInstance){this.graphUpdaterInstance.dispose()}},dispose:function(){this.defaultDispose()}}})}());
(function(){sap.galilei.ui.common.layout.GraphUpdater=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.GraphUpdater",properties:{autoLayout:undefined,graph:undefined,viewer:undefined,transitionDefinition:undefined},methods:{checkOptions:function(oGraphOptions){return true},updateDiagram:function(oAutoLayout){if(!oAutoLayout){return}this.autoLayout=oAutoLayout;this.graph=oAutoLayout.graph},defaultDispose:function(){this.graph=undefined},dispose:function(){this.defaultDispose()}}})}());
(function(){sap.galilei.ui.common.layout.KlayLayouter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.KlayLayouter",parent:sap.galilei.ui.common.layout.Layouter,methods:{checkOptions:function(oOptions){oOptions=oOptions||{};if(oOptions){oOptions.isDirected=true}this.options=oOptions;return true},filterLayoutOptions:function(oOptions){var oLayoutOptions={};if(oOptions&&oOptions.layout){sap.galilei.core.copyProperties(oLayoutOptions,oOptions.layout,true);delete oLayoutOptions.name;delete oLayoutOptions.levelSpacing}return oLayoutOptions},layoutGraph:function(oGraph,fnSuccess,fnError){var self=this,oLayoutOptions={};function onError(sError){sError=(sError&&sError.message)||(sError&&sError.text)||sError;if(fnError){fnError(sError)}}if(oGraph&&(typeof $klay!=="undefined")){this.graphAdapter=new sap.galilei.ui.common.graph.KlayGraphAdapter(this.options);oLayoutOptions=this.filterLayoutOptions(this.options);try{this.graphAdapter.convertGraphFrom(oGraph);$klay.layout({graph:this.internalGraph,options:oLayoutOptions,success:function(oLayouted){self.graphAdapter.updateGraphTo();self.offsetNodesPerLevel();if(fnSuccess){fnSuccess(oGraph)}},error:onError})}catch(e){onError(e)}}else{onError(oGraph?"Cannot find klay.js.":"The graph is not defined.")}},_offsetChildNodes:function(aParentNodes,nLevel,dx,dy){var index,index2,max,max2,oParentNode,aEdges,oEdge,oTargetNode,aChildNodes=[],bDown=false,nInitialLevel=nLevel;if(aParentNodes){if(this.options&&this.options.layout&&this.options.layout.direction==="DOWN"){bDown=true}for(index=0,max=aParentNodes.length;index<max;index++){oParentNode=aParentNodes[index];aEdges=oParentNode.getOutEdges();if(aEdges){for(index2=0,max2=aEdges.length;index2<max2;index2++){oEdge=aEdges[index2];nLevel=nInitialLevel;oTargetNode=oEdge.targetNode;nLevel=oTargetNode.level;if(oTargetNode._isMoved===undefined){oTargetNode.x+=nLevel*dx;oTargetNode.y+=nLevel*dy;oTargetNode._isMoved=true}aChildNodes.push(oTargetNode)}}}if(aChildNodes&&aChildNodes.length>0){this._offsetChildNodes(aChildNodes,nLevel+1,dx,dy)}}},_offsetEdges:function(aEdges,dx,dy,dWidth,dHeight){var index,max,oEdge,oOldBBox,oNewBBox,oMatrix,bDown=false;if(aEdges){for(index=0,max=aEdges.length;index<max;index++){oEdge=aEdges[index];if(oEdge.points){oOldBBox=oEdge.getBBox();if(oOldBBox){if(oOldBBox.width===0){oOldBBox.width=1}if(oOldBBox.height===0){oOldBBox.height=1}oNewBBox=oOldBBox.clone();oNewBBox.x+=dx;oNewBBox.y+=dy;oNewBBox.width+=dWidth;oNewBBox.height+=dHeight;oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oOldBBox,oNewBBox);oEdge.points.matrixTransform(oMatrix)}}}}},_offsetNodes:function(aNodes,dx,dy,dWidth,dHeight){var index,max,oNode;if(aNodes){for(index=0,max=aNodes.length;index<max;index++){oNode=aNodes[index];if(oNode._isMoved===undefined){oNode.x+=oNode.level*dx;oNode.y+=oNode.level*dy;oNode._isMoved=true}}}},offsetNodesPerLevel:function(){var oLayoutOptions=this.options.layout,nOffset,dxLevel=0,dyLevel=0,aRootNodes,oGraph=this.graphAdapter&&this.graphAdapter.graph;if(oLayoutOptions&&!isNaN(oLayoutOptions.levelSpacing)&&!isNaN(oLayoutOptions.spacing)&&this.options.isDirected){nOffset=oLayoutOptions.levelSpacing-oLayoutOptions.spacing;if(nOffset>0){if(this.options&&this.options.layout&&this.options.layout.direction==="DOWN"){dyLevel=nOffset}else{dxLevel=nOffset}if(oGraph&&oGraph.nodes){oGraph.computeNodesLevel();if(oGraph.isDoubleTree&&oGraph.fixedNode){this._offsetNodes(oGraph.nodes,dxLevel,dyLevel)}else{aRootNodes=oGraph.getRootNodes();this._offsetChildNodes(aRootNodes,1,dxLevel,dyLevel)}}}}}},statics:{LAYOUTER_NAME:"Layered"}});sap.galilei.ui.common.layout.LayouterRegistry.registerLayouter(sap.galilei.ui.common.layout.KlayLayouter.LAYOUTER_NAME,sap.galilei.ui.common.layout.KlayLayouter)}());
(function(){sap.galilei.ui.common.layout.OrganicLayouter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.OrganicLayouter",parent:sap.galilei.ui.common.layout.DagreLayouter,methods:{checkOptions:function(oOptions){oOptions=oOptions||{};oOptions.isDirected=false;oOptions.layout=oOptions.layout||{};oOptions.layout.rankdir=undefined;this.options=oOptions;return true}},statics:{LAYOUTER_NAME:"Organic"}});sap.galilei.ui.common.layout.LayouterRegistry.registerLayouter(sap.galilei.ui.common.layout.OrganicLayouter.LAYOUTER_NAME,sap.galilei.ui.common.layout.OrganicLayouter)}());
(function(){sap.galilei.ui.common.layout.PointsLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.PointsLayout",statics:{ELBOW_DISTANCE:8,getLinkDirection:function(aStartPoint,aEndPoint){if(aStartPoint&&aEndPoint){var xDistance,yDistance;xDistance=aEndPoint[0]-aStartPoint[0];yDistance=aEndPoint[1]-aStartPoint[1];if(xDistance>=0){if(yDistance>=0){return(yDistance>=xDistance)?sap.galilei.ui.common.LinkDirection.south:sap.galilei.ui.common.LinkDirection.east}else{return(Math.abs(yDistance)>=xDistance)?sap.galilei.ui.common.LinkDirection.north:sap.galilei.ui.common.LinkDirection.east}}else{if(yDistance>=0){return(yDistance>=Math.abs(xDistance))?sap.galilei.ui.common.LinkDirection.south:sap.galilei.ui.common.LinkDirection.west}else{return(Math.abs(yDistance)>=Math.abs(xDistance))?sap.galilei.ui.common.LinkDirection.north:sap.galilei.ui.common.LinkDirection.west}}}return sap.galilei.ui.common.LinkDirection.DEFAULT},getLinkEndingDirection:function(aPoint,oRect){if(aPoint&&oRect){return oRect.getPointDirection(aPoint)}return sap.galilei.ui.common.LinkDirection.DEFAULT},routeLinkPoints:function(vPoint1,vPoint2,oRect1,oRect2,direction1,direction2){var aPoint1=sap.galilei.ui.common.Point.getPointArray(vPoint1),aPoint2=sap.galilei.ui.common.Point.getPointArray(vPoint2),oMatrix,nDegree,oTransformedRect1,oTransformedRect2,aTransformedPoint2,transformedDirection2,aRoutePoints;if(aPoint1&&aPoint1.length===2&&aPoint1[0]!==undefined&&!isNaN(aPoint1[0])&&aPoint1[1]!==undefined&&!isNaN(aPoint1[1])&&aPoint2&&aPoint2.length===2&&aPoint2[0]!==undefined&&!isNaN(aPoint2[0])&&aPoint2[1]!==undefined&&!isNaN(aPoint2[1])&&oRect1&&oRect2){nDegree=sap.galilei.ui.common.LinkDirection.degree(direction1,sap.galilei.ui.common.LinkDirection.east);oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.rotate(nDegree);oMatrix.translate(-aPoint1[0],-aPoint1[1]);oTransformedRect1=oRect1.matrixTransform(oMatrix,false,true);oTransformedRect2=oRect2.matrixTransform(oMatrix,false,true);aTransformedPoint2=sap.galilei.ui.common.Point.matrixTransform(aPoint2[0],aPoint2[1],oMatrix,false);transformedDirection2=sap.galilei.ui.common.LinkDirection.rotate(direction2,nDegree);aRoutePoints=sap.galilei.ui.common.layout.PointsLayout.calculateOrthogonalLinkPoints(oTransformedRect1,oTransformedRect2,aTransformedPoint2,transformedDirection2);if(aRoutePoints){if(aRoutePoints.length>0){aRoutePoints.matrixTransform(oMatrix.inverse(),false,false)}aRoutePoints.splice(0,0,aPoint1);aRoutePoints.push(aPoint2);return aRoutePoints}}},calculateOrthogonalLinkPoints:function(oSourceRect,oTargetRect,vPoint,direction){var mid,points,aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint),nRouteMargin=50;if(!aPoint||aPoint.length<2||aPoint[0]===undefined||isNaN(aPoint[0]||aPoint[1]===undefined||isNaN(aPoint[1]))){return undefined}points=new sap.galilei.ui.common.Points();switch(direction){case sap.galilei.ui.common.LinkDirection.west:if(aPoint[0]<=0){if(oSourceRect.top>oTargetRect.bottom){mid=(oSourceRect.top-oTargetRect.bottom)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oTargetRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,oTargetRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,aPoint[1]])}else{if(oTargetRect.top>oSourceRect.bottom){mid=(oTargetRect.top-oSourceRect.bottom)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,oSourceRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,aPoint[1]])}else{points.push([nRouteMargin,0]);points.push([nRouteMargin,Math.min(oSourceRect.top,oTargetRect.top)-nRouteMargin]);points.push([Math.min(oSourceRect.left,aPoint[0])-nRouteMargin,Math.min(oSourceRect.top,oTargetRect.top)-nRouteMargin]);points.push([Math.min(oSourceRect.left,aPoint[0])-nRouteMargin,aPoint[1]])}}}else{if(aPoint[1]!==0){mid=oTargetRect.left*0.5;points.push([mid,0]);points.push([mid,aPoint[1]])}}break;case sap.galilei.ui.common.LinkDirection.north:if(aPoint[1]>0){if(aPoint[0]>0){points.push([aPoint[0],0])}else{if(aPoint[1]>oSourceRect.bottom){mid=(aPoint[1]-oSourceRect.bottom)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.bottom+mid]);points.push([aPoint[0],oSourceRect.bottom+mid])}else{points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.top-nRouteMargin]);points.push([aPoint[0],oSourceRect.top-nRouteMargin])}}}else{if(oTargetRect.left>0){mid=oTargetRect.left*0.5;points.push([mid,0]);points.push([mid,aPoint[1]-nRouteMargin]);points.push([aPoint[0],aPoint[1]-nRouteMargin])}else{points.push([oTargetRect.right+nRouteMargin,0]);points.push([oTargetRect.right+nRouteMargin,Math.min(oSourceRect.top,aPoint[1])-nRouteMargin]);points.push([aPoint[0],Math.min(oSourceRect.top,aPoint[1])-nRouteMargin])}}break;case sap.galilei.ui.common.LinkDirection.east:if(aPoint[0]>=0){if(oTargetRect.top>0||oTargetRect.bottom<0){points.push([aPoint[0]+nRouteMargin,0]);points.push([aPoint[0]+nRouteMargin,aPoint[1]])}else{mid=oTargetRect.left*0.5;points.push([mid,0]);if(aPoint[1]>0){points.push([mid,oTargetRect.bottom+nRouteMargin]);points.push([aPoint[0]+nRouteMargin,oTargetRect.bottom+nRouteMargin]);points.push([aPoint[0]+nRouteMargin,aPoint[1]])}else{points.push([mid,oTargetRect.top-nRouteMargin]);points.push([aPoint[0]+nRouteMargin,oTargetRect.top-nRouteMargin]);points.push([aPoint[0]+nRouteMargin,aPoint[1]])}}}else{if(aPoint[1]<oSourceRect.top||aPoint[1]>oSourceRect.bottom||oTargetRect.right>oSourceRect.left){points.push([nRouteMargin,0]);points.push([nRouteMargin,aPoint[1]])}else{mid=(oSourceRect.left-oTargetRect.right)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.top-nRouteMargin]);points.push([oTargetRect.right+mid,oSourceRect.top-nRouteMargin]);points.push([oTargetRect.right+mid,aPoint[1]])}}break;case sap.galilei.ui.common.LinkDirection.south:if(aPoint[1]<0){if(aPoint[0]>0){points.push([aPoint[0],0])}else{if(aPoint[1]<oSourceRect.top){mid=(oSourceRect.top-aPoint[1])*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.top-mid]);points.push([aPoint[0],oSourceRect.top-mid])}else{points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.bottom+nRouteMargin]);points.push([aPoint[0],oSourceRect.bottom+nRouteMargin])}}}else{if(oTargetRect.left>0){mid=oTargetRect.left*0.5;points.push([mid,0]);points.push([mid,aPoint[1]+nRouteMargin]);points.push([aPoint[0],aPoint[1]+nRouteMargin])}else{points.push([oTargetRect.right+nRouteMargin,0]);points.push([oTargetRect.right+nRouteMargin,Math.max(oSourceRect.bottom,aPoint[1])+nRouteMargin]);points.push([aPoint[0],Math.max(oSourceRect.bottom,aPoint[1])+nRouteMargin])}}break}return points},getQuadraticBezierPoints:function(aPoints,bClosed){var aNewPoints,aFirst,aLast,index,aCenter;if(aPoints&&aPoints.length>1){aNewPoints=new sap.galilei.ui.common.Points();for(index=0;index<aPoints.length;index++){aNewPoints.add(aPoints[index]);if(index>=1&&index<aPoints.length-(bClosed?1:2)){aCenter=sap.galilei.ui.common.Segment.getCenter(aPoints[index],aPoints[index+1]);aNewPoints.add(aCenter)}}if(bClosed){aFirst=aPoints[0];aLast=aPoints[aPoints.length-1];if(aFirst[0]!==aLast[0]||aFirst[1]!==aLast[1]){aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aFirst,aLast));aNewPoints.add(aFirst);aCenter=sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[1]);aNewPoints.add(aCenter);aNewPoints[0]=[aCenter[0],aCenter[1]]}else{aCenter=sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[1]);aNewPoints[0]=[aCenter[0],aCenter[1]];aNewPoints.add(aCenter)}}}return aNewPoints},getHalfCubicBezierPoints:function(aPoints,bClosed){var aNewPoints,aFirst,aLast,index,aCenter;if(aPoints&&aPoints.length>1){aNewPoints=new sap.galilei.ui.common.Points();if(!bClosed){aNewPoints.add(aPoints[0])}else{aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[1]))}for(index=1;index<aPoints.length-1;++index){aNewPoints.add(aPoints[index]);aNewPoints.add(aPoints[index]);if(bClosed||index<aPoints.length-2){aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aPoints[index],aPoints[index+1]))}}aFirst=aPoints[0];aLast=aPoints[aPoints.length-1];if(bClosed){if(aFirst[0]!==aLast[0]||aFirst[1]!==aLast[1]){aNewPoints.add(aLast);aNewPoints.add(aLast);aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aFirst,aLast));aNewPoints.add(aFirst);aNewPoints.add(aFirst);aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aFirst,aPoints[1]))}else{aNewPoints.add(aFirst);aNewPoints.add(aFirst);aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aFirst,aPoints[1]))}}else{aNewPoints.add(aLast)}}return aNewPoints},getStreightLinePoints:function(aPoints){var aPathPoints=[],aPt1,aPt2;if(aPoints&&aPoints.length>=2){aPt1=aPoints[0];aPt2=aPoints[aPoints.length-1];aPathPoints.push(aPt1);aPathPoints.push(aPt2)}return aPathPoints},getDiagonalPoints:function(aPoints,bHorizontal){var aPathPoints=[],aPt1,aPt2,aPt3,aPt4,nOffset;if(aPoints&&aPoints.length>=2){aPt1=aPoints[0];aPt2=aPoints[1];aPt3=aPoints[aPoints.length-2];aPt4=aPoints[aPoints.length-1];if(bHorizontal===undefined){bHorizontal=(Math.abs(aPt4[0]-aPt1[0])>=Math.abs(aPt4[1]-aPt1[1]))}if(bHorizontal){nOffset=sap.galilei.ui.common.Points.DIAGONAL_OFFSET;if(aPt2[0]<aPt1[0]){nOffset=-nOffset}aPt2=[aPt1[0]+nOffset,aPt1[1]];nOffset=sap.galilei.ui.common.Points.DIAGONAL_OFFSET;if(aPt4[0]<aPt3[0]){nOffset=-nOffset}aPt3=[aPt4[0]-nOffset,aPt4[1]]}else{nOffset=sap.galilei.ui.common.Points.DIAGONAL_OFFSET;if(aPt2[1]<aPt1[1]){nOffset=-nOffset}aPt2=[aPt1[0],aPt1[1]+nOffset];nOffset=sap.galilei.ui.common.Points.DIAGONAL_OFFSET;if(aPt4[1]<aPt3[1]){nOffset=-nOffset}aPt3=[aPt4[0],aPt4[1]-nOffset]}aPathPoints.push(aPt1);aPathPoints.push(aPt2);aPathPoints.push(aPt3);aPathPoints.push(aPt4)}return aPathPoints},getDiagonalBezierPoints:function(aPoints,bHorizontal){var aPathPoints=[],aPt1,aPt2,aPt3,aPt4;if(aPoints&&aPoints.length>=2){aPt1=aPoints[0];aPt4=aPoints[aPoints.length-1];if(bHorizontal===undefined){bHorizontal=(Math.abs(aPt4[0]-aPt1[0])>=Math.abs(aPt4[1]-aPt1[1]))}if(bHorizontal){aPt2=[(aPt1[0]+aPt4[0])/2,aPt1[1]];aPt3=[(aPt1[0]+aPt4[0])/2,aPt4[1]]}else{aPt2=[aPt1[0],(aPt1[1]+aPt4[1])/2];aPt3=[aPt4[0],(aPt1[1]+aPt4[1])/2]}aPathPoints.push(aPt1);aPathPoints.push(aPt2);aPathPoints.push(aPt3);aPathPoints.push(aPt4)}return aPathPoints},removeElbows:function(aPoints){function removeElbow(index,aPoints){var nDiff;if(index<=aPoints.length-4){if(aPoints[index+1][0]===aPoints[index+2][0]){if(Math.abs(aPoints[index+1][1]-aPoints[index+2][1])<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE&&(aPoints[index][0]-aPoints[index+1][0])*(aPoints[index+3][0]-aPoints[index+2][0])<0){nDiff=aPoints[index+3][1]-aPoints[index][1];aPoints[index][1]+=nDiff*0.5;aPoints[index+3][1]=aPoints[index][1];aPoints.splice(index+1,2);return true}}if(aPoints[index+1][1]===aPoints[index+2][1]){if(Math.abs(aPoints[index+1][0]-aPoints[index+2][0])<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE&&(aPoints[index][1]-aPoints[index+1][1])*(aPoints[index+3][1]-aPoints[index+2][1])<0){nDiff=aPoints[index+3][0]-aPoints[index][0];aPoints[index][0]+=nDiff*0.5;aPoints[index+3][0]=aPoints[index][0];aPoints.splice(index+1,2);return true}}}}var i,aNewPoints;if(aPoints){aNewPoints=aPoints.clone();if(aNewPoints.length>=3){for(i=0;i<aNewPoints.length-2;i++){if(aNewPoints[i][1]===aNewPoints[i+1][1]&&aNewPoints[i+1][1]===aNewPoints[i+2][1]){aNewPoints.splice(i+1,1);i--}else{if(aNewPoints[i][0]===aNewPoints[i+1][0]&&aNewPoints[i+1][0]===aNewPoints[i+2][0]){aNewPoints.splice(i+1,1);i--}}}}if(aNewPoints.length>=4){for(i=0;i<aNewPoints.length-3;i++){if(removeElbow(i,aNewPoints)){return sap.galilei.ui.common.layout.PointsLayout.removeElbows(aNewPoints)}}}}return aNewPoints}}})}());
(function(){sap.galilei.ui.common.layout.StackLayouter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.StackLayouter",parent:sap.galilei.ui.common.layout.Layouter,methods:{checkOptions:function(oOptions){oOptions=oOptions||{};if(oOptions){if(oOptions.orientation===undefined){oOptions.orientation="horizontal"}if(oOptions.originX===undefined){oOptions.originX=0}if(oOptions.originY===undefined){oOptions.originY=0}if(oOptions.offsetX===undefined){oOptions.offsetX=40}if(oOptions.offsetY===undefined){oOptions.offsetY=40}if(oOptions.wrap===undefined){oOptions.wrap=true}if(oOptions.maxWidth===undefined){oOptions.maxWidth=1920}if(oOptions.maxHeight===undefined){oOptions.maxHeight=1200}}this.options=oOptions;return true},layoutGraph:function(oGraph,fnSuccess,fnError){var self=this,oLayoutOptions={};function onError(sError){sError=(sError&&sError.message)||(sError&&sError.text)||sError;if(fnError){fnError(sError)}}if(oGraph!==undefined){this.layoutNodes(oGraph);if(fnSuccess){fnSuccess(oGraph)}}else{onError("The graph is not defined.")}},layoutNodes:function(oGraph){var index,max,oNode,x=this.options.originX,y=this.options.originY,width=0,height=0,left,top;if(oGraph!==undefined){for(index=0,max=oGraph.nodes.length;index<max;index++){oNode=oGraph.nodes[index];left=oNode.left;top=oNode.top;if(this.options.orientation==="horizontal"){if(this.options.wrap&&x+oNode.width>this.options.originX+this.options.maxWidth){x=this.options.originX;y+=height+this.options.offsetY;height=0}oNode.left=x;oNode.top=y;x+=oNode.width+this.options.offsetX;height=Math.max(height,oNode.height)}else{if(this.options.wrap&&y+oNode.height>this.options.originY+this.options.maxHeight){y=this.options.originY;x+=width+this.options.offsetX;width=0}oNode.left=x;oNode.top=y;y+=oNode.height+this.options.offsetY;width=Math.max(width,oNode.width)}}}}},statics:{LAYOUTER_NAME:"Stack"}});sap.galilei.ui.common.layout.LayouterRegistry.registerLayouter(sap.galilei.ui.common.layout.StackLayouter.LAYOUTER_NAME,sap.galilei.ui.common.layout.StackLayouter)}());
(function(){namespace("sap.galilei.ui.common.decorator");sap.galilei.ui.common.decorator.Decorator=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.decorator.Decorator",properties:{id:undefined,shapeTemplate:undefined,shape:undefined,events:undefined}})}());
(function(){sap.galilei.ui.common.decorator.DecoratorGroup=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.decorator.DecoratorGroup",properties:{id:undefined,orientation:sap.galilei.ui.common.Orientation.horizontal,innerPadding:2,attachPosition:undefined,alignPosition:undefined,offsetX:0,offsetY:0,decorators:{type:sap.galilei.core.EnumPropertyType.collection,writable:false}},methods:{addDecorator:function(oDecorator){if(oDecorator){this.insertDecorator(-1,oDecorator)}},insertDecorator:function(index,oDecorator){if(oDecorator&&((index>=0&&index<this.decorators.length)||index===-1)){if(!this.getDecoratorById(oDecorator.id)){oDecorator.attachPosition=oDecorator.attachPosition||sap.galilei.ui.common.DockPosition.topLeft;if(!sap.galilei.core.isInstanceOf(oDecorator,"sap.galilei.ui.common.decorator.Decorator")){oDecorator=new sap.galilei.ui.common.decorator.Decorator(oDecorator)}this.decorators.insert(index,oDecorator)}}},removeDecorator:function(sId){var index;if(sId){index=this.getDecoratorIndexById(sId);if(index!==-1){this.decorators.removeAt(index)}}},removeDecoratorAt:function(index){if(index>=0&&index<this.decorators.length){this.decorators.removeAt(index)}},getDecoratorById:function(sId){var oDecoratorDef,index;if(sId){for(index=0;index<this.decorators.length;index++){oDecoratorDef=this.decorators[index];if(oDecoratorDef.id==sId){return oDecoratorDef}}}return undefined},getDecoratorIndexById:function(sId){var oDecoratorDef,index;if(sId){for(index=0;index<this.decorators.length;index++){oDecoratorDef=this.decorators[index];if(oDecoratorDef.id==sId){return index}}}return -1}},statics:{getDecoratorGroupInfo:function(sAttachPosition){var sAlignPosition,sOrientation,nOffsetX=0,nOffsetY=0;switch(sAttachPosition){case sap.galilei.ui.common.DockPosition.topLeft:sAlignPosition=sap.galilei.ui.common.DockPosition.bottomLeft;sOrientation=sap.galilei.ui.common.Orientation.horizontal;nOffsetY=-4;break;case sap.galilei.ui.common.DockPosition.top:sAlignPosition=sap.galilei.ui.common.DockPosition.bottom;sOrientation=sap.galilei.ui.common.Orientation.horizontal;nOffsetY=-4;break;case sap.galilei.ui.common.DockPosition.topRight:sAlignPosition=sap.galilei.ui.common.DockPosition.bottomRight;sOrientation=sap.galilei.ui.common.Orientation.horizontal;nOffsetY=-4;break;case sap.galilei.ui.common.DockPosition.bottomLeft:sAlignPosition=sap.galilei.ui.common.DockPosition.topLeft;sOrientation=sap.galilei.ui.common.Orientation.horizontal;nOffsetY=4;break;case sap.galilei.ui.common.DockPosition.bottom:sAlignPosition=sap.galilei.ui.common.DockPosition.top;sOrientation=sap.galilei.ui.common.Orientation.horizontal;nOffsetY=4;break;case sap.galilei.ui.common.DockPosition.bottomRight:sAlignPosition=sap.galilei.ui.common.DockPosition.topRight;sOrientation=sap.galilei.ui.common.Orientation.horizontal;nOffsetY=4;break;case sap.galilei.ui.common.DockPosition.left:sAlignPosition=sap.galilei.ui.common.DockPosition.right;sOrientation=sap.galilei.ui.common.Orientation.horizontal;break;case sap.galilei.ui.common.DockPosition.right:sAlignPosition=sap.galilei.ui.common.DockPosition.left;sOrientation=sap.galilei.ui.common.Orientation.vertical;nOffsetX=4;break;default:sAlignPosition=sap.galilei.ui.common.DockPosition.bottomLeft;sOrientation=sap.galilei.ui.common.Orientation.vertical;nOffsetX=-4;break}return{attachPosition:sAttachPosition,alignPosition:sAlignPosition,orientation:sOrientation,offsetX:nOffsetX,offsetY:nOffsetY}}}})}());
(function(){sap.galilei.ui.common.decorator.DecoratorGroups=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.decorator.DecoratorGroups",properties:{decoratorGroups:{field:"_decoratorGroups",get:function(){if(!this._decoratorGroups){this._decoratorGroups={}}return this._decoratorGroups}}},methods:{getDecoratorGroup:function(sAttachPosition){sAttachPosition=sAttachPosition||sap.galilei.ui.common.DockPosition.topLeft;return this.decoratorGroups[sAttachPosition]},getOrCreateDecoratorGroup:function(sAttachPosition){var oDecoratorGroup,oDecoratorGroupInfo;sAttachPosition=sAttachPosition||sap.galilei.ui.common.DockPosition.topLeft;oDecoratorGroup=this.decoratorGroups[sAttachPosition];if(!oDecoratorGroup){oDecoratorGroupInfo=sap.galilei.ui.common.decorator.DecoratorGroup.getDecoratorGroupInfo(sAttachPosition);oDecoratorGroup=new sap.galilei.ui.common.decorator.DecoratorGroup(oDecoratorGroupInfo);this.decoratorGroups[sAttachPosition]=oDecoratorGroup}return oDecoratorGroup},addDecorator:function(oDecorator){var oDecoratorGroup;if(oDecorator){oDecoratorGroup=this.getOrCreateDecoratorGroup(oDecorator.attachPosition);if(oDecoratorGroup){if(!oDecoratorGroup.getDecoratorById(oDecorator.id)){oDecoratorGroup.addDecorator(oDecorator)}}}},getDecoratorById:function(sId){var sGroupId,oDecoratorGroup,oDecoratorDef;if(sId){for(sGroupId in this.decoratorGroups){if(this.decoratorGroups.hasOwnProperty(sGroupId)){oDecoratorGroup=this.decoratorGroups[sGroupId];oDecoratorDef=oDecoratorGroup.getDecoratorById(sId);if(oDecoratorDef){return oDecoratorDef}}}}return undefined},removeDecorator:function(sId){var sGroupId,oDecoratorGroup,index;if(sId){for(sGroupId in this.decoratorGroups){if(this.decoratorGroups.hasOwnProperty(sGroupId)){oDecoratorGroup=this.decoratorGroups[sGroupId];index=oDecoratorGroup.getDecoratorIndexById(sId);if(index!==-1){oDecoratorGroup.removeDecoratorAt(index);return}}}}},removeAllDecorators:function(sId){this.decoratorGroups.clear()}}})}());
(function(){namespace("sap.galilei.ui.common.widget");sap.galilei.ui.common.widget.Widget=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.widget.Widget",parent:sap.galilei.ui.common.shape.Group,shapeName:"Widget",shapeCategory:"Internal",initialize:function(options){if(options){this.set(options)}this.updatePosition(false);if(this.isUseAnimation&&!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration})}this.createWidget()},fields:{_parentWidget:undefined,_group:undefined,_referenceBBox:undefined,_widgetBBox:undefined,_widgetAlignPoint:undefined,_bounceDuration:300,_bounceUpAnimation:undefined,_bounceDownAnimation:undefined,_isUseSemanticZoomLayer:true},properties:{isUseAnimation:true,shape:{get:function(){if(this.shapes.length===1){return this.shapes[0]}return this.shapes},set:function(vShape){var self=this,index,oShape;this.remove();this._group=new sap.galilei.ui.common.shape.Group();this._group.isEnableTranslate=true;if(sap.galilei.core.isInstanceOf(vShape,"sap.galilei.ui.common.shape.Shape")){this._group.addSubShape(vShape);this.addSubShape(this._group)}else{if(vShape instanceof Array){for(index=0;index<vShape.length;index++){oShape=vShape[index];self._group.addSubShape(oShape)}this.addSubShape(this._group)}}}},shapeTemplate:{field:"_shapeTemplate",get:function(){return this._shapeTemplate},set:function(vShapeTemplate){this.remove();if(vShapeTemplate){this.shape=sap.galilei.ui.common.shape.ShapeSerializer.load(vShapeTemplate)}}},attachTo:{field:"_attachTo",get:function(){return this._attachTo},set:function(vValue){this._attachTo=vValue;this._referenceBBox=sap.galilei.ui.common.layout.getAttachBBox(vValue)}},attachPosition:sap.galilei.ui.common.DockPosition.topLeft,alignPosition:sap.galilei.ui.common.DockPosition.bottomLeft,offsetX:0,offsetY:0,isZoomable:false,isAutoHide:true,isUseDropAnimation:false,isDisableContextMenu:true,dropDuration:500,isEnableBounce:false,bounceNumber:undefined,tooltip:undefined,viewer:undefined,transitionDefinition:undefined,transitionDuration:200},methods:{getLayer:function(oViewer){return oViewer&&oViewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME)},getFixedLayer:function(oViewer){return oViewer&&oViewer.getLayerByName(sap.galilei.ui.common.svg.ZoomToolLayer.NAME)},createWidget:function(){},updateWidget:function(){},updateAttachTo:function(){},defaultUpdatePosition:function(bUpdateDrawing){this.updateAttachTo();if(this._referenceBBox){var oAlignBBox=this.getBBox(),oRect,oLayer;bUpdateDrawing=(bUpdateDrawing!==false);oRect=sap.galilei.ui.common.layout.getRelativePosition({attachBBox:this._referenceBBox,attachPosition:this.attachPosition,alignBBox:oAlignBBox,alignPosition:this.alignPosition,offsetX:this.offsetX,offsetY:this.offsetY});this._widgetBBox=oRect;this._widgetAlignPoint=this._widgetBBox.getPoint(this.alignPosition);if(this._group&&oAlignBBox){this._group.x+=oRect.x-oAlignBBox.x;this._group.y+=oRect.y-oAlignBBox.y}else{if(oRect&&oAlignBBox){this.moveBy(oRect.x-oAlignBBox.x,oRect.y-oAlignBBox.y)}}if(this.viewer&&this.isDrawn&&!this.isZoomable&&this._widgetAlignPoint){if(bUpdateDrawing){this.updateDrawing(this.viewer,undefined,["x","y","cx","cy","path","points","groupTransform"])}if(this._isUseSemanticZoomLayer){oLayer=this.getLayer(this.viewer);if(oLayer){oLayer.setAttachPoint(this,this._widgetAlignPoint[0],this._widgetAlignPoint[1])}}}}},updatePosition:function(bUpdateDrawing){this.defaultUpdatePosition(bUpdateDrawing)},drawWidget:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var self=this,oDropTransitionDef,oViewRect,y,index,shape,nDuration=0,oLayer;oViewer=oViewer||this.viewer;if(!oViewer){return}if(!this.viewer){this.viewer=oViewer}if(!this.isZoomable){oLayer=this.getLayer(oViewer);d3ParentNode=d3ParentNode||(oLayer&&oLayer.d3Layer);if(oLayer&&d3ParentNode!==oLayer.d3Layer){oLayer=undefined;this._isUseSemanticZoomLayer=false}}oTransitionDef=oTransitionDef||this.transitionDefinition;if(this.isUseDropAnimation){oDropTransitionDef=new sap.galilei.ui.common.TransitionDefinition({duration:this.dropDuration,ease:sap.galilei.ui.common.EasingFunction.bounce});oTransitionDef=undefined;nDuration=this.dropDuration}else{if(oTransitionDef){nDuration=oTransitionDef.duration}}if(!this._parentWidget){this.removeEventHandlers();this.addEventHandlers()}if(oDropTransitionDef&&this._group){y=this._group.y;oViewRect=oViewer.getViewRect();if(this._group){this._group.y=oViewRect.y}else{this.moveTo(this.x,oViewRect.y)}}this.createNode("svg:g",oViewer,d3ParentNode,undefined,insertBeforeSelector);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.draw(oViewer,this.d3Node,undefined)}if(!this.isZoomable){if(this._widgetAlignPoint&&oLayer&&oLayer.setAttachPoint){oLayer.setAttachPoint(this,this._widgetAlignPoint[0],this._widgetAlignPoint[1])}}if(oDropTransitionDef){if(this._group){this._group.y=y}else{this.moveTo(this.x,y)}this.updateDrawing(oViewer,oDropTransitionDef,["x","y","cx","cy","path","points","groupTransform"])}if(this.isEnableBounce){setTimeout(function(){self.startBounce()},nDuration)}return this.d3Node},updateDrawingWidget:function(oViewer,oTransitionDef,aAttributes){this.updateDrawingGroup(oViewer,oTransitionDef,aAttributes)},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){this.drawWidget(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){this.updateDrawingWidget(oViewer,oTransitionDef,aAttributes)},addWidgetEventHandlers:function(){if(this.isAutoHide){sap.galilei.core.Event.subscribe("viewer.zoompan.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("viewer.zoompan.after",this.onShowWidget,this)}},removeWidgetEventHandlers:function(){if(this.isAutoHide){sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.before",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.after",this)}},addEventHandlers:function(){this.addWidgetEventHandlers()},removeEventHandlers:function(){this.removeWidgetEventHandlers()},showWidget:function(){this.updatePosition();if(this.viewer&&this.viewer.zoomScale<0.4){return}if(!this.isEnableBounce){this.show(this.viewer,this.transitionDefinition)}},hideWidget:function(){if(!this.isEnableBounce){this.hide(this.viewer)}},removeWidget:function(){this.hideWidget();this.dispose()},onShowWidget:function(oEvent){if(oEvent&&oEvent.source===this.viewer){this.showWidget()}},onHideWidget:function(oEvent){if(oEvent&&oEvent.source===this.viewer){this.hideWidget()}},onRemoveWidget:function(oEvent){if(oEvent&&oEvent.source===this.viewer&&!this.isEnableBounce){this.removeWidget()}},_bounce:function(){var self=this,oBBox=this.getBBox();if(this._group){this._group.y-=oBBox.height}else{this.moveBy(0,-oBBox.height)}this.updateDrawing(this.viewer,this._bounceUpAnimation,["x","y","cx","cy","path","points","groupTransform"]);setTimeout(function(){if(self._group){self._group.y+=oBBox.height}else{self.moveBy(0,oBBox.height)}self.updateDrawing(this.viewer,self._bounceDownAnimation,["x","y","cx","cy","path","points","groupTransform"])},this._bounceDuration)},_repeatBounce:function(){var self=this;if(this.bounceNumber!==undefined){--this.bounceNumber;if(this.bounceNumber<0){this.bounceNumber=undefined;this.isEnableBounce=false}}if(this.isEnableBounce){this._bounce();setTimeout(function(){if(self.isEnableBounce){self._repeatBounce()}},self._bounceDuration*2)}},startBounce:function(){if(!this._bounceUpAnimation){this._bounceUpAnimation=new sap.galilei.ui.common.TransitionDefinition({duration:this._bounceDuration,ease:sap.galilei.ui.common.EasingFunction.cubicInOut})}if(!this._bounceDownAnimation){this._bounceDownAnimation=new sap.galilei.ui.common.TransitionDefinition({duration:this._bounceDuration,ease:sap.galilei.ui.common.EasingFunction.bounce})}this.isEnableBounce=true;this._repeatBounce()},stopBounce:function(){this.isEnableBounce=false},disposeWidget:function(){this.isEnableBounce=false;this.removeEventHandlers();this.remove();if(this._group){this._group.dispose();this._group=undefined}this._parentWidget=undefined},dispose:function(){this.disposeWidget()}}});sap.galilei.ui.common.widget.defineWidget=function(oWidgetDef){var sWidgetName,WidgetClass;if(oWidgetDef){if(!oWidgetDef.parent){oWidgetDef.parent=sap.galilei.ui.common.widget.Widget}sWidgetName=oWidgetDef.widgetName;if(sWidgetName){oWidgetDef.shapeName=sWidgetName;delete oWidgetDef.widgetName}oWidgetDef.shapeCategory="Widget";oWidgetDef=sap.galilei.ui.common.shape.transformShapeDef(oWidgetDef);WidgetClass=sap.galilei.core.defineClass(oWidgetDef);if(sWidgetName){sap.galilei.ui.common.shape.ShapeRegistry.registerShape(sWidgetName,WidgetClass)}}return WidgetClass}}());
(function(){sap.galilei.ui.common.widget.Badge=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.Badge",widgetName:"Badge",properties:{cx:undefined,cy:undefined,x:{field:"_x",get:function(){if(this._cx!==undefined&&this._width!==undefined){return this._cx-this._width/2}else{return this._x}},set:function(value){if(value!==undefined&&this._width!==undefined){this._cx=value+this._width/2}else{this._x=value}}},y:{field:"_y",get:function(){if(this._cy!==undefined&&this._height!==undefined){return this._cy-this._height/2}else{return this._y}},set:function(value){if(value!==undefined&&this._height!==undefined){this._cy=value+this._height/2}else{this._y=value}}},rx:undefined,ry:undefined,outerOffset:1,outerStroke:undefined,outerStrokeWidth:1,outerStrokeDashArray:undefined,outerFill:"white",outerFilter:undefined,innerFill:"#0099EB",innerFilter:undefined,purpose:"Badge",suffix:undefined,isShowImage:{field:"_isShowImage",get:function(){if(this._isShowImage!==undefined){return this._isShowImage}return this.image!==undefined},set:function(bValue){this._isShowImage=bValue}},image:undefined,imageWidth:16,imageHeight:16,isShowText:{field:"_isShowText",get:function(){if(this._isShowText!==undefined){return this._isShowText}return this.text!==undefined},set:function(bValue){this._isShowText=bValue}},text:undefined,font:undefined,textColor:"black",textClass:undefined,isSupportHover:false,opacityHover:1,opacityOut:0.6,animationDuration:200,isSupportDrag:false,outerShape:undefined,innerShape:undefined,imageShape:undefined,textShape:undefined,icon:undefined,iconSize:16,iconClass:undefined,isShowIcon:{field:"_isShowIcon",get:function(){if(this._isShowIcon!==undefined){return this._isShowIcon}return this.icon!==undefined},set:function(bValue){this._isShowIcon=bValue}},iconShapeName:"IconFont",iconShape:undefined},methods:{createWidget:function(){if(!this.outerShape&&!this.innerShape){this.outerShape=new sap.galilei.ui.common.shape.RoundedRectangle();this.addSubShape(this.outerShape);this.innerShape=new sap.galilei.ui.common.shape.RoundedRectangle();this.addSubShape(this.innerShape);if(this.isShowIcon){if(this.iconShapeName!==undefined){this.iconShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(this.iconShapeName,{src:this.icon,size:this.iconSize});if(this.iconShape!==undefined){this.addSubShape(this.iconShape);this.isShowImage=false}}}if(this.isShowImage&&this.image){this.imageShape=new sap.galilei.ui.common.shape.Image();this.addSubShape(this.imageShape)}if(this.isShowText&&this.text){this.textShape=new sap.galilei.ui.common.shape.Text();this.addSubShape(this.textShape)}this.updateWidget()}},updateWidget:function(){var x,y,width=this.width,height=this.height,outerSize=this.outerOffset,innerWidth,innerHeight,imageWidth=0,imageHeight=0,textWidth=0,textHeight=0,imageTextMargin=8,imageTextPadding=0,rx=this.rx,ry=this.ry,r,offsetX,offsetY,opacity=this.opacity,iconFontSize=this.iconSize,sPurpose=this.purpose||"",sCssClassRoot="sapGalilei"+sPurpose,sCssClass;if(isNaN(this.cx)){if(this.x!==undefined&&this.width!==undefined){this.cx=this.x+this.width/2}else{this.cx=0}}if(isNaN(this.cy)){if(this.y!==undefined&&this.height!==undefined){this.cy=this.y+this.height/2}else{this.cy=0}}if(isNaN(outerSize)){outerSize=0}if(width!==0&&!isNaN(width)){innerWidth=width-outerSize-outerSize}if(height!==0&&!isNaN(height)){innerHeight=height-outerSize-outerSize}if((this.isShowImage||this.isShowIcon)&&this.isShowText&&this.text){imageTextPadding=4}if(this.isShowImage){imageWidth=this.imageWidth;imageHeight=this.imageHeight}if(this.isShowIcon){imageWidth=iconFontSize;imageHeight=iconFontSize}if(this.isShowText&&this.text){if(!this.font){this.font=sap.galilei.ui.common.Text.DEFAULT_UI_FONT}textWidth=sap.galilei.ui.common.Text.measureTextLineWidth(this.text,this.font)+4;textHeight=sap.galilei.ui.common.Font.getFontHeight(this.font);innerWidth=imageTextMargin+imageWidth+imageTextPadding+textWidth+imageTextMargin;width=innerWidth+outerSize+outerSize}if(width===0||isNaN(width)){innerWidth=imageTextMargin+imageWidth+imageTextMargin;width=innerWidth+outerSize+outerSize}if(height===0||isNaN(height)){innerHeight=imageTextMargin+Math.max(imageHeight,textHeight)+imageTextMargin;height=innerHeight+outerSize+outerSize}if(isNaN(rx)){rx=width/2}if(isNaN(ry)){ry=height/2}r=Math.min(rx,ry);x=this.x;y=this.y;if(opacity===undefined&&this.isSupportHover){opacity=this.opacityOut}this.opacity=opacity;sCssClass=sCssClassRoot;if(this.suffix!==undefined){sCssClass+="-";sCssClass+=this.suffix}this.domClass=sCssClass;if(this.outerShape){sCssClass=sCssClassRoot+"Outer";if(this.suffix!==undefined){sCssClass+="-";sCssClass+=this.suffix}this.outerShape.set({domClass:sCssClass,x:x,y:y,width:width,height:height,rx:r,ry:r,stroke:this.outerStroke,strokeWidth:this.outerStrokeWidth,strokeDashArray:this.outerStrokeDashArray,fill:this.outerFill,filter:this.outerFilter})}if(!this.textShape){rx=this.rx;ry=this.ry;if(rx===undefined||isNaN(rx)){rx=innerWidth/2}if(ry===undefined||isNaN(ry)){ry=innerHeight/2}r=Math.min(rx,ry)}if(this.innerShape){sCssClass=sCssClassRoot+"Inner";if(this.suffix!==undefined){sCssClass+="-";sCssClass+=this.suffix}this.innerShape.set({domClass:sCssClass,x:x+outerSize,y:y+outerSize,width:innerWidth,height:innerHeight,rx:r,ry:r,stroke:"none",fill:this.innerFill,filter:this.innerFilter})}if(this.imageShape){sCssClass=sCssClassRoot+"Image";if(this.suffix!==undefined){sCssClass+="-";sCssClass+=this.suffix}if(!this.textShape){offsetX=(width-imageWidth)/2}else{offsetX=outerSize+imageTextMargin}offsetY=(height-imageHeight)/2;this.imageShape.set({domClass:sCssClass,x:x+offsetX,y:y+offsetY,width:imageWidth,height:imageHeight,href:this.image})}if(this.iconShape){sCssClass=sCssClassRoot+"Icon";if(this.suffix!==undefined){sCssClass+="-";sCssClass+=this.suffix}if(this.iconClass){sCssClass+=", "+this.iconClass}if(!this.textShape){offsetX=(width-iconFontSize)/2}else{offsetX=outerSize+imageTextMargin}offsetY=(height-iconFontSize)/2;this.iconShape.set({domClass:sCssClass,x:x+offsetX,y:y+offsetY,width:iconFontSize,height:iconFontSize,fill:this.textColor,verticalAlignment:sap.galilei.ui.common.VerticalAlignment.middle,horizontalAlignment:sap.galilei.ui.common.HorizontalAlignment.center})}if(this.textShape){sCssClass=sCssClassRoot+"Text";if(this.suffix!==undefined){sCssClass+="-";sCssClass+=this.suffix}if(this.textClass){sCssClass+=", "+this.textClass}offsetX=outerSize+imageTextMargin+imageWidth+imageTextPadding;offsetY=outerSize;this.textShape.set({domClass:sCssClass,x:x+offsetX,y:y+offsetY,width:textWidth,height:innerHeight,text:this.text,font:this.font,fill:this.textColor,verticalAlignment:sap.galilei.ui.common.VerticalAlignment.middle})}if(this.width===undefined||this.width===0||isNaN(this.width)){this.width=width}if(this.height===undefined||this.height===0||isNaN(this.height)){this.height=height}this.addEventHandlers()},addEventHandlers:function(){if(!this.eventHandlers){if(this.isSupportDrag){this.on("pointerdown",function(oEvent){oEvent.preventDefault();oEvent.stopPropagation()},this);this.on("dragstart",function(oEvent){var aCenter=this.getCenter();this._isDragging=true;this._cx0=aCenter[0];this._cy0=aCenter[1]},this);this.on("dragend",function(oEvent){delete this._isDragging;delete this._cx0;delete this._cy0},this)}if(this.isSupportHover&&this.opacityHover!==undefined&&this.opacityOut!==undefined){this.on("pointerover",function(oEvent){if(!this._isDragging){this.d3Node.transition().duration(this.animationDuration).attr("opacity",this.opacityHover);if(this.isSupportDrag){this.opacity=this.opacityHover}}},this);this.on("pointerout",function(oEvent){if(!this._isDragging){this.d3Node.transition().duration(this.animationDuration).attr("opacity",this.opacityOut);if(this.isSupportDrag){this.opacity=this.opacityOut}}},this)}}},getCenter:function(){if(this.cx!==undefined&&this.cy!==undefined){return[this.cx,this.cy]}var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){var aCenter=this.getCenter();if(aCenter){this.moveBy(x-aCenter[0],y-aCenter[1])}this.cx=x;this.cy=y},disposeBadge:function(){this.defaultWidget();this.imageShape=undefined;this.iconShape=undefined;this.textShape=undefined},dispose:function(){this.disposeBadge()}}})}());
(function(){sap.galilei.ui.common.widget.Button=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.Button",parent:sap.galilei.ui.common.widget.Badge,widgetName:"Button",properties:{},methods:{}})}());
(function(){sap.galilei.ui.common.widget.ButtonPad=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.ButtonPad",widgetName:"ButtonPad",properties:{attachToBBox:undefined,isBBoxViewCoordinates:false,buttonsOffset:0,buttonsDefinition:undefined},methods:{create:function(oViewer,oTransitionDef,oBBox,aButtonDef){var oRect,aPt,oContextButton,radius=16,oLayer,oParamCommon,oParam,index,oButtonParam,nHandleRadius=sap.galilei.ui.common.tracker.Handle.DEFAULT_SIZE/2,nSpeedMenuOffset=1,nButtonOffset=this.buttonsOffset,aButtons=[],nMaxWidth=0,j,oShape,nDeltaWidth;if(oViewer&&oBBox&&aButtonDef){this.viewer=oViewer;this.transitionDefinition=undefined;this.buttonsDefinition=aButtonDef;oRect=oBBox.clone();oRect.inflate(nHandleRadius+nSpeedMenuOffset,nHandleRadius+nSpeedMenuOffset,false);this.attachTo=oRect;this.attachPosition=sap.galilei.ui.common.DockPosition.right;this.alignPosition=sap.galilei.ui.common.DockPosition.left;aPt=[0,0];oParamCommon={width:radius+radius,height:radius+radius,outerOffset:2,outerFill:"white",innerFill:"#009DE0"};for(index=0;index<aButtonDef.length;index++){oButtonParam=aButtonDef[index];oParam={cx:aPt[0],cy:aPt[1],image:oButtonParam.image,imageWidth:oButtonParam.imageWidth,imageHeight:oButtonParam.imageHeight};sap.galilei.core.copyProperties(oParam,oParamCommon);sap.galilei.core.copyProperties(oParam,oButtonParam);oContextButton=this.createButton(oParam,oButtonParam);if(oContextButton){aButtons.push(oContextButton);if(oContextButton.shape&&oContextButton.shape.length>0){nMaxWidth=Math.max(nMaxWidth,oContextButton.shape[0].width)}aPt[1]+=radius+radius+nButtonOffset}}for(index=0;index<aButtons.length;index++){oContextButton=aButtons[index];if(oContextButton.isShowText){if(oContextButton.shape&&oContextButton.shape.length>0){for(j=0;j<oContextButton.shape.length;j++){oShape=oContextButton.shape[j];if(j===0){nDeltaWidth=nMaxWidth-oShape.width;oShape.width=nMaxWidth}else{if(!sap.galilei.core.isInstanceOf(oShape,"sap.galilei.ui.common.shape.Image")&&!sap.galilei.core.isInstanceOf(oShape,"sap.galilei.ui.common.shape.IconFont")){oShape.width+=nDeltaWidth}}}}}}this.shape=aButtons;this.updatePosition(false);oLayer=this.getFixedLayer(oViewer);this.draw(oViewer,oLayer&&oLayer.d3Layer)}},createButton:function(oParam,oButtonParam){if(oParam){return new sap.galilei.ui.common.widget.Button(oParam)}else{return undefined}}}})}());
(function(){sap.galilei.ui.common.widget.DiagramOverview=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.DiagramOverview",widgetName:"DiagramOverview",properties:{opacityHover:1,opacityOut:0.5,animationDuration:200,isAutoHide:false,state:undefined,isSupportDrag:true,TOOLTIP_SHOW:"Show Overview (F9)",TOOLTIP_HIDE:"Hide Overview (F9)"},methods:{create:function(oViewer,oZoomLayer){var self=this,oPosition,oPath,oBBox,oRect,aShapes=[];this.viewer=oViewer;this.initializeContainerDivAndActiveRectangle();if(this._overviewContainer){if(!this._oOverviewButtonToggle){oPosition=this._computePosition();this._oOverviewButtonToggle=this.createGroup();oPath=this.createPath({id:this._overviewToggleDivId+"-rectangle",fill:"darkgray",path:oPosition.path},function(e){self._onSwitchToggle(e)});oBBox=oPath.getBBox();oRect=this.createRoundedRectangle({r:4,x:oBBox.x,y:oBBox.y,width:20,height:20,fill:"white",fillOpacity:0,},function(e){self._onSwitchToggle(e)});this._oOverviewButtonToggle.addSubShape(oRect);this._oOverviewButtonToggle.addSubShape(oPath);this._oOverviewButtonToggle.cursor="pointer";this._oOverviewButtonToggle.transform="rotate("+oPosition.rotate+")"}this._panGroup=this.createGroup({opacity:this.opacityOut,strokeOpacity:this.opacityOut},function(){self._panGroup.d3Node.transition().duration(this.animationDuration).attr("opacity",self.opacityHover).attr("stroke-opacity",self.opacityHover)},function(){self._panGroup.d3Node.transition().duration(this.animationDuration).attr("opacity",self.opacityOut).attr("stroke-opacity",self.opacityOut)});this._panGroup.addSubShape(this._oOverviewButtonToggle);aShapes.push(this._panGroup);this.shape=aShapes;this.draw(oViewer,this._overviewToggleSVG);this._oOverviewButtonToggle.d3Node.append("svg:title").text(this.TOOLTIP_SHOW)}},initializeContainerDivAndActiveRectangle:function(){if((this._overviewContainer&&this._overviewContainer.node())||this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.hidden){return}var oViewerDiv=this.viewer.d3ParentNode[0][0],self=this,oOverviewContainerDiv,oToggleDiv,oToggle,sMainShapeLayerId=this.viewer.mainShapeLayer.id,oDivPositions,sPosition;sPosition=window.getComputedStyle(oViewerDiv,null).getPropertyValue("position");if(sPosition==""||sPosition==="static"){oViewerDiv.style.position="relative"}if(this.viewer.overviewId){this._overviewContainer=d3.select("#"+this.viewer.overviewId)}if(!this._overviewContainer||!this._overviewContainer.node()){this.viewer.overviewId=oViewerDiv.id+"-overview";oOverviewContainerDiv=document.createElement("div");oOverviewContainerDiv.id=this.viewer.overviewId;oViewerDiv.appendChild(oOverviewContainerDiv);this._overviewContainer=d3.select("#"+this.viewer.overviewId);console.info("Created automatically overview DIV ("+this.viewer.overviewId+")")}else{oOverviewContainerDiv=jQuery("#"+oViewerDiv.id+"-overview")[0];if(oOverviewContainerDiv){while(oOverviewContainerDiv.firstChild){oOverviewContainerDiv.removeChild(oOverviewContainerDiv.firstChild)}}oToggleDiv=jQuery("#"+oViewerDiv.id+"-overview-toggle")[0];if(oToggleDiv){oToggleDiv.parentNode.removeChild(oToggleDiv)}}oDivPositions=this._computePosition();if(this._overviewContainer!=undefined){if(this._overviewContainer.node()!=undefined){this._overviewContainer.node().setAttribute("class","sapGalileiOverviewContainer")}this._overviewContainer.style("position","absolute");this._overviewContainer.style(oDivPositions.containerPosition[0][0],oDivPositions.containerPosition[0][1]+"px");this._overviewContainer.style(oDivPositions.containerPosition[1][0],oDivPositions.containerPosition[1][1]+"px");this._overviewContainer.style("width",this.viewer.overviewWidth+"px");this._overviewContainer.style("height",this.viewer.overviewHeight+"px");this._overviewContainer.style("overflow","hidden");if(this.viewer.overviewSetDefaultStyles){this._overviewContainer.style("border","1px solid lightGray");this._overviewContainer.style("background","white");this._overviewContainer.style("border-radius","4px");this._overviewContainer.style("box-shadow","-1px 2px 4px 1px rgba(100, 100, 100, 0.2),-1px 2px 4px rgba(255, 255, 255, 0.3) inset")}}oToggleDiv=document.createElement("div");this._overviewToggleDivId=oViewerDiv.id+"-overview-toggle";oToggleDiv.id=this._overviewToggleDivId;oViewerDiv.appendChild(oToggleDiv);oToggle=d3.select("#"+this._overviewToggleDivId);this._overviewToggleSVG=oToggle.append("svg:svg").attr("id",oViewerDiv.id+"-overview-toggle-svg").attr("height","100%").attr("width","100%");this._overviewToggleSVG.node().setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");this._overviewToggleSVG.node().setAttribute("xmlns:galilei",sap.galilei.ui.common.NAMESPACE_GALILEI);oToggle.style("position","absolute");oToggle.style(oDivPositions.togglePosition[0][0],oDivPositions.togglePosition[0][1]+"px");oToggle.style(oDivPositions.togglePosition[1][0],oDivPositions.togglePosition[1][1]+"px");oToggle.style("height","20px");oToggle.style("width","20px");this._oOverviewSVGRoot=this._overviewContainer.append("svg:svg").attr("id",oViewerDiv.id+"-svgRootOverview").attr("height","100%").attr("fill","gray").attr("width","100%");if(this._oOverviewSVGRoot.node()!=undefined){this._oOverviewSVGRoot.node().setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");this._oOverviewSVGRoot.node().setAttribute("xmlns:galilei",sap.galilei.ui.common.NAMESPACE_GALILEI)}var oOverviewGroup=this.createGroup({});this._overviewActiveRectangleId=oViewerDiv.id+"-svgRootOverviewPort";this._oOverviewRectangle=this.createRoundedRectangle({id:this._overviewActiveRectangleId});this._oOverviewRectangle.addClass("sapGalileiOverviewRectangle");if(this.viewer.overviewSetDefaultStyles){this._oOverviewRectangle.fill="#C9E0ED";this._oOverviewRectangle.fillOpacity=0.4;this._oOverviewRectangle.cursor="move";this._oOverviewRectangle.stroke="#6EB1FA";this._oOverviewRectangle.strokeWidth=3}oOverviewGroup.addSubShape(this.createImage({href:"#svgPageLimitLayer-"+this.viewer.viewerNumber,width:this.viewer.overviewWidth,height:this.viewer.overviewHeight,useReference:true}));oOverviewGroup.addSubShape(this.createImage({href:"#"+sMainShapeLayerId,width:this.viewer.overviewWidth,height:this.viewer.overviewHeight,useReference:true}));oOverviewGroup.addSubShape(this._oOverviewRectangle);oOverviewGroup.draw(this.viewer,this._oOverviewSVGRoot);if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){this._overviewContainer.style("display","block");this.viewer.enableAnimation=false;this._updateOverviewViewBox()}else{this._overviewContainer.style("display","none")}this._oOverviewRectangle.on("mouseover",function(oEvent){if(!this._dragEventAdded){this.addDragEventHandlers();this._dragEventAdded=true}},this);this._oOverviewRectangle.on("pointerdown",function(oEvent){oEvent.preventDefault();oEvent.stopPropagation()},this)},onZoomPan:function(eventName,scale,translate){if(this._oOverviewSVGRoot){if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){this._updateOverviewViewBox(scale,translate)}}},updateOverviewLocation:function(){var oDivPositions=this._computePosition(),oToggle=d3.select("#"+this._overviewToggleDivId);if(oToggle){oToggle.style(oDivPositions.togglePosition[0][0],oDivPositions.togglePosition[0][1]+"px");oToggle.style(oDivPositions.togglePosition[1][0],oDivPositions.togglePosition[1][1]+"px")}if(this._overviewContainer){this._overviewContainer.style("top",oDivPositions.containerY+"px");this._overviewContainer.style("left",oDivPositions.containerX+"px");this._updateOverviewViewBox()}},_updateOverviewViewBox:function(scale,translate){var oGlobalViewRect=sap.galilei.ui.common.svg.Svg.getChildNodesBBox(this.viewer.mainShapeLayer.svgLayer,true,false),oViewRect=this.viewer.getViewRect().clone(),oOverviewPort=jQuery("#"+this._overviewActiveRectangleId)[0],oLastZoomPan=this.viewer._lastZoomPan,sViewBox,nScale,nPadding=20,aTranslate;nScale=scale||(oLastZoomPan&&oLastZoomPan._event&&oLastZoomPan._event.scale);aTranslate=translate||(oLastZoomPan&&oLastZoomPan._event&&oLastZoomPan._event.translate);if(!this._oViewRect){this._oViewRect={};this._oGlobalViewRect={}}if(!oGlobalViewRect){oGlobalViewRect=oViewRect}else{oGlobalViewRect.unionRect(oViewRect)}oGlobalViewRect.x-=nPadding;oGlobalViewRect.y-=nPadding;oGlobalViewRect.width+=(nPadding*2);oGlobalViewRect.height+=(nPadding*2);this._oViewRect.x=oViewRect.x;this._oViewRect.y=oViewRect.y;this._oViewRect.width=oViewRect.width;this._oViewRect.height=oViewRect.height;this._oGlobalViewRect.x=oGlobalViewRect.x;this._oGlobalViewRect.y=oGlobalViewRect.y;this._oGlobalViewRect.width=oGlobalViewRect.width;this._oGlobalViewRect.height=oGlobalViewRect.height;if(aTranslate&&aTranslate.length==2&&aTranslate[0]&&aTranslate[1]&&nScale){oGlobalViewRect.width*=nScale;oGlobalViewRect.height*=nScale;oGlobalViewRect.x=(oGlobalViewRect.x*nScale+aTranslate[0]);oGlobalViewRect.y=(oGlobalViewRect.y*nScale+aTranslate[1]);oViewRect.x=oViewRect.x*nScale+aTranslate[0];oViewRect.y=oViewRect.y*nScale+aTranslate[1];oViewRect.width=oViewRect.width*nScale;oViewRect.height=oViewRect.height*nScale}if(this._oOverviewSVGRoot.node()!=undefined){this._oOverviewSVGRoot.node().setAttribute("viewBox",oGlobalViewRect.x+" "+oGlobalViewRect.y+" "+oGlobalViewRect.width+" "+oGlobalViewRect.height)}if(oOverviewPort){oOverviewPort.setAttribute("x",oViewRect.x);oOverviewPort.setAttribute("y",oViewRect.y);oOverviewPort.setAttribute("width",oViewRect.width);oOverviewPort.setAttribute("height",oViewRect.height)}},_onSwitchToggle:function(oEvent){var oTarget=oEvent.target||oEvent.srcElement;if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.collapsed){var oLastZoomPan=this.viewer._lastZoomPan,nScale=(oLastZoomPan&&oLastZoomPan._event&&oLastZoomPan._event.scale),aTranslate=(oLastZoomPan&&oLastZoomPan._event&&oLastZoomPan._event.translate);this.viewer.overviewState=sap.galilei.ui.common.FolderStatus.expanded;this._updateToggleAndContainer(oTarget);this._updateOverviewViewBox();if(nScale&&aTranslate){this.viewer.notifyLayers("onZoomPan",nScale,aTranslate,false)}}else{this.viewer.overviewState=sap.galilei.ui.common.FolderStatus.collapsed;this._updateToggleAndContainer(oTarget)}},_updateToggleAndContainer:function(oElement){var oToggleDiv=this._overviewToggleSVG[0][0].parentElement,bExpanded,oPosition,oPath,oGroup;if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){bExpanded=true;this._overviewContainer.style("display","block");this.viewer.enableAnimation=false}else{bExpanded=false;this._overviewContainer.style("display","none");this.viewer.enableAnimation=true}oPosition=this._computePosition();if(oElement.nodeName==="path"||oElement.nodeName==="rect"){oPath=oElement;oGroup=oPath.parentNode}if(oPath){oPath.setAttribute("d",oPosition.path)}oToggleDiv.style[oPosition.togglePosition[0][0]]=oPosition.togglePosition[0][1]+"px";oToggleDiv.style[oPosition.togglePosition[1][0]]=oPosition.togglePosition[1][1]+"px";if(oGroup){oGroup.setAttribute("transform","rotate("+oPosition.rotate+")");if(oGroup.childNodes.length>=3&&oGroup.childNodes[2].nodeName==="title"){oGroup.childNodes[2].textContent=bExpanded?this.TOOLTIP_HIDE:this.TOOLTIP_SHOW}}},_getPathElement:function(){var oPath;if(this._oOverviewButtonToggle!==undefined&&this._oOverviewButtonToggle.isDrawn){oPath=this._oOverviewButtonToggle.shapes[1].svgNode}return oPath},showOverview:function(){if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.collapsed){this.toggleOverview()}},hideOverview:function(){if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){this.toggleOverview()}},toggleOverview:function(){var oPath;if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.collapsed||this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){oPath=this._getPathElement();this._onSwitchToggle({srcElement:oPath})}},_computePosition:function(){var ret={path:"M1,1 l10,7 l4,-7 l0,14 l-14,0 l7,-4 z"},nContainerPadding=5,nToggleSize=10,nTogglePadding=nContainerPadding+nToggleSize;if(this.viewer.overviewHorizontalAlignement===sap.galilei.ui.common.HorizontalAlignment.right){if(this.viewer.overviewVerticalAlignement===sap.galilei.ui.common.VerticalAlignment.bottom){ret.containerPosition=[["right",nContainerPadding],["bottom",nContainerPadding]];if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){ret.togglePosition=[["right",this.viewer.overviewWidth-nTogglePadding],["bottom",this.viewer.overviewHeight-nTogglePadding]];ret.rotate=0}else{ret.togglePosition=[["right",nContainerPadding],["bottom",nContainerPadding]];ret.rotate="180, 10, 10"}}else{ret.containerPosition=[["right",nContainerPadding],["top",nContainerPadding]];if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){ret.togglePosition=[["right",this.viewer.overviewWidth-nTogglePadding],["top",this.viewer.overviewHeight-nTogglePadding]];ret.rotate="270, 10, 10"}else{ret.togglePosition=[["right",nContainerPadding],["top",nContainerPadding]];ret.rotate="90, 10, 10"}}}else{if(this.viewer.overviewVerticalAlignement===sap.galilei.ui.common.VerticalAlignment.bottom){ret.containerPosition=[["left",nContainerPadding],["bottom",nContainerPadding]];if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){ret.togglePosition=[["left",this.viewer.overviewWidth-nTogglePadding],["bottom",this.viewer.overviewHeight-nTogglePadding]];ret.rotate="90, 10, 10"}else{ret.togglePosition=[["left",nContainerPadding],["bottom",nContainerPadding]];ret.rotate="270, 10, 10"}}else{ret.containerPosition=[["left",nContainerPadding],["top",nContainerPadding]];if(this.viewer.overviewState===sap.galilei.ui.common.FolderStatus.expanded){ret.togglePosition=[["left",this.viewer.overviewWidth-nTogglePadding],["top",this.viewer.overviewHeight-nTogglePadding]];ret.rotate="180, 10, 10"}else{ret.togglePosition=[["left",nContainerPadding],["top",nContainerPadding]];ret.rotate="0"}}}return ret},addDragEventHandlers:function(){if(this.isSupportDrag){var oOverviewPort=jQuery("#"+this._overviewActiveRectangleId)[0];this._oOverviewRectangle.on("dragstart",function(oEvent){this._overviewStartDragX=parseInt(oOverviewPort.getAttribute("x"));this._overviewStartDragY=parseInt(oOverviewPort.getAttribute("y"))},this);this._oOverviewRectangle.on("drag",function(oEvent){var oViewBox=this._oOverviewSVGRoot[0][0].viewBox.animVal,nOverviewHWFactor=this.viewer.overviewHeight/this.viewer.overviewWidth,nBoxHWFactor=oViewBox.height/oViewBox.width,nVScale=(oViewBox.height/this.viewer.overviewHeight),nHScale=(oViewBox.width/this.viewer.overviewWidth);if(nBoxHWFactor>1&&nOverviewHWFactor<1){nVScale*=1;nHScale*=(nBoxHWFactor/nOverviewHWFactor)}else{if(nOverviewHWFactor>1&&nBoxHWFactor<1){nHScale*=1;nVScale*=(nOverviewHWFactor/nBoxHWFactor)}}oOverviewPort.setAttribute("x",this._overviewStartDragX+oEvent.gesture.deltaX*nHScale);oOverviewPort.setAttribute("y",this._overviewStartDragY+oEvent.gesture.deltaY*nVScale)},this);this._oOverviewRectangle.on("dragend",function(oEvent){var oViewBox=this._oOverviewSVGRoot[0][0].viewBox.animVal,nOverviewHWFactor=this.viewer.overviewHeight/this.viewer.overviewWidth,nBoxHWFactor=oViewBox.height/oViewBox.width,nVScale=(oViewBox.height/this.viewer.overviewHeight),nHScale=(oViewBox.width/this.viewer.overviewWidth);if(nBoxHWFactor>1&&nOverviewHWFactor<1){nVScale*=1;nHScale*=(nBoxHWFactor/nOverviewHWFactor)}else{if(nOverviewHWFactor>1&&nBoxHWFactor<1){nHScale*=1;nVScale*=(nOverviewHWFactor/nBoxHWFactor)}}this.viewer.panView(-oEvent.gesture.deltaX*nHScale,-oEvent.gesture.deltaY*nVScale)},this)}},createGroup:function(oParam,fMouseOver,fMouseOut){var oGroup=new sap.galilei.ui.common.shape.Group(oParam);if(fMouseOver){oGroup.on("mouseover",fMouseOver)}if(fMouseOut){oGroup.on("mouseout",fMouseOut)}return oGroup},createPath:function(oParam,fMouseUp,nRotate){var oPath=new sap.galilei.ui.common.shape.Path();oPath.set(oParam);if(fMouseUp){oPath.on("mouseup",fMouseUp)}return oPath},createImage:function(oParam){var oImage=new sap.galilei.ui.common.shape.Image(oParam);return oImage},createRoundedRectangle:function(oParam,fMouseUp){var oRectangle=new sap.galilei.ui.common.shape.RoundedRectangle();oRectangle.set(oParam);if(fMouseUp){oRectangle.on("mouseup",fMouseUp)}return oRectangle}}});var oProps={overviewId:undefined,overviewHorizontalAlignement:sap.galilei.ui.common.HorizontalAlignment.right,overviewVerticalAlignement:sap.galilei.ui.common.VerticalAlignment.bottom,overviewState:sap.galilei.ui.common.FolderStatus.collapsed,overviewSetDefaultStyles:true,overviewWidth:450,overviewHeight:250},oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)}());
(function(){namespace("sap.galilei.ui.common.command");sap.galilei.ui.common.command.Command=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.command.Command",properties:{name:undefined,displayName:undefined,tooltip:undefined,type:undefined,parameters:undefined,isEnabled:true,isHidden:false,smallIcon:undefined,smallIconWidth:16,smallIconHeight:16,largeIcon:undefined,largeIconWidth:32,largeIconHeight:32,icon:undefined,iconShapeName:undefined,iconColor:undefined,iconClass:undefined,textColor:undefined,textClass:undefined,publish:undefined,viewer:undefined},methods:{canExecute:function(oParam){return this.isEnabled&&!this.isHidden},execute:undefined,executeCommand:function(oParam){if(!this.canExecute||(this.canExecute&&this.canExecute(oParam))){if(this.execute){this.execute(oParam)}else{if(this.publish&&this.publish.type){sap.galilei.core.Event.publish(this.publish.type,this.publish.source,this.publish.target,oParam)}}}},getParameters:function(oParam,bSave){},dispose:function(){}}});sap.galilei.ui.common.command.CommandRegistry=new sap.galilei.core.DefaultLookupClass();sap.galilei.ui.common.command.getCommand=function(sCommandName){var oCommand;if(sCommandName&&sap.galilei.ui.common.command.CommandRegistry){oCommand=sap.galilei.ui.common.command.CommandRegistry.get(sCommandName)}return oCommand};sap.galilei.ui.common.command.addCommand=function(sCommandName,oCommand){if(sCommandName&&oCommand&&sap.galilei.ui.common.command.CommandRegistry){sap.galilei.ui.common.command.CommandRegistry.add(sCommandName,oCommand)}};sap.galilei.ui.common.command.removeCommand=function(sCommandName){if(sCommandName&&sap.galilei.ui.common.command.CommandRegistry){sap.galilei.ui.common.command.CommandRegistry.remove(sCommandName)}}}());
"use strict";sap.galilei.ui.common.svg.GridLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.GridLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.GRID_LAYER,id:sap.galilei.ui.common.svg.Layer.GRID_LAYER,domClass:sap.galilei.ui.common.svg.Layer.GRID_LAYER},methods:{add:function(){return this.createGridLayer()},createGridLayer:function(){if(this.viewer&&!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass);if(!this.viewer.showGrid){this.d3Layer.attr("opacity",0)}}this.onUpdatePageSize();this.addGridPattern();this.updateGrid();return this.d3Layer},onUpdatePageSize:function(sEventHandlerName){if(this.d3Layer&&this.viewer){this.d3Layer.attr("x",this.viewer.allPagesLeft).attr("y",this.viewer.allPagesTop).attr("width",this.viewer.allPagesWidth).attr("height",this.viewer.allPagesHeight)}return this.d3Layer},addGridPattern:function(){if(this.d3Layer&&this.viewer){var d3SvgDefs=this.viewer.d3SvgDefs,d3Pattern;d3Pattern=d3SvgDefs.select("#gridPattern-"+this.viewer.viewerNumber);if(!d3Pattern.node()){d3Pattern=d3SvgDefs.append("svg:pattern").attr("id","gridPattern-"+this.viewer.viewerNumber).attr("patternUnits","userSpaceOnUse")}this.onUpdateGridPattern()}},onUpdateGridPattern:function(){if(this.d3Layer&&this.viewer){var d3SvgDefs=this.viewer.d3SvgDefs,nSize=5*this.viewer.gridSize,d3Pattern,svgPattern,d3Border1,d3Border2,path;d3Pattern=d3SvgDefs.select("#gridPattern-"+this.viewer.viewerNumber);svgPattern=d3Pattern.node();if(svgPattern){d3Pattern.attr("width",nSize).attr("height",nSize);if(svgPattern.hasChildNodes()){for(path=svgPattern.firstChild;path;path=svgPattern.firstChild){svgPattern.removeChild(path)}}d3Border1=d3Pattern.append("svg:path").attr("d","M0 "+this.viewer.gridSize+" H"+nSize+" M0 "+2*this.viewer.gridSize+" H"+nSize+" M0 "+3*this.viewer.gridSize+" H"+nSize+" M0 "+4*this.viewer.gridSize+" H"+nSize+" M"+this.viewer.gridSize+" 0 V"+nSize+" M"+2*this.viewer.gridSize+" 0 V"+nSize+" M"+3*this.viewer.gridSize+" 0 V"+nSize+" M"+4*this.viewer.gridSize+" 0 V"+nSize).attr("fill","none").attr("stroke",this.viewer.gridBorderInnerColor).attr("stroke-width",1);d3Border2=d3Pattern.append("svg:path").attr("d","M"+nSize+" 0 L0 0 L0 "+nSize+" L"+nSize+" "+nSize+" L"+nSize+" 0").attr("fill","none").attr("stroke",this.viewer.gridBorderOuterColor).attr("stroke-width",1.5);this.d3Layer.attr("fill","url(#gridPattern-"+this.viewer.viewerNumber+")")}}},updateGrid:function(bShowGrid){if(this.d3Layer&&this.viewer){if(bShowGrid===undefined){bShowGrid=this.viewer.showGrid}if(bShowGrid){this.show(true)}else{this.hide(true)}}},onUpdateGrid:function(){this.updateGrid()},onZoomPanUpdate:function(sEventHandlerName,scale,translate,bUseAnimation){if(this.d3Layer&&this.viewer){var oldGridVisible=(this.viewer.oldZoomScale>=0.5)&&this.viewer.showGrid,newGridVisible=(scale>=0.5)&&this.viewer.showGrid;if(newGridVisible!==oldGridVisible){this.updateGrid(newGridVisible)}}}},statics:{ID:sap.galilei.ui.common.svg.Layer.GRID_LAYER,NAME:sap.galilei.ui.common.svg.Layer.GRID_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.GRID_LAYER}});(function(){sap.galilei.core.extendStatic(sap.galilei.ui.common.svg.Viewer,{GRID_SIZE:10,GRID_BORDER_INNER_COLOR:"#CEE0F2",GRID_BORDER_OUTER_COLOR:"#ADCDED"});var oProps={showGrid:{value:false,onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGrid",newValue,oldValue)}},gridSize:{expression:"sap.galilei.ui.common.svg.Viewer.GRID_SIZE",onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGridPattern",newValue,oldValue)}},gridBorderInnerColor:{expression:"sap.galilei.ui.common.svg.Viewer.GRID_BORDER_INNER_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGridPattern",newValue,oldValue)}},gridBorderOuterColor:{expression:"sap.galilei.ui.common.svg.Viewer.GRID_BORDER_OUTER_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGridPattern",newValue,oldValue)}}},oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)}());
(function(){sap.galilei.ui.common.svg.PageBackgroundLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.PageBackgroundLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,id:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,domClass:"sapGalileiPageBackground"},methods:{add:function(){if(!this.d3Layer&&this.viewer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass).attr("fill",this.viewer.pageBackgroundFill)}this.onUpdatePageSize();return this.d3Layer},onUpdatePageSize:function(sEventHandlerName){if(this.d3Layer&&this.viewer){this.d3Layer.attr("x",this.viewer.allPagesLeft).attr("y",this.viewer.allPagesTop).attr("width",this.viewer.allPagesWidth).attr("height",this.viewer.allPagesHeight)}return this.d3Layer},onUpdatePageBackground:function(){if(this.d3Layer&&this.viewer){this.d3Layer.attr("fill",this.viewer.pageBackgroundFill)}return this.d3Layer}},statics:{ID:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,NAME:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER}})}());(function(){sap.galilei.core.extendStatic(sap.galilei.ui.common.svg.Viewer,{PAGE_BACKGROUND_COLOR:"#FFFFFF"});var oProps={pageBackgroundFill:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_BACKGROUND_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdatePageBackground",newValue,oldValue)}}},oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)}());
(function(){sap.galilei.ui.common.svg.PageLimitLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.PageLimitLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,id:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,domClass:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER},methods:{add:function(){if(!this.d3Layer&&this.viewer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass).attr("fill","#FFFFFF")}this.onUpdatePageSize();this.addPagePattern();this.onUpdatePageLimit();return this.d3Layer},addPagePattern:function(){var d3SvgDefs=this.viewer.d3SvgDefs,d3Pattern;d3Pattern=d3SvgDefs.select("#pagePattern-"+this.viewer.viewerNumber);if(!d3Pattern.node()){d3Pattern=d3SvgDefs.append("svg:pattern").attr("id","pagePattern-"+this.viewer.viewerNumber).attr("patternUnits","userSpaceOnUse")}this.onUpdatePagePattern();this.onUpdatePageLimit();return d3Pattern},onUpdatePageSize:function(sEventHandlerName){if(this.d3Layer&&this.viewer){this.d3Layer.attr("x",this.viewer.allPagesLeft).attr("y",this.viewer.allPagesTop).attr("width",this.viewer.allPagesWidth).attr("height",this.viewer.allPagesHeight);this.onUpdatePagePattern()}return this.d3Layer},onUpdatePagePattern:function(){if(this.viewer&&this.viewer.showPageLimit){var d3SvgDefs=this.viewer.d3SvgDefs,nSizeH=this.viewer.pageWidth,nSizeV=this.viewer.pageHeight,nOffsetX=this.viewer.pageLeftOffset,nOffsetY=this.viewer.pageTopOffset,d3Pattern,svgPattern,d3Border,path;d3Pattern=d3SvgDefs.select("#pagePattern-"+this.viewer.viewerNumber);svgPattern=d3Pattern.node();if(svgPattern){d3Pattern.attr("x",nOffsetX).attr("y",nOffsetY).attr("width",nSizeH).attr("height",nSizeV);if(svgPattern.hasChildNodes()){for(path=svgPattern.firstChild;path;path=svgPattern.firstChild){svgPattern.removeChild(path)}}d3Border=d3Pattern.append("svg:path").attr("d","M"+nSizeH+" "+nOffsetY+" L"+nOffsetX+" "+nOffsetY+" L"+nOffsetX+" "+nSizeV+" L"+nSizeH+" "+nSizeV+" L"+nSizeH+" "+nOffsetY).attr("fill","none").attr("stroke",this.viewer.pageLimitColor).attr("stroke-width",1.5);this.d3Layer.attr("fill","url(#pagePattern-"+this.viewer.viewerNumber+")");return d3Pattern}}return undefined},updatePageLimit:function(bShowPageLimit){if(this.d3Layer&&this.viewer){if(bShowPageLimit===undefined){bShowPageLimit=this.viewer.showPageLimit}if(bShowPageLimit){this.show(true)}else{this.hide(true)}}},onUpdatePageLimit:function(){this.updatePageLimit()}},statics:{ID:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,NAME:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER}})}());(function(){sap.galilei.core.extendStatic(sap.galilei.ui.common.svg.Viewer,{PAGE_LIMIT_COLOR:"#808080"});var oProps={showPageLimit:{value:false,onChange:function(newValue,oldValue){this.notifyLayers("onUpdatePageLimit",newValue,oldValue)}},pageLimitColor:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_LIMIT_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdatePagePattern",newValue,oldValue)}}},oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)}());
(function(){sap.galilei.ui.common.svg.SemanticZoomLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.FixedLayer,fullClassName:"sap.galilei.ui.common.svg.SemanticZoomLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,id:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,domClass:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,matrix:{expression:"new sap.galilei.ui.common.Matrix()",writable:false,configurable:false},isSemanticZoomLayer:{value:true,writable:false,configurable:false},isUseAnimation:false,animationDuration:0},methods:{add:function(){if(!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:g").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},transformPoint:function(aPoint){var oPt=new sap.galilei.ui.common.Point(aPoint);oPt.matrixTransform(this.matrix);return[oPt.x,oPt.y]},getTransform:function(aPoint){var aNewPoint=this.transformPoint(aPoint);return"translate("+(aNewPoint[0]-aPoint[0])+","+(aNewPoint[1]-aPoint[1])+")"},moveNodeBy:function(d3Node,dx,dy,oTransitionDef){if(d3Node&&!isNaN(dx)&&!isNaN(dy)){var x=d3Node.attr("galilei:x0"),y=d3Node.attr("galilei:y0");if(x==undefined||x===""||y==undefined||y===""){x=d3Node.attr("x");y=d3Node.attr("y")}if(x!=undefined&&x!==""&&y!=undefined&&y!==""){x=+x+dx;y=+y+dy;this.moveNodeTo(d3Node,x,y,oTransitionDef)}}},setNodeAttachPoint:function(d3Node,x,y,oTransitionDef){if(d3Node&&!isNaN(x)&&!isNaN(y)){var d3Selection=d3Node;if(oTransitionDef){d3Selection=oTransitionDef.getTransition(d3Node)}d3Selection.attr("galilei:x0",x).attr("galilei:y0",y).attr("transform",this.getTransform([x,y]))}},moveNodeTo:function(d3Node,x,y,oTransitionDef){if(d3Node&&!isNaN(x)&&!isNaN(y)){var d3Selection=d3Node;if(oTransitionDef){d3Selection=oTransitionDef.getTransition(d3Node)}d3Selection.attr("x",x).attr("y",y).attr("galilei:x0",x).attr("galilei:y0",y).attr("transform",this.getTransform([x,y]))}},moveBy:function(oShape,dx,dy,oTransitionDef){if(oShape&&oShape.d3Node&&!isNaN(dx)&&!isNaN(dy)){this.moveNodeBy(oShape.d3Node,dx,dy,oTransitionDef)}},moveTo:function(oShape,x,y,oTransitionDef){if(oShape&&oShape.d3Node&&!isNaN(x)&&!isNaN(y)){this.moveNodeTo(oShape.d3Node,x,y,oTransitionDef)}},setAttachPoint:function(oShape,x,y,oTransitionDef){if(oShape&&oShape.d3Node&&!isNaN(x)&&!isNaN(y)){this.setNodeAttachPoint(oShape.d3Node,x,y,oTransitionDef)}},onZoomPan:function(eventName,scale,translate,bUseAnimation){this.isUseAnimation=(bUseAnimation===true);this.animationDuration=0;if(this.isUseAnimation){if(scale!==this.viewer.oldZoomScale){this.animationDuration=this.viewer.zoomDuration}else{if(translate[0]!==this.viewer.oldZoomTranslate[0]||translate[1]!==this.viewer.oldZoomTranslate[1]){this.animationDuration=this.viewer.panDuration}}}this.matrix.setIdentity();this.matrix.translate(translate[0],translate[1]).scale(scale);var i,node,box,x0,y0,selection,pt=new sap.galilei.ui.common.Point();for(i=0;i<this.svgLayer.childNodes.length;i++){node=this.svgLayer.childNodes[i];selection=d3.select(node);x0=selection.attr("galilei:x0");y0=selection.attr("galilei:y0");if(x0==undefined||x0===""||y0==undefined||y0===""){box=sap.galilei.ui.common.svg.Svg.getBBox(node,true,this.svgLayer);if(box.width!==undefined&&box.height!==undefined){x0=box.x+box.width/2;y0=box.y+box.height/2}else{x0=box.x;y0=box.y}selection.attr("galilei:x0",x0);selection.attr("galilei:y0",y0)}if(this.isUseAnimation&&this.animationDuration!==0){selection=selection.transition().duration(this.animationDuration).ease("linear")}pt.set(x0,y0);pt.matrixTransform(this.matrix);selection.attr("transform","translate("+(pt.x-x0)+","+(pt.y-y0)+")")}}},statics:{ID:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,NAME:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER}})}());
(function(){sap.galilei.ui.common.svg.ShapeLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.ShapeLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,id:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,domClass:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,isShapeLayer:{value:true,writable:false,configurable:false},isMainShapeLayer:false,isShapeDecoratorLayer:false},methods:{add:function(){if(!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:g").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},getGlobalViewRect:function(){return sap.galilei.ui.common.svg.Svg.getChildNodesBBox(this.svgLayer,true,true)}},statics:{ID:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,NAME:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER}})}());
(function(){sap.galilei.ui.common.svg.ZoomToolLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.FixedLayer,fullClassName:"sap.galilei.ui.common.svg.ZoomToolLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}if(viewer&&viewer.viewerNumber){this.id+="-"+viewer.viewerNumber}this.add()},properties:{name:{expression:"sap.galilei.ui.common.svg.ZoomToolLayer.NAME"},zoomToolPadding:20,panGroupRayon:24,zoomButtonSize:24,zoomToolHorizontalAlignment:{get:function(){if(this.viewer){return this.viewer.zoomToolHorizontalAlignment}return sap.galilei.ui.common.HorizontalAlignment.left}},zoomToolVerticalAlignment:{get:function(){if(this.viewer){return this.viewer.zoomToolVerticalAlignment}return sap.galilei.ui.common.VerticalAlignment.top}},opacityOff:1,opacityOn:0.5,animationDuration:200,zoomTextFont:"normal normal normal 12px Verdana, Helvetica",zoomToolGroup:undefined,panGroup:undefined,zoomInGroup:undefined,zoomOutGroup:undefined,zoomTextRect:undefined,zoomText:undefined,zoomTextTimer:undefined},methods:{add:function(){var self=this,x0=0,y0=0,cx=x0+this.panGroupRayon,cy=y0+this.panGroupRayon,d1=4,d2=10,d3=6,d4=-1,d,x1,y1,dd1,dd3,dd2,y2,d3SvgZoomText,TOOLTIP_PAN_LEFT="Pan View Left (Left)",TOOLTIP_PAN_RIGHT="Pan View Right (Right)",TOOLTIP_PAN_UP="Pan View Up (Up)",TOOLTIP_PAN_DOWN="Pan View Down (Down)",TOOLTIP_CENTER_VIEW="Global View (Click, F8)\nActual Size (Ctrl+Click, F5)",TOOLTIP_ZOOM_IN="Zoom In (F6)",TOOLTIP_ZOOM_OUT="Zoom Out (F7)";this._super.prototype.add.apply(this);this.zoomToolGroup=self.d3Layer.append("svg:g").attr("opacity",0);this.zoomToolGroup.node().addEventListener("contextmenu",function(oEvent){oEvent.stopImmediatePropagation();oEvent.preventDefault()},false);if(!this._diagramOverview&&sap.galilei.ui.common.widget&&sap.galilei.ui.common.widget.DiagramOverview){this._diagramOverview=new sap.galilei.ui.common.widget.DiagramOverview()}if(this._diagramOverview!==undefined){this._diagramOverview.create(this.viewer,this)}this.panGroup=self.zoomToolGroup.append("svg:g").attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.panGroup.on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()});this.panGroup.append("svg:circle").attr("cx",cx).attr("cy",cy).attr("r",this.panGroupRayon).attr("stroke-width","3").attr("stroke","gray").attr("fill","white");d="M"+(cx-self.panGroupRayon+d1)+","+cy+" l"+d2+","+(-d3)+" l"+d4+","+d3+" l"+(-d4)+","+d3+" l"+(-d2)+","+(-d3)+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(e){self.viewer.panLeft()}).append("svg:title").text(TOOLTIP_PAN_LEFT);d="M"+(cx+self.panGroupRayon-d1)+","+cy+" l"+(-d2)+","+(-d3)+" l"+(-d4)+","+d3+" l"+d4+","+d3+" l"+d2+","+(-d3)+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(e){self.viewer.panRight()}).append("svg:title").text(TOOLTIP_PAN_RIGHT);d="M"+cx+","+(cy-self.panGroupRayon+d1)+" l"+d3+","+d2+" l"+(-d3)+","+d4+" l"+(-d3)+","+(-d4)+" l"+d3+","+(-d2)+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(e){self.viewer.panUp()}).append("svg:title").text(TOOLTIP_PAN_UP);d="M"+cx+","+(cy+self.panGroupRayon-d1)+" l"+d3+","+(-d2)+" l"+(-d3)+","+(-d4)+" l"+(-d3)+","+d4+" l"+d3+","+d2+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(e){self.viewer.panDown()}).append("svg:title").text(TOOLTIP_PAN_DOWN);this.panGroup.append("svg:circle").attr("cx",cx).attr("cy",cy).attr("r",8).attr("stroke","none").attr("fill","none").on("mouseup",function(e){if(self._ctrlKey){self.viewer.showActualSize()}else{self.viewer.showGlobalView()}}).append("svg:title").text(TOOLTIP_CENTER_VIEW);this.panGroup.append("svg:circle").attr("cx",cx).attr("cy",cy).attr("r",4).attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").on("mouseup",function(e){if(self._ctrlKey){self.viewer.showActualSize()}else{self.viewer.showGlobalView()}}).append("svg:title").text(TOOLTIP_CENTER_VIEW);x1=x0+Math.round(this.panGroupRayon-this.zoomButtonSize/2);y1=cy+self.panGroupRayon+10;dd1=5;dd3=2;dd2=Math.floor((self.zoomButtonSize-dd1*2-dd3)/2);this.zoomInGroup=self.zoomToolGroup.append("svg:g").attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn).on("mouseup",function(){self.viewer.zoomIn()}).on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()}).on("touchstart",function(){self.onMouseOver()}).on("touchmove",function(){self.onMouseOver()}).on("touchend",function(){self.viewer.zoomIn();self.onTouchEnd()});this.zoomInGroup.append("svg:title").text(TOOLTIP_ZOOM_IN);this.zoomInGroup.append("svg:rect").attr("x",x1).attr("y",y1).attr("width",this.zoomButtonSize).attr("height",this.zoomButtonSize).attr("rx",4).attr("ry",4).attr("stroke-width","2").attr("stroke","gray").attr("fill","white");d="M"+(x1+dd1)+","+(y1+dd1+dd2)+" l"+dd2+",0 l0, "+(-dd2)+" l"+dd3+",0 l0,"+dd2+" l"+dd2+",0 l0,"+dd3+" l"+(-dd2)+",0 l0,"+dd2+" l"+(-dd3)+",0 l0,"+(-dd2)+" l"+(-dd2)+",0 l0,"+(-dd3)+" Z";this.zoomInGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d);y1+=this.zoomButtonSize+4;this.zoomOutGroup=self.zoomToolGroup.append("svg:g").attr("opacity",self.opacityOn).attr("stroke-opacity",this.opacityOn).on("mouseup",function(){self.viewer.zoomOut()}).on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()}).on("touchstart",function(){self.onMouseOver()}).on("touchmove",function(){self.onMouseOver()}).on("touchend",function(){self.viewer.zoomOut();self.onTouchEnd()});this.zoomOutGroup.append("svg:title").text(TOOLTIP_ZOOM_OUT);this.zoomOutGroup.append("svg:rect").attr("x",x1).attr("y",y1).attr("width",this.zoomButtonSize).attr("height",this.zoomButtonSize).attr("rx",4).attr("ry",4).attr("stroke-width","2").attr("stroke","gray").attr("fill","white");d="M"+(x1+dd1)+","+(y1+dd1+dd2)+" l"+(dd2+dd3+dd2)+",0 l0, "+dd3+" l"+(-dd2-dd3-dd2)+",0 l0,"+(-dd3)+" Z";this.zoomOutGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d);y2=y1+self.zoomButtonSize+10;this.zoomTextRect=self.zoomToolGroup.append("svg:rect").attr("x",x0-4).attr("y",y2).attr("width",this.panGroupRayon*2+8).attr("height",this.zoomButtonSize).attr("rx",8).attr("ry",8).attr("stroke-width","2").attr("stroke","gray").attr("fill","white").attr("opacity",0).attr("stroke-opacity",0).on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()});d3SvgZoomText=sap.galilei.ui.common.svg.Svg.appendText(this.zoomToolGroup,(this.viewer.zoomScale*100).toFixed(0)+"%",x0,y2,this.panGroupRayon*2,self.zoomButtonSize,self.zoomTextFont,sap.galilei.ui.common.HorizontalAlignment.center,sap.galilei.ui.common.VerticalAlignment.middle,false,false,0,undefined,undefined,{style:"font: "+this.zoomTextFont+";",fill:"black",opacity:this.opacityOn});this.zoomText=d3SvgZoomText.on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()});this.onPostZoomPan=function(eventName,scale,translate){var opacity=self.opacityOn;if(scale!==self.viewer.oldZoomScale){if(self.zoomTextTimer){clearTimeout(self.zoomTextTimer);self.zoomTextTimer=undefined}self.onMouseOverText();opacity=self.opacityOff}sap.galilei.ui.common.svg.Svg.updateText(d3SvgZoomText,(scale*100).toFixed(0)+"%",x0,y2,self.panGroupRayon*2,self.zoomButtonSize,self.zoomTextFont,sap.galilei.ui.common.HorizontalAlignment.center,sap.galilei.ui.common.VerticalAlignment.middle,false,false,0,undefined,undefined,{style:"font: "+self.zoomTextFont+";",fill:"black",opacity:opacity});if(scale!==self.viewer.oldZoomScale){self.zoomTextTimer=setTimeout(function(){self.onMouseOutText(true)},1000)}};this.onZoomPan=function(eventName,scale,translate){if(self._diagramOverview){self._diagramOverview.onZoomPan(eventName,scale,translate)}};this.updateZoomTools();this.updateZoomToolsLocation();document.addEventListener("keydown",function(oEvent){if(!self.isDisableKeyboardEvents){self.onKeyDown(oEvent)}},false);document.addEventListener("keyup",function(oEvent){if(!self.isDisableKeyboardEvents){self.onKeyUp(oEvent)}},false);return self.d3Layer},onResize:function(sEventHandlerName){this._super.prototype.onResize.apply(this);this.updateZoomToolsLocation();if(this._diagramOverview){this._diagramOverview.updateOverviewLocation()}},updateZoomToolsLocation:function(){var x,y,rect;if(this.zoomToolGroup&&this.zoomToolGroup.node()){rect=sap.galilei.ui.common.svg.Svg.getBBox(this.zoomToolGroup.node());if(rect){if(this.zoomToolHorizontalAlignment===sap.galilei.ui.common.HorizontalAlignment.right){x=this.viewer.viewWidth-this.panGroupRayon*2-this.zoomToolPadding}else{x=this.zoomToolPadding}if(this.zoomToolVerticalAlignment===sap.galilei.ui.common.VerticalAlignment.middle){y=Math.round((this.viewer.viewHeight-rect.height)/2)}else{if(this.zoomToolVerticalAlignment===sap.galilei.ui.common.VerticalAlignment.bottom){y=this.viewer.viewHeight-rect.height-this.zoomToolPadding}else{y=this.zoomToolPadding}}this.zoomToolGroup.transition().duration(this.animationDuration).attr("transform","translate("+x+","+y+")").attr("opacity",1)}}},updateZoomTools:function(bShowZoomTools){if(this.d3Layer&&this.viewer){if(bShowZoomTools===undefined){bShowZoomTools=this.viewer.showZoomTools}if(this.zoomToolGroup){if(bShowZoomTools){this.zoomToolGroup.attr("opacity",1).attr("display","inline")}else{this.zoomToolGroup.attr("opacity",0).attr("display","none")}}}},onChangeShowZoomTools:function(){this.updateZoomTools()},onChangeZoomToolsLocation:function(){this.updateZoomToolsLocation()},onMouseOver:function(){this.panGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.zoomInGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.zoomOutGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.onMouseOverText()},onMouseOut:function(){this.panGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomInGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomOutGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.onMouseOutText()},onTouchEnd:function(){this.panGroup.transition().delay(1000).duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomInGroup.transition().delay(1000).duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomOutGroup.transition().delay(1000).duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.onMouseOutText()},onMouseOverText:function(){this.zoomTextRect.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.zoomText.transition().duration(this.animationDuration).attr("opacity",this.opacityOff)},onMouseOutText:function(bZoomPan){var duration=this.animationDuration;if(bZoomPan===true){duration=2000}this.zoomTextRect.transition().duration(duration).attr("opacity",0).attr("stroke-opacity",0);this.zoomText.transition().duration(duration).attr("opacity",this.opacityOn)},defaultOnKeyDown:function(oEvent){var bProcessed=false,sKeyValue,nPercentage;if(this.viewer&&!this.viewer.hasFocus){return false}this._ctrlKey=oEvent.ctrlKey;switch(oEvent.keyCode){case 37:this.viewer.panLeft();bProcessed=true;break;case 39:this.viewer.panRight();bProcessed=true;break;case 38:this.viewer.panUp();bProcessed=true;break;case 40:this.viewer.panDown();bProcessed=true;break;case 36:this.viewer.panPageLeft();bProcessed=true;break;case 35:this.viewer.panPageRight();bProcessed=true;break;case 33:this.viewer.panPageUp();bProcessed=true;break;case 34:this.viewer.panPageDown();bProcessed=true;break;case 116:if(oEvent.ctrlKey&&!oEvent.shiftKey){this.viewer.showInitialView()}else{if(oEvent.shiftKey&&!oEvent.ctrlKey){this.viewer.centerView()}else{this.viewer.showActualSize()}}bProcessed=true;break;case 117:this.viewer.zoomIn();bProcessed=true;break;case 118:this.viewer.zoomOut();bProcessed=true;break;case 119:if(oEvent.ctrlKey&&!oEvent.shiftKey){this.viewer.showUsedPages()}else{if(oEvent.shiftKey&&!oEvent.ctrlKey){this.viewer.showAllPages()}else{this.viewer.showGlobalView()}}bProcessed=true;break;case 120:if(this._diagramOverview){this._diagramOverview.toggleOverview();bProcessed=true}break;case 48:case 96:if(oEvent.ctrlKey){this.viewer.showActualSize();bProcessed=true}break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:if(oEvent.ctrlKey){sKeyValue=oEvent.keyCode<58?(oEvent.keyCode-48):(oEvent.keyCode-96);nPercentage=Number(sKeyValue)*10;this.viewer.zoomToPercentage(nPercentage);bProcessed=true}break}return bProcessed},onKeyDown:function(oEvent){var bProcessed=this.defaultOnKeyDown(oEvent);if(bProcessed){oEvent.preventDefault();oEvent.stopImmediatePropagation()}return bProcessed},defaultOnKeyUp:function(oEvent){var bProcessed=false;delete this._ctrlKey;return bProcessed},onKeyUp:function(oEvent){var bProcessed=this.defaultOnKeyUp(oEvent);if(bProcessed){oEvent.preventDefault();oEvent.stopImmediatePropagation()}return bProcessed}},statics:{ID:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER,NAME:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER}});var oProps={showZoomTools:{value:false,onChange:function(newValue,oldValue){this.notifyLayers("onChangeShowZoomTools",newValue,oldValue)}},zoomToolHorizontalAlignment:{value:sap.galilei.ui.common.HorizontalAlignment.left,onChange:function(newValue,oldValue){this.notifyLayers("onChangeZoomToolsLocation",newValue,oldValue)}},zoomToolVerticalAlignment:{value:sap.galilei.ui.common.VerticalAlignment.top,onChange:function(newValue,oldValue){this.notifyLayers("onChangeZoomToolsLocation",newValue,oldValue)}}},oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)}());
(function(){namespace("sap.galilei.ui.common.tracker");sap.galilei.ui.common.tracker.Tracker=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.tracker.Tracker",initialize:function(options){if(options){this.set(options)}this.onInitialize();this.createHandles();this.drawHandles();this.addEventHandlers()},properties:{mainShape:undefined,cloneMainShape:undefined,viewer:undefined,transitionDefinition:{get:function(){if(this.viewer!==undefined&&!this.viewer.enableAnimation){return false}if(!this._transitionDefinition){this._transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}return this._transitionDefinition},set:function(oTransitionDef){this._transitionDefinition=oTransitionDef}},endTransitionDefinition:undefined,handleProperties:undefined,handles:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.shape.Shape",writable:false},shapes:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.shape.Shape",writable:false}},methods:{onInitialize:function(){},createHandles:function(){},defaultAddEventHandlers:function(){var index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this,oHandle)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];if(oShape.fill!==undefined&&oShape.fill!=="none"){oShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this,oShape);oShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this,oShape);oShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this,oShape);oShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this,oShape)}}if(this.mainShape){this.mainShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this,this.mainShape);this.mainShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this,this.mainShape);this.mainShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this,this.mainShape);this.mainShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this,this.mainShape)}},addEventHandlers:function(){this.defaultAddEventHandlers()},defaultRemoveEventHandlers:function(){var index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];if(oShape.fill!==undefined&&oShape.fill!=="none"){oShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this);oShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this);oShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this);oShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this)}}if(this.mainShape){this.mainShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this);this.mainShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this);this.mainShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this);this.mainShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this)}},removeEventHandlers:function(){this.defaultRemoveEventHandlers()},defaultRemoveHandles:function(){var index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.removeNode(this.viewer,this.transitionDefinition)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oShape.removeNode(this.viewer,this.transitionDefinition)}this.handles.clear();this.shapes.clear();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}},removeHandles:function(){this.defaultRemoveHandles()},onDragStartHandle:function(oEvent,oHandle){},defaultOnDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle){var aDelta=this.viewer.pageDeltaToViewDelta([oEvent.gesture.deltaX,oEvent.gesture.deltaY]),oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME),aCenter;oEvent.stopPropagation();aCenter=[oHandle._cx0+aDelta[0],oHandle._cy0+aDelta[1]];oHandle.setCenter(aCenter[0],aCenter[1]);oHandle.updateDrawing(this.viewer);oLayer.moveTo(oHandle,oHandle.cx,oHandle.cy)}},canDragHandle:function(oEvent,oHandle){return true},onDragHandle:function(oEvent,oHandle){if(this.canDragHandle(oEvent,oHandle)){this.defaultOnDragHandle(oEvent,oHandle)}},onDragEndHandle:function(oEvent,oHandle){},onPointerDownShape:function(oEvent,oShape){oEvent.preventDefault();oEvent.stopPropagation()},onDragStartShape:function(oEvent,oShape){},canDragShape:function(oEvent,oShape){return true},onDragShape:function(oEvent,oShape){if(this.canDragShape(oEvent,oShape)){}},onDragEndShape:function(oEvent,oShape){},updateHandles:function(bUseAnimation){},defaultDrawHandles:function(){var oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME),index,oHandle,oShape,aCenter;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.draw(this.viewer,oLayer.d3Layer,this.transitionDefinition);aCenter=oHandle.getCenter();oLayer.moveTo(oHandle,aCenter[0],aCenter[1])}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}},drawHandles:function(){this.defaultDrawHandles()},showHandles:function(){var self=this,index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.show(this.viewer,this.transitionDefinition)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oHandle.show(this.viewer,this.transitionDefinition)}},hideHandles:function(){var self=this,index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.hide(this.viewer,this.transitionDefinition)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oHandle.hide(this.viewer,this.transitionDefinition)}},defaultCancel:function(){},cancel:function(){this.defaultCancel()},defaultDispose:function(){this.removeEventHandlers();this.removeHandles()},dispose:function(){this.defaultDispose()}}});sap.galilei.ui.common.tracker.defineTracker=function(oTrackerDef){var sTrackerName,TrackerClass;if(oTrackerDef){if(!oTrackerDef.parent){oTrackerDef.parent=sap.galilei.ui.common.tracker.Tracker}sTrackerName=oTrackerDef.trackerName;if(sTrackerName){delete oTrackerDef.trackerName}TrackerClass=sap.galilei.core.defineClass(oTrackerDef)}return TrackerClass}}());
(function(){sap.galilei.ui.common.tracker.Handle=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.tracker.Handle",widgetName:"SelectionHandle",parent:sap.galilei.ui.common.widget.Badge,properties:{purpose:"Handle",width:{expression:"sap.galilei.ui.common.tracker.Handle.DEFAULT_SIZE"},height:{expression:"sap.galilei.ui.common.tracker.Handle.DEFAULT_SIZE"},rx:{expression:"sap.galilei.ui.common.tracker.Handle.DEFAULT_RX"},ry:{expression:"sap.galilei.ui.common.tracker.Handle.DEFAULT_RY"},outerFill:{expression:"sap.galilei.ui.common.tracker.Handle.OUTER_FILL"},innerFill:{expression:"sap.galilei.ui.common.tracker.Handle.INNER_FILL"},isSupportDrag:true},statics:{DEFAULT_SIZE:12,DEFAULT_RX:undefined,DEFAULT_RY:undefined,OUTER_FILL:"white",INNER_FILL:"#0099EB"}})}());
(function(){sap.galilei.ui.common.tracker.MouseHoverHandler=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.tracker.MouseHoverHandler",initialize:function(oHost){this.host=oHost},fields:{TIMEOUT_DURATION:200,_mouseOverTimerId:undefined,_mouseOutTimerId:undefined},properties:{host:{field:"_host",get:function(){return this._host},set:function(oHost){this._host=oHost;if(oHost&&oHost.on){oHost.on("mouseover",this.onMouseOver,this);oHost.on("mouseout",this.onMouseOut,this);oHost._mouseHoverHandler=this}}},isMouseOver:false},methods:{defaultNotifyMouseOver:function(oEvent){if(this.host&&(typeof this.host.onMouseOver==="function")){this.host.onMouseOver.call(this.host,oEvent)}},notifyMouseOver:function(oEvent){this.defaultNotifyMouseOver(oEvent)},defaultNotifyMouseOut:function(oEvent){if(this.host&&(typeof this.host.onMouseOut==="function")){this.host.onMouseOut.call(this.host,oEvent)}},notifyMouseOut:function(oEvent){this.defaultNotifyMouseOut(oEvent)},onMouseOver:function(oEvent){var self=this;if(this._mouseOverTimerId!==undefined){clearTimeout(this._mouseOverTimerId);this._mouseOverTimerId=undefined}if(this._mouseOutTimerId!==undefined){clearTimeout(this._mouseOutTimerId);this._mouseOutTimerId=undefined}if(!this._isMouseOver){this._mouseOverTimerId=setTimeout(function(){self._mouseOverTimerId=undefined;self.isMouseOver=true;self.notifyMouseOver(oEvent)},this.TIMEOUT_DURATION)}},onMouseOut:function(oEvent){var self=this;if(this._mouseOverTimerId!==undefined){clearTimeout(this._mouseOverTimerId);this._mouseOverTimerId=undefined}if(this._mouseOutTimerId!==undefined){clearTimeout(this._mouseOutTimerId);this._mouseOutTimerId=undefined}if(this._isMouseOver){this._mouseOutTimerId=setTimeout(function(){self._mouseOutTimerId=undefined;self.isMouseOver=false;self.notifyMouseOut(oEvent)},this.TIMEOUT_DURATION)}},defaultDispose:function(){if(this.host&&this.host.off){this.host.off("mouseover",this.onMouseOver,this);this.host.off("mouseout",this.onMouseOut,this);delete this.host._mouseHoverHandler}this.host=undefined},dispose:function(){this.defaultDispose()}}})}());
(function(){sap.galilei.ui.common.tracker.PointsTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.common.tracker.PointsTracker",trackerName:"PointsTracker",fields:{_isDraggingHandle:false,_isDraggingShape:false},properties:{snapToGrid:false,isReadOnly:false,gridSize:sap.galilei.ui.common.svg.Viewer.GRID_SIZE,initialPoints:undefined,modifiedPoints:undefined,pointsShape:undefined,previewShape:undefined,clonedPointsShape:undefined,draggedSegmentIndex:undefined},methods:{createHandles:function(){if(!this.viewer){throw"The viewer must be defined."}if(!this.initialPoints&&this.pointsShape&&this.pointsShape.points){this.initialPoints=this.pointsShape.points.clone()}if(!this.initialPoints||this.handles.length>0){return}if(!this.previewShape&&this.pointsShape){this.previewShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(this.pointsShape.name);this.previewShape.set({domClass:"sapGalileiSelectionPath",points:this.pointsShape.points.clone(),stroke:sap.galilei.ui.common.style.Color.orange,strokeWidth:2,strokeDashArray:"3",markerStart:undefined,markerEnd:undefined,markerMiddle:undefined});switch(this.pointsShape.lineStyle){case sap.galilei.ui.common.LineStyle.streight:case sap.galilei.ui.common.LineStyle.horzDiagonalBezier:case sap.galilei.ui.common.LineStyle.vertDiagonalBezier:case sap.galilei.ui.common.LineStyle.horzDiagonal:case sap.galilei.ui.common.LineStyle.vertDiagonal:this.previewShape.lineStyle=this.pointsShape.lineStyle;break}this.previewShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}if(!this.isReadOnly&&this.pointsShape){if(!this.clonedPointsShape){this.clonedPointsShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(this.pointsShape.name);this.clonedPointsShape.set({points:this.pointsShape.points.clone(),lineStyle:this.pointsShape.lineStyle,strokeWidth:10,opacity:0,stroke:"white"});this.clonedPointsShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}this.updateHandles()}},removeHandles:function(){var index,length,oHandle;for(index=0,length=this.handles.length;index<length;index++){oHandle=this.handles[index];oHandle.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this);oHandle.removeNode(this.viewer,this.transitionDefinition)}this.handles.clear();if(this.clonedPointsShape){this.clonedPointsShape.dispose();this.clonedPointsShape=undefined}if(this.previewShape){this.previewShape.dispose();this.previewShape=undefined}},drawHandles:function(){var node;if(this.previewShape){if(!this.previewShape.isDrawn){this.previewShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition);if(this.clonedPointsShape&&this.clonedPointsShape.isDrawn){node=this.previewShape.d3Node.node();if(node){node.parentNode.insertBefore(node,this.clonedPointsShape.d3Node.node())}}}else{this.previewShape.updateDrawing(this.viewer,this.transitionDefinition)}}this.defaultDrawHandles()},updateHandles:function(){var index,length,aPoint,oHandle;if(this.clonedPointsShape&&this.pointsShape.points){this.clonedPointsShape.points=this.pointsShape.points.clone();this.clonedPointsShape.updateDrawing(this.viewer)}if(this.previewShape&&this.pointsShape.points){if(this.previewShape){this.previewShape.dispose()}this.previewShape.points=this.pointsShape.points.clone()}for(index=0,length=this.handles.length;index<length;index++){oHandle=this.handles[index];oHandle.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this);oHandle.removeNode(this.viewer)}this.handles.clear();if(this.initialPoints){for(index=0,length=this.initialPoints.length;index<length;index++){if(!this.isPointEditable(index)){continue}aPoint=this.initialPoints[index];oHandle=new sap.galilei.ui.common.tracker.Handle({cx:aPoint[0],cy:aPoint[1]});oHandle._index=index;oHandle.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this,oHandle);this.handles.add(oHandle)}}},defaultAddEventHandlers:function(){if(this.clonedPointsShape){this.clonedPointsShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.doubletap,this.onShapeDoubleTap,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.hold,this.onShapeHold,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.DOMEvents.contextmenu,this.onShapeContextMenu,this,this.clonedPointsShape)}},defaultRemoveEventHandlers:function(){if(this.clonedPointsShape){this.clonedPointsShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.doubletap,this.onShapeDoubleTap,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.hold,this.onShapeHold,this);this.clonedPointsShape.off(sap.galilei.ui.common.DOMEvents.contextmenu,this.onShapeContextMenu,this)}},isPointEditable:function(index){return true},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&!this.isReadOnly){oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];sap.galilei.core.Event.publish("pointsshape.handle.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.canDragStartHandle(oEvent,oHandle)){this._isDraggingHandle=true}},onDragStartHandle:function(oEvent,oHandle){this.defaultOnDragStartHandle(oEvent,oHandle)},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this._isDraggingHandle){oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];sap.galilei.core.Event.publish("pointsshape.handle.drag",this,undefined,oEvent);return !oEvent.cancel}return false},snapToAttachPoint:function(oEvent,oHandle,aPoint){return aPoint},defaultOnDragHandle:function(oEvent,oHandle){var aDelta,aCenter,oLayer;if(oEvent&&oHandle&&this._isDraggingHandle){this.viewer.normalizePointerEvent(oEvent);aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY];oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME);oEvent.stopPropagation();aCenter=[oHandle._cx0+aDelta[0],oHandle._cy0+aDelta[1]];if(this.snapToGrid){aCenter.snapToGrid(this.gridSize)}aCenter=this.snapToAttachPoint(oEvent,oHandle,aCenter);if(this.canDragHandle(oEvent,oHandle)){oHandle.setCenter(aCenter[0],aCenter[1]);oHandle.updateDrawing(this.viewer);oLayer.moveTo(oHandle,oHandle.cx,oHandle.cy)}}},onDragHandle:function(oEvent,oHandle){this.defaultOnDragHandle(oEvent,oHandle)},defaultOnDragEndHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this._isDraggingHandle){this._isDraggingHandle=false;this.modifiedPoints=this.initialPoints.clone();this.modifiedPoints[oHandle._index][0]=oHandle.cx;this.modifiedPoints[oHandle._index][1]=oHandle.cy;if(this.canModifyPointsShape()){this.modifyPointsShape(true,oHandle._index);this.updateHandles();this.drawHandles()}}},onDragEndHandle:function(oEvent,oHandle){this.defaultOnDragEndHandle(oEvent,oHandle)},defaultOnPointerDownShape:function(oEvent,oShape){var oRect,oSegment,aPoint,i,length;oEvent.preventDefault();oEvent.stopPropagation();aPoint=this.viewer.normalizePointerEvent(oEvent);oRect=new sap.galilei.ui.common.Rect(aPoint[0]-5,aPoint[1]-5,10,10);for(i=0,length=this.initialPoints.length;i<length-1;i++){oSegment=new sap.galilei.ui.common.Segment(this.initialPoints[i],this.initialPoints[i+1]);if(oRect.isIntersectSegment(oSegment)){this.draggedSegmentIndex=i;break}}},onPointerDownShape:function(oEvent,oShape){this.defaultOnPointerDownShape(oEvent,oShape)},onPointerUpShape:function(oEvent,oShape){},canDragSegments:function(){return true},canDragStartShape:function(oEvent,oShape){if(oEvent&&!this.isReadOnly&&this.canDragSegments()){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.segmentIndex=this.draggedSegmentIndex;sap.galilei.core.Event.publish("pointsshape.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartShape:function(oEvent,oShape){if(oEvent&&this.canDragStartShape(oEvent,oShape)){this._isDraggingShape=true}},onDragStartShape:function(oEvent,oShape){this.defaultOnDragStartShape(oEvent,oShape)},defaultOnDragShape:function(oEvent,oShape){var aPoint,aPoints,aNewPoints,oSegment;if(this._isDraggingShape&&this.draggedSegmentIndex!==undefined&&this.previewShape){aPoint=this.viewer.normalizePointerEvent(oEvent);oSegment=new sap.galilei.ui.common.Segment(this.initialPoints[this.draggedSegmentIndex],this.initialPoints[this.draggedSegmentIndex+1]);oSegment.parallelMoveTo(aPoint[0],aPoint[1]);aPoints=this.initialPoints.clone();if(this.initialPoints.length===2){aPoints.splice(1,0,oSegment.point1,oSegment.point2)}else{if(this.draggedSegmentIndex===0){aPoints.splice(1,1,oSegment.point1,oSegment.point2)}else{if(this.draggedSegmentIndex===this.initialPoints.length-2){aPoints.splice(this.draggedSegmentIndex,1,oSegment.point1,oSegment.point2)}else{aPoints.splice(this.draggedSegmentIndex,2,oSegment.point1,oSegment.point2)}}}aNewPoints=sap.galilei.ui.common.layout.PointsLayout.removeElbows(aPoints);if(aNewPoints&&aNewPoints.length>=2&&aNewPoints.length!==aPoints){this.previewShape.points=aNewPoints}else{this.previewShape.points=aPoints}this.previewShape.updateDrawing(this.viewer)}},onDragShape:function(oEvent,oShape){this.defaultOnDragShape(oEvent,oShape)},defaultOnDragEndShape:function(oEvent,oShape){if(this._isDraggingShape){this._isDraggingShape=false;if(this.previewShape){this.modifiedPoints=this.previewShape.points.clone()}if(this.canModifyPointsShape()){this.modifyPointsShape(false);this.updateHandles();this.drawHandles()}}},onDragEndShape:function(oEvent,oShape){this.defaultOnDragEndShape(oEvent,oShape)},onShapeHold:function(oEvent){},onShapeDoubleTap:function(oEvent){},onShapeContextMenu:function(oEvent){if(oEvent){oEvent.stopImmediatePropagation();oEvent.preventDefault()}},canModifyPointsShape:function(){return this.isReadOnly!=true},modifyPointsShape:function(){},defaultCancel:function(){this.initialPoints=this.symbol.points.clone();this.modifiedPoints=undefined;this.draggedSegmentIndex=undefined;this._isDraggingHandle=false;this._isDraggingShape=false;this.updateHandles();this.drawHandles();if(this.clonedPointsShape){this.clonedPointsShape.dispose();this.clonedPointsShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}},defaultDispose:function(){this.removeEventHandlers();this.removeHandles();this.initialPoints=undefined;this.modifiedPoints=undefined;this.pointsShape=undefined;if(this.clonedPointsShape){this.clonedPointsShape.dispose();this.clonedPointsShape=undefined}if(this.previewShape){this.previewShape.dispose();this.previewShape=undefined}this.draggedSegmentIndex=undefined}}})}());
(function(){sap.galilei.ui.common.tracker.ResizeTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.common.tracker.ResizeTracker",trackerName:"ResizeTracker",properties:{initialBBox:undefined,resizedBBox:undefined,movedBBox:undefined,snapToGrid:false,gridSize:sap.galilei.ui.common.svg.Viewer.GRID_SIZE,snapToShapes:true,snapToShapesCenter:true,snapToShapesBorder:true,isReadOnly:false,isKeepSize:{field:"_isKeepSize",value:false,get:function(){if(this.isReadOnly){return true}return this._isKeepSize},set:function(bValue){this._isKeepSize=bValue}},isKeepAspectRatio:false,isKeepCenter:false,isKeepPosition:{field:"_isKeepPosition",value:false,get:function(){if(this.isReadOnly||this.isPinching){return true}return this._isKeepPosition},set:function(bValue){this._isKeepPosition=bValue}},isDraggingHandle:false,isDraggingShape:false,isPinching:false,frameShape:undefined,frameColor:"gray",frameMargin:1,snapToShapesHandler:undefined},methods:{createHandles:function(){if(!this.viewer){throw"The viewer must be defined."}if(this.mainShape){if(!this.initialBBox){this.initialBBox=this.mainShape.getBBox()}}if(!this.initialBBox||this.handles.length>0){return}var aPosition=[sap.galilei.ui.common.DockPosition.topLeft,sap.galilei.ui.common.DockPosition.top,sap.galilei.ui.common.DockPosition.topRight,sap.galilei.ui.common.DockPosition.right,sap.galilei.ui.common.DockPosition.bottomRight,sap.galilei.ui.common.DockPosition.bottom,sap.galilei.ui.common.DockPosition.bottomLeft,sap.galilei.ui.common.DockPosition.left],oCursors={topLeft:"nw-resize",top:"n-resize",topRight:"ne-resize",right:"e-resize",bottomRight:"se-resize",bottom:"s-resize",bottomLeft:"sw-resize",left:"w-resize"},index,aPt,oParams=this.handleProperties||{},oHandle,oFrameRect,oShape;this.initialBBox.normalize();this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();oShape=this.mainShape;if(oShape&&oShape.isComposite&&oShape.shapes.length>0){oShape=oShape.shapes[0]}if(oShape&&oShape.isComposite&&oShape.shapes.length>0){oShape=oShape.shapes[0]}if(oShape&&oShape.strokeWidth!==undefined&&oShape.strokeWidth!==1&&this.frameMargin===1){this.frameMargin=(oShape.strokeWidth-1)/2+1}oFrameRect=this.initialBBox.clone();oFrameRect.inflate(this.frameMargin,this.frameMargin);if(!this.isReadOnly&&!this.isKeepSize){for(index=0;index<aPosition.length;index++){aPt=oFrameRect.getPoint(aPosition[index]);sap.galilei.core.copyProperties(oParams,{cx:aPt[0],cy:aPt[1],cursor:oCursors[aPosition[index]]});oHandle=new sap.galilei.ui.common.tracker.Handle(oParams);oHandle._position=aPosition[index];this.handles.add(oHandle)}}this.frameShape=new sap.galilei.ui.common.shape.Rectangle({domClass:"sapGalileiSelectionFrame",x:oFrameRect.x,y:oFrameRect.y,width:oFrameRect.width,height:oFrameRect.height,fill:"none",stroke:this.frameColor,strokeWidth:2,strokeDashArray:"3,3",isDisableContextMenu:true});this.shapes.add(this.frameShape)},updateHandles:function(bUseEndTransition){var aPosition=[sap.galilei.ui.common.DockPosition.topLeft,sap.galilei.ui.common.DockPosition.top,sap.galilei.ui.common.DockPosition.topRight,sap.galilei.ui.common.DockPosition.right,sap.galilei.ui.common.DockPosition.bottomRight,sap.galilei.ui.common.DockPosition.bottom,sap.galilei.ui.common.DockPosition.bottomLeft,sap.galilei.ui.common.DockPosition.left],oLayer,index,aPt,oHandle,oTransformDef=bUseEndTransition?this.endTransitionDefinition:undefined,oResizedRect=this.resizedBBox.clone(),oMovedRect=this.movedBBox.normalize(true);oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME);oResizedRect.inflate(this.frameMargin,this.frameMargin);for(index=0;(index<aPosition.length&&index<this.handles.length);index++){aPt=oResizedRect.getPoint(aPosition[index]);oHandle=this.handles[index];if(oHandle.cx!==aPt[0]||oHandle.cy!==aPt[1]){oHandle.setCenter(aPt[0],aPt[1]);oHandle.updateDrawing(this.viewer,oTransformDef);if(oLayer){oLayer.moveTo(oHandle,oHandle.cx,oHandle.cy,oTransformDef)}}}if(this.cloneMainShape){this.cloneMainShape.x=oMovedRect.x;this.cloneMainShape.y=oMovedRect.y;this.cloneMainShape.updateDrawing(this.viewer,oTransformDef)}if(this.frameShape){oMovedRect.inflate(this.frameMargin,this.frameMargin);this.frameShape.setBBox(oMovedRect);this.frameShape.updateDrawing(this.viewer,oTransformDef)}},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&!this.isKeepSize){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.handle.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle){if(this.canDragStartHandle(oEvent,oHandle)){this.isDraggingHandle=true}}},onDragStartHandle:function(oEvent,oHandle){this.defaultOnDragStartHandle(oEvent,oHandle)},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.handle.drag",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],aCenter,aOldPoint,aOldBBox,bShiftKey=oEvent.gesture.srcEvent.shiftKey,bCtrlKey=oEvent.gesture.srcEvent.ctrlKey;oEvent.stopPropagation();aCenter=[oHandle._cx0+aDelta[0],oHandle._cy0+aDelta[1]];aOldBBox=this.resizedBBox.clone();this.resizedBBox=this.initialBBox.resizeByHandle(aCenter[0],aCenter[1],oHandle._position,true,this.isKeepAspectRatio||bShiftKey,this.isKeepCenter||bCtrlKey);this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.resizedBBox,true,oHandle._position)}if(this.snapToGrid){this.resizedBBox.snapToGrid(this.gridSize)}aOldPoint=[oHandle.cx,oHandle.cy];oHandle.cx=aCenter[0];oHandle.cy=aCenter[1];if(this.canDragHandle(oEvent,oHandle)){this.movedBBox=this.resizedBBox.clone();oHandle.cx=aOldPoint[0];oHandle.cy=aOldPoint[1];this.updateHandles()}else{oHandle.cx=aOldPoint[0];oHandle.cy=aOldPoint[1];this.resizedBBox=aOldBBox}}},onDragHandle:function(oEvent,oHandle){this.defaultOnDragHandle(oEvent,oHandle)},defaultCanResizeShape:function(oEvent,oHandle){if(oEvent){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;if(oHandle){oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.handle.dragend",this,undefined,oEvent)}else{oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.pinchend",this,undefined,oEvent)}return !oEvent.cancel}return false},canResizeShape:function(oEvent,oHandle){return this.defaultCanResizeShape(oEvent,oHandle)},defaultResizeShape:function(oEvent){if(this.mainShape){if(this.endTransitionDefinition){this.frameShape.fill="white";this.frameShape.fillOpacity="0.01";this.frameShape.updateDrawing(this.viewer,undefined,["fill","fillOpacity"])}this.mainShape.setBBox(this.resizedBBox);this.mainShape.updateDrawing(this.viewer,this.endTransitionDefinition);if(this.endTransitionDefinition){var self=this;setTimeout(function(){self.frameShape.fill="none";self.frameShape.fillOpacity="0";self.frameShape.updateDrawing(self.viewer,undefined,["fill","fillOpacity"])},self.endTransitionDefinition.duration)}}},resizeShape:function(oEvent){this.defaultResizeShape(oEvent)},defaultOnDragEndHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){this.isDraggingHandle=false;this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canResizeShape(oEvent,oHandle)){this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone();this.resizeShape(oEvent)}else{this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onDragEndHandle:function(oEvent,oHandle){this.defaultOnDragEndHandle(oEvent,oHandle)},onPinchStartShape:function(oEvent){},canPinchShape:function(oEvent){if(oEvent){oEvent.cancel=false;oEvent.currentBBox=this.resizedBBox;sap.galilei.core.Event.publish("resize.shape.pinch",this,undefined,oEvent);return !oEvent.cancel}return false},onPinchShape:function(oEvent){if(oEvent&&!this.isKeepSize){oEvent.preventDefault();oEvent.stopPropagation();if(!this.isPinching){this.isPinching=true;this.onPinchStartShape(oEvent)}var oNewRect=new sap.galilei.ui.common.Rect(this.initialBBox),oOldRect=this.resizedBBox.clone(),nPinchScale=oEvent.gesture.scale,nNewWidth=this.initialBBox.width*nPinchScale,nNewHeight=this.initialBBox.height*nPinchScale;this.resizedBBox=oNewRect.resize(nNewWidth,nNewWidth,false,true,true);this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.resizedBBox,true,undefined,true)}if(this.snapToGrid){this.resizedBBox.snapToGrid(this.gridSize)}if(this.canPinchShape(oEvent)){this.movedBBox=this.resizedBBox.clone();this.updateHandles()}else{this.resizedBBox=oOldRect}}},onPinchEndShape:function(oEvent){if(oEvent&&!this.isKeepSize){this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.transitionDefinition)}if(this.canResizeShape(oEvent)){this.movedBBox=this.resizedBBox.clone();this.resizeShape(oEvent)}else{this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onReleaseShape:function(oEvent){if(this.isPinching){this.onPinchEndShape(oEvent);this.isPinching=false;this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone()}},canDragStartShape:function(oEvent){if(oEvent&&!this.isKeepPosition){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentBBox=this.movedBBox;sap.galilei.core.Event.publish("move.shape.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartShape:function(oEvent){if(oEvent){if(this.canDragStartShape(oEvent)){this.isDraggingShape=true;if(!this.cloneMainShape){this.cloneMainShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(this.mainShape);this.cloneMainShape.x=this.initialBBox.x;this.cloneMainShape.y=this.initialBBox.y;this.cloneMainShape.filter=undefined;this.cloneMainShape.opacity=0.6;this.cloneMainShape.transform=undefined;if(sap.galilei.core.isInstanceOf(this.cloneMainShape,"sap.galilei.ui.common.shape.Group")){this.cloneMainShape.isEnableTransform=true;this.cloneMainShape.width=undefined;this.cloneMainShape.height=undefined}this.cloneMainShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}}}},onDragStartShape:function(oEvent){this.defaultOnDragStartShape(oEvent)},canDragShape:function(oEvent){if(oEvent&&this.isDraggingShape){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;sap.galilei.core.Event.publish("move.shape.drag",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragShape:function(oEvent){if(oEvent&&this.isDraggingShape){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],oOldBBox=this.movedBBox.clone();this.movedBBox.x=this.initialBBox.x+aDelta[0];this.movedBBox.y=this.initialBBox.y+aDelta[1];if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.movedBBox,true)}if(this.snapToGrid){this.movedBBox.snapToGrid(this.gridSize)}if(this.canDragShape(oEvent)){this.updateHandles()}else{this.movedBBox=oOldBBox}}},onDragShape:function(oEvent){this.defaultOnDragShape(oEvent)},defaultCanMoveShape:function(oEvent){if(oEvent){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;sap.galilei.core.Event.publish("move.shape.dragend",this,undefined,oEvent);return !oEvent.cancel}return true},canMoveShape:function(oEvent){return this.defaultCanMoveShape(oEvent)},defaultMoveShape:function(oEvent){if(this.mainShape){if(this.endTransitionDefinition){this.frameShape.fill="white";this.frameShape.fillOpacity="0.01";this.frameShape.updateDrawing(this.viewer,undefined,["fill","fillOpacity"])}this.mainShape.setBBox(this.movedBBox);this.mainShape.updateDrawing(this.viewer,this.endTransitionDefinition);this.updateHandles(true);if(this.endTransitionDefinition){var self=this;setTimeout(function(){self.frameShape.fill="none";self.frameShape.fillOpacity="0";self.frameShape.updateDrawing(self.viewer,undefined,["fill","fillOpacity"])},self.endTransitionDefinition.duration)}}},moveShape:function(oEvent){this.defaultMoveShape(oEvent)},defaultOnDragEndShape:function(oEvent){if(oEvent&&this.isDraggingShape){this.isDraggingShape=false;if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canMoveShape(oEvent)){this.resizedBBox=this.movedBBox.clone();this.initialBBox=this.movedBBox.clone();this.moveShape(oEvent)}else{this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onDragEndShape:function(oEvent){this.defaultOnDragEndShape(oEvent)},defaultCancel:function(){this.isDraggingHandle=false;this.isDraggingShape=false;this.isPinching=false;this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}},defaultDispose:function(){this.removeEventHandlers();this.removeHandles();this.isDraggingHandle=false;this.isDraggingShape=false;this.isPinching=false;if(this.snapToShapesHandler){this.snapToShapesHandler.dispose();this.snapToShapesHandler=undefined}}}})}());
(function(){sap.galilei.ui.common.tracker.SnapToShapes=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.tracker.SnapToShapes",statics:{SNAP_LINE_THRESHOLD:4,SNAP_LINE_COLOR:sap.galilei.ui.common.style.Color.orange},properties:{horizontalShapesIndex:[],verticalShapesIndex:[],snapToShapesCenter:true,snapToShapesBorder:true,viewer:undefined,transitionDefinition:undefined,horizontalLine1:undefined,horizontalLine2:undefined,horizontalLine3:undefined,verticalLine1:undefined,verticalLine2:undefined,verticalLine3:undefined},methods:{addShapeBBox:function(oRect){if(oRect){var oNormRect=oRect.normalize(true),left=Math.round(oNormRect.x),top=Math.round(oNormRect.y),right=Math.round(oNormRect.right),bottom=Math.round(oNormRect.bottom),aCenter=oNormRect.getCenter(true),hCenter=aCenter[0],vCenter=aCenter[1];if(this.snapToShapesBorder){this.addHorizontalShapeIndex(left,top,bottom);this.addHorizontalShapeIndex(right,top,bottom);this.addVerticalShapeIndex(top,left,right);this.addVerticalShapeIndex(bottom,left,right)}if(this.snapToShapesCenter){this.addHorizontalShapeIndex(hCenter,top,bottom);this.addVerticalShapeIndex(vCenter,left,right)}}},addHorizontalShapeIndex:function(x,top,bottom){var oResult={},oEntry;if(!this.findShapeIndexEntry(oResult,this.horizontalShapesIndex,x)){oEntry={coordinate:x,minValue:top,maxValue:bottom};this.horizontalShapesIndex.splice(oResult.index,0,oEntry)}else{oEntry=oResult.entry;oEntry.minValue=Math.min(oEntry.minValue,top);oEntry.maxValue=Math.max(oEntry.maxValue,bottom)}},addVerticalShapeIndex:function(y,left,right){var oResult={},oEntry;if(!this.findShapeIndexEntry(oResult,this.verticalShapesIndex,y)){oEntry={coordinate:y,minValue:left,maxValue:right};this.verticalShapesIndex.splice(oResult.index,0,oEntry)}else{oEntry=oResult.entry;oEntry.minValue=Math.min(oEntry.minValue,left);oEntry.maxValue=Math.max(oEntry.maxValue,right)}},findShapeIndexEntry:function(oResult,aShapeIndex,nCoordinate){if(oResult&&aShapeIndex){var index,oEntry;oResult.index=-1;oResult.entry=undefined;for(index=0;index<aShapeIndex.length;index++){oEntry=aShapeIndex[index];if(oEntry.coordinate===nCoordinate){oResult.index=index;oResult.entry=oEntry;return true}else{if(oEntry.coordinate>nCoordinate){oResult.index=index;return false}}}oResult.index=aShapeIndex.length}return false},findVerticalSnapLine:function(x,nThreshold){return this.findSnapLine(this.horizontalShapesIndex,x,nThreshold)},findHorizontalSnapLine:function(y,nThreshold){return this.findSnapLine(this.verticalShapesIndex,y,nThreshold)},findSnapLine:function(aShapeIndex,nCoordinate,nThreshold){if(aShapeIndex){var index,oEntry,nDiff,nMinValue,nBestIndex;for(index=0;index<aShapeIndex.length;index++){oEntry=aShapeIndex[index];nDiff=Math.abs(oEntry.coordinate-nCoordinate);if(nDiff<=nThreshold){if(nBestIndex===undefined||nDiff<nMinValue){nBestIndex=index;nMinValue=nDiff}else{break}}}if(nBestIndex!==undefined){return aShapeIndex[nBestIndex]}}return undefined},createSnapLines:function(){var aSnapLines=["verticalLine1","verticalLine2","verticalLine3","horizontalLine1","horizontalLine2","horizontalLine3"],index;for(index=0;index<aSnapLines.length;index++){if(!this[aSnapLines[index]]){this[aSnapLines[index]]=new sap.galilei.ui.common.shape.Line({domClass:"sapGalileiSnapToShapeLine",x1:0,y1:0,x2:0,y2:0,opacity:0,stroke:sap.galilei.ui.common.tracker.SnapToShapes.SNAP_LINE_COLOR})}}},updateSnapLines:function(oRect,bModify,sDockPosition,bNoSnapCenter,bNoSnapBorder){if(oRect){var oNormRect=oRect.normalize(true),left=Math.round(oNormRect.x),top=Math.round(oNormRect.y),right=Math.round(oNormRect.right),bottom=Math.round(oNormRect.bottom),aCenter=oNormRect.getCenter(true),hCenter=aCenter[0],vCenter=aCenter[1],aSnapLines=[[false,left,top,bottom,this.verticalLine1,true,false],[false,hCenter,top,bottom,this.verticalLine2,true,false],[false,right,top,bottom,this.verticalLine3,true,false],[true,top,left,right,this.horizontalLine1,true,false],[true,vCenter,left,right,this.horizontalLine2,true,false],[true,bottom,left,right,this.horizontalLine3,true,false]],oEnabledLines={topLeft:[0,3],top:[3],topRight:[3,2],right:[2],bottomRight:[5,2],bottom:[5],bottomLeft:[5,0],left:[0]},aSnapLine,aEnabledLines,index,oEntry,nThreshold=sap.galilei.ui.common.tracker.SnapToShapes.SNAP_LINE_THRESHOLD,bHorizontal,nCoordinate,nMinValue,nMaxValue,oShape,bEnabled,bShow,dx=0,dy=0,dx2,dy2,aNewPoint;if(sDockPosition){for(index=0;index<aSnapLines.length;index++){aSnapLine=aSnapLines[index][5]=false}aEnabledLines=oEnabledLines[sDockPosition];if(aEnabledLines){for(index=0;index<aEnabledLines.length;index++){aSnapLine=aSnapLines[aEnabledLines[index]][5]=true}}}if(bNoSnapCenter){aSnapLines[1][5]=false;aSnapLines[4][5]=false}if(bNoSnapBorder){aSnapLines[0][5]=false;aSnapLines[2][5]=false;aSnapLines[3][5]=false;aSnapLines[5][5]=false}for(index=0;index<aSnapLines.length;index++){aSnapLine=aSnapLines[index];bHorizontal=aSnapLine[0];nCoordinate=aSnapLine[1];nMinValue=aSnapLine[2];nMaxValue=aSnapLine[3];oShape=aSnapLine[4];bEnabled=aSnapLine[5];if(bEnabled){if(bHorizontal){oEntry=this.findHorizontalSnapLine(nCoordinate,nThreshold)}else{oEntry=this.findVerticalSnapLine(nCoordinate,nThreshold)}if(oEntry){nMinValue=Math.min(oEntry.minValue,nMinValue);nMaxValue=Math.max(oEntry.maxValue,nMaxValue);if(bHorizontal){dy2=oEntry.coordinate-nCoordinate;if(dy===0||dy2===dy){aSnapLine[6]=true;oShape.x1=nMinValue-20;oShape.x2=nMaxValue+20;oShape.y1=oShape.y2=oEntry.coordinate;if(dy===0){dy=dy2}}}else{dx2=oEntry.coordinate-nCoordinate;if(dx===0||dx2===dx){aSnapLine[6]=true;oShape.y1=nMinValue-20;oShape.y2=nMaxValue+20;oShape.x1=oShape.x2=oEntry.coordinate;if(dx===0){dx=dx2}}}}}}if(aSnapLines[0][6]&&aSnapLines[1][6]&&aSnapLines[2][6]&&Math.abs(aSnapLines[0][4].y1-aSnapLines[1][4].y1)<=1&&Math.abs(aSnapLines[0][4].y1-aSnapLines[2][4].y1)<=1&&Math.abs(aSnapLines[0][4].y2-aSnapLines[1][4].y2)<=1&&Math.abs(aSnapLines[0][4].y2-aSnapLines[2][4].y2)<=1){aSnapLines[0][6]=false;aSnapLines[2][6]=false}if(aSnapLines[3][6]&&aSnapLines[4][6]&&aSnapLines[5][6]&&Math.abs(aSnapLines[3][4].x1-aSnapLines[4][4].x1)<=1&&Math.abs(aSnapLines[3][4].x1-aSnapLines[5][4].x1)<=1&&Math.abs(aSnapLines[3][4].x2-aSnapLines[4][4].x2)<=1&&Math.abs(aSnapLines[3][4].x2-aSnapLines[5][4].x2)<=1){aSnapLines[3][6]=false;aSnapLines[5][6]=false}for(index=0;index<aSnapLines.length;index++){aSnapLine=aSnapLines[index];oShape=aSnapLine[4];bShow=aSnapLine[6];if(bShow){if(!oShape.isDrawn){oShape.isVisible=true;oShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}oShape.opacity=1;oShape.updateDrawing(this.viewer,this.transitionDefinition,["x1","y1","x2","y2","opacity"])}else{this.hideSnapLine(oShape)}}if(bModify&&(dx!==0||dy!==0)){if(sDockPosition){aNewPoint=oRect.getPoint(sDockPosition);oRect.resizeByHandle(aNewPoint[0]+dx,aNewPoint[1]+dy,sDockPosition)}else{oRect.moveBy(dx,dy)}}}},hideSnapLine:function(oShape,oTransitionDef){if(oShape&&oShape.isDrawn){oTransitionDef=oTransitionDef||this.transitionDefinition;oShape.removeNode(this.viewer,oTransitionDef)}},hideSnapLines:function(oTransitionDef){var aSnapLines=["verticalLine1","verticalLine2","verticalLine3","horizontalLine1","horizontalLine2","horizontalLine3"],index;for(index=0;index<aSnapLines.length;index++){this.hideSnapLine(this[aSnapLines[index]],oTransitionDef)}},highlightAndHideShape:function(oShape,oTransitionDef){var self=this;oShape.strokeWidth=2;oShape.updateDrawing(this.viewer,oTransitionDef,["strokeWidth"]);setTimeout(function(){oShape.strokeWidth=1;oShape.opacity=0.01;oShape.updateDrawing(self.viewer,oTransitionDef,["strokeWidth, opacity"]);setTimeout(function(){oShape.removeNode()},oTransitionDef.duration)},oTransitionDef.duration)},highlightAndHideSnapLines:function(oTransitionDef){var aSnapLines=["verticalLine1","verticalLine2","verticalLine3","horizontalLine1","horizontalLine2","horizontalLine3"],index,oShape;if(!oTransitionDef){oTransitionDef=this.transitionDefinition}for(index=0;index<aSnapLines.length;index++){oShape=this[aSnapLines[index]];if(oTransitionDef){this.highlightAndHideShape(oShape,oTransitionDef)}else{this.hideSnapLine(oShape)}}},clearShapeIndexes:function(){this.horizontalShapesIndex=[];this.verticalShapesIndex=[]},dispose:function(){this.hideSnapLines();this.clearShapeIndexes()}}})}());
(function(){sap.galilei.ui.common.Blob=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Blob",statics:{createBlobFromString:function(sString,sMimeType){var aBytes,index,max,oBlob,oOptions={};if(sString){aBytes=new Uint8Array(sString.length);for(index=0,max=sString.length;index<max;index++){aBytes[index]=sString.charCodeAt(index)}if(sMimeType){oOptions.type=sMimeType}oBlob=new Blob([aBytes],oOptions)}return oBlob},encodeBase64Text:function(sString){function base64EncodeChar(sMatch,ch){return String.fromCharCode("0x"+ch)}if(sString!==undefined&&typeof(window)!=="undefined"&&window.btoa&&window.encodeURIComponent){return btoa(encodeURIComponent(sString).replace(/%([0-9A-F]{2})/g,base64EncodeChar))}return undefined},decodeBase64:function(sString){if(sString!==undefined&&typeof(window)!=="undefined"&&window.atob){sString=atob(sString)}return sString},decodeBase64AsBlob:function(sString){var oBlob;if(sString){sString=this.decodeBase64(sString);oBlob=this.createBlobFromString(sString)}return oBlob}}})}());
(function(){sap.galilei.ui.common.FileManager=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.FileManager",statics:{URL:{get:function(){return window&&(window.URL||window.webkitURL||window)}},saveLink:{field:"_saveLink",get:function(){if(!sap.galilei.ui.common.FileManager._saveLink&&typeof(window)!=="undefined"){sap.galilei.ui.common.FileManager._saveLink=window.document.createElementNS("http://www.w3.org/1999/xhtml","a")}return sap.galilei.ui.common.FileManager._saveLink}},_tempFileUrls:[],_defaultSaveAs:function(oBlob,sFilename,sContentType){if(oBlob&&sFilename){var oOptions={},oSaveLink=sap.galilei.ui.common.FileManager.saveLink,oURL=sap.galilei.ui.common.FileManager.URL,bSafari=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),bUseFileReader=bSafari&&(oBlob.type==="application/octet-stream"||sContentType==="application/octet-stream"),sUrl,oEvent;if(oURL){try{if(typeof oBlob==="string"){oBlob=sap.galilei.ui.common.Blob.createBlobFromString(oBlob,sContentType)}else{if(oBlob instanceof ArrayBuffer){if(sContentType){oOptions.type=sContentType}oBlob=new Blob([oBlob],oOptions)}}if(!bUseFileReader){sUrl=oURL.createObjectURL(oBlob);if(sUrl){sap.galilei.ui.common.FileManager._tempFileUrls.push(sUrl);oSaveLink.href=sUrl;oSaveLink.download=sFilename;oEvent=window.document.createEvent("MouseEvents");oEvent.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);oSaveLink.dispatchEvent(oEvent)}}else{var oReader=new FileReader(),oPopup;oReader.onloadend=function(){sUrl=oReader.result.replace(/^data:[^;]*;/,"data:attachment/file;");oPopup=window.open(sUrl,"_blank");if(!oPopup){window.location.href=sUrl}sUrl=undefined};oReader.readAsDataURL(oBlob)}}catch(e){console.log("Error: "+e.message)}}}},saveAs:function(oBlob,sFilename,sContentType){var fnSaveAs;fnSaveAs=(typeof(navigator)!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))||sap.galilei.ui.common.FileManager._defaultSaveAs;if(fnSaveAs){try{fnSaveAs(oBlob,sFilename,sContentType)}catch(e){console.log("Error: "+e.message)}}},open:function(oFile,fnOnOpen,fnOnError,sFormat){if(oFile&&fnOnOpen&&typeof(window)!=="undefined"){if(!window.FileReader){throw"The FileReader API is not supported by the current browser."}var oReader=new FileReader(),bUseArrayBuffer=false;oReader.onload=(function(oFile){return function(evt){var vContent=evt.target.result,aBytes,length,index,sBinaryString="";if(sFormat==="base64"){index=vContent.indexOf(",");if(index!==-1){vContent=vContent.substring(index+1)}}else{if(sFormat==="binaryString"||sFormat==="blob"){if(bUseArrayBuffer&&vContent){aBytes=new Uint8Array(vContent);for(index=0,length=aBytes.byteLength;index<length;index++){sBinaryString+=String.fromCharCode(aBytes[index])}vContent=sBinaryString}if(sFormat==="blob"){vContent=sap.galilei.ui.common.Blob.createBlobFromString(vContent)}}}if(fnOnOpen){fnOnOpen(vContent)}}})(oFile);oReader.onerror=function(e){e=e||window.event;if(fnOnError){fnOnError(e&&e.target&&e.target.error&&e.target.error.code)}};switch(sFormat){case"binaryString":case"blob":if(typeof oReader.readAsBinaryString==="function"){oReader.readAsBinaryString(oFile)}else{bUseArrayBuffer=true;oReader.readAsArrayBuffer(oFile)}break;case"arrayBuffer":oReader.readAsArrayBuffer(oFile);break;case"dataURL":case"base64":oReader.readAsDataURL(oFile);break;default:oReader.readAsText(oFile);break}}},cleanUp:function(){var oURL=sap.galilei.ui.common.FileManager.URL,i;if(oURL){for(i=sap.galilei.ui.common.FileManager._tempFileUrls.length-1;i>=0;i--){if(typeof sap.galilei.ui.common.FileManager._tempFileUrls[i]==="string"){oURL.revokeObjectURL(sap.galilei.ui.common.FileManager._tempFileUrls[i])}}}sap.galilei.ui.common.FileManager._tempFileUrls=[]}}});if(typeof(window)!=="undefined"){window.addEventListener("unload",sap.galilei.ui.common.FileManager.cleanUp,false)}}());
(function(){sap.galilei.ui.common.Font=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Font",statics:{getFontHeight:function(sFontProps){var oFont=sap.galilei.ui.common.Font.getCSSFontProperties(sFontProps),nFontSize=oFont.fontSize,index;if(nFontSize){index=nFontSize.indexOf("px");if(index!==-1){nFontSize=+nFontSize.substring(0,index)}}return nFontSize},getCSSFontProperties:function(sFontProps){var aFontProperties,sElement,sElementLower,aParts,index,max,sFontFamily=null,sFontSize=null,sFontStyle="normal",sFontWeight="normal",sFontVariant="normal",sLineHeight="normal";if(sFontProps){aFontProperties=sFontProps.split(/\s+/);for(index=0,max=aFontProperties.length;index<max;index++){sElement=aFontProperties[index];sElementLower=sElement.toLowerCase();switch(sElementLower){case"normal":break;case"italic":case"oblique":sFontStyle=sElementLower;break;case"small-caps":sFontVariant=sElementLower;break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":sFontWeight=sElementLower;break;default:if(!sFontSize){aParts=sElement.split("/");sFontSize=aParts[0];if(aParts.length>1){sLineHeight=aParts[1]}break}else{if(!sFontFamily){sFontFamily=sElement}else{sFontFamily+=" "+sElement}}break}}return{fontStyle:sFontStyle,fontVariant:sFontVariant,fontWeight:sFontWeight,fontSize:sFontSize,lineHeight:sLineHeight,fontFamily:sFontFamily}}},getFontProperties:function(dElement){if(dElement){var oStyle=window.getComputedStyle(dElement,null);return sap.galilei.ui.common.Font.getFontPropertiesFromStyle(oStyle)}return""},getFontPropertiesFromStyle:function(oStyle){var sFont="",sSize="",fontWeight;if(oStyle){if(oStyle.font&&oStyle.font.length>0){return oStyle.font}if(oStyle.fontStyle&&oStyle.fontStyle.length>0){sFont+=oStyle.fontStyle+" "}if(oStyle.fontVariant&&oStyle.fontVariant.length>0){sFont+=oStyle.fontVariant+" "}if(oStyle.fontWeight&&oStyle.fontWeight.length>0){fontWeight=oStyle.fontWeight;switch(fontWeight){case"100":case"200":fontWeight="lighter";break;case"300":case"400":case"500":fontWeight="normal";break;case"600":case"700":case"800":fontWeight="bold";break;case"900":fontWeight="bolder";break}sFont+=fontWeight+" "}if(oStyle.fontSize!=undefined){sSize=""+oStyle.fontSize;if(sSize.indexOf("px")===-1){sSize+="px"}}sFont+=sSize;if(oStyle.lineHeight&&oStyle.lineHeight.length>0){sFont+="/"+oStyle.lineHeight}sFont+=" ";if(oStyle.fontFamily&&oStyle.fontFamily.length>0){if(oStyle.fontFamily.indexOf(" ")!==-1||oStyle.fontFamily.indexOf(",")!==-1){sFont+="'"+oStyle.fontFamily+"'"}else{sFont+=oStyle.fontFamily}}}return sFont}}});sap.galilei.ui.common.IconPool=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.IconPool",statics:{iconFonts:undefined,registerIconFont:function(sFontFamily,sCollectionName,oIcons){var aIconNames,index,sIconName;if(sFontFamily&&oIcons){aIconNames=Object.getOwnPropertyNames(oIcons);for(index=0;index<aIconNames.length;index++){sIconName=aIconNames[index];sap.galilei.ui.common.IconPool.addIcon(sFontFamily,sCollectionName,sIconName,oIcons[sIconName])}}},getIconFont:function(sCollectionName){var aIconFonts=sap.galilei.ui.common.IconPool.iconFonts,index,oIconFont;if(aIconFonts!==undefined){for(index=0;index<aIconFonts.length;index++){oIconFont=aIconFonts[index];if(sCollectionName==oIconFont.collectionName){return oIconFont}}}return undefined},getIconFontByFamily:function(sFontFamily){var aIconFonts=sap.galilei.ui.common.IconPool.iconFonts,index,oIconFont;if(aIconFonts!==undefined&&sFontFamily!==undefined){index=sFontFamily.lastIndexOf(" ");if(index!==-1){sFontFamily=sFontFamily.substring(index+1)}for(index=0;index<aIconFonts.length;index++){oIconFont=aIconFonts[index];if(sFontFamily==oIconFont.fontFamily){return oIconFont}}}return undefined},isIconFont:function(sFontFamily){return sap.galilei.ui.common.IconPool.getIconFontByFamily(sFontFamily)!==undefined},addIcon:function(sFontFamily,sCollectionName,sIconName,sIconContent){var aIconFonts,oIconFont;if(sFontFamily&&sIconName&&sIconContent){if(sap.ui&&sap.ui.core&&sap.ui.core.IconPool){sap.ui.core.IconPool.addIcon(sIconName,sCollectionName,{fontFamily:sFontFamily,content:sIconContent})}else{sCollectionName=(sCollectionName===undefined)?"":sCollectionName;oIconFont=sap.galilei.ui.common.IconPool.getIconFont(sCollectionName);if(oIconFont===undefined){aIconFonts=sap.galilei.ui.common.IconPool.iconFonts=sap.galilei.ui.common.IconPool.iconFonts||[];oIconFont={fontFamily:sFontFamily,collectionName:sCollectionName,icons:[]};aIconFonts.push(oIconFont)}oIconFont.icons[sIconName]=sIconContent}}},getIconInfo:function(sIconName,sCollectionName){var oIconInfo,oIconFont;if(sIconName){if(sap.ui&&sap.ui.core&&sap.ui.core.IconPool){oIconInfo=sap.ui.core.IconPool.getIconInfo(sIconName,sCollectionName)}else{sCollectionName=(sCollectionName===undefined)?"":sCollectionName;oIconFont=sap.galilei.ui.common.IconPool.getIconFont(sCollectionName);if(oIconFont!==undefined){oIconInfo={name:sIconName,collection:sCollectionName,uri:sap.galilei.ui.common.IconPool.getIconURI(sIconName,sCollectionName),fontFamily:oIconFont.fontFamily,content:oIconFont.icons[sIconName]}}}}return oIconInfo},getIconCollectionNames:function(){var aIconFonts=sap.galilei.ui.common.IconPool.iconFonts,index,oIconFont,aIconFontNames=[];if(sap.ui&&sap.ui.core&&sap.ui.core.IconPool){aIconFontNames=sap.galilei.ui.common.IconPool.getIconCollectionNames()}else{if(aIconFonts!==undefined){for(index=0;index<aIconFonts.length;index++){oIconFont=aIconFonts[index];aIconFontNames.push(oIconFont.collectionName)}}}return aIconFontNames},getIconNames:function(sCollectionName){var aIconNames=[],oIconFont;if(sap.ui&&sap.ui.core&&sap.ui.core.IconPool){aIconNames=sap.ui.core.IconPool.getIconNames(sCollectionName)}else{oIconFont=sap.galilei.ui.common.IconPool.getIconFont(sCollectionName);if(oIconFont!==undefined){aIconNames=Object.getOwnPropertyNames(oIconFont.icons)}}return aIconNames},getIconURI:function(sIconName,sCollectionName){var sURI;if(sap.ui&&sap.ui.core&&sap.ui.core.IconPool){sURI=sap.ui.core.IconPool.getIconURI(sIconName,sCollectionName)}else{sURI="sap-icon://";if(sCollectionName!==undefined){sURI+=sCollectionName+"/"}sURI+=sIconName}return sURI}}})}());
(function(){sap.galilei.ui.common.Image=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Image",statics:{convertImageToDataUrl:function(oImage,sImageFormat,oOptions){return sap.galilei.ui.common.canvas.Canvas.convertImageToDataUrl(oImage,sImageFormat,oOptions)},convertSVGToImageDataUrl:function(sSVG,fnImageReady,sImageFormat,oOptions){var sExtension,sSvgDataURL,sImageDataURL,oImage;if(sSVG){if(sSVG.length>4){sExtension=sSVG.substring(sSVG.length-4);sExtension=sExtension.toLowerCase()}if(sExtension===".svg"){sSvgDataURL=sSVG}else{sSvgDataURL=sap.galilei.ui.common.svg.Svg.convertSvgToDataUrl(sSVG)}if(sSvgDataURL){oImage=new Image();oImage.crossOrigin="Anonymous";oImage.onload=function(){if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}sImageDataURL=sap.galilei.ui.common.Image.convertImageToDataUrl(oImage,sImageFormat,oOptions);oImage=undefined;if(sImageDataURL){if(fnImageReady){fnImageReady(sImageDataURL)}}};oImage.src=sSvgDataURL}}},convertSVGToImageBase64:function(sSVG,fnImageReady,sImageFormat,oOptions){if(sSVG&&window&&window.atob){this.convertSVGToImageDataUrl(sSVG,function(sImageDataURL){var sImageData;if(sImageDataURL){sImageDataURL=sImageDataURL.replace(/^data:image\/(png|jpeg);base64,/,"");sImageData=sap.galilei.ui.common.Blob.decodeBase64(sImageDataURL);if(fnImageReady){fnImageReady(sImageData)}}},sImageFormat,oOptions)}},convertSVGToImageBlob:function(sSVG,fnImageReady,sImageFormat,oOptions){var oBlob;if(sSVG){sap.galilei.ui.common.Image.convertSVGToImageBase64(sSVG,function(sImageData){if(sImageData){if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}oBlob=sap.galilei.ui.common.Blob.createBlobFromString(sImageData,sImageFormat);if(fnImageReady){fnImageReady(oBlob)}}},sImageFormat,oOptions)}},isImageURL:function(sImageURL){var nIndex,sExtension;if(sImageURL&&sImageURL.length>0){nIndex=sImageURL.lastIndexOf(".");if(nIndex!==-1){sExtension=sImageURL.substring(nIndex+1);if(sExtension){sExtension=sExtension.toLowerCase();switch(sExtension){case"png":case"jpg":case"jpeg":case"gif":case"bmp":case"ico":case"svg":return true}}}}return false}}})}());
(function(){sap.galilei.ui.common.Matrix=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Matrix",initialize:function(options){this.set.apply(this,arguments)},properties:{a:1,b:0,c:0,d:1,e:0,f:0,isIdentity:{get:function(){return(this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.e===0&&this.f===0)}}},methods:{set:function(oMatrix){if(arguments.length===1){if(oMatrix instanceof SVGMatrix){sap.galilei.ui.common.Matrix.setMatrixProperties(this,oMatrix)}else{this.a=oMatrix.a;this.b=oMatrix.b;this.c=oMatrix.c;this.d=oMatrix.d;this.e=oMatrix.e;this.f=oMatrix.f}}else{if(arguments.length===6){this.a=+arguments[0];this.b=+arguments[1];this.c=+arguments[2];this.d=+arguments[3];this.e=+arguments[4];this.f=+arguments[5]}}return this},clone:function(){return new sap.galilei.ui.common.Matrix(this)},setIdentity:function(){this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0},transformRectangles:function(oRect1,oRect2){if(oRect1&&oRect2){var scaleX,scaleY,ptCenter1,ptCenter2;ptCenter1=oRect1.getCenter(false);ptCenter2=oRect2.getCenter(false);if(oRect1.width!==0&&oRect1.height!==0){scaleX=oRect2.width/oRect1.width;scaleY=oRect2.height/oRect1.height;this.translate(ptCenter2[0],ptCenter2[1]);this.scale(scaleX,scaleY);this.translate(-ptCenter1[0],-ptCenter1[1])}}return this},multiply:function(oSecondMatrix){var svgMatrix1,svgMatrix2;if(oSecondMatrix){svgMatrix1=sap.galilei.ui.common.Matrix.getSVGMatrix(this);svgMatrix2=sap.galilei.ui.common.Matrix.getSVGMatrix2(oSecondMatrix);this.set(svgMatrix1.multiply(svgMatrix2))}return this},inverse:function(){var svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.inverse());return this},translate:function(dx,dy){var svgMatrix;dx=+dx;dy=+dy;if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)){svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.translate(dx,dy))}return this},scale:function(scaleX,scaleY,cx,cy){var svgMatrix,newSvgMatrix;scaleX=+scaleX;scaleY=+scaleY;if(scaleX!==undefined&&!isNaN(scaleX)){cx=+cx;cy=+cy;if(arguments.length===4&&!isNaN(cx)&&!isNaN(cy)){this.translate(cx,cy)}svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);if(scaleY===undefined||isNaN(scaleY)||scaleY===scaleX){newSvgMatrix=svgMatrix.scale(scaleX)}else{newSvgMatrix=svgMatrix.scaleNonUniform(scaleX,scaleY)}this.set(newSvgMatrix);if(arguments.length===4&&!isNaN(cx)&&!isNaN(cy)){this.translate(-cx,-cy)}}return this},rotate:function(angle,cx,cy){var svgMatrix;angle=+angle;if(angle!==undefined&&!isNaN(angle)){cx=+cx;cy=+cy;if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(cx,cy)}svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.rotate(angle));if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(-cx,-cy)}}return this},rotateFromVector:function(dx,dy,cx,cy){var svgMatrix;dx=+dx;dy=+dy;if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)){cx=+cx;cy=+cy;if(dx===0){if(dy<0){return this.rotate(-90,cx,cy)}else{return this.rotate(90,cx,cy)}}if(dy!==0){if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(cx,cy)}svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.rotateFromVector(dx,dy));if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(-cx,-cy)}}}return this},rotateFromVectors:function(x1,y1,x2,y2,cx,cy){x1=+x1;y1=+y1;x2=+x2;y2=+y2;if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined&&!isNaN(x1)&&!isNaN(y1)&&!isNaN(x2)&&!isNaN(y2)){var dx1,dy1,dx2,dy2;cx=+cx;cy=+cy;if(cx===undefined||isNaN(cx)){cx=0}if(cy===undefined||isNaN(cy)){cy=0}dx1=x1-cx;dy1=y1-cy;dx2=x2-cx;dy2=y2-cy;this.rotateFromVector(dx2,dy2,cx,cy);this.rotateFromVector(dx1,-dy1,cx,cy)}return this},flipX:function(cx){var svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);cx=+cx;if(arguments.length===1&&!isNaN(cx)){this.translate(cx,0)}this.set(svgMatrix.flipX());if(arguments.length===1&&!isNaN(cx)){this.translate(-cx-cx,0)}return this},flipY:function(cy){var svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);cy=+cy;if(arguments.length===1&&!isNaN(cy)){this.translate(0,cy)}this.set(svgMatrix.flipY());if(arguments.length===1&&!isNaN(cy)){this.translate(0,-cy-cy)}return this},getTransform:function(){var sTransform;if(this.b===0&&this.c===0){if(this.e!==0||this.f!==0){sTransform="translate("+this.e+" "+this.f+")"}if(this.a!==0||this.d!==0){if(!sTransform){sTransform=""}else{sTransform+=" "}sTransform+="scale("+this.a+" "+this.d+")"}}else{sTransform="matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")"}return sTransform}},statics:{_svgMatrx:undefined,_svgMatrx2:undefined,svgMatrix:{get:function(){if(this._svgMatrx===undefined){this._svgMatrx=sap.galilei.ui.common.svg.Svg.hiddenSvg.createSVGMatrix()}return this._svgMatrx}},svgMatrix2:{get:function(){if(this._svgMatrx2===undefined){this._svgMatrx2=sap.galilei.ui.common.svg.Svg.hiddenSvg.createSVGMatrix()}return this._svgMatrx2}},setSvgMatrixProperties:function(oSvgMatrix,oMatrix){if(oSvgMatrix&&oMatrix){oSvgMatrix.a=oMatrix.a;oSvgMatrix.b=oMatrix.b;oSvgMatrix.c=oMatrix.c;oSvgMatrix.d=oMatrix.d;oSvgMatrix.e=oMatrix.e;oSvgMatrix.f=oMatrix.f}return oSvgMatrix},setMatrixProperties:function(oMatrix,oSvgMatrix){if(oMatrix&&oSvgMatrix){oMatrix.a=oSvgMatrix.a;oMatrix.b=oSvgMatrix.b;oMatrix.c=oSvgMatrix.c;oMatrix.d=oSvgMatrix.d;oMatrix.e=oSvgMatrix.e;oMatrix.f=oSvgMatrix.f}return oMatrix},getNewMatrix:function(oSvgMatrix){return new sap.galilei.ui.common.Matrix(oSvgMatrix)},getSVGMatrix:function(oMatrix){var oSvgMatrix=sap.galilei.ui.common.Matrix.svgMatrix;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(oSvgMatrix,oMatrix);return oSvgMatrix},getSVGMatrix2:function(oMatrix){var oSvgMatrix=sap.galilei.ui.common.Matrix.svgMatrix2;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(oSvgMatrix,oMatrix);return oSvgMatrix}}})}());
(function(){sap.galilei.ui.common.PdfWriter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.PdfWriter",properties:{pdfDocument:undefined,unit:"pt",page:{field:"_page",get:function(){if(!this._page){this._page=new sap.galilei.ui.common.Page()}return this._page},set:function(oPage){if(oPage){this._page=oPage.clone();this.checkPage()}}},pageOrientation:{get:function(){return this.page.pageOrientation}},paperType:{get:function(){this.checkPage();return this.page.paperType.toLowerCase()}},pageWidthPixels:{get:function(){return this.page.pageWidthPixels}},pageHeightPixels:{get:function(){return this.page.pageHeightPixels}},leftMarginPixels:{get:function(){return this.page.pageLeftMarginPixels}},topMarginPixels:{get:function(){return this.page.pageTopMarginPixels}},rightMarginPixels:{get:function(){return this.page.pageRightMarginPixels}},bottomMarginPixels:{get:function(){return this.page.pageBottomMarginPixels}}},methods:{checkPage:function(){if(this.page){switch(this.page.paperType){case sap.galilei.ui.common.PaperTypes.A5:case sap.galilei.ui.common.PaperTypes.A4:case sap.galilei.ui.common.PaperTypes.A3:case sap.galilei.ui.common.PaperTypes.B5:case sap.galilei.ui.common.PaperTypes.B4:case sap.galilei.ui.common.PaperTypes.letter:case sap.galilei.ui.common.PaperTypes.legal:case sap.galilei.ui.common.PaperTypes.ledger:break;default:this.page.setPaperSize(sap.galilei.ui.common.PaperTypes.A4);break}}},createDocument:function(){try{var oJsPDF=sap.galilei.ui.common.PdfWriter.getJsPDF();if(oJsPDF){this.pdfDocument=new oJsPDF(this.pageOrientation,this.unit,this.paperType)}}catch(e){throw"Cannot find jsPDF."}return this.pdfDocument},saveDocument:function(sFileName){if(this.pdfDocument&&sFileName){this.pdfDocument.save(sFileName)}},generatePdfDataURL:function(){var sPDF;if(this.pdfDocument){sPDF=this.pdfDocument.output("datauristring",{})}return sPDF},generatePdf:function(){var sPDF;if(this.pdfDocument){sPDF=this.pdfDocument.output(undefined,{})}return sPDF},addPage:function(){if(this.pdfDocument){this.pdfDocument.addPage()}},drawBorder:function(nSize){var nSizeX,nSizeY,x,y,width,height;if(this.pdfDocument){if(nSize===undefined){nSize=5}nSizeX=sap.galilei.ui.common.Measure.measureToPixel(nSize,"mm",true,0);nSizeY=sap.galilei.ui.common.Measure.measureToPixel(nSize,"mm",false,0);x=nSizeX-this.leftMarginPixels;y=nSizeY-this.topMarginPixels;width=this.leftMarginPixels+this.pageWidthPixels+this.rightMarginPixels-nSizeX-nSizeX;height=this.topMarginPixels+this.pageHeightPixels+this.bottomMarginPixels-nSizeY-nSizeY;this.drawRect(x,y,width,height)}},drawImage:function(sImageDataURL,sImageType,x,y,width,height,bCenter){var oImageRect;if(sImageDataURL&&sImageType&&this.pdfDocument){switch(sImageType){case"image/jpeg":sImageType="JPEG";break;default:sImageType="PNG";break}if(bCenter){if(width>this.pageWidthPixels||height>this.pageHeightPixels){oImageRect=new sap.galilei.ui.common.Rect(0,0,width,height);oImageRect.resize(this.pageWidthPixels,this.pageHeightPixels,false,true,false);width=oImageRect.width;height=oImageRect.height}x=(this.pageWidthPixels-width)/2;y=(this.pageHeightPixels-height)/2}x=this.toFontPointsX(this.leftMarginPixels+x);y=this.toFontPointsY(this.topMarginPixels+y);width=this.toFontPointsX(width);height=this.toFontPointsY(height);this.pdfDocument.addImage(sImageDataURL,sImageType,x,y,width,height)}},drawRect:function(x,y,width,height,bStroke,bFill){var sStyle=null;if(this.pdfDocument){bStroke=(bStroke===undefined)?true:bStroke;bFill=(bFill===undefined)?false:bFill;if(bStroke&&bFill){sStyle="FD"}else{if(bStroke){sStyle="S"}else{if(bFill){sStyle="F"}}}x=this.toFontPointsX(this.leftMarginPixels+x);y=this.toFontPointsY(this.topMarginPixels+y);width=this.toFontPointsX(width);height=this.toFontPointsY(height);this.pdfDocument.rect(x,y,width,height,sStyle)}},toFontPointsX:function(nPixels){return nPixels*72/sap.galilei.ui.common.Device.screenDpiX},toFontPointsY:function(nPixels){return nPixels*72/sap.galilei.ui.common.Device.screenDpiY},dispose:function(){this.pdfDocument=undefined}},statics:{_jsPDF:undefined,getJsPDF:function(){if(typeof jsPDF==="undefined"){return sap.galilei.ui.common.PdfWriter._jsPDF}else{return jsPDF}},setJsPDF:function(oJsPDF){sap.galilei.ui.common.PdfWriter._jsPDF=oJsPDF},isSupportPDF:{get:function(){return sap.galilei.ui.common.PdfWriter.getJsPDF()!==undefined}}}})}());
(function(){sap.galilei.ui.common.Print=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Print",properties:{pdfWriter:undefined},methods:{printDiagram:function(oViewer,oPage,oOptions,fnSuccess,fnError){var self=this,sSVG,oGlobalViewRect;if(oViewer){oPage=oPage||oViewer.page;oOptions=oOptions||{};oOptions.includeDecoratorLayers=(oOptions.includeDecoratorLayers===undefined)?false:oOptions.includeDecoratorLayers;oOptions.isFitToOnePage=(oOptions.isFitToOnePage===undefined)?true:oOptions.isFitToOnePage;oGlobalViewRect=oViewer.getGlobalViewRect();oGlobalViewRect.inflate(sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN,sap.galilei.ui.common.svg.Svg.SVG_RECT_MARGIN);if(oPage){oViewer.generateSVG({includeDecoratorLayers:oOptions.includeDecoratorLayers,replaceImageURL:true},function(sSVG){if(sSVG){self.printSVG(sSVG,oGlobalViewRect&&oGlobalViewRect.width,oGlobalViewRect&&oGlobalViewRect.height,oPage,oOptions,fnSuccess,fnError)}else{if(fnError){fnError()}}});return}}if(fnError){fnError()}},printSVG:function(sSVG,nSVGWidth,nSVGHeight,oPage,oOptions,fnSuccess,fnError){var self=this,oFitToPages,oGlobalViewRect,oPdfWriter,sFileName,oImageRect,nTotalPages,nPageWidth,nPageHeight,nDiagramOffsetX,nDiagramOffsetY,aUsedPages,oPageRect,nIndexPage=0,nPageX,nPageY,x0,y0,x,y;function endPrint(){if(oPdfWriter){oPdfWriter.saveDocument(sFileName);self.dispose();if(fnSuccess){fnSuccess()}}}function printNextPage(){var bAdjustImage=false,nImageWidth,nImageHeight;if(oPdfWriter&&nIndexPage<nTotalPages){if(nTotalPages===1){bAdjustImage=true;nImageWidth=nSVGWidth;nImageHeight=nSVGHeight;x=undefined;y=undefined;if(nImageWidth>2000||nImageHeight>2000){oImageRect=new sap.galilei.ui.common.Rect(0,0,nImageWidth,nImageHeight);oImageRect.resize(2000,2000,false,true,false);nImageWidth=oImageRect.width;nImageHeight=oImageRect.height}}else{bAdjustImage=false;oPageRect=aUsedPages[nIndexPage];nPageX=oPageRect.x;nPageY=oPageRect.y;nPageWidth=oPageRect.width;nPageHeight=oPageRect.height;nImageWidth=nPageWidth;nImageHeight=nPageHeight;x0=aUsedPages[0].x;y0=aUsedPages[0].y;x=nDiagramOffsetX/oOptions.pageScale-(nPageX-x0);y=nDiagramOffsetY/oOptions.pageScale-(nPageY-y0)}sap.galilei.ui.common.Image.convertSVGToImageDataUrl(sSVG,function(sImageDataURL){oPdfWriter.drawBorder();oPdfWriter.drawImage(sImageDataURL,"image/png",0,0,nImageWidth,nImageHeight,true);sImageDataURL=undefined;nIndexPage++;if(nIndexPage===nTotalPages){endPrint()}else{oPdfWriter.addPage();printNextPage()}},"image/png",{x:x,y:y,width:nImageWidth,height:nImageHeight,adjustTargetImageSize:bAdjustImage,fitInTargetImage:bAdjustImage})}}if(sSVG){if(oPage){oPage=oPage.clone()}else{oPage=new sap.galilei.ui.common.Page()}if(isNaN(nSVGWidth)){nSVGWidth=100}if(isNaN(nSVGHeight)){nSVGHeight=100}oOptions=oOptions||{};oOptions.isFitToOnePage=(oOptions.isFitToOnePage===undefined)?true:oOptions.isFitToOnePage;oGlobalViewRect=new sap.galilei.ui.common.Rect(0,0,nSVGWidth,nSVGHeight);if(oOptions.isFitToOnePage){oFitToPages=oPage.fitToOnePage(oGlobalViewRect,oPage.isCanChangeOrientation)}else{oFitToPages=oPage.fitToPages(oGlobalViewRect,oPage.isCanChangeOrientation)}sap.galilei.core.copyProperties(oOptions,oFitToPages,true);sFileName=oOptions.fileName||"diagram.pdf";nTotalPages=(!isNaN(oOptions.totalPages))?oOptions.totalPages:1;aUsedPages=oOptions.usedPages;if(!aUsedPages||aUsedPages.length!==nTotalPages){nTotalPages=1;aUsedPages=undefined}nPageX=(!isNaN(oOptions.diagramLeftOffset))?oOptions.diagramLeftOffset:0;nPageY=(!isNaN(oOptions.diagramTopOffset))?oOptions.diagramTopOffset:0;nPageWidth=(!isNaN(oOptions.pageWidthPixels))?oOptions.pageWidthPixels:0;nPageHeight=(!isNaN(oOptions.pageHeightPixels))?oOptions.pageHeightPixels:0;nDiagramOffsetX=(!isNaN(oOptions.diagramLeftOffset))?oOptions.diagramLeftOffset:0;nDiagramOffsetY=(!isNaN(oOptions.diagramTopOffset))?oOptions.diagramTopOffset:0;oPdfWriter=this.pdfWriter=new sap.galilei.ui.common.PdfWriter({page:oPage});if(oPdfWriter.createDocument()){nIndexPage=0;printNextPage()}else{if(fnError){fnError()}}}else{if(fnError){fnError()}}},dispose:function(){if(this.pdfWriter){this.pdfWriter.dispose();this.pdfWriter=undefined}}}})}());
namespace("sap.galilei.ui.common",function(nsCommon){nsCommon.Text=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Text",statics:{DEFAULT_FONT:"12px Arial, Helvetica, sans-serif",DEFAULT_UI_FONT:"14px Arial, Helvetica, sans-serif",NEWLINE_SEPARATOR:"\r\n",WORD_SEPARATORS:" \t,;.!?-_()[]{}'\"*+/%<>|@=&#",measureTextLineWidth:function(sText,sFontProps){return nsCommon.canvas.Canvas.measureTextLineWidth(sText,sFontProps)},measureTextSize:function(sText,sFontProps){return nsCommon.canvas.Canvas.measureTextSize(sText,sFontProps)},ellipsisTextLine:function(sText,iClipWidth,sFontProps){var clipText="",iTextWidth=0,iTextHeight=0,iEllipsisWidth,len,sLine,iWidth,bAddEllipsis;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;if(sText&&sText.length>0){nsCommon.canvas.Canvas.font(sFontProps);iTextHeight=nsCommon.canvas.Canvas.getFontHeight();if(iClipWidth>=0){iEllipsisWidth=nsCommon.canvas.Canvas.measureTextLineWidth("...");len=sText.length;sLine=sText;iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sText);bAddEllipsis=true;if(nsCommon.canvas.Canvas.measureTextLineWidth(sText.slice(0,2))+iEllipsisWidth>iClipWidth){bAddEllipsis=false;iEllipsisWidth=0}if(len>0){if(bAddEllipsis){iWidth+=iEllipsisWidth}while(iWidth>iClipWidth){--len;if(len===0){sLine="";iWidth=0;iTextHeight=0;break}if(len<=1){bAddEllipsis=false;iEllipsisWidth=0}sLine=sText.slice(0,len);iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine);if(bAddEllipsis){iWidth+=iEllipsisWidth}}if(bAddEllipsis){sLine+="..."}}clipText=sLine;iTextWidth=iWidth}else{clipText=sText+"...";iTextWidth=nsCommon.canvas.Canvas.measureTextLineWidth(clipText)}}return{text:clipText,width:iTextWidth,height:iTextHeight}},clipTextLine:function(sText,iClipWidth,iClipHeight,bAddEllipsis,sFontProps){var clipText="",iTextWidth=0,iTextHeight=0,len,oldLen,sLine,iWidth,iEllipsisWidth;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(bAddEllipsis===undefined){bAddEllipsis=true}if(sText&&sText.length>0){nsCommon.canvas.Canvas.font(sFontProps);iTextHeight=nsCommon.canvas.Canvas.getFontHeight();if(iClipHeight===-1||iClipHeight>=iTextHeight){if(iClipWidth>=0){len=sText.length;oldLen=len;sLine=sText.slice(0,len);iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine);if(iWidth>iClipWidth){while(iWidth>iClipWidth){oldLen=len;len=Math.floor(len/2);if(len===0){break}sLine=sText.slice(0,len);iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine)}len=oldLen;iEllipsisWidth=0;if(bAddEllipsis){iEllipsisWidth=nsCommon.canvas.Canvas.measureTextLineWidth("...")}if(len<5||(nsCommon.canvas.Canvas.measureTextLineWidth(sText.slice(0,2))+iEllipsisWidth>iClipWidth)){bAddEllipsis=false;iEllipsisWidth=0}if(len>0){sLine=sText.slice(0,len);iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine);if(bAddEllipsis){iWidth+=iEllipsisWidth}while(iWidth>iClipWidth){--len;if(len===0){sLine="";iWidth=0;iTextHeight=0;break}if(len<=1){bAddEllipsis=false;iEllipsisWidth=0}sLine=sText.slice(0,len);iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine);if(bAddEllipsis){iWidth+=iEllipsisWidth}}if(bAddEllipsis){sLine+="..."}}}clipText=sLine;iTextWidth=iWidth}else{clipText=sText;iTextWidth=nsCommon.canvas.Canvas.measureTextLineWidth(clipText)}}else{iTextHeight=0}}if(clipText.length===0){iTextWidth=iTextHeight=0}return{text:clipText,width:iTextWidth,height:iTextHeight}},isWordSeparator:function(c){var i;if(c&&c.length===1){for(i=0;i<this.WORD_SEPARATORS.length;++i){if(c===this.WORD_SEPARATORS[i]){return true}}}return false},getWord:function(text){var word="",i,c;if(text&&text.length>0){for(i=0;i<text.length;++i){c=text[i];word+=c;if(this.isWordSeparator(c)){return word}}}return word},wrapWord:function(word,iClipWidth,iClipHeight,sFontProps){var aLines=[],aLineWidths=[],iLineHeight=0,iTotalWidth=0,iTotalHeight=0,bLinesClipped=false,iWidth,sRest,c,sLine,iCharWidth;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(word&&word.length>0){nsCommon.canvas.Canvas.font(sFontProps);iLineHeight=nsCommon.canvas.Canvas.getFontHeight();if(iClipHeight===-1||iClipHeight>=iLineHeight){iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(word);if(iClipWidth>=0&&iWidth>iClipWidth){sRest=word;sLine="";iWidth=0;do{c=sRest.slice(0,1);if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;sLine="";break}iCharWidth=nsCommon.canvas.Canvas.measureTextLineWidth(c);if(iWidth+iCharWidth>iClipWidth){if(sLine.length>0){aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight;sLine=c;iWidth=iCharWidth}else{aLines.push(c);aLineWidths.push(iCharWidth);iTotalWidth=Math.max(iTotalWidth,iCharWidth);iTotalHeight+=iLineHeight}}else{sLine+=c;iWidth+=iCharWidth}sRest=sRest.slice(1)}while(sRest.length>0);if(sLine.length>0){aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight}}else{aLines[0]=word;aLineWidths[0]=iTotalWidth=nsCommon.canvas.Canvas.measureTextLineWidth(word);iTotalHeight=iLineHeight}}else{iLineHeight=0;bLinesClipped=true}}return{lines:aLines,lineWidths:aLineWidths,lineHeight:iLineHeight,totalWidth:iTotalWidth,totalHeight:iTotalHeight,isLinesClipped:bLinesClipped}},lineWrapText:function(sText,iClipHeight,sFontProps){var aLines=[],aLineWidths=[],iLineHeight=0,iTotalWidth=0,iTotalHeight=0,bLinesClipped=false,aInternalLines,i,sLine,iWidth;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(sText!==undefined){sText=sText.trimLeft();sText=sText.trimRight();if(sText.length>0){nsCommon.canvas.Canvas.font(sFontProps);iLineHeight=nsCommon.canvas.Canvas.getFontHeight();aInternalLines=sText.split("\r\n");for(i=0;i<aInternalLines.length;++i){if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;break}sLine=aInternalLines[i];iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine);aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight}}}if(aLines.length===0){iLineHeight=0}return{lines:aLines,lineWidths:aLineWidths,lineHeight:iLineHeight,totalWidth:iTotalWidth,totalHeight:iTotalHeight,isLinesClipped:bLinesClipped}},wordWrapText:function(sText,iClipWidth,iClipHeight,sFontProps){var aLines=[],aLineWidths=[],iLineHeight=0,iTotalWidth=0,iTotalHeight=0,bLinesClipped=false,aInternalLines,noLine,sLine,sTrimLine,word,sRest,iWidth,iWordWidth,oWordParts,len,iPart;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(sText!==undefined){sText=sText.trimLeft();sText=sText.trimRight();if(sText.length>0){if(iClipWidth===-1){return this.lineWrapText(sText,iClipHeight,sFontProps)}nsCommon.canvas.Canvas.font(sFontProps);iLineHeight=nsCommon.canvas.Canvas.getFontHeight();aInternalLines=sText.split("\r\n");for(noLine=0;noLine<aInternalLines.length;++noLine){if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;break}sRest=aInternalLines[noLine];sLine="";iWidth=0;do{word=this.getWord(sRest);iWordWidth=nsCommon.canvas.Canvas.measureTextLineWidth(word);if(iWidth+iWordWidth>iClipWidth){if(sLine.length>0){sTrimLine=sLine.trim();if(sTrimLine.length<sLine.length){sLine=sTrimLine;iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine)}aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight;sLine="";iWidth=0;if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;sRest="";break}}oWordParts=this.wrapWord(word,iClipWidth,iClipHeight,sFontProps);len=oWordParts.lines.length;for(iPart=0;iPart<len-1;++iPart){aLines.push(oWordParts.lines[iPart]);aLineWidths.push(oWordParts.lineWidths[iPart]);iTotalWidth=Math.max(iTotalWidth,oWordParts.lineWidths[iPart]);iTotalHeight+=iLineHeight;if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;sRest=sLine="";len=0;break}}if(oWordParts.isLinesClipped){bLinesClipped=true}if(len>0){sLine=oWordParts.lines[len-1];if(sLine[0]===" "){sLine.trimLeft()}iWidth=0;if(sLine.length>0){iWidth=oWordParts.lineWidths[len-1]}}else{sLine="";iWidth=0}}else{sLine+=word;iWidth+=iWordWidth}sRest=sRest.slice(word.length)}while(sRest.length>0);if(sLine.length>0){sTrimLine=sLine.trim();if(sTrimLine.length<sLine.length){sLine=sTrimLine;iWidth=nsCommon.canvas.Canvas.measureTextLineWidth(sLine)}aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight}}}}if(aLines.length===0){iLineHeight=0}return{lines:aLines,lineWidths:aLineWidths,lineHeight:iLineHeight,totalWidth:iTotalWidth,totalHeight:iTotalHeight,isLinesClipped:bLinesClipped}},layoutText:function(sText,iClipWidth,iClipHeight,eHorzAlignment,eVertAlignment,bWordWrap,bAddEllipsis,sFontProps){var oLayout,iLines,dy,nLast,lastLine,ellipsis,i,x,y,iWidth,sLine,oClipLine,nAscend=0.8;if(sText!==undefined){sText=sText.trimLeft();sText=sText.trimRight()}iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(bWordWrap===undefined||iClipWidth===-1){bWordWrap=false}if(bAddEllipsis===undefined){bAddEllipsis=true}eHorzAlignment=sap.galilei.core.validateEnum(nsCommon.HorizontalAlignment,eHorzAlignment);eVertAlignment=sap.galilei.core.validateEnum(nsCommon.VerticalAlignment,eVertAlignment);if(bWordWrap){oLayout=this.wordWrapText(sText,iClipWidth,iClipHeight,sFontProps)}else{oLayout=this.lineWrapText(sText,iClipHeight,sFontProps)}if(oLayout){oLayout.x=[];oLayout.y=[];oLayout.left=oLayout.top=0;iLines=oLayout.lines.length;if(sFontProps&&(sFontProps.indexOf("SAP-")!==-1||sFontProps.indexOf("sap-")!==-1||sFontProps.indexOf("-icon")!==-1||sap.galilei.ui.common.IconPool.isIconFont(sFontProps))){nAscend=0.9375}dy=Math.round(oLayout.lineHeight*nAscend);if(iLines>0){if(iClipHeight!==-1){if(oLayout.isLinesClipped&&iLines>0){if(bAddEllipsis){nLast=iLines-1;lastLine=oLayout.lines[nLast];ellipsis=this.ellipsisTextLine(lastLine,iClipWidth);oLayout.lines[nLast]=ellipsis.text;oLayout.lineWidths[nLast]=ellipsis.width}}if(eVertAlignment===nsCommon.VerticalAlignment.middle||eVertAlignment===nsCommon.VerticalAlignment.height){dy+=Math.round((iClipHeight-oLayout.totalHeight)/2)}else{if(eVertAlignment===nsCommon.VerticalAlignment.bottom){dy+=iClipHeight-oLayout.totalHeight}}}y=dy;oLayout.totalWidth=0;for(i=0,x=0;i<oLayout.lines.length;++i){sLine=oLayout.lines[i];if(iClipWidth!==-1){if(!bWordWrap){oClipLine=this.clipTextLine(sLine,iClipWidth,-1,!bWordWrap&&bAddEllipsis,sFontProps);if(sLine!==oClipLine.text){sLine=oClipLine.text;oLayout.lines[i]=oClipLine.text;oLayout.lineWidths[i]=oClipLine.width}iWidth=oClipLine.width}else{iWidth=oLayout.lineWidths[i]}if(eHorzAlignment===nsCommon.HorizontalAlignment.center||eHorzAlignment===nsCommon.HorizontalAlignment.width){x=Math.round((iClipWidth-iWidth)/2)}else{if(eHorzAlignment===nsCommon.HorizontalAlignment.right){x=iClipWidth-iWidth}}}else{iWidth=oLayout.lineWidths[i]}oLayout.totalWidth=Math.max(oLayout.totalWidth,iWidth);oLayout.x.push(x);oLayout.y.push(y);if(i===0){oLayout.left=x;oLayout.top=y-dy}else{oLayout.left=Math.min(x,oLayout.left);oLayout.top=Math.min(y-dy,oLayout.top)}x=0;y+=oLayout.lineHeight}}}return oLayout}}})});
(function(){sap.galilei.ui.common.EasingFunction={linear:"linear",poly:"poly",quad:"quad",cubic:"cubic",cubicInOut:"cubic-in-out",sin:"sin",exp:"exp",circle:"circle",elastic:"elastic",back:"back",bounce:"bounce",DEFAULT:"cubic-in-out"};sap.galilei.ui.common.TransitionDefinition=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.TransitionDefinition",properties:{duration:500,ease:"cubic-in-out",argument1:undefined,argument2:undefined,delay:undefined},methods:{getTransition:function(oNode){var d3Node,oTransition;if(oNode&&oNode.d3Node){d3Node=oNode.d3Node}else{if(oNode&&oNode.node){d3Node=oNode}}if(d3Node){oTransition=d3Node.transition()}if(oTransition){if(this.delay!==undefined){oTransition.delay(this.delay)}if(this.duration!==undefined){oTransition.duration(this.duration)}if(this.ease!==undefined){oTransition.ease(this.ease,this.argument1,this.argument2)}return oTransition}return d3Node}}})}());
