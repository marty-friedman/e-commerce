!function(e){function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){function a(e){e.keys().forEach(function(t){i[t]=e(t)})}var i={};a(n(3)),a(n(26))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=(n.n(a),n(0)),o=(n.n(i),this);a.module("personalizationsmarteditcontainermodule",["personalizationsmarteditcontainerTemplates","personalizationsmarteditContextServiceModule","personalizationsmarteditRestServiceModule","ui.bootstrap","personalizationsmarteditCommons","functionsModule","personalizationsmarteditPreviewServiceModule","personalizationsmarteditManagerModule","personalizationsmarteditManagerViewModule","personalizationsmarteditContextMenu","featureServiceModule","perspectiveServiceModule","iFrameManagerModule","personalizationsmarteditCombinedViewModule","personalizationsmarteditSegmentViewModule","personalizationsmarteditToolbarContextModule","crossFrameEventServiceModule","seConstantsModule","personalizationsmarteditRulesAndPermissionsRegistrationModule","gatewayFactoryModule","yjqueryModule","eventServiceModule","personalizationsmarteditCustomizeViewModule","languageServiceModule"]).constant("PERSONALIZATION_PERSPECTIVE_KEY","personalizationsmartedit.perspective").factory("personalizationsmarteditIFrameUtils",["$filter","iFrameManager","personalizationsmarteditContextService","personalizationsmarteditPreviewService","personalizationsmarteditMessageHandler",function(e,t,n,a,i){"ngInject";var r=o;return o.reloadPreview=function(e,n){t.loadPreview(e,n)},o.clearAndReloadPreview=function(){var t=n.getSeData().sePreviewData.previewTicketId;a.removePersonalizationDataFromPreview(t).then(function(){var e=n.getSeData().sePreviewData;r.reloadPreview(e.resourcePath,e.previewTicketId)},function(){i.sendError(e("translate")("personalization.error.updatingpreviewticket"))})},o}]).controller("topToolbarMenuController",["$scope","personalizationsmarteditManager","personalizationsmarteditManagerView","personalizationsmarteditIFrameUtils","personalizationsmarteditContextService","personalizationsmarteditContextUtils","personalizationsmarteditCombinedView",function(e,t,n,a,i,o,r){"ngInject";e.status={isopen:!1},e.preventDefault=function(e){e.stopPropagation()},e.createCustomizationClick=function(){t.openCreateCustomizationModal()},e.managerViewClick=function(){o.clearCombinedViewCustomizeContext(i),o.clearCustomizeContextAndReloadPreview(a,i),o.clearCombinedViewContextAndReloadPreview(a,i),n.openManagerAction()},e.combinedViewClick=function(){o.clearCustomizeContextAndReloadPreview(a,i),r.openManagerAction()},e.isCustomizeCustomizationSelected=function(){return i.getCustomize().selectedCustomization},e.isCombinedViewCustomizationSelected=function(){return i.getCombinedView().customize.selectedCustomization}}]).run(["yjQuery","domain",function(e,t){"ngInject";!function(t){var n=e("<link rel='stylesheet' type='text/css' href='"+t+"'>");e("head").append(n)}(t+"/personalizationsmartedit/css/style.css")}]).run(["PERSONALIZATION_PERSPECTIVE_KEY","personalizationsmarteditContextServiceReverseProxy","personalizationsmarteditContextService","personalizationsmarteditContextModal","featureService","perspectiveService",function(e,t,n,a,i,o){"ngInject";i.addToolbarItem({toolbarId:"experienceSelectorToolbar",key:"personalizationsmartedit.container.pagecustomizations.toolbar",type:"TEMPLATE",nameI18nKey:"personalization.toolbar.pagecustomizations",priority:4,section:"left",include:"personalizationsmarteditCustomizeViewWrapperTemplate.html",keepAliveOnClose:!1,permissions:["se.edit.page"]}),i.addToolbarItem({toolbarId:"experienceSelectorToolbar",key:"personalizationsmartedit.container.combinedview.toolbar",type:"TEMPLATE",nameI18nKey:"personalization.toolbar.combinedview.name",priority:6,section:"left",include:"personalizationsmarteditCombinedViewMenuTemplate.html",keepAliveOnClose:!1,permissions:["se.read.page"]}),i.addToolbarItem({toolbarId:"experienceSelectorToolbar",key:"personalizationsmartedit.container.manager.toolbar",type:"TEMPLATE",nameI18nKey:"personalization.toolbar.library.name",priority:8,section:"left",include:"personalizationsmarteditCustomizationManagMenuTemplate.html",keepAliveOnClose:!1,permissions:["se.edit.page"]}),i.register({key:"personalizationsmartedit.context.service",nameI18nKey:"personalization.context.service.name",descriptionI18nKey:"personalization.context.service.description",enablingCallback:function(){var e=n.getPersonalization();e.enabled=!0,n.setPersonalization(e)},disablingCallback:function(){var e=n.getPersonalization();e.enabled=!1,n.setPersonalization(e)},permissions:["se.edit.page"]}),o.register({key:e,nameI18nKey:"personalization.perspective.name",descriptionI18nKey:"personalization.perspective.description",features:["personalizationsmartedit.context.service","personalizationsmartedit.container.pagecustomizations.toolbar","personalizationsmartedit.container.manager.toolbar","personalizationsmartedit.container.combinedview.toolbar","personalizationsmarteditSharedSlot","personalizationsmarteditComponentLightUp","personalizationsmarteditCombinedViewComponentLightUp","personalizationsmartedit.context.add.action","personalizationsmartedit.context.edit.action","personalizationsmartedit.context.delete.action","personalizationsmartedit.context.info.action","personalizationsmartedit.context.component.edit.action","personalizationsmartedit.context.show.action.list","se.contextualMenu","se.emptySlotFix","externalcomponentbutton","personalizationsmarteditExternalComponentDecorator"],perspectives:[],permissions:["se.personalization.open"]})}]).run(["PERSONALIZATION_PERSPECTIVE_KEY","personalizationsmarteditContextUtils","personalizationsmarteditContextService","personalizationsmarteditIFrameUtils","EVENT_PERSPECTIVE_UNLOADING","crossFrameEventService",function(e,t,n,a,i,o){"ngInject";var r=function(){t.clearCombinedViewCustomizeContext(n),t.clearCustomizeContextAndReloadPreview(a,n),t.clearCombinedViewContextAndReloadPreview(a,n)};o.subscribe(i,function(t,n){n===e&&r()})}]).run(["$q","PERSONALIZATION_PERSPECTIVE_KEY","personalizationsmarteditContextService","personalizationsmarteditContextUtils","personalizationsmarteditMessageHandler","personalizationsmarteditRestService","personalizationsmarteditUtils","EVENTS","SWITCH_LANGUAGE_EVENT","smartEditBootstrapGateway","systemEventService","perspectiveService",function(e,t,n,i,o,r,s,l,c,d,m,u){"ngInject";var p=function(){i.clearCombinedViewCustomizeContext(n),i.clearCustomizeContext(n),i.clearCombinedViewContext(n)};m.registerEventHandler(l.EXPERIENCE_UPDATE,function(){return p(),e.when()}),m.registerEventHandler(c,function(){var t=n.getCombinedView();return a.forEach(t.selectedItems,function(e){s.getAndSetCatalogVersionNameL10N(e.variation)}),n.setCombinedView(t),e.when()}),d.subscribe("smartEditReady",function(e,a){var i=(n.getSeData().sePreviewData||{}).previewTicketId;n.refreshPreviewData().then(function(){var e=n.getSeData().sePreviewData.previewTicketId;i!==e&&r.getPreviewTicket(e).then(function(e){0===e.variations.length&&r.getPreviewTicket(i).then(function(t){t.variations.length>0&&0===e.variations.length&&p()},function(){p()})})}),n.refreshExperienceData().then(function(){var e=n.getSeData().seExperienceData;if((u.getActivePerspective()||{}).key===t&&e.pageContext.catalogVersionUuid!==e.catalogDescriptor.catalogVersionUuid){var a={message:"personalization.warning.pagefromparent",timeout:-1};o.sendWarning(a)}}).finally(function(){n.applySynchronization()})})}])},function(e,t){e.exports=angular},function(e,t,n){function a(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./combinedView/personalizationsmarteditCombinedView.js":4,"./commonComponents/catalogFilterDropdown.js":5,"./commonComponents/catalogVersionFilterDropdown.js":6,"./commonComponents/hasMulticatalog.js":7,"./commonComponents/pageFilterDropdown.js":8,"./commonComponents/statusFilterDropdown.js":9,"./contextMenu/personalizationsmarteditContextMenu.js":10,"./customizeView/customizationsList/customizationsList.js":11,"./customizeView/personalizationsmarteditCustomizeView.js":12,"./dataFactory/dataFactory.js":13,"./management/commerceCustomizationView/personalizationsmarteditCommerceCustomizationView.js":14,"./management/managerView/personalizationsmarteditManagerView.js":15,"./management/personalizationsmarteditManager.js":16,"./management/tabs/personalizationsmarteditCustVarManagTargetGrp.js":17,"./management/tabs/segmentView/personalizationsmarteditSegmentView.js":18,"./management/tabs/segmentView/segmentExpressionAsHtml/personalizationsmarteditSegmentExpressionAsHtml.js":19,"./requireLegacyJsFiles.js":0,"./service/personalizationsmarteditContextService.js":20,"./service/personalizationsmarteditPreviewService.js":21,"./service/personalizationsmarteditRestService.js":22,"./service/personalizationsmarteditRulesAndPermissionsRegistrationService.js":23,"./templates.js":24,"./toolbarContext/personalizationsmarteditToolbarContext.js":25};a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=3},function(e,t){angular.module("personalizationsmarteditCombinedViewModule",["personalizationsmarteditRestServiceModule","personalizationsmarteditCommons","ui.select","personalizationsmarteditContextServiceModule","renderServiceModule","personalizationsmarteditDataFactory","modalServiceModule","personalizationsmarteditPreviewServiceModule","pageFilterDropdownModule","catalogFilterDropdownModule","hasMulticatalogModule","componentMenuServiceModule","personalizationsmarteditDataUtils","permissionServiceModule"]).factory("personalizationsmarteditCombinedView",["$controller","modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES","personalizationsmarteditContextService","personalizationsmarteditCombinedViewCommons","personalizationsmarteditContextUtils",function(e,t,n,a,i,o,r){var s={};return s.openManagerAction=function(){t.open({title:"personalization.modal.combinedview.title",templateUrl:"personalizationsmarteditCombinedViewConfigureTemplate.html",controller:["$scope","modalManager",function(t,n){t.modalManager=n,angular.extend(this,e("personalizationsmarteditCombinedViewController",{$scope:t}))}],buttons:[{id:"confirmCancel",label:"personalization.modal.combinedview.button.cancel",style:a.SECONDARY,action:n.DISMISS},{id:"confirmOk",label:"personalization.modal.combinedview.button.ok",action:n.CLOSE}]}).then(function(){r.clearCombinedViewCustomizeContext(i),i.getCombinedView().enabled&&o.updatePreview(o.getVariationsForPreviewTicket())},function(){})},s}]).factory("personalizationsmarteditCombinedViewCommons",["$q","$filter","personalizationsmarteditContextService","personalizationsmarteditPreviewService","personalizationsmarteditIFrameUtils","personalizationsmarteditMessageHandler","personalizationsmarteditRestService","personalizationsmarteditUtils",function(e,t,n,a,i,o,r,s){var l={},c=function(){var t=n.getCombinedView(),a=[];(t.selectedItems||[]).forEach(function(e){a.push(r.getActions(e.customization.code,e.variation.code,e.variation).then(function(t){e.variation.actions=t.actions}))}),e.all(a).then(function(){n.setCombinedView(t)})};return l.updatePreview=function(e){var r=n.getSeData().sePreviewData.previewTicketId;a.updatePreviewTicketWithVariations(r,e).then(function(){var e=n.getSeData().sePreviewData;i.reloadPreview(e.resourcePath,e.previewTicketId)},function(){o.sendError(t("translate")("personalization.error.updatingpreviewticket"))}),c()},l.getVariationsForPreviewTicket=function(){var e=[];return(n.getCombinedView().selectedItems||[]).forEach(function(t){e.push({customizationCode:t.customization.code,variationCode:t.variation.code,catalog:t.variation.catalog,catalogVersion:t.variation.catalogVersion})}),e},l.combinedViewEnabledEvent=function(e){var t=n.getCombinedView();t.enabled=e,n.setCombinedView(t);var a=n.getCustomize();a.selectedCustomization=null,a.selectedVariations=null,a.selectedComponents=null,n.setCustomize(a),e?l.updatePreview(l.getVariationsForPreviewTicket()):l.updatePreview([])},l.isItemFromCurrentCatalog=function(e){return s.isItemFromCurrentCatalog(e,n.getSeData())},l}]).controller("personalizationsmarteditCombinedViewMenuController",["$scope","$filter","personalizationsmarteditUtils","personalizationsmarteditMessageHandler","personalizationsmarteditRestService","personalizationsmarteditContextService","personalizationsmarteditCombinedViewCommons","permissionService",function(e,t,n,a,i,o,r,s){e.combinedView=o.getCombinedView(),e.selectedItems=e.combinedView.selectedItems||[];var l=function(e,n,r,s){i.getComponenentsIdsForVariation(e,n,r,s).then(function(e){var t=o.getCombinedView();t.customize.selectedComponents=e.components,o.setCombinedView(t)},function(){a.sendError(t("translate")("personalization.error.gettingcomponentsforvariation"))})};e.itemClick=function(t){var a=o.getCombinedView();a.enabled&&(e.selectedItems.forEach(function(e){e.highlighted=!1}),t.highlighted=!0,a.customize.selectedCustomization=t.customization,a.customize.selectedVariations=t.variation,o.setCombinedView(a),s.isPermitted([{names:["se.edit.page"]}]).then(function(e){e&&l(t.customization.code,t.variation.code,t.customization.catalog,t.customization.catalogVersion)}),r.updatePreview(n.getVariationKey(t.customization.code,[t.variation])))},e.getClassForElement=n.getClassForElement,e.getLetterForElement=n.getLetterForElement,e.combinedViewEnabledChangeEvent=function(){r.combinedViewEnabledEvent(e.combinedView.enabled)},e.isItemFromCurrentCatalog=r.isItemFromCurrentCatalog,e.$watch("combinedView.selectedItems",function(t,n){t!==n&&(e.selectedItems=e.combinedView.selectedItems||[])},!0)}]).controller("personalizationsmarteditCombinedViewController",["$q","$scope","$filter","customizationDataFactory","PaginationHelper","personalizationsmarteditCombinedViewCommons","personalizationsmarteditContextService","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","personalizationsmarteditUtils","PERSONALIZATION_VIEW_STATUS_MAPPING_CODES","PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER","componentMenuService",function(e,t,n,a,i,o,r,s,l,c,d,m,u){a.resetData();var p=function(e){t.pagination=new i(e.pagination),t.selectionArray.length=0,a.items.map(function(e){e.variations.filter(function(e){return c.isItemVisible(e)}).forEach(function(n){t.selectionArray.push({customization:{code:e.code,name:e.name,rank:e.rank,catalog:e.catalog,catalogVersion:e.catalogVersion},variation:{code:n.code,name:n.name,catalog:n.catalog,catalogVersion:n.catalogVersion}})})}),t.moreCustomizationsRequestProcessing=!1},g=function(){l.sendError(n("translate")("personalization.error.gettingcustomizations")),t.moreCustomizationsRequestProcessing=!1},v=function(){return c.getStatusesMapping().filter(function(e){return e.code===d.ALL})[0]},f=function(){var e={currentSize:t.pagination.count,currentPage:t.pagination.page+1,name:t.customizationFilter.name,statuses:v().modelStatuses,catalogs:t.catalogFilter};return t.customizationPageFilter===m.ONLY_THIS_PAGE&&(e.pageId=r.getSeData().pageId,e.pageCatalogId=r.getSeData().seExperienceData.pageContext.catalogId),e},z=function(e){var t={filter:e,dataArrayName:"customizations"};a.updateData(t,p,g)};t.pagination=new i,t.pagination.reset(),t.combinedView=r.getCombinedView(),t.selectedItems=[],angular.copy(t.combinedView.selectedItems||[],t.selectedItems),t.selectedElement={},t.selectionArray=[],t.moreCustomizationsRequestProcessing=!1,t.addMoreItems=function(){t.pagination.page<t.pagination.totalPages-1&&!t.moreCustomizationsRequestProcessing&&(t.moreCustomizationsRequestProcessing=!0,z(f()))},t.selectElement=function(e){t.selectedItems.push(e),u.getValidContentCatalogVersions().then(function(e){var n=e.map(function(e){return e.id});t.selectedItems.sort(function(e,t){var a=e.customization.catalog+"/"+e.customization.catalogVersion,i=t.customization.catalog+"/"+t.customization.catalogVersion;return a===i?e.customization.rank-t.customization.rank:n.indexOf(i)-n.indexOf(a)})}),t.selectedElement=null,t.searchInputKeypress(null,"")},t.initUiSelect=function(e){e.isActive=function(){return!1}},t.removeSelectedItem=function(e){t.selectedItems.splice(t.selectedItems.indexOf(e),1),t.selectedElement=null,t.searchInputKeypress(null,"")},t.getClassForElement=c.getClassForElement,t.getLetterForElement=c.getLetterForElement,t.isItemInSelectDisabled=function(e){return t.selectedItems.find(function(t){return t.customization.code===e.customization.code})},t.isItemSelected=function(e){return t.selectedItems.find(function(t){return t.customization.code===e.customization.code&&t.variation.code===e.variation.code})},t.customizationFilter={name:""},t.searchInputKeypress=function(e,n){e&&[37,38,39,40].indexOf(e.which)>-1||(t.pagination.reset(),t.customizationFilter.name=n,a.resetData(),t.addMoreItems())};var b=function(e){return 0===e.selectedItems.filter(function(t){return t.customization.code===e.customize.selectedCustomization.code&&t.variation.code===e.customize.selectedVariations.code}).length};t.modalManager.setButtonHandler(function(n){var a=e.defer();if("confirmOk"===n){var i=r.getCombinedView();return i.selectedItems=t.selectedItems,i.enabled&&null!==i.customize.selectedVariations&&b(i)&&(i.customize.selectedCustomization=null,i.customize.selectedVariations=null,i.customize.selectedComponents=null),r.setCombinedView(i),a.resolve()}return a.reject()}),t.$watch("selectedItems",function(e,n){if(t.modalManager.disableButton("confirmOk"),e!==n){var a=r.getCombinedView(),i=0===(a.selectedItems||[]).length&&0===t.selectedItems.length;(i=i||angular.equals(a.selectedItems,t.selectedItems))||t.modalManager.enableButton("confirmOk")}},!0),t.pageFilerChange=function(e){t.customizationPageFilter=e,t.pagination.reset(),a.resetData(),t.addMoreItems()},t.catalogFilerChange=function(e){t.catalogFilter=e,t.pagination.reset(),a.resetData(),t.addMoreItems()},t.isItemFromCurrentCatalog=o.isItemFromCurrentCatalog,t.getAndSetCatalogVersionNameL10N=c.getAndSetCatalogVersionNameL10N}])},function(e,t){angular.module("catalogFilterDropdownModule",["personalizationsmarteditCommons","ySelectModule"]).constant("PERSONALIZATION_CATALOG_FILTER",{ALL:"all",CURRENT:"current",PARENTS:"parents"}).controller("catalogFilterDropdownController",["$q","personalizationsmarteditUtils","PERSONALIZATION_CATALOG_FILTER",function(e,t,n){var a=this;this.$onInit=function(){a.items=[{id:n.ALL,label:"personalization.filter.catalog.all"},{id:n.CURRENT,label:"personalization.filter.catalog.current"},{id:n.PARENTS,label:"personalization.filter.catalog.parents"}],a.selectedId=a.initialValue||a.items[1].id},this.fetchStrategy={fetchAll:function(){return e.when(a.items)}},this.onChange=function(){a.onSelectCallback({value:a.selectedId})}}]).component("catalogFilterDropdown",{templateUrl:"pageFilterDropdownTemplate.html",controller:"catalogFilterDropdownController",controllerAs:"ctrl",transclude:!0,bindings:{onSelectCallback:"&",initialValue:"<?"}})},function(e,t){angular.module("catalogVersionFilterDropdownModule",["personalizationsmarteditCommons","personalizationsmarteditContextServiceModule","ySelectModule","componentMenuServiceModule","l10nModule"]).controller("catalogVersionFilterDropdownController",["$q","personalizationsmarteditUtils","componentMenuService","personalizationsmarteditContextService",function(e,t,n,a){var i=this;this.$onInit=function(){i.itemTemplate="catalogVersionFilterDropdownItemTemplate.html",n.getValidContentCatalogVersions().then(function(e){i.items=e;var t=a.getSeData().seExperienceData;i.items.forEach(function(e){e.isCurrentCatalog=e.id===t.catalogDescriptor.catalogVersionUuid}),n.getInitialCatalogVersion(i.items).then(function(e){i.selectedId=i.initialValue||e.id})})},this.fetchStrategy={fetchAll:function(){return e.when(i.items)}},this.onChange=function(){i.onSelectCallback({value:i.selectedId})}}]).component("catalogVersionFilterDropdown",{templateUrl:"pageFilterDropdownTemplate.html",controller:"catalogVersionFilterDropdownController",controllerAs:"ctrl",transclude:!0,bindings:{onSelectCallback:"&",initialValue:"<?"}})},function(e,t){angular.module("hasMulticatalogModule",["personalizationsmarteditContextServiceModule"]).controller("hasMulticatalogController",["personalizationsmarteditContextService",function(e){var t=this,n=function(){return e.getSeData().seExperienceData};this.$onInit=function(){t.hasMulticatalog=n().siteDescriptor.contentCatalogs.length>1}}]).component("hasMulticatalog",{templateUrl:"hasMulticatalogTemplate.html",controller:"hasMulticatalogController",controllerAs:"ctrl",transclude:!0,bindings:{}})},function(e,t){angular.module("pageFilterDropdownModule",["personalizationsmarteditCommons","ySelectModule"]).constant("PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER",{ALL:"all",ONLY_THIS_PAGE:"onlythispage"}).controller("pageFilterDropdownController",["$q","personalizationsmarteditUtils","PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER",function(e,t,n){var a=this;this.$onInit=function(){a.items=[{id:n.ALL,label:"personalization.filter.page.all"},{id:n.ONLY_THIS_PAGE,label:"personalization.filter.page.onlythispage"}],a.selectedId=a.initialValue||a.items[1].id},this.fetchStrategy={fetchAll:function(){return e.when(a.items)}},this.onChange=function(){a.onSelectCallback({value:a.selectedId})}}]).component("pageFilterDropdown",{templateUrl:"pageFilterDropdownTemplate.html",controller:"pageFilterDropdownController",controllerAs:"ctrl",transclude:!0,bindings:{onSelectCallback:"&",initialValue:"<?"}})},function(e,t){angular.module("statusFilterDropdownModule",["personalizationsmarteditCommons","ySelectModule"]).controller("statusFilterDropdownController",["$q","personalizationsmarteditUtils",function(e,t){var n=this;this.$onInit=function(){n.items=t.getStatusesMapping().map(function(e){return{id:e.code,label:e.text,modelStatuses:e.modelStatuses}}),n.selectedId=n.initialValue||n.items[0].id},this.fetchStrategy={fetchAll:function(){return e.when(n.items)}},this.onChange=function(){n.onSelectCallback({value:n.selectedId})}}]).component("statusFilterDropdown",{templateUrl:"pageFilterDropdownTemplate.html",controller:"statusFilterDropdownController",controllerAs:"ctrl",transclude:!0,bindings:{onSelectCallback:"&",initialValue:"<?"}})},function(e,t){angular.module("personalizationsmarteditContextMenu",["modalServiceModule","personalizationsmarteditRestServiceModule","personalizationsmarteditCommons","ui.select","genericEditorModule","editorModalServiceModule","gatewayProxyModule","personalizationsmarteditContextServiceModule","renderServiceModule","personalizationsmarteditDataFactory","slotRestrictionsServiceModule","catalogVersionFilterDropdownModule","hasMulticatalogModule","personalizationsmarteditDataUtils"]).factory("personalizationsmarteditContextModal",["$controller","modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES","$filter","personalizationsmarteditMessageHandler","gatewayProxy","personalizationsmarteditContextService","renderService","personalizationsmarteditRestService","editorModalService",function(e,t,n,a,i,o,r,s,l,c,d){var m=function(){this.gatewayId="personalizationsmarteditContextModal",r.initForService(this)},u=[{id:"cancel",label:"personalization.modal.addeditaction.button.cancel",style:a.SECONDARY,action:n.DISMISS},{id:"submit",label:"personalization.modal.addeditaction.button.submit",action:n.CLOSE}],p=[{id:"confirmCancel",label:"personalization.modal.deleteaction.button.cancel",style:a.SECONDARY,action:n.DISMISS},{id:"confirmOk",label:"personalization.modal.deleteaction.button.ok",action:n.CLOSE}];return m.prototype.openDeleteAction=function(n){t.open({size:"md",title:"personalization.modal.deleteaction.title",templateInline:'<div id="confirmationModalDescription">{{ "personalization.modal.deleteaction.content" | translate }}</div>',controller:["$scope","modalManager",function(t,a){angular.merge(t,n),t.modalManager=a,angular.extend(this,e("modalDeleteActionController",{$scope:t}))}],cssClasses:"yFrontModal",buttons:p}).then(function(){if(s.getCombinedView().enabled)c.getActions(n.selectedCustomizationCode,n.selectedVariationCode,n).then(function(e){var t=s.getCombinedView();t.customize.selectedComponents&&t.customize.selectedComponents.splice(t.customize.selectedComponents.indexOf(n.containerSourceId),1),angular.forEach(t.selectedItems,function(t){t.customization.code===n.selectedCustomizationCode&&t.variation.code===n.selectedVariationCode&&(t.variation.actions=e.actions)}),s.setCombinedView(t)},function(){o.sendError(i("translate")("personalization.error.gettingactions"))});else{var e=s.getCustomize();e.selectedComponents.splice(e.selectedComponents.indexOf(n.containerSourceId),1),s.setCustomize(e)}l.renderSlots(n.slotsToRefresh)})},m.prototype.openAddAction=function(n){t.open({title:"personalization.modal.addaction.title",templateUrl:"personalizationsmarteditAddEditActionTemplate.html",controller:["$scope","modalManager",function(t,a){angular.merge(t,n),t.defaultComponentId=n.componentId,t.modalManager=a,t.editEnabled=!1,angular.extend(this,e("modalAddEditActionController",{$scope:t})),angular.extend(this,e("modalAddActionController",{$scope:t}))}],cssClasses:"yPersonalizationContextModal",buttons:u}).then(function(e){if(s.getCombinedView().enabled){var t=s.getCombinedView();t.customize.selectedComponents.push(e),s.setCombinedView(t)}else{var a=s.getCustomize();a.selectedComponents.push(e),s.setCustomize(a)}l.renderSlots(n.slotsToRefresh)},function(){})},m.prototype.openEditAction=function(n){t.open({title:"personalization.modal.editaction.title",templateUrl:"personalizationsmarteditAddEditActionTemplate.html",controller:["$scope","modalManager",function(t,a){angular.merge(t,n),t.modalManager=a,t.editEnabled=!0,angular.extend(this,e("modalAddEditActionController",{$scope:t})),angular.extend(this,e("modalEditActionController",{$scope:t}))}],cssClasses:"yPersonalizationContextModal",buttons:u}).then(function(){l.renderSlots(n.slotsToRefresh)})},m.prototype.openEditComponentAction=function(e){d.open(e)},new m}]).controller("modalAddEditActionController",["$scope","$filter","$q","$timeout","editorModalService","personalizationsmarteditContextService","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","PaginationHelper","slotRestrictionsService","PERSONALIZATION_COMBINED_VIEW_CSS_MAPPING",function(e,t,n,a,i,o,r,s,l,c,d){e.actions=[{id:"create",name:t("translate")("personalization.modal.addeditaction.createnewcomponent")},{id:"use",name:t("translate")("personalization.modal.addeditaction.usecomponent")}],e.newComponent={},e.component={},e.components=[],e.newComponentTypes=[];var m=function(){c.getSlotRestrictions(e.slotId).then(function(n){r.getNewComponentTypes().then(function(t){e.newComponentTypes=t.componentTypes.filter(function(e){return n.indexOf(e.code)>-1})},function(){s.sendError(t("translate")("personalization.error.gettingcomponentstypes"))})},function(){s.sendError(t("translate")("personalization.error.gettingslotrestrictions"))})},u=function(n){r.getComponent(n).then(function(t){e.component.selected=t},function(){s.sendError(t("translate")("personalization.error.gettingcomponents"))})};e.newComponentTypeSelectedEvent=function(){var n={smarteditComponentType:e.newComponent.selected.code,catalogVersionUuid:o.getSeData().seExperienceData.pageContext.catalogVersionUuid};i.open(n).then(function(n){e.action={selected:t("filter")(e.actions,{id:"use"},!0)[0]},e.componentUuid=n.uuid,u(e.componentUuid)},function(){e.newComponent={}})};var p=function(e,a,i,o,l,c){var d=n.defer();return r.editAction(e,a,i,o,l,c).then(function(){s.sendSuccess(t("translate")("personalization.info.updatingaction")),d.resolve()},function(){s.sendError(t("translate")("personalization.error.updatingaction")),d.reject()}),d.promise},g=function(e,a,i,o,l,c){var d=n.defer();return r.addActionToContainer(e,a,i,o,l,c).then(function(){s.sendSuccess(t("translate")("personalization.info.creatingaction")),d.resolve(i)},function(){s.sendError(t("translate")("personalization.error.creatingaction")),d.reject()}),d.promise};e.modalManager.setButtonHandler(function(a){if("submit"===a){var i=e.component.selected.catalogVersion.substring(0,e.component.selected.catalogVersion.indexOf("/")),o={catalog:e.selectedCustomization.catalog,catalogVersion:e.selectedCustomization.catalogVersion},l={slotCatalog:e.slotCatalog,oldComponentCatalog:e.componentCatalog};return angular.extend(l,o),e.editEnabled?p(e.selectedCustomization.code,e.selectedVariation.code,e.actionId,e.component.selected.uid,i,o):r.replaceComponentWithContainer(e.defaultComponentId,e.slotId,l).then(function(t){return g(e.component.selected.uid,i,t.sourceId,e.selectedCustomization.code,e.selectedVariation.code,o)},function(){return s.sendError(t("translate")("personalization.error.replacingcomponent")),n.defer().reject()})}return n.defer().reject()}),e.componentFilter={name:""};var v=function(){return{currentPage:e.componentPagination.page+1,mask:e.componentFilter.name,pageSize:100,sort:"name",catalog:e.catalogFilter,catalogVersion:e.catalogVersionFilter,typeCode:"AbstractCMSComponent"}};e.componentPagination=new l,e.componentPagination.reset(),e.moreComponentRequestProcessing=!1,e.addMoreComponentItems=function(){e.componentPagination.page<e.componentPagination.totalPages-1&&!e.moreComponentRequestProcessing&&(e.moreComponentRequestProcessing=!0,r.getComponents(v()).then(function(t){var n=t.response.filter(function(t){return e.newComponentTypes.some(function(e){return t.typeCode===e.code&&!t.restricted})});Array.prototype.push.apply(e.components,n),e.componentPagination=new l(t.pagination),e.moreComponentRequestProcessing=!1,e.components.length<20&&a(function(){e.addMoreComponentItems()},0)},function(){s.sendError(t("translate")("personalization.error.gettingcomponents")),e.moreComponentRequestProcessing=!1}))},e.componentSearchInputKeypress=function(t,n){t&&[37,38,39,40].indexOf(t.which)>-1||(e.componentPagination.reset(),e.componentFilter.name=n,e.components.length=0,e.addMoreComponentItems())};var f=function(){var t=o.getCombinedView();t.enabled&&(t.selectedItems||[]).forEach(function(t,n){var a=e.selectedCustomizationCode===t.customization.code;a=a&&e.selectedVariationCode===t.variation.code;var i=n%Object.keys(d).length;a&&(e.letterIndicatorForElement=String.fromCharCode("a".charCodeAt()+i).toUpperCase(),e.colorIndicatorForElement=d[i].listClass)})};e.catalogVersionFilerChange=function(t){var n=t.split("/");e.catalogFilter=n[0],e.catalogVersionFilter=n[1],e.componentPagination.reset(),e.components.length=0,e.addMoreComponentItems()},e.$watch("action.selected",function(t,n){t!==n&&(e.component.selected=void 0,e.editEnabled&&u(e.componentUuid))},!0),e.$watch("component.selected",function(t){e.modalManager.disableButton("submit"),void 0!==t&&e.modalManager.enableButton("submit")},!0),e.$watch("newComponentTypes",function(t){void 0!==t&&(e.componentPagination=new l,e.componentPagination.reset(),e.moreComponentRequestProcessing=!1,e.addMoreComponentItems())},!0),r.getCustomization({code:e.selectedCustomizationCode}).then(function(t){e.selectedCustomization=t,e.selectedVariation=t.variations.filter(function(t){return t.code===e.selectedVariationCode})[0]},function(){s.sendError(t("translate")("personalization.error.gettingcustomization"))}),e.editEnabled&&u(e.componentUuid),m(),f()}]).controller("modalAddActionController",["$scope",function(e){e.action={}}]).controller("modalEditActionController",["$scope","$filter",function(e,t){e.action={selected:t("filter")(e.actions,{id:"use"},!0)[0]}}]).controller("modalDeleteActionController",["$scope","$q","personalizationsmarteditRestService",function(e,t,n){e.modalManager.setButtonHandler(function(a){if("confirmOk"===a){var i={catalog:e.catalog,catalogVersion:e.catalogVersion};return n.deleteAction(e.selectedCustomizationCode,e.selectedVariationCode,e.actionId,i)}return t.defer().reject()})}])},function(e,t){angular.module("customizationsListModule",["personalizationsmarteditCommons","personalizationsmarteditRestServiceModule","personalizationsmarteditContextServiceModule","personalizationsmarteditPreviewServiceModule","personalizationsmarteditManagerModule","personalizationsmarteditContextUtilsModule","eventServiceModule"]).controller("customizationsListController",["$q","$filter","personalizationsmarteditContextService","personalizationsmarteditRestService","personalizationsmarteditCommerceCustomizationService","personalizationsmarteditMessageHandler","personalizationsmarteditUtils","personalizationsmarteditIFrameUtils","personalizationsmarteditDateUtils","personalizationsmarteditContextUtils","personalizationsmarteditPreviewService","personalizationsmarteditManager","systemEventService",function(e,t,n,a,i,o,r,s,l,c,d,m,u){var p=this,g=function(e,t){return e.variationCode===t.code&&e.actionCatalog===t.catalog&&e.actionCatalogVersion===t.catalogVersion},v=function(e){e.variations.forEach(function(e){e.numberOfAffectedComponents=0})},f=function(e,n){0===n&&v(e),a.getCxCmsActionsOnPageForCustomization(e,n).then(function(t){e.variations.forEach(function(e){var n=t.actions.filter(function(t){return g(t,e)});e.numberOfAffectedComponents+=n.length});var a=n+1;a<t.pagination.totalPages&&f(e,a)},function(){o.sendError(t("translate")("personalization.error.gettingnumberofaffectedcomponentsforvariation"))})},z=function(e){f(e,0)},b=function(e){a.getVariationsForCustomization(e.code,e).then(function(t){e.variations=t.variations||[],e.variations.forEach(function(e){e.numberOfCommerceActions=i.getCommerceActionsCount(e),e.commerceCustomizations=i.getCommerceActionsCountMap(e)}),z(e)},function(){o.sendError(t("translate")("personalization.error.gettingcustomization"))})},C=function(e){return r.getVisibleItems(e.variations)},h=function(e,i,r,s){a.getComponenentsIdsForVariation(e,i,r,s).then(function(e){var t=n.getCustomize();t.selectedComponents=e.components,n.setCustomize(t)},function(){o.sendError(t("translate")("personalization.error.gettingcomponentsforvariation"))})},S=function(e,a){var i=n.getSeData().sePreviewData.previewTicketId,l=r.getVariationKey(e,a);d.updatePreviewTicketWithVariations(i,l).then(function(){var e=n.getSeData().sePreviewData;s.reloadPreview(e.resourcePath,e.previewTicketId)},function(){o.sendError(t("translate")("personalization.error.updatingpreviewticket"))})},_=function(){var e=n.getCustomize();e.selectedCustomization&&a.getCustomization(e.selectedCustomization).then(function(t){e.selectedCustomization=t,e.selectedVariations&&!angular.isArray(e.selectedVariations)&&t.variations.filter(function(t){return e.selectedVariations.code===t.code}).forEach(function(t){e.selectedVariations=t}),n.setCustomize(e)},function(){o.sendError(t("translate")("personalization.error.gettingcustomization"))})};this.initCustomization=function(e){e.collapsed=!0,(n.getCustomize().selectedCustomization||{}).code===e.code&&(e.collapsed=!1,b(e)),r.getAndSetCatalogVersionNameL10N(e)},this.editCustomizationAction=function(e){c.clearCombinedViewContextAndReloadPreview(s,n),m.openEditCustomizationModal(e.code)},this.customizationRowClick=function(e,t){this.clearAllSubMenu(),e.collapsed=!e.collapsed,e.collapsed||b(e),t&&this.customizationClick(e),p.customizationsList.filter(function(t){return e.code!==t.code}).forEach(function(e){e.collapsed=!0})},this.customizationClick=function(e){var t=n.getCombinedView(),a=n.getCustomize().selectedVariations,i=C(e),o=n.getCustomize();if(o.selectedCustomization=e,o.selectedVariations=i,n.setCustomize(o),i.length>0){var s=r.getVariationCodes(i).join(",");h(e.code,s,e.catalog,e.catalogVersion)}(angular.isObject(a)&&!angular.isArray(a)||t.enabled)&&S(),t.enabled=!1,n.setCombinedView(t)},this.getSelectedVariationClass=function(e){if(angular.equals(e.code,(n.getCustomize().selectedVariations||{}).code))return"selectedVariation"},this.getSelectedCustomizationClass=function(e){if(angular.equals(e.code,(n.getCustomize().selectedCustomization||{}).code)&&angular.isArray(n.getCustomize().selectedVariations))return"selectedCustomization"},this.variationClick=function(e,t){var a=n.getCustomize();a.selectedCustomization=e,a.selectedVariations=t,n.setCustomize(a);var i=n.getCombinedView();i.enabled=!1,n.setCombinedView(i),h(e.code,t.code,e.catalog,e.catalogVersion),S(e.code,[t])},this.hasCommerceActions=r.hasCommerceActions,this.getCommerceCustomizationTooltip=r.getCommerceCustomizationTooltipHTML,this.getActivityStateForCustomization=r.getActivityStateForCustomization,this.getActivityStateForVariation=r.getActivityStateForVariation,this.clearAllSubMenu=function(){angular.forEach(p.customizationsList,function(e){e.subMenu=!1})},this.getEnablementTextForCustomization=function(e){return r.getEnablementTextForCustomization(e,"personalization.toolbar.pagecustomizations")},this.getEnablementTextForVariation=function(e){return r.getEnablementTextForVariation(e,"personalization.toolbar.pagecustomizations")},this.isEnabled=r.isPersonalizationItemEnabled,this.getDatesForCustomization=function(e){var t="",n="",a="";return(e.enabledStartDate||e.enabledEndDate)&&(n=l.formatDateWithMessage(e.enabledStartDate),a=l.formatDateWithMessage(e.enabledEndDate),e.enabledStartDate||(n=" ..."),e.enabledEndDate||(a="... "),t+=" ("+n+" - "+a+") "),t},this.customizationSubMenuAction=function(e){e.subMenu||p.clearAllSubMenu(),e.subMenu=!e.subMenu},this.isCustomizationFromCurrentCatalog=function(e){return r.isItemFromCurrentCatalog(e,n.getSeData())},this.$onInit=function(){u.registerEventHandler("CUSTOMIZATIONS_MODIFIED",function(){return _(),e.when()})}}]).component("customizationsList",{templateUrl:"customizationsListTemplate.html",controller:"customizationsListController",controllerAs:"ctrl",transclude:!0,bindings:{customizationsList:"<"}})},function(e,t){angular.module("personalizationsmarteditCustomizeViewModule",["personalizationsmarteditCommons","personalizationsmarteditContextServiceModule","personalizationsmarteditDataFactory","customizationsListModule","catalogFilterDropdownModule","hasMulticatalogModule","statusFilterDropdownModule","pageFilterDropdownModule","personalizationsmarteditDataUtils"]).controller("personalizationsmarteditCustomizeViewController",["$filter","customizationDataFactory","PaginationHelper","personalizationsmarteditContextService","personalizationsmarteditMessageHandler","personalizationsmarteditUtils","PERSONALIZATION_CUSTOMIZATION_PAGE_FILTER",function(e,t,n,a,i,o,r){var s=this,l=function(){i.sendError(e("translate")("personalization.error.gettingcustomizations")),s.moreCustomizationsRequestProcessing=!1},c=function(e){s.pagination=new n(e.pagination),s.moreCustomizationsRequestProcessing=!1},d=function(){return o.getStatusesMapping().filter(function(e){return e.code===s.statusFilter})[0]},m=function(e){var n={filter:e,dataArrayName:"customizations"};s.moreCustomizationsRequestProcessing=!0,t.updateData(n,c,l)},u=function(){var e={currentSize:s.pagination.count,currentPage:s.pagination.page+1,name:s.nameFilter,statuses:d().modelStatuses,catalogs:s.catalogFilter};return s.pageFilter===r.ONLY_THIS_PAGE&&(e.pageId=a.getSeData().pageId,e.pageCatalogId=(a.getSeData().seExperienceData.pageContext||{}).catalogId),e},p=function(){s.moreCustomizationsRequestProcessing||(s.pagination.reset(),t.resetData(),m(u()))};this.catalogFilerChange=function(e){s.catalogFilter=e,p()},this.pageFilerChange=function(e){s.pageFilter=e,p()},this.statusFilerChange=function(e){s.statusFilter=e,p()},this.nameInputKeypress=function(e){(13===e.which||s.nameFilter.length>2||0===s.nameFilter.length)&&p()},this.addMoreCustomizationItems=function(){s.pagination.page<s.pagination.totalPages-1&&!s.moreCustomizationsRequestProcessing&&m(u())},this.$onInit=function(){a.refreshExperienceData(),s.pagination=new n,s.pagination.reset(),s.moreCustomizationsRequestProcessing=!1,s.customizationsList=t.items,t.resetData();var e=a.getCustomizeFiltersState();s.catalogFilter=e.catalogFilter,s.pageFilter=e.pageFilter,s.statusFilter=e.statusFilter,s.nameFilter=e.nameFilter},this.$onDestroy=function(){var e=a.getCustomizeFiltersState();e.catalogFilter=s.catalogFilter,e.pageFilter=s.pageFilter,e.statusFilter=s.statusFilter,e.nameFilter=s.nameFilter,a.setCustomizeFiltersState(e)},this.$onChanges=function(e){e.isMenuOpen&&e.isMenuOpen.currentValue&&p()}}]).component("personalizationsmarteditCustomizeView",{templateUrl:"personalizationsmarteditCustomizeViewTemplate.html",controller:"personalizationsmarteditCustomizeViewController",controllerAs:"ctrl",transclude:!0,bindings:{isMenuOpen:"<"}})},function(e,t){angular.module("personalizationsmarteditDataFactory",["personalizationsmarteditRestServiceModule"]).factory("customizationDataFactory",["personalizationsmarteditRestService",function(e){var t={},n={},a="customizations",i=function(){},o=function(){},r=function(n){e.getCustomizations(n).then(function(e){Array.prototype.push.apply(t.items,e[a]),i(e)},function(e){o(e)})};return t.items=[],t.updateData=function(e,t,s){n=(e=e||{}).filter||n,a=e.dataArrayName||a,t&&"function"==typeof t&&(i=t),s&&"function"==typeof s&&(o=s),r(n)},t.refreshData=function(){if(!angular.equals({},n)){var e={};angular.copy(n,e),e.currentSize=t.items.length,e.currentPage=0,t.resetData(),r(e)}},t.resetData=function(){t.items.length=0},t.pushData=function(e){angular.isObject(e)&&(angular.isArray(e)?Array.prototype.push.apply(t.items,e):t.items.push(e))},t}])},function(e,t){angular.module("personalizationsmarteditCommerceCustomizationModule",["modalServiceModule","personalizationsmarteditCommons","personalizationsmarteditRestServiceModule","eventServiceModule","personalizationsmarteditContextServiceModule","confirmationModalServiceModule"]).constant("PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES",{OLD:"old",NEW:"new",DELETE:"delete",UPDATE:"update"}).factory("personalizationsmarteditCommerceCustomizationView",["$controller","modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES",function(e,t,n,a){var i={};return i.openCommerceCustomizationAction=function(i,o){t.open({title:"personalization.modal.commercecustomization.title",templateUrl:"personalizationsmarteditCommerceCustomizationViewTemplate.html",controller:["$scope","modalManager",function(t,n){t.customization=i,t.variation=o,t.modalManager=n,angular.extend(this,e("personalizationsmarteditCommerceCustomizationViewController",{$scope:t}))}],buttons:[{id:"confirmCancel",label:"personalization.modal.commercecustomization.button.cancel",style:a.SECONDARY,action:n.CLOSE},{id:"confirmSave",label:"personalization.modal.commercecustomization.button.submit",action:n.CLOSE}]}).then(function(){},function(){})},i}]).controller("personalizationsmarteditCommerceCustomizationViewController",["$scope","$filter","$q","$log","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","systemEventService","personalizationsmarteditCommerceCustomizationService","personalizationsmarteditContextService","personalizationsmarteditUtils","confirmationModalService","PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES",function(e,t,n,a,i,o,r,s,l,c,d,m){e.availableTypes=[],e.select={},e.actions=[],e.removedActions=[];var u=function(){i.getActions(e.customization.code,e.variation.code).then(function(t){e.actions=t.actions.filter(function(e){return"cxCmsActionData"!==e.type}).map(function(e){return{action:e,status:m.OLD}})},function(){o.sendError(t("translate")("personalization.error.gettingactions"))})},p=function(t){for(var n=0;n<e.availableTypes.length;++n)if(e.availableTypes[n].type===t)return e.availableTypes[n];return{}},g=function(){r.sendSynchEvent("CUSTOMIZATIONS_MODIFIED",{})},v=function(){return e.isDirty()?d.confirm({description:"personalization.modal.commercecustomization.cancelconfirmation"}).then(function(){return n.resolve()},function(){return n.reject()}):n.resolve()};e.getActionsToDisplay=function(){return e.actions},e.isItemInSelectedActions=function(t,n){return e.actions.find(function(e){return n(t,e.action)})},e.displayAction=function(e){var t=e.action,n=p(t.type);return n.getName?n.getName(t):t.code},e.addAction=function(t,n){var a=!1;if(e.actions.forEach(function(e){a=a||n(t,e.action)}),!a){var i=m.NEW,o=-1;e.removedActions.forEach(function(e,a){n(t,e.action)&&(o=a)}),o>=0&&(i=m.OLD,e.removedActions.splice(o,1)),e.actions.push({action:t,status:i})}},e.removeSelectedAction=function(t){var n=e.actions.indexOf(t);if(!(n<0)){var a=e.actions.splice(n,1);a[0].status!==m.OLD&&a[0].status!==m.UPDATE||(a[0].status=m.DELETE,e.removedActions.push(a[0]))}},e.isDirty=function(){var t=!1;return e.actions.forEach(function(e){t=t||e.status===m.NEW||e.status===m.UPDATE}),t=t||e.removedActions.length>0},e.customizationStatusText=c.getEnablementTextForCustomization(e.customization,"personalization.modal.commercecustomization"),e.variationStatusText=c.getEnablementTextForVariation(e.variation,"personalization.modal.commercecustomization"),e.customizationStatus=c.getActivityStateForCustomization(e.customization),e.variationStatus=c.getActivityStateForVariation(e.customization,e.variation);var f=function(t){return t.map(function(e){return e.type}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(t){return e.availableTypes.filter(function(e){return e.type===t})[0]})},z=function(e,a,r){var s=n.defer();return i.createActions(e,a,r).then(function(e){o.sendSuccess(t("translate")("personalization.info.creatingaction")),g(),s.resolve(e)},function(){o.sendError(t("translate")("personalization.error.creatingaction")),s.reject()}),s.promise},b=function(e,a,r){var s=n.defer();return i.deleteActions(e,a,r).then(function(e){o.sendSuccess(t("translate")("personalization.info.removingaction")),g(),s.resolve(e)},function(){o.sendError(t("translate")("personalization.error.removingaction")),s.resolve()}),s.promise},C=function(e,n,i,r,s){f(i.actions).forEach(function(l){if(l.updateActions){var c=i.actions.filter(function(e){return p(e.type)===l});l.updateActions(e,n,c,r,s).then(function(){o.sendSuccess(t("translate")("personalization.info.updatingactions")),g()},function(){o.sendError(t("translate")("personalization.error.updatingactions"))})}else a.debug(t("translate")("personalization.error.noupdatingactions"))})};e.onSave=function(){var t={actions:e.actions.filter(function(e){return e.status===m.NEW}).map(function(e){return e.action})},a=e.removedActions.filter(function(e){return e.status===m.DELETE}).map(function(e){return e.action.code}),i={actions:e.actions.filter(function(e){return e.status===m.UPDATE}).map(function(e){return e.action})},o=t.actions.length>0,r=a.length>0,s=i.actions.length>0;(o?z(e.customization.code,e.variation.code,t):n.resolve()).then(function(t){(r?b(e.customization.code,e.variation.code,a):n.resolve()).then(function(n){s&&C(e.customization.code,e.variation.code,i,t,n)})})},e.$watch("actions",function(){e.isDirty()?e.modalManager.enableButton("confirmSave"):e.modalManager.disableButton("confirmSave")},!0),e.modalManager.setButtonHandler(function(t){if("confirmSave"===t)e.onSave();else if("confirmCancel"===t)return v()}),e.modalManager.setDismissCallback(function(){return v()}),e.availableTypes=s.getAvailableTypes(l.getSeData().seConfigurationData),e.select={type:e.availableTypes[0]},u()}])},function(e,t){angular.module("personalizationsmarteditManagerViewModule",["modalServiceModule","personalizationsmarteditCommons","personalizationsmarteditRestServiceModule","personalizationsmarteditContextServiceModule","confirmationModalServiceModule","personalizationsmarteditManagerModule","personalizationsmarteditCommerceCustomizationModule","eventServiceModule","personalizationsmarteditDataFactory","waitDialogServiceModule","personalizationsmarteditDataUtils"]).factory("personalizationsmarteditManagerView",["modalService",function(e){var t={};return t.openManagerAction=function(){e.open({title:"personalization.modal.manager.title",templateUrl:"personalizationsmarteditManagerViewTemplate.html",controller:"personalizationsmarteditManagerViewController",size:"fullscreen",cssClasses:"perso-library"}).then(function(){},function(){})},t}]).controller("personalizationsmarteditManagerViewController",["$q","$scope","$filter","confirmationModalService","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","personalizationsmarteditContextService","personalizationsmarteditManager","systemEventService","personalizationsmarteditUtils","personalizationsmarteditDateUtils","personalizationsmarteditCommerceCustomizationView","personalizationsmarteditCommerceCustomizationService","PERSONALIZATION_VIEW_STATUS_MAPPING_CODES","PERSONALIZATION_MODEL_STATUS_CODES","PaginationHelper","waitDialogService",function(e,t,n,a,i,o,r,s,l,c,d,m,u,p,g,v,f){var z=function(e){i.getCustomizations(e).then(function(e){Array.prototype.push.apply(t.customizations,e.customizations),t.filteredCustomizationsCount=e.pagination.totalCount,t.pagination=new v(e.pagination),t.moreCustomizationsRequestProcessing=!1},function(){o.sendError(n("translate")("personalization.error.gettingcustomizations")),t.moreCustomizationsRequestProcessing=!1})},b=function(){return{active:"all",name:t.search.name,currentSize:t.pagination.count,currentPage:t.pagination.page+1,statuses:t.search.status.modelStatuses}},C=function(){t.pagination.reset(),t.customizations.length=0,t.addMoreItems()},h=function(){return t.statuses.filter(function(e){return e.code===p.ALL})[0]},S=function(t,a){var r=e.defer();return i.updateCustomizationRank(t,a).then(function(){r.resolve()},function(){o.sendError(n("translate")("personalization.error.updatingcustomization")),r.reject()}),r.promise},_=function(t,a,r){var s=e.defer();return i.getVariation(t.code,a).then(function(e){e.rank=e.rank+r,i.editVariation(t.code,e).then(function(){s.resolve()},function(){o.sendError(n("translate")("personalization.error.editingvariation")),s.reject()})},function(){o.sendError(n("translate")("personalization.error.gettingvariation")),s.reject()}),s.promise},w=function(e,t){return e.indexOf(t)===e.length-1},y=function(e,t,n,a,i){for(var o=i>0?a.source.index:a.dest.index,r=i>0?a.dest.index:a.source.index,s=o;s<=r;s++)n[s].rank+=i>0?-1:1;n[a.dest.index].rank=w(n,e)?t.rank+1:t.rank-1},E=function(e,t){var n=(t=t||[]).filter(function(t){return e===t.code})[0];return n?n.actions:[]},T=r.getSeData().seExperienceData,A=T.languageDescriptor.isocode;t.catalogName=T.catalogDescriptor.name[A],t.catalogName+=" - "+T.catalogDescriptor.catalogVersion,t.customizations=[],t.filteredCustomizationsCount=0,t.scrollZoneElement=void 0,t.statuses=c.getStatusesMapping(),t.search={name:"",status:h()},t.moreCustomizationsRequestProcessing=!1,t.addMoreItems=function(){t.pagination.page<t.pagination.totalPages-1&&!t.moreCustomizationsRequestProcessing&&(t.moreCustomizationsRequestProcessing=!0,z(b()))},t.pagination=new v,t.pagination.reset(),t.searchInputKeypress=function(e){(13===e.which||t.search.name.length>2||0===t.search.name.length)&&C()},t.resetSearchInput=function(){t.search.name="",t.search.status=h(),C()},t.editCustomizationAction=function(e){s.openEditCustomizationModal(e.code)},t.deleteCustomizationAction=function(e){a.confirm({description:"personalization.modal.manager.deletecustomization.content"}).then(function(){i.getCustomization(e).then(function(a){a.status="DELETED",i.updateCustomization(a).then(function(){t.customizations.splice(t.customizations.indexOf(e),1)},function(){o.sendError(n("translate")("personalization.error.deletingcustomization"))})},function(){o.sendError(n("translate")("personalization.error.deletingcustomization"))})})},t.editVariationAction=function(e,t){s.openEditCustomizationModal(e.code,t.code)},t.isCommerceCustomizationEnabled=function(){return u.isCommerceCustomizationEnabled(r.getSeData().seConfigurationData)},t.manageCommerceCustomization=function(e,t){m.openCommerceCustomizationAction(e,t)},t.isDeleteVariationEnabled=function(e){return c.getVisibleItems(e.variations).length>1},t.deleteVariationAction=function(e,r,s){t.isDeleteVariationEnabled(e)?a.confirm({description:"personalization.modal.manager.deletevariation.content"}).then(function(){i.getVariation(e.code,r.code).then(function(t){t.status="DELETED",i.editVariation(e.code,t).then(function(e){r.status=e.status},function(){o.sendError(n("translate")("personalization.error.deletingvariation"))})},function(){o.sendError(n("translate")("personalization.error.deletingvariation"))})}):s.stopPropagation()},t.openNewModal=function(){s.openCreateCustomizationModal()},t.toogleVariationActive=function(e,t){i.getVariation(e.code,t.code).then(function(a){a.enabled=!a.enabled,a.status=a.enabled?g.ENABLED:g.DISABLED,i.editVariation(e.code,a).then(function(e){t.enabled=e.enabled,t.status=e.status},function(){o.sendError(n("translate")("personalization.error.editingvariation"))})},function(){o.sendError(n("translate")("personalization.error.gettingvariation"))})},t.isUndefined=function(e){return void 0===e},t.customizationClickAction=function(t){var a=e.defer();return i.getVariationsForCustomization(t.code,t).then(function(e){t.variations.forEach(function(t){t.actions=E(t.code,e.variations),t.numberOfComponents=u.getNonCommerceActionsCount(t),t.commerceCustomizations=u.getCommerceActionsCountMap(t),t.numberOfCommerceActions=u.getCommerceActionsCount(t)}),a.resolve()},function(){o.sendError(n("translate")("personalization.error.gettingcustomization")),a.reject()}),a.promise},t.getCommerceCustomizationTooltip=c.getCommerceCustomizationTooltipHTML,t.hasCommerceActions=c.hasCommerceActions,t.getFormattedDate=function(e){return e?d.formatDate(e):""},t.getEnablementTextForCustomization=function(e){return c.getEnablementTextForCustomization(e,"personalization.modal.manager")},t.getEnablementTextForVariation=function(e){return c.getEnablementTextForVariation(e,"personalization.modal.manager")},t.getEnablementActionTextForVariation=function(e){return c.getEnablementActionTextForVariation(e,"personalization.modal.manager")},t.getActivityStateForCustomization=function(e){return c.getActivityStateForCustomization(e)},t.getActivityStateForVariation=function(e,t){return c.getActivityStateForVariation(e,t)},t.allCustomizationsCollapsed=function(){return t.customizations.map(function(e){return e.isCollapsed}).reduce(function(e,t){return e&&t},!0)},t.isReturnToTopButtonVisible=function(){return t.scrollZoneElement.scrollTop()>50},t.scrollZoneReturnToTop=function(){t.scrollZoneElement.animate({scrollTop:0},500)},t.treeOptions={dragStart:function(e){t.scrollZoneVisible=t.isScrollZoneVisible(),e.source.nodeScope.$modelValue.isDragging=!0},dragStop:function(e){e.source.nodeScope.$modelValue.isDragging=void 0},dropped:function(e){t.scrollZoneVisible=!1;var n,a,i=e.source.nodeScope.$modelValue;if(i.variations)n=t.customizations[t.customizations.indexOf(i)+1],n=n||t.customizations[t.customizations.indexOf(i)-1],a=n.rank-i.rank,0!==(a=a>0&&!w(t.customizations,i)?a-1:a)&&(f.showWaitModal(),S(i.code,a).then(function(){y(i,n,t.customizations,e,a)}).finally(function(){f.hideWaitModal()}));else{var o=e.source.nodesScope.$modelValue;n=o[o.indexOf(i)+1],n=n||o[o.indexOf(i)-1],a=n.rank-i.rank,a=a>0&&!w(o,i)?a-1:a;var r=e.source.nodesScope.$parent.$modelValue;0!==a&&(f.showWaitModal(),_(r,i.code,a).then(function(){y(i,n,r.variations,e,a)}).finally(function(){f.hideWaitModal()}))}},accept:function(e,t){return!!(angular.isArray(t.$modelValue)&&t.$modelValue.indexOf(e.$modelValue)>-1)}},t.isScrollZoneVisible=function(){return t.scrollZoneElement.get(0).scrollHeight>t.scrollZoneElement.get(0).clientHeight},t.isSearchResultHidden=function(){return t.scrollZoneElement.scrollTop()>=125},t.isSearchGridHeaderHidden=function(){return t.scrollZoneElement.scrollTop()>=220},t.setScrollZoneElement=function(e){t.scrollZoneElement=e},t.getElementToScroll=function(){return t.scrollZoneElement},t.statusNotDeleted=function(e){return c.isItemVisible(e)},t.isFilterEnabled=function(){return""!==t.search.name||t.search.status!==h()},t.setCustomizationRank=function(e,n){var a=t.customizations[t.customizations.indexOf(e)+n];f.showWaitModal(),S(e.code,a.rank-e.rank).then(function(){e.rank+=n,a.rank-=n;var i=t.customizations.indexOf(e),o=t.customizations.splice(i,1);t.customizations.splice(i+n,0,o[0])}).finally(function(){f.hideWaitModal()})},t.setVariationRank=function(e,t,n){var a=e.variations[e.variations.indexOf(t)+n];f.showWaitModal(),_(e,t.code,n).then(function(){t.rank+=n,a.rank-=n}).finally(function(){f.hideWaitModal()})},t.$watch("search.status",function(e,t){e!==t&&C()},!0),l.registerEventHandler("CUSTOMIZATIONS_MODIFIED",function(){return C(),e.when()})}])},function(e,t){angular.module("personalizationsmarteditManagerModule",["modalServiceModule","coretemplates","ui.select","confirmationModalServiceModule","functionsModule","personalizationsmarteditCommons","eventServiceModule","personalizationsmarteditDataFactory","sliderPanelModule","seConstantsModule","yjqueryModule"]).constant("CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS",{BASIC_INFO_TAB_NAME:"basicinfotab",BASIC_INFO_TAB_FORM_NAME:"form.basicinfotab",TARGET_GROUP_TAB_NAME:"targetgrptab",TARGET_GROUP_TAB_FORM_NAME:"form.targetgrptab"}).constant("CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS",{CONFIRM_OK:"confirmOk",CONFIRM_CANCEL:"confirmCancel",CONFIRM_NEXT:"confirmNext"}).constant("CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY",{CRITERIA_AND:"AND",CRITERIA_OR:"OR"}).factory("personalizationsmarteditManager",["$controller","modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES","CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS",function(e,t,n,a,i){var o={};return o.openCreateCustomizationModal=function(){return t.open({title:"personalization.modal.customizationvariationmanagement.title",templateUrl:"personalizationsmarteditCustomizationManagTemplate.html",controller:["$scope","modalManager",function(t,n){t.modalManager=n,angular.extend(this,e("personalizationsmarteditManagerController",{$scope:t}))}],buttons:[{id:i.CONFIRM_CANCEL,label:"personalization.modal.customizationvariationmanagement.button.cancel",style:a.SECONDARY}],size:"lg modal_bigger sliderPanelParentModal"})},o.openEditCustomizationModal=function(n,i){return t.open({title:"personalization.modal.customizationvariationmanagement.title",templateUrl:"personalizationsmarteditCustomizationManagTemplate.html",controller:["$scope","modalManager",function(t,a){t.customizationCode=n,t.variationCode=i,t.modalManager=a,angular.extend(this,e("personalizationsmarteditManagerController",{$scope:t}))}],buttons:[{id:"confirmCancel",label:"personalization.modal.customizationvariationmanagement.button.cancel",style:a.SECONDARY}],size:"lg modal_bigger sliderPanelParentModal"})},o}]).controller("personalizationsmarteditManagerController",["$scope","hitch","$q","$log","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","personalizationsmarteditUtils","personalizationsmarteditDateUtils","confirmationModalService","$filter","MODAL_BUTTON_ACTIONS","CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS","CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS","systemEventService","CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY","PERSONALIZATION_DATE_FORMATS","PERSONALIZATION_MODEL_STATUS_CODES","personalizationsmarteditCommerceCustomizationService","customizationDataFactory","DATE_CONSTANTS",function(e,t,n,a,i,o,r,s,l,c,d,m,u,p,g,v,f,z,b,C){var h=this,S=function(e){var t={includeFullFields:!0};return i.getVariationsForCustomization(e,t)},_=function(e){e.forEach(function(e){e.commerceCustomizations=z.getCommerceActionsCountMap(e),e.numberOfCommerceActions=z.getCommerceActionsCount(e),delete e.actions})};if(h.isModallDirty=!1,e.form={},e.customization={code:"",description:"",rank:0,variations:[],active:!1},e.activeTabNumber=0,e.tabsArr=[{name:m.BASIC_INFO_TAB_NAME,active:!0,disabled:!1,heading:c("translate")("personalization.modal.customizationvariationmanagement.basicinformationtab"),template:"personalizationsmarteditCustVarManagBasicInfoTemplate.html",formName:m.BASIC_INFO_TAB_FORM_NAME,isDirty:function(){return e.form.basicinfotab&&e.form.basicinfotab.$dirty},setPristine:function(){e.form.basicinfotab.$setPristine()},isValid:function(){return e.form.basicinfotab&&e.form.basicinfotab.$valid},setEnabled:function(t){t?(e.tabsArr[1].disabled=!1,e.modalManager.enableButton(u.CONFIRM_NEXT)):(e.tabsArr[1].disabled=!0,e.modalManager.disableButton(u.CONFIRM_NEXT))},onConfirm:function(){e.activeTabNumber=1},onCancel:function(){h.onCancel()}},{name:m.TARGET_GROUP_TAB_NAME,active:!1,disabled:!0,heading:c("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab"),template:"personalizationsmarteditCustVarManagTargetGrpTemplate.html",formName:m.TARGET_GROUP_TAB_FORM_NAME,isDirty:function(){return e.form.targetgrptab&&e.form.targetgrptab.$dirty||e.edit.variationsListDirty},setPristine:function(){e.form.targetgrptab.$setPristine()},isValid:function(){var t=r.getVisibleItems(e.customization.variations).length>0,n=angular.isDefined(e.edit.selectedVariation);return e.form.targetgrptab&&e.form.targetgrptab.$valid&&t&&!n},setEnabled:function(t){t?e.modalManager.enableButton(u.CONFIRM_OK):e.modalManager.disableButton(u.CONFIRM_OK)},onConfirm:function(){h.onSave()},onCancel:function(){h.onCancel()}}],e.edit={code:"",name:"",variationsListChanged:!1,selectedTab:e.tabsArr[0],variationsLoaded:!1,viewDateFormat:C.MOMENT_FORMAT,datetimeConfigurationEnabled:!1},e.editMode=angular.isDefined(e.customizationCode),e.editMode){var w={code:e.customizationCode};i.getCustomization(w).then(function(t){e.customization=t,e.customization.enabledStartDate=s.formatDate(e.customization.enabledStartDate),e.customization.enabledEndDate=s.formatDate(e.customization.enabledEndDate),e.customization.statusBoolean=e.customization.status===f.ENABLED,(e.customization.enabledStartDate||e.customization.enabledEndDate)&&(e.edit.datetimeConfigurationEnabled=!0),angular.isDefined(e.variationCode)?S(e.customizationCode).then(function(t){_(t.variations),e.customization.variations=t.variations,e.edit.variationsLoaded=!0;var n=e.customization.variations.filter(function(t){return t.code===e.variationCode});if(n.length>0){e.activeTabNumber=1,e.edit.selectedTab=e.tabsArr[1];var a=n[0];e.edit.selectedVariation=a}},function(){o.sendError(c("translate")("personalization.error.gettingsegments"))}):e.edit.selectedTab=e.tabsArr[0]},function(){o.sendError(c("translate")("personalization.error.gettingcomponents"))})}e.selectTab=function(t){switch(e.edit.selectedTab=t,e.activeTabNumber=e.tabsArr.indexOf(t),t.name){case m.BASIC_INFO_TAB_NAME:e.modalManager.removeButton(u.CONFIRM_OK),e.modalManager.getButton(u.CONFIRM_NEXT)||e.modalManager.addButton({id:u.CONFIRM_NEXT,label:"personalization.modal.customizationvariationmanagement.basicinformationtab.button.next"});break;case m.TARGET_GROUP_TAB_NAME:e.modalManager.removeButton(u.CONFIRM_NEXT),e.modalManager.getButton(u.CONFIRM_OK)||e.modalManager.addButton({id:u.CONFIRM_OK,label:"personalization.modal.customizationvariationmanagement.targetgrouptab.button.submit",action:d.CLOSE})}},h.onSave=function(){e.customization.enabledStartDate?e.customization.enabledStartDate=s.formatDate(e.customization.enabledStartDate,v.MODEL_DATE_FORMAT):e.customization.enabledStartDate=void 0,e.customization.enabledEndDate?e.customization.enabledEndDate=s.formatDate(e.customization.enabledEndDate,v.MODEL_DATE_FORMAT):e.customization.enabledEndDate=void 0,e.editMode?i.updateCustomizationPackage(e.customization).then(function(){p.sendSynchEvent("CUSTOMIZATIONS_MODIFIED",{}),b.refreshData(),o.sendSuccess(c("translate")("personalization.info.updatingcustomization"))},function(){o.sendError(c("translate")("personalization.error.updatingcustomization"))}):i.createCustomization(e.customization).then(function(){p.sendSynchEvent("CUSTOMIZATIONS_MODIFIED",{}),o.sendSuccess(c("translate")("personalization.info.creatingcustomization"))},function(){o.sendError(c("translate")("personalization.error.creatingcustomization"))})},h.onCancel=function(){var t=n.defer();return h.isModallDirty?l.confirm({description:c("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.cancelconfirmation")}).then(function(){e.modalManager.dismiss(),t.resolve()},function(){t.reject()}):(e.modalManager.dismiss(),t.resolve()),t.promise},h.init=function(){e.modalManager.setDismissCallback(h.onCancel),e.modalManager.setButtonHandler(t(this,function(t){switch(t){case u.CONFIRM_OK:case u.CONFIRM_NEXT:return e.edit.selectedTab.onConfirm();case u.CONFIRM_CANCEL:return e.edit.selectedTab.onCancel();default:a.error(c("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.invalidbuttonid"),t)}})),e.resetDateTimeConfiguration=function(){e.customization.enabledStartDate=void 0,e.customization.enabledEndDate=void 0},e.$watch(t(this,function(){return{isDirty:e.edit.selectedTab.isDirty(),isValid:e.edit.selectedTab.isValid()}}),t(this,function(t){t.isDirty?(h.isModallDirty=!0,t.isValid?e.edit.selectedTab.setEnabled(!0):e.edit.selectedTab.setEnabled(!1)):e.editMode?t.isValid?e.edit.selectedTab.setEnabled(!0):e.edit.selectedTab.setEnabled(!1):(h.isModallDirty=!1,e.edit.selectedTab.setEnabled(!1))}),!0),e.$watch("customization.variations",function(){!e.edit.variationsLoaded&&e.editMode||(!1===e.edit.variationsListDirty?e.edit.variationsListDirty=!0:void 0===e.edit.variationsListDirty&&(e.edit.variationsListDirty=!1))},!0),e.$watch("customization.enabledEndDate",function(){e.form.basicinfotab&&e.form.basicinfotab.date_to_key.$validate(),e.isEndDateInThePast=s.isDateInThePast(e.customization.enabledEndDate)},!0),e.$watch("edit.selectedTab",function(){e.editMode&&!e.edit.variationsLoaded&&e.edit.selectedTab&&e.edit.selectedTab.name===m.TARGET_GROUP_TAB_NAME&&S(e.customizationCode).then(function(t){_(t.variations),e.customization.variations=t.variations,e.edit.variationsLoaded=!0},function(){o.sendError(c("translate")("personalization.error.gettingsegments"))})},!0)}}]).directive("uniquetargetgroupname",["isBlank",function(e){var t=function(e,t){return e.edit.selectedVariation&&t===e.edit.selectedVariation.code};return{require:"ngModel",scope:!1,link:function(n,a,i,o){o.$validators.uniquetargetgroupname=function(a){return!(!e(a)&&!t(n,a))||0===n.customization.variations.filter(function(e){return e.code===a}).length}}}}])},function(e,t){angular.module("personalizationsmarteditManagerModule").service("personalizationsmarteditTriggerService",function(){var e={},t=["defaultTriggerData","segmentTriggerData","expressionTriggerData"],n=[{id:"AND",name:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.and"},{id:"OR",name:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.or"},{id:"NOT",name:"personalization.modal.customizationvariationmanagement.targetgrouptab.expression.not"}],a=function(e,t){return!!angular.isDefined(e)&&e.type===t},i=function(e){return a(e,"dropzone")},o=function(e){return a(e,"item")},r=function(e){return a(e,"container")},s=function(e){return r(e)&&"NOT"===e.operation.id},l=function(e){return e.isDefault},c=function(e){return"NOT"===e.operation.id||e.nodes.some(function(e){return!o(e)})},d=function(e){return!!e&&(r(e)?e.nodes&&e.nodes.length>0&&e.nodes.every(d):void 0!==e.selectedSegment)},m=function(e){return t.indexOf(e.type)>=0},u=function(e){return a(e,"defaultTriggerData")},p=function(e){return a(e,"segmentTriggerData")},g=function(e){return a(e,"expressionTriggerData")},v=function(e){return a(e,"groupExpressionData")},f=function(e){return a(e,"segmentExpressionData")},z=function(e){return a(e,"negationExpressionData")},b=function(e){var t="";if(void 0===e)return t;var n=s(e)?"AND":e.operation.id;return t+=s(e)?" NOT ":"",t+="(",e.nodes.forEach(function(e,a){i(e)?t+=" [] ":(t+=a>0?" "+n+" ":"",t+=o(e)?e.selectedSegment.code:b(e))}),t+=")"},C=function(e){return e.nodes.filter(o).map(function(e){return e.selectedSegment})},h=function(e){if(s(e))return{type:"negationExpressionData",element:{type:"groupExpressionData",operator:"AND",elements:Array.from(e.nodes,h)}};if(r(e)){var t=Array.from(e.nodes,h);return{type:"groupExpressionData",operator:e.operation.id,elements:t}}return{type:"segmentExpressionData",code:e.selectedSegment.code}},S=function(e){return{type:"expressionTriggerData",expression:h(e)}},_=function(e){return{type:"segmentTriggerData",groupBy:e.operation.id,segments:C(e)}},w=function(e,t){if(!angular.isDefined(e))return[t];var n=e.findIndex(function(e){return e.type===t.type});n>=0&&(t.code=e[n].code);var a=e.filter(function(e){return!m(e)});return a.push(t),a},y=function(e){return{type:"container",operation:n.find(function(t){return t.id===e}),nodes:[]}},E=function(e){return{type:"item",operation:"",selectedSegment:{code:e},nodes:[]}},T=function(){return[y("AND")]},A=function(e){var t={};if(v(e))(t=y(e.operator)).nodes=e.elements.map(function(e){return A(e)});else if(z(e)){t=y("NOT");var n=A(e.element);v(e.element)&&"AND"===e.element.operator?t.nodes=n.nodes:t.nodes.push(n)}else f(e)&&(t=E(e.code));return t},D=function(e){var t=y(e.groupBy);return e.segments.forEach(function(e){t.nodes.push(E(e.code))}),[t]},V=function(e){return[A(e.expression)]};return e.isContainer=r,e.isNotEmptyContainer=function(e){return r(e)&&e.nodes.length>0},e.isEmptyContainer=function(e){return r(e)&&0===e.nodes.length},e.isItem=o,e.isDropzone=i,e.isValidExpression=d,e.buildTriggers=function(e,t){var n={};if(e=e||{},l(e))n={type:"defaultTriggerData"};else if(e.expression&&e.expression.length>0){var a=e.expression[0];n=c(a)?S(a):_(a)}return w(t,n)},e.buildData=function(e){var t={},n=T();return e&&e.length>0&&(t=e.find(m)),u(t)||(g(t)?n=V(t):p(t)&&(n=D(t))),n},e.isDefault=function(e){return!(!e||!e.find(u))},e.getExpressionAsString=b,e.actions=n,e}).controller("personalizationsmarteditManagerTargetGrpController",["$scope","isBlank","$filter","yjQuery","personalizationsmarteditUtils","personalizationsmarteditTriggerService","personalizationsmarteditMessageHandler","confirmationModalService","CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY","PERSONALIZATION_MODEL_STATUS_CODES","$timeout",function(e,t,n,a,i,o,r,s,l,c,d){var m=this;e.edit.expression=[],e.edit.isDefault=!1,e.edit.showExpression=!0,this.sliderPanelConfiguration={modal:{showDismissButton:!0,title:"personalization.modal.customizationvariationmanagement.targetgrouptab.slidingpanel.title",cancel:{label:"personalization.modal.customizationvariationmanagement.targetgrouptab.cancelchanges",onClick:function(){m.cancelChangesClick()}},dismiss:{onClick:function(){m.cancelChangesClick()}},save:{}},cssSelector:"#y-modal-dialog"};var u=function(){e.edit.code="",e.edit.name="",e.edit.expression=[],e.edit.isDefault=!1,e.edit.showExpression=!0};this.addVariationClick=function(){var t=o.buildTriggers(e.edit);e.customization.variations.push({code:e.edit.code,name:e.edit.name,enabled:!0,status:c.ENABLED,triggers:t,rank:e.customization.variations.length,isNew:!0}),u(),e.toggleSliderFullscreen(!1),d(function(){m.hideSliderPanel()},0)},this.submitChangesClick=function(){var t=o.buildTriggers(e.edit,e.edit.selectedVariation.triggers||[]);e.edit.selectedVariation.triggers=t,e.edit.selectedVariation.name=e.edit.name,e.edit.selectedVariation=void 0,e.toggleSliderFullscreen(!1)},this.cancelChangesClick=function(){e.isVariationSelected()?e.edit.selectedVariation=void 0:(u(),d(function(){m.hideSliderPanel()},0)),e.toggleSliderFullscreen(!1)},e.removeVariationClick=function(t){s.confirm({description:"personalization.modal.manager.targetgrouptab.deletevariation.content"}).then(function(){t.isNew?e.customization.variations.splice(e.customization.variations.indexOf(t),1):t.status="DELETED",e.edit.selectedVariation=void 0,e.recalculateRanksForVariations()})},e.setVariationRank=function(t,n,a,o){if(o)a.stopPropagation();else{var r=e.customization.variations.indexOf(t),s=i.getValidRank(e.customization.variations,t,n),l=e.customization.variations;s>=0&&s<l.length&&(l.splice(s,0,l.splice(r,1)[0]),e.recalculateRanksForVariations())}},e.toogleVariationActive=function(e){e.enabled=!e.enabled,e.status=e.enabled?c.ENABLED:c.DISABLED},e.recalculateRanksForVariations=function(){e.customization.variations.forEach(function(t,n){e.customization.variations[n].rank=n})},e.editVariationAction=function(t){e.edit.selectedVariation=t},this.canSaveVariation=function(){return!t(e.edit.name)&&(e.edit.isDefault||o.isValidExpression(e.edit.expression[0]))},e.isVariationSelected=function(){return angular.isDefined(e.edit.selectedVariation)},e.getSegmentLenghtForVariation=function(e){return(i.getSegmentTriggerForVariation(e).segments||[]).length},e.getEnablementTextForVariation=function(e){return"("+i.getEnablementTextForVariation(e,"personalization.modal.customizationvariationmanagement.targetgrouptab")+")"},e.getActivityActionTextForVariation=function(e){return e.enabled?n("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.disable"):n("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.enable")},e.getActivityStateForCustomization=function(e){return i.getActivityStateForCustomization(e)},e.getActivityStateForVariation=function(e,t){return i.getActivityStateForVariation(e,t)},e.getCommerceCustomizationText=function(e){var t="";return angular.forEach(e.commerceCustomizations,function(e,a){t+=e+" "+n("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.commercecustomization."+a)}),t},e.toggleSliderFullscreen=function(e){var t=angular.element(".sliderPanelParentModal");t.hasClass("modal-fullscreen")||!1===e?t.removeClass("modal-fullscreen"):t.addClass("modal-fullscreen"),d(function(){a(window).resize()},0)},e.confirmDefaultTrigger=function(t){t&&o.isValidExpression(e.edit.expression[0])?s.confirm({description:"personalization.modal.manager.targetgrouptab.defaulttrigger.content"}).then(function(){e.edit.showExpression=!1},function(){e.edit.isDefault=!1}):e.edit.showExpression=!t},e.isDefaultVariation=function(e){return o.isDefault(e.triggers)};var p=function(){m.sliderPanelConfiguration.modal.save.label="personalization.modal.customizationvariationmanagement.targetgrouptab.addvariation",m.sliderPanelConfiguration.modal.save.isDisabledFn=function(){return!m.canSaveVariation()},m.sliderPanelConfiguration.modal.save.onClick=function(){m.addVariationClick()}},g=function(){m.sliderPanelConfiguration.modal.save.label="personalization.modal.customizationvariationmanagement.targetgrouptab.savechanges",m.sliderPanelConfiguration.modal.save.isDisabledFn=function(){return!m.canSaveVariation()},m.sliderPanelConfiguration.modal.save.onClick=function(){m.submitChangesClick()}};e.$watch("customization.statusBoolean",function(){e.customization.status=e.customization.statusBoolean?c.ENABLED:c.DISABLED},!0),e.$watch("edit.selectedVariation",function(t){t?(g(),e.edit.code=t.code,e.edit.name=t.name,e.edit.isDefault=o.isDefault(t.triggers),e.edit.showExpression=!e.edit.isDefault,d(function(){m.showSliderPanel()},0)):(u(),p(),d(function(){m.hideSliderPanel()},0))},!0)}])},function(e,t){angular.module("personalizationsmarteditSegmentViewModule",["modalServiceModule","personalizationsmarteditCommons","personalizationsmarteditRestServiceModule","confirmationModalServiceModule","personalizationsmarteditManagerModule","personalizationsmarteditCommerceCustomizationModule","eventServiceModule","personalizationsmarteditDataFactory","ui.tree","personalizationsmarteditScrollZone","personalizationsmarteditSegmentExpressionAsHtml","personalizationsmarteditDataUtils"]).controller("personalizationsmarteditSegmentViewController",["personalizationsmarteditRestService","personalizationsmarteditMessageHandler","personalizationsmarteditTriggerService","PaginationHelper","$timeout","$filter","confirmationModalService",function(e,t,n,a,i,o,r){var s=this;this.actions=n.actions;var l=0;Object.defineProperty(this,"elementToScrollHeight",{get:function(){return l},set:function(e){l=e}});var c=function(){return{code:s.segmentFilter.code,pageSize:s.segmentPagination.count,currentPage:s.segmentPagination.page+1}},d=function(e,t,n){var a=this;return a===e?(n.splice(t,0,angular.copy(a)),!0):(s.isContainer(e)&&e.nodes.some(d,a),!1)},m={type:"dropzone"},u=[{type:"container",operation:s.actions[0],nodes:[m]}],p=function(e){e.forEach(function(e,t,n){s.isDropzone(e)&&n.splice(t,1)})},g=function(e){e.forEach(function(e){s.isEmptyContainer(e)&&e.nodes.push(m),s.isContainer(e)&&g(e.nodes)})};this.treeOptions={dragStart:function(){s.scrollZoneVisible=s.isScrollZoneVisible()},dragStop:function(e){s.scrollZoneVisible=!1,p(e.dest.nodesScope.$nodeScope.$modelValue.nodes),g(s.expression)},dragMove:function(e){s.highlightedContainer=e.dest.nodesScope.$nodeScope.$modelValue.$$hashKey,s.isScrollZoneVisible()!==s.scrollZoneVisible?s.scrollZoneVisible=s.isScrollZoneVisible():Math.abs(s.elementToScrollHeight-s.elementToScroll.get(0).scrollHeight)>10&&(s.elementToScrollHeight=s.elementToScroll.get(0).scrollHeight,s.scrollZoneVisible=!1)}},this.isScrollZoneVisible=function(){return s.elementToScroll.get(0).scrollHeight>s.elementToScroll.get(0).clientHeight},this.getElementToScroll=function(){return s.elementToScroll},this.removeItem=function(e){n.isNotEmptyContainer(e.$modelValue)&&!s.isContainerWithDropzone(e.$modelValue)?r.confirm({description:o("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.segments.removecontainerconfirmation")}).then(function(){e.remove(),g(s.expression)}):(e.remove(),g(s.expression))},this.duplicateItem=function(e){s.expression[0].nodes.some(d,e)},this.toggle=function(e){e.toggle()},this.newSubItem=function(e,t){var n=e.$modelValue;p(n.nodes),n.nodes.unshift({type:t,operation:"item"===t?"":s.actions[0],nodes:[m]}),e.expand(),i(function(){e.childNodes()[0].expand()},0)},this.segments=[],this.segmentPagination=new a,this.segmentPagination.reset(),this.segmentFilter={code:""},this.segmentSearchInputKeypress=function(e,t){e&&[37,38,39,40].indexOf(e.which)>-1||(s.segmentPagination.reset(),s.segmentFilter.code=t,s.segments.length=0,s.addMoreSegmentItems())},this.segmentSelectedEvent=function(e){s.expression[0].nodes.unshift({type:"item",operation:"",selectedSegment:e,nodes:[]}),s.singleSegment=null,s.highlightedContainer=s.expression[0].$$hashKey,p(s.expression[0].nodes)},this.moreSegmentRequestProcessing=!1,this.addMoreSegmentItems=function(){s.segmentPagination.page<s.segmentPagination.totalPages-1&&!s.moreSegmentRequestProcessing&&(s.moreSegmentRequestProcessing=!0,e.getSegments(c()).then(function(e){Array.prototype.push.apply(s.segments,e.segments),s.segmentPagination=new a(e.pagination),s.moreSegmentRequestProcessing=!1},function(){t.sendError(o("translate")("personalization.error.gettingsegments")),s.moreSegmentRequestProcessing=!1}))},this.isTopContainer=function(e){return angular.equals(s.expression[0],e.node)},this.isEmptyContainer=function(e){return s.isContainer(e)&&0===e.nodes.length},this.isContainerWithDropzone=function(e){return s.isContainer(e)&&1===e.nodes.length&&s.isDropzone(e.nodes[0])},this.isItem=n.isItem,this.isDropzone=n.isDropzone,this.isContainer=n.isContainer,this.isHighlightedContainer=function(e){return e.$$hashKey===s.highlightedContainer},this.$onInit=function(){s.triggers&&s.triggers.length>0?s.expression=n.buildData(s.triggers):s.expression=angular.copy(u),s.elementToScroll=angular.element(".sliderpanel-body")}}]).component("multiSegmentView",{templateUrl:"personalizationsmarteditSegmentViewTemplate.html",controller:"personalizationsmarteditSegmentViewController",controllerAs:"ctrl",bindings:{triggers:"<",expression:"="}})},function(e,t){angular.module("personalizationsmarteditSegmentExpressionAsHtml",[]).controller("personalizationsmarteditSegmentExpressionAsHtmlController",["personalizationsmarteditTriggerService",function(e){var t=this,n={};Object.defineProperty(this,"segmentExpression",{get:function(){return n},set:function(e){n=e}});var a=["AND","OR","NOT"];Object.defineProperty(this,"operators",{get:function(){return a}});Object.defineProperty(this,"emptyGroup",{get:function(){return"[]"}});var i=t.operators.concat("[]");Object.defineProperty(this,"emptyGroupAndOperators",{get:function(){return i}}),this.getExpressionAsArray=function(){return angular.isDefined(t.segmentExpression)&&!angular.isDefined(t.segmentExpression.operation)&&(t.segmentExpression=e.buildData(t.segmentExpression)[0]),e.getExpressionAsString(t.segmentExpression).split(" ")},this.getLocalizationKeyForOperator=function(e){return"personalization.modal.customizationvariationmanagement.targetgrouptab.expression."+e.toLowerCase()}}]).component("personalizationsmarteditSegmentExpressionAsHtml",{templateUrl:"personalizationsmarteditSegmentExpressionAsHtmlTemplate.html",controller:"personalizationsmarteditSegmentExpressionAsHtmlController",controllerAs:"ctrl",transclude:!0,bindings:{segmentExpression:"<"}})},function(e,t){angular.module("personalizationsmarteditContextServiceModule",["sharedDataServiceModule","loadConfigModule","personalizationsmarteditContextUtilsModule"]).factory("personalizationsmarteditContextService",["$q","personalizationsmarteditContextServiceProxy","sharedDataService","loadConfigManagerService","personalizationsmarteditContextUtils",function(e,t,n,a,i){var o=i.getContextObject(),r=new t("PersonalizationCtxGateway");return o.getPersonalization=function(){return o.personalization},o.setPersonalization=function(e){o.personalization=e,r.setPersonalization(e)},o.getCustomize=function(){return o.customize},o.setCustomize=function(e){o.customize=e,r.setCustomize(e)},o.getCombinedView=function(){return o.combinedView},o.setCombinedView=function(e){o.combinedView=e,r.setCombinedView(e)},o.getSeData=function(){return o.seData},o.setSeData=function(e){o.seData=e,r.setSeData(e)},o.refreshExperienceData=function(){return n.get("experience").then(function(t){var n=o.getSeData();return n.seExperienceData=t,o.setSeData(n),e.when()})},o.refreshPreviewData=function(){return n.get("preview").then(function(e){var t=o.getSeData();t.sePreviewData=e,o.setSeData(t)})},o.refreshConfigurationData=function(){a.loadAsObject().then(function(e){var t=o.getSeData();t.seConfigurationData=e,o.setSeData(t)})},o.applySynchronization=function(){r.setPersonalization(o.personalization),r.setCustomize(o.customize),r.setCombinedView(o.combinedView),r.setSeData(o.seData),o.refreshExperienceData(),o.refreshPreviewData(),o.refreshConfigurationData()},o.getContexServiceProxy=function(){return r},o.customizeFiltersState={},o.getCustomizeFiltersState=function(){return o.customizeFiltersState},o.setCustomizeFiltersState=function(e){o.customizeFiltersState=e},o}]).factory("personalizationsmarteditContextServiceProxy",["gatewayProxy",function(e){var t=function(t){this.gatewayId=t,e.initForService(this)};return t.prototype.setPersonalization=function(){},t.prototype.setCustomize=function(){},t.prototype.setCombinedView=function(){},t.prototype.setSeData=function(){},t}]).factory("personalizationsmarteditContextServiceReverseProxy",["gatewayProxy","personalizationsmarteditContextService",function(e,t){var n=function(t){this.gatewayId=t,e.initForService(this)};return n.prototype.applySynchronization=function(){t.applySynchronization()},n.prototype.setPageId=function(e){var n=t.getSeData();n.pageId=e,t.setSeData(n)},new n("PersonalizationCtxReverseGateway")}])},function(e,t){angular.module("personalizationsmarteditPreviewServiceModule",["personalizationsmarteditRestServiceModule","sharedDataServiceModule","personalizationsmarteditCommons","personalizationsmarteditContextServiceModule"]).factory("personalizationsmarteditPreviewService",["$q","$filter","personalizationsmarteditRestService","sharedDataService","personalizationsmarteditUtils","personalizationsmarteditMessageHandler","personalizationsmarteditContextService",function(e,t,n,a,i,o,r){var s={},l=function(e){a.get("experience").then(function(t){t.variations=e})};return s.removePersonalizationDataFromPreview=function(t){var n=e.defer();return s.updatePreviewTicketWithVariations(t,[]).then(function(e){l([]),n.resolve(e)},function(e){n.reject(e)}),n.promise},s.updatePreviewTicketWithVariations=function(a,i){var r=e.defer();return n.getPreviewTicket(a).then(function(e){e.variations=i,l(i),r.resolve(n.updatePreviewTicket(e))},function(e){404===e.status?r.resolve(s.createPreviewTicket(i)):(o.sendError(t("translate")("personalization.error.gettingpreviewticket")),r.reject(e))}),r.promise},s.createPreviewTicket=function(a){var i=r.getSeData().seExperienceData,c=r.getSeData().seConfigurationData,d=e.defer(),m=c.domain+i.siteDescriptor.previewUrl,u={catalog:i.catalogDescriptor.catalogId,catalogVersion:i.catalogDescriptor.catalogVersion,language:i.languageDescriptor.isocode,resourcePath:m,variations:a};return l(a),n.createPreviewTicket(u).then(function(e){s.storePreviewTicketData(e.resourcePath,e.ticketId),r.refreshPreviewData(),o.sendSuccess(t("translate")("personalization.info.newpreviewticketcreated")),d.resolve(e)},function(e){o.sendError(t("translate")("personalization.error.creatingpreviewticket")),d.reject(e)}),d.promise},s.storePreviewTicketData=function(e,t){var n={previewTicketId:t,resourcePath:e};a.set("preview",n)},s}])},function(e,t){angular.module("personalizationsmarteditRestServiceModule",["smarteditServicesModule","personalizationsmarteditCommons","personalizationsmarteditContextServiceModule","yjqueryModule"]).factory("personalizationsmarteditRestService",["restServiceFactory","personalizationsmarteditUtils","personalizationsmarteditContextService","$http","$q","yjQuery",function(e,t,n,a,i,o){var r="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizations",s=r+"/:customizationCode",l="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizationpackages",c=s+"/variations",d=c+"/:variationCode",m=d+"/actions",u=m+"/:actionId",p="/previewwebservices/v1/preview/:ticketId",g="/cmswebservices/v1/sites/:siteId/cmsitems",v=function(e,t){t=t||{};var a=n.getSeData().seExperienceData,i={catalogId:t.catalog||a.catalogDescriptor.catalogId,catalogVersion:t.catalogVersion||a.catalogDescriptor.catalogVersion};return e=angular.extend(e,i)},f=function(e,t){var n={customizationCode:t};return e=angular.extend(e,n)},z=function(e,t){var n={variationCode:t};return e=angular.extend(e,n)},b=function(e,n,a,i,o,r){var s=[];return t.pushToArrayIfValueExists(s,"oldComponentId",e),t.pushToArrayIfValueExists(s,"newComponentId",n),t.pushToArrayIfValueExists(s,"slotId",a),t.pushToArrayIfValueExists(s,"containerId",i),t.pushToArrayIfValueExists(s,"variationId",r),t.pushToArrayIfValueExists(s,"customizationId",o),{params:{entry:s}}},C=function(e,t,a,i){var o=n.getSeData().seExperienceData;return i=i||{},{customizationCode:e,variationCode:t,actionId:a,catalogId:i.catalog||o.catalogDescriptor.catalogId,catalogVersion:i.catalogVersion||o.catalogDescriptor.catalogVersion}},h=function(e,t){return e.replace(/((?:\:)(\w*)(?:\/))/g,function(e,n,a){return t[a]+"/"})},S=function(e){return{code:angular.isDefined(e.code)?e.code:void 0,pageId:angular.isDefined(e.pageId)?e.pageId:void 0,pageCatalogId:angular.isDefined(e.pageCatalogId)?e.pageCatalogId:void 0,name:angular.isDefined(e.name)?e.name:void 0,negatePageId:angular.isDefined(e.negatePageId)?e.negatePageId:void 0,catalogs:angular.isDefined(e.catalogs)?e.catalogs:void 0,statuses:angular.isDefined(e.statuses)?e.statuses.join(","):void 0}},_=function(t){var n=e.get("/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/actions");return t=v(t),n.get(t)},w={};return w.getCustomizations=function(t){t=t||{};var n=e.get(r),a={};return a=v(a,t),a.pageSize=t.currentSize||10,a.currentPage=t.currentPage||0,o.extend(a,S(t)),n.get(a)},w.getComponenentsIdsForVariation=function(a,i,o,r){var s=n.getSeData().seExperienceData,l=e.get("/personalizationwebservices/v1/query/cxcmscomponentsfromvariations"),c=[];t.pushToArrayIfValueExists(c,"customization",a),t.pushToArrayIfValueExists(c,"variations",i),t.pushToArrayIfValueExists(c,"catalog",o||s.catalogDescriptor.catalogId),t.pushToArrayIfValueExists(c,"catalogVersion",r||s.catalogDescriptor.catalogVersion);var d={params:{entry:c}};return l.save(d)},w.getCxCmsActionsOnPageForCustomization=function(e,t){var a={type:"CXCMSACTION",catalogs:"ALL",pageId:n.getSeData().pageId,pageCatalogId:n.getSeData().seExperienceData.pageContext.catalogId,customizationCode:e.code||"",currentPage:t||0};return _(a)},w.getPreviewTicket=function(t){var a=n.getSeData().sePreviewData,i=e.get(p,"ticketId"),o={ticketId:t||a.previewTicketId};return i.get(o)},w.updatePreviewTicket=function(t){return e.get(p,"ticketId").update(t)},w.createPreviewTicket=function(t){return e.get(p).save(t)},w.getSegments=function(t){return e.get("/personalizationwebservices/v1/segments").get(t)},w.getCustomization=function(t){var n=e.get(s,"customizationCode"),a=f({},t.code);return a=v(a,t),n.get(a)},w.createCustomization=function(t){return e.get(l).save(v(t))},w.updateCustomization=function(t){var n=e.get(s,"customizationCode");return t.customizationCode=t.code,n.update(v(t))},w.updateCustomizationPackage=function(t){var n=e.get("/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizationpackages/:customizationCode","customizationCode");return t.customizationCode=t.code,n.update(v(t))},w.deleteCustomization=function(t){var n={customizationCode:t};return e.get(s,"customizationCode").remove(v(n))},w.getVariation=function(t,n){var a=e.get(d,"variationCode"),i=z({},n);return i=v(i),i=f(i,t),a.get(i)},w.editVariation=function(t,n){var a=e.get(d,"variationCode");return n=v(n),n=f(n,t),n.variationCode=n.code,a.update(n)},w.deleteVariation=function(t,n){var a=e.get(d,"variationCode"),i=z({},n);return i=v(i),i=f(i,t),a.remove(i)},w.createVariationForCustomization=function(t,n){var a=e.get(c);return n=v(n),n=f(n,t),a.save(n)},w.getVariationsForCustomization=function(t,n){var a=e.get(c),i={},o=n||{};return i=v(i,o),(i=f(i,t)).fields="variations(active,actions,enabled,code,name,rank,status,catalog,catalogVersion)",void 0!==o.includeFullFields&&o.includeFullFields&&(i.fields="FULL"),a.get(i)},w.replaceComponentWithContainer=function(n,a,i){var o=e.get("/personalizationwebservices/v1/query/cxReplaceComponentWithContainer"),r=v({},i),s=b(n,null,a,null,null,null);return t.pushToArrayIfValueExists(s.params.entry,"catalog",r.catalogId),t.pushToArrayIfValueExists(s.params.entry,"catalogVersion",r.catalogVersion),t.pushToArrayIfValueExists(s.params.entry,"slotCatalog",i.slotCatalog),t.pushToArrayIfValueExists(s.params.entry,"oldComponentCatalog",i.oldComponentCatalog),o.save(s)},w.getActions=function(t,n,a){var i=e.get(m),o=C(t,n,void 0,a),r={fields:"FULL"};return r=angular.extend(r,o),i.get(r)},w.createActions=function(e,t,n,i){var o=C(e,t,void 0,i),r=h(m,o);return a({url:r,method:"PATCH",data:n,headers:{"Content-Type":"application/json;charset=utf-8"}})},w.addActionToContainer=function(t,n,a,i,o,r){var s=e.get(m),l=C(i,o,void 0,r),c={type:"cxCmsActionData",containerId:a,componentId:t,componentCatalog:n};return c=angular.extend(c,l),s.save(c)},w.editAction=function(t,n,a,i,o,r){var s=e.get(u,"actionId"),l=C(t,n,a,r);return s.get(l).then(function(e){return e=angular.extend(e,l),e.componentId=i,e.componentCatalog=o,s.update(e)})},w.deleteAction=function(t,n,a,i){var o=e.get(u,"actionId"),r=C(t,n,a,i);return o.remove(r)},w.deleteActions=function(e,t,n,i){var o=C(e,t,void 0,i),r=h(m,o);return a({url:r,method:"DELETE",data:n,headers:{"Content-Type":"application/json;charset=utf-8"}})},w.getComponents=function(t){var a=n.getSeData().seExperienceData,i=e.get(g),o={siteId:a.siteDescriptor.uid};return o=angular.extend(o,t),i.get(v(o,t))},w.getComponent=function(t){var a=n.getSeData().seExperienceData,i=e.get("/cmswebservices/v1/sites/:siteId/cmsitems/:itemUuid","itemUuid"),o={itemUuid:t,siteId:a.siteDescriptor.uid};return i.get(o)},w.getNewComponentTypes=function(){return e.get("/cmswebservices/v1/types?category=COMPONENT").get()},w.updateCustomizationRank=function(a,i){var o=n.getSeData().seExperienceData,r=e.get("/personalizationwebservices/v1/query/cxUpdateCustomizationRank"),s=[];t.pushToArrayIfValueExists(s,"customization",a),t.pushToArrayIfValueExists(s,"increaseValue",i),t.pushToArrayIfValueExists(s,"catalog",o.catalogDescriptor.catalogId),t.pushToArrayIfValueExists(s,"catalogVersion",o.catalogDescriptor.catalogVersion);var l={params:{entry:s}};return r.save(l)},w}])},function(e,t){angular.module("personalizationsmarteditRulesAndPermissionsRegistrationModule",["permissionServiceModule","personalizationsmarteditRestServiceModule","personalizationsmarteditContextServiceModule"]).run(["$q","permissionService","personalizationsmarteditRestService","personalizationsmarteditContextService",function(e,t,n,a){t.registerRule({names:["se.access.personalization"],verify:function(){return a.refreshExperienceData().then(function(){return n.getCustomizations({currentPage:0,currentSize:1}).then(function(){return e.when(!0)},function(t){return 403===t.status?e.when(!1):e.when(!0)})})}}),t.registerPermission({aliases:["se.personalization.open"],rules:["se.read.page","se.access.personalization"]})}])},function(e,t){angular.module("personalizationsmarteditcontainerTemplates",[]).run(["$templateCache",function(e){"use strict";e.put("web/features/personalizationsmarteditcontainer/combinedView/personalizationsmarteditCombinedViewConfigureTemplate.html",'<form>\n    <div class="form-group">\n        <div class="pe-combinedview-config__select-group-layout">\n            <div class="pe-combinedview-config__select-group-label-layout">\n                <label for="CombinedViewSearchField1"\n                    class="control-label required pe-combinedview-config__label"\n                    data-translate="personalization.modal.combinedview.search.label"></label>\n                <div class="pe-combinedview-config__filter-layout">\n                    <label for="PageFilterDropdownField001"\n                        class="personalization-modal__label pe-combinedview-config__filter-label"\n                        data-translate="personalization.commons.filter.label"></label>\n                    <page-filter-dropdown id="PageFilterDropdownField001"\n                        data-on-select-callback="pageFilerChange(value)"></page-filter-dropdown>\n                    <has-multicatalog>\n                        <catalog-filter-dropdown data-on-select-callback="catalogFilerChange(value)" />\n                    </has-multicatalog>\n                </div>\n            </div>\n            <ui-select uis-open-close="initUiSelect($select)"\n                ng-model="selectedElement"\n                theme="select2"\n                class="form-control"\n                ng-keyup="searchInputKeypress($event, $select.search)"\n                on-select="selectElement($item)"\n                reset-search-input="false"\n                id="CombinedViewSearchField1">\n                <ui-select-match placeholder="{{ \'personalization.modal.combinedview.search.placeholder\' | translate}}">\n                    <span class="pe-combinedview-config__ui-select-placeholder">{{\'personalization.modal.combinedview.search.placeholder\' | translate}}</span>\n                </ui-select-match>\n                <ui-select-choices repeat="item in selectionArray"\n                    position="down"\n                    ui-disable-choice="isItemInSelectDisabled(item)"\n                    personalization-infinite-scroll="addMoreItems()"\n                    personalization-infinite-scroll-distance="1">\n                    <div class="pe-combinedview-config__ui-select-choices-layout"\n                        data-ng-class="{\'pe-combinedview-config__ui-select-item--selected\': isItemSelected(item)}">\n                        <div class="pe-combinedview-config__ui-select-choices-col1">\n                            <div class="perso-wrap-ellipsis"\n                                data-ng-bind="item.customization.name + \' > \' + item.variation.name"\n                                title="{{item.customization.name}} > {{item.variation.name}}">\n                            </div>\n                        </div>\n                        <div class="pe-combinedview-config__ui-select-choices-col2">\n                            <has-multicatalog>\n                                <div data-ng-if="catalogFilter!==\'current\'"\n                                    data-ng-init="getAndSetCatalogVersionNameL10N(item.variation)">\n                                    <div class="perso-wrap-ellipsis"\n                                        data-ng-if="!isItemFromCurrentCatalog(item.variation)"\n                                        data-ng-bind="item.variation.catalogVersionNameL10N"\n                                        title="{{item.variation.catalogVersionNameL10N}}">\n                                    </div>\n                                    <div class="perso-wrap-ellipsis"\n                                        data-ng-if="isItemFromCurrentCatalog(item.variation)"\n                                        data-translate="personalization.filter.catalog.current"\n                                        title="{{\'personalization.filter.catalog.current\' | translate }}">\n                                    </div>\n                                </div>\n                            </has-multicatalog>\n                        </div>\n                    </div>\n                </ui-select-choices>\n            </ui-select>\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="CombinedViewSelectedField1"\n            data-ng-show="selectedItems.length > 0"\n            class="personalization-modal__label pe-combinedview-config__list-label"\n            data-translate="personalization.modal.combinedview.selected.label"></label>\n        <div id="CombinedViewSelectedField1"\n            class="pe-combinedview-config__list-layout"\n            data-ng-repeat="item in selectedItems"\n            data-ng-class="{\'pe-combinedview-config__divider\': $first}">\n            <div class="pe-combinedview-config__letter-layout">\n                <div data-ng-class="getClassForElement($index)"\n                    data-ng-bind="getLetterForElement($index)"></div>\n            </div>\n            <div class="pe-combinedview-config__names-layout">\n                <div class="perso-wrap-ellipsis pe-combinedview-config__cname"\n                    data-ng-bind="item.customization.name"\n                    title="{{item.customization.name}}"></div>\n                <span> ></span>\n                <div class="perso-wrap-ellipsis pe-combinedview-config__vname"\n                    data-ng-bind="item.variation.name"\n                    title="{{item.variation.name}}"></div>\n            </div>\n            <div class="pe-combinedview-config__hyicon-globe">\n                <span data-ng-if="!isItemFromCurrentCatalog(item.variation)"\n                    class="perso__globe-icon hyicon hyicon-globe"\n                    data-uib-tooltip="{{item.variation.catalogVersionNameL10N}}"\n                    data-tooltip-placement="top-right"></span>\n            </div>\n            <div class="pe-combinedview-config__hyicon-remove">\n                <span class="hyicon hyicon-remove"\n                    data-ng-click="removeSelectedItem(item)"\n                    title="{{\'personalization.modal.combinedview.icon.remove.title\' | translate}}"></span>\n            </div>\n        </div>\n    </div>\n</form>'),e.put("web/features/personalizationsmarteditcontainer/combinedView/personalizationsmarteditCombinedViewMenuTemplate.html",'<div data-ng-controller="topToolbarMenuController"\n    data-uib-dropdown\n    data-is-open="item.isOpen"\n    class="btn-group pe-toolbar-action pe-combined-view-menu"\n    data-auto-close="disabled">\n    <button type="button"\n        class="btn btn-default pe-toolbar-action--button"\n        data-uib-dropdown-toggle\n        data-ng-disabled="disabled"\n        aria-pressed="false"\n        data-ng-class="{\'pe-toolbar-action-combined-view--button-with-context\': isCombinedViewCustomizationSelected()}">\n        <span class="hyicon hyicon-combinedview pe-toolbar-menu-ddlb--button__icon"></span>\n        <span class="pe-toolbar-action--button--txt"\n            data-translate="personalization.toolbar.combinedview.name"></span>\n    </button>\n\n    <personalizationsmartedit-combined-view-toolbar-context></personalizationsmartedit-combined-view-toolbar-context>\n\n    <div data-uib-dropdown-menu\n        class="btn-block pe-toolbar-action--include">\n\n        <ul class="pe-toolbar-menu-content se-toolbar-menu-content--pe-customized"\n            role="menu">\n            <div class="se-toolbar-menu-content--pe-customized__headers">\n                <h2 class="se-toolbar-menu-content--pe-customized__headers--h2"\n                    data-translate="personalization.toolbar.combinedview.header.title"></h2>\n                <y-help class="se-toolbar-menu-content__y-help"\n                    data-template="\'<span data-translate=personalization.toolbar.combinedview.header.description></span>\'"></y-help>\n            </div>\n            <div class="pe-combined-view-menu">\n                <div class="pe-combined-view-panel__wrapper"\n                    data-ng-controller="personalizationsmarteditCombinedViewMenuController">\n                    <div class="pe-combined-view-panel__configure-layout">\n                        <button class="btn btn-link pe-combined-view-panel__configure-btn perso-wrap-ellipsis"\n                            data-ng-click="$parent.combinedViewClick()"\n                            data-translate="personalization.toolbar.combinedview.openconfigure.button"\n                            title="{{\'personalization.toolbar.combinedview.openconfigure.button\' | translate}}">\n                        </button>\n                        <div class="perso-toggle">\n                            <label class="personalization-modal__label perso-toggle__label perso-wrap-ellipsis"\n                                data-translate="personalization.toolbar.combinedview.toggle.label"\n                                title="{{\'personalization.toolbar.combinedview.toggle.label\' | translate}}"></label>\n                            <span class="y-toggle y-toggle-lg">\n                                <input type="checkbox"\n                                    id="combinedview-checkbox-1"\n                                    data-ng-change="combinedViewEnabledChangeEvent()"\n                                    data-ng-model="combinedView.enabled" />\n                                <label class="perso-toggle__checkbox-label"\n                                    for="combinedview-checkbox-1"></label>\n                            </span>\n                        </div>\n                    </div>\n                    <div data-ng-class="combinedView.enabled ? \'\':\'pe-combined-view-panel--disabled\'">\n                        <div class="pe-combined-view-panel__list-layout"\n                            data-ng-repeat="item in selectedItems"\n                            data-ng-click="itemClick(item)"\n                            data-ng-class="{\'pe-combined-view-panel-list__item--highlighted\': item.highlighted}">\n                            <div class="pe-combined-view-panel-list__letter-layout">\n                                <div data-ng-class="getClassForElement($index)"\n                                    data-ng-bind="getLetterForElement($index)"></div>\n                            </div>\n                            <div class="pe-combined-view-panel-list__names-layout">\n                                <div class="perso-wrap-ellipsis"\n                                    data-ng-bind="item.customization.name"\n                                    title="{{item.customization.name}}"></div>\n                                <div class="perso-wrap-ellipsis pe-combined-view-panel-list__vname"\n                                    data-ng-bind="item.variation.name"\n                                    title="{{item.variation.name}}"></div>\n                            </div>\n                            <div class="pe-combined-view-panel-list__icon">\n                                <span data-ng-if="!isItemFromCurrentCatalog(item.variation)"\n                                    class="perso__globe-icon hyicon hyicon-globe"\n                                    data-uib-tooltip="{{item.variation.catalogVersionNameL10N}}"\n                                    data-tooltip-placement="auto top"\n                                    data-tooltip-enable="combinedView.enabled"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </ul>\n\n    </div>\n\n</div>'),e.put("web/features/personalizationsmarteditcontainer/commonComponents/catalogVersionFilterDropdownItemTemplate.html",'<div>\n    <span class="hyicon hyicon-globe"\n        data-ng-if="item.isCurrentCatalog === false"></span>\n    <span data-ng-if="item.isCurrentCatalog === false">{{item.catalogName | l10n}} - {{item.catalogVersionId}}</span>\n    <span data-ng-if="item.isCurrentCatalog === true"\n        data-translate="personalization.filter.catalog.current"></span>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/commonComponents/hasMulticatalogTemplate.html",'<div data-ng-if="ctrl.hasMulticatalog">\n    <div data-ng-transclude></div>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/commonComponents/pageFilterDropdownTemplate.html",'<y-select class="perso-filter"\n    data-ng-model="ctrl.selectedId"\n    data-on-change="ctrl.onChange"\n    data-fetch-strategy="ctrl.fetchStrategy"\n    data-item-template="::ctrl.itemTemplate"\n    data-search-enabled="false" />'),e.put("web/features/personalizationsmarteditcontainer/contextMenu/personalizationsmarteditAddEditActionTemplate.html",'<div class="perso-customize-component">\n    <div class="perso-customize-component__title-layout">\n        <div data-ng-show=\'letterIndicatorForElement\'\n            class="perso-customize-component__title-layout__letter-block">\n            <span data-ng-class="colorIndicatorForElement"\n                data-ng-bind="letterIndicatorForElement">\n            </span>\n        </div>\n        <div class="perso-customize-component__title-layout__cust-name perso-wrap-ellipsis"\n            data-ng-bind="selectedCustomization.name"\n            title="{{selectedCustomization.name}}">\n        </div>\n        <div class="perso-customize-component__title-layout__target-group-name perso-wrap-ellipsis"\n            data-ng-bind="\'> \'+ selectedVariation.name"\n            title="{{selectedVariation.name}}">\n        </div>\n    </div>\n\n    <dl class="perso-customize-component__data-list">\n        <label class="personalization-modal__label"\n            data-translate="personalization.modal.addeditaction.selected.mastercomponent.title"></label>\n        <dd>{{componentType}}</dd>\n    </dl>\n\n    <label class="control-label required"\n        data-translate="personalization.modal.addeditaction.selected.actions.title"></label>\n    <y-help data-template="\'<span data-translate=personalization.modal.addeditaction.selected.actions.help.label></span>\'">\n    </y-help>\n\n    <ui-select class="perso-customize-component__select2-container"\n        ng-model="action.selected"\n        theme="select2"\n        title=""\n        search-enabled="false">\n        <ui-select-match placeholder="{{\'personalization.modal.addeditaction.dropdown.placeholder\' | translate}}">\n            <span ng-bind="$select.selected.name"></span>\n        </ui-select-match>\n        <ui-select-choices repeat="item in actions"\n            position="down">\n            <span ng-bind="item.name "></span>\n        </ui-select-choices>\n    </ui-select>\n    <div class="perso-customize-component__select-group-label-layout">\n        <div data-ng-show="action.selected.id == \'use\'">\n            <label class="control-label required"\n                data-translate="personalization.modal.addeditaction.selected.component.title"></label>\n        </div>\n        <has-multicatalog data-ng-show="action.selected.id == \'use\'">\n            <div class="perso-customize-component__filter-layout">\n                <label class="personalization-modal__label perso-customize-component__filter-label"\n                    data-translate="personalization.commons.filter.label"></label>\n                <catalog-version-filter-dropdown data-on-select-callback="catalogVersionFilerChange(value)" />\n            </div>\n        </has-multicatalog>\n    </div>\n\n    <ui-select class="perso-customize-component__select2-container"\n        ng-show="action.selected.id == \'use\'"\n        ng-model="component.selected"\n        ng-keyup="componentSearchInputKeypress($event, $select.search)"\n        theme="select2"\n        title=""\n        reset-search-input="false">\n        <ui-select-match placeholder="{{\'personalization.modal.addeditaction.dropdown.componentlist.placeholder\' | translate}}">\n            <span ng-bind="$select.selected.name | translate"></span>\n        </ui-select-match>\n        <ui-select-choices repeat="item in components"\n            position="down"\n            personalization-infinite-scroll="addMoreComponentItems()"\n            personalization-infinite-scroll-distance="2">\n            <div class="row">\n                <span class="col-md-7"\n                    ng-bind="item.name"></span>\n                <span class="col-md-5"\n                    ng-bind="item.typeCode"></span>\n            </div>\n        </ui-select-choices>\n    </ui-select>\n\n    <ui-select class="perso-customize-component__select2-container"\n        ng-show="action.selected.id == \'create\'"\n        on-select="newComponentTypeSelectedEvent($item, $model)"\n        ng-model="newComponent.selected"\n        theme="select2"\n        title=""\n        search-enabled="false">\n        <ui-select-match placeholder="{{\'personalization.modal.addeditaction.dropdown.componenttype.placeholder\' | translate}}">\n            <span ng-bind="$select.selected.name"></span>\n        </ui-select-match>\n        <ui-select-choices repeat="item in newComponentTypes"\n            position="down">\n            <span ng-bind="item.i18nKey | translate"></span>\n        </ui-select-choices>\n    </ui-select>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/customizeView/customizationsList/customizationsListTemplate.html",'<div class="pe-customize-panel-list">\n    <div data-ng-class="$last && customization.collapsed && ctrl.isCustomizationFromCurrentCatalog(customization) ? \'pe-customize-panel-list__item-last\':\'\'"\n        data-ng-repeat="customization in ctrl.customizationsList track by $index"\n        data-ng-init="ctrl.initCustomization(customization)">\n        <div class="pe-customize-panel-list__row-layout"\n            data-ng-class="ctrl.getSelectedCustomizationClass(customization)">\n            <div class="pe-customize-panel-list__icon-layout pe-customize-panel-list__icon-divider"\n                data-ng-click="ctrl.customizationRowClick(customization);">\n                <a class="pe-customize-panel-list__btn-link btn btn-link"\n                    title="{{customization.collapsed ? \'personalization.commons.icon.title.expand\' : \'personalization.commons.icon.title.collapse\' | translate}}">\n                    <span data-ng-class="customization.collapsed ? \'glyphicon-chevron-right\' : \'glyphicon-chevron-down\'"\n                        class="perso__chevron-down-icon glyphicon"></span>\n                </a>\n            </div>\n            <div class="pe-customize-panel-list__row"\n                data-ng-click="ctrl.customizationRowClick(customization,true);">\n                <div class="pe-customize-panel-list__col-lg">\n                    <div class="perso-wrap-ellipsis pe-customize-panel-list__parent-layout perso-list__primary-data"\n                        data-ng-bind="customization.name"\n                        title={{customization.name}}></div>\n                </div>\n                <div class="pe-customize-panel-list__col-md"></div>\n                <div class="pe-customize-panel-list__col-md">\n                    <div class="perso-list__status--value"\n                        data-ng-class="ctrl.getActivityStateForCustomization(customization)"\n                        data-ng-bind="ctrl.getEnablementTextForCustomization(customization)"></div>\n                    <div class="perso-list__dates-layout"\n                        data-ng-if="ctrl.isEnabled(customization)"\n                        data-ng-bind="ctrl.getDatesForCustomization(customization)"></div>\n                </div>\n                <div class="pe-customize-panel-list__col-sm">\n                    <span data-ng-if="!ctrl.isCustomizationFromCurrentCatalog(customization)"\n                        class="perso__globe-icon hyicon hyicon-globe"\n                        data-uib-tooltip="{{customization.catalogVersionNameL10N}}"\n                        data-tooltip-placement="auto top"></span>\n                </div>\n            </div>\n            <div class="pe-customize-panel-list__col-xs pe-customize-panel-list__dropdown">\n                <div data-ng-if="ctrl.isCustomizationFromCurrentCatalog(customization)"\n                    class="dropdown"\n                    data-ng-init="ctrl.clearAllSubMenu();">\n                    <button type="button"\n                        class="pe-customize-panel-list__btn-link btn btn-link customization-rank-{{customization.rank}}-dropdown-toggle"\n                        data-ng-click="ctrl.customizationSubMenuAction(customization)">\n                        <span class="perso__more-icon hyicon hyicon-more"></span>\n                    </button>\n                    <ul data-ng-if="customization.subMenu"\n                        class="pull-right dropdown-menu pe-customize-panel-list__dropdown-menu"\n                        role="menu">\n                        <li>\n                            <a class="pe-customize-panel-list__dropdown-menu__item cutomization-rank-{{customization.rank}}-edit-button"\n                                data-ng-click="ctrl.clearAllSubMenu(); ctrl.editCustomizationAction(customization);"\n                                data-translate="personalization.toolbar.pagecustomizations.customization.options.edit "></a>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n        \x3c!--end customization row--\x3e\n        <div data-uib-collapse="customization.collapsed">\n            <div class="pe-customize-panel-list__row-layout"\n                data-ng-repeat="variation in customization.variations | statusNotDeleted"\n                data-ng-class="ctrl.getSelectedVariationClass(variation)"\n                data-ng-click="ctrl.clearAllSubMenu(); ctrl.variationClick(customization, variation);">\n                <div class="pe-customize-panel-list__icon-layout">\n                    <div class="pe-customize-panel-list__btn-link btn btn-link"></div>\n                </div>\n                <div class="pe-customize-panel-list__row">\n                    <div class="pe-customize-panel-list__col-lg">\n                        <div class="perso-wrap-ellipsis pe-customize-panel-list__child-layout"\n                            data-ng-bind="variation.name"\n                            title={{variation.name}}></div>\n                    </div>\n                    <div class="pe-customize-panel-list__col-md">\n                        <div class="pe-customize-panel-list__components-layout">\n                            <div class="pe-customize-panel-list__number-layout"\n                                data-ng-bind="variation.numberOfAffectedComponents"></div>\n                            <div class="perso-wrap-ellipsis"\n                                data-translate="personalization.toolbar.pagecustomizations.variation.numberofaffectedcomponents.label"\n                                title="{{\'personalization.toolbar.pagecustomizations.variation.numberofaffectedcomponents.label\' | translate}}">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pe-customize-panel-list__col-md perso-list__status--value"\n                        data-ng-class="ctrl.getActivityStateForVariation(customization, variation)"\n                        data-ng-bind="ctrl.getEnablementTextForVariation(variation)"></div>\n                    <div class="pe-customize-panel-list__col-sm">\n                        <span class="pe-customize-panel-list__cc-icon hyicon hyicon-commerce"\n                            data-ng-class="{\'pe-customize-panel-list__cc-icon--hidden\': !ctrl.hasCommerceActions(variation)}"\n                            data-uib-tooltip-html="ctrl.getCommerceCustomizationTooltip(variation)"\n                            data-tooltip-placement="auto top"></span>\n                    </div>\n                </div>\n                <div class="pe-customize-panel-list__col-xs pe-customize-panel-list__dropdown"></div>\n            </div>\n        </div>\n    </div>\n    \x3c!--end data repeat--\x3e\n</div>'),e.put("web/features/personalizationsmarteditcontainer/customizeView/personalizationsmarteditCustomizeViewTemplate.html",'<div id="personalizationsmartedit-right-toolbar-item-template">\n    <div class="pe-customize-panel__filter-label-layout">\n        <label class="personalization-modal__label pe-customize-panel__filter-label"\n            data-translate="personalization.commons.filter.label"></label>\n        <div class="pe-customize-panel__filter-layout">\n            <page-filter-dropdown data-initial-value="ctrl.pageFilter"\n                data-on-select-callback="ctrl.pageFilerChange(value)"></page-filter-dropdown>\n            <has-multicatalog>\n                <catalog-filter-dropdown data-initial-value="ctrl.catalogFilter"\n                    data-on-select-callback="ctrl.catalogFilerChange(value)" />\n            </has-multicatalog>\n            <status-filter-dropdown data-initial-value="ctrl.statusFilter"\n                data-on-select-callback="ctrl.statusFilerChange(value)"></status-filter-dropdown>\n        </div>\n    </div>\n    <div data-ng-class="ctrl.customizationsList.length == 0 ? \'pe-customize-panel-list--empty\':\'\'">\n        <div class="pe-customize-panel__search-layout">\n            <div class="perso-search">\n                <div class="input-group">\n                    <span class="input-group-addon hyicon hyicon-search perso-search__search-icon"></span>\n                    <input type="text"\n                        class="form-control ng-pristine ng-untouched ng-valid"\n                        placeholder="{{ \'personalization.toolbar.pagecustomizations.search.placeholder\' | translate}}"\n                        data-ng-model="ctrl.nameFilter"\n                        data-ng-keyup="ctrl.nameInputKeypress($event)"></input>\n                    <span data-ng-show="ctrl.nameFilter"\n                        class="input-group-addon glyphicon glyphicon-remove-sign perso-search__reset-icon"\n                        data-ng-click="ctrl.nameFilter=\'\'; ctrl.nameInputKeypress($event)"></span>\n                </div>\n            </div>\n            <div class="perso-search__results">\n                <span data-ng-bind="ctrl.pagination.totalCount"></span>\n                <span data-translate="personalization.toolbar.pagecustomizations.search.result.label"></span>\n            </div>\n        </div>\n    </div>\n    <div class="pe-customize-panel__wrapper"\n        personalization-infinite-scroll="ctrl.addMoreCustomizationItems()"\n        personalization-infinite-scroll-distance="2"\n        data-customizations-loaded="{{ctrl.customizationsList.length > 0}}">\n        <customizations-list data-customizations-list="ctrl.customizationsList" />\n    </div>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/customizeView/personalizationsmarteditCustomizeViewWrapperTemplate.html",'<div data-ng-controller="topToolbarMenuController"\n    data-uib-dropdown\n    data-is-open="item.isOpen"\n    class="btn-group pe-toolbar-action pe-combined-view-menu"\n    data-auto-close="outsideClick">\n    <button type="button"\n        class="btn btn-default pe-toolbar-action--button personalizationsmarteditTopToolbarCustomizeButton"\n        data-uib-dropdown-toggle\n        data-ng-disabled="disabled"\n        aria-pressed="false"\n        data-ng-class="{\'pe-toolbar-action-customize--button-with-context\': isCustomizeCustomizationSelected()}">\n        <span class="hyicon hyicon-customize pe-toolbar-menu-ddlb--button__icon"></span>\n        <span class="pe-toolbar-action--button--txt"\n            data-translate="personalization.toolbar.pagecustomizations"></span>\n    </button>\n\n    <personalizationsmartedit-customize-toolbar-context></personalizationsmartedit-customize-toolbar-context>\n\n    <div data-uib-dropdown-menu\n        class="btn-block pe-toolbar-action--include">\n        <div class="pe-toolbar-menu-content se-toolbar-menu-content--pe-customized-customizations-panel"\n            role="menu">\n            <div class="se-toolbar-menu-content--pe-customized__headers">\n                <h2 class="se-toolbar-menu-content--pe-customized__headers--h2"\n                    data-translate="personalization.toolbar.pagecustomizations.header.title"></h2>\n                <y-help class="se-toolbar-menu-content__y-help"\n                    data-template="\'<span data-translate=personalization.toolbar.pagecustomizations.header.description></span>\'"></y-help>\n            </div>\n            <div role="menuitem"\n                class="pe-combined-view-menu">\n                <personalizationsmartedit-customize-view data-is-menu-open="item.isOpen" />\n            </div>\n        </div>\n    </div>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/commerceCustomizationView/personalizationsmarteditCommerceCustomizationViewTemplate.html",'<div id="commerceCustomizationBody-002"\n    class="perso-cc-modal">\n    <div class="perso-cc-modal__title-layout">\n        <div class="perso-wrap-ellipsis perso-cc-modal__title-cname"\n            data-ng-bind="customization.name"\n            title="{{customization.name}}">\n        </div>\n        <div class="perso-cc-modal__title-status"\n            data-ng-class="customizationStatus"\n            data-ng-bind="\' (\' + customizationStatusText + \') \'">\n        </div>\n        <span> > </span>\n        <div class="perso-wrap-ellipsis perso-cc-modal__title-vname"\n            data-ng-bind="variation.name"\n            title="{{variation.name}}">\n        </div>\n        <div class="perso-cc-modal__title-status"\n            data-ng-class="variationStatus"\n            data-ng-bind="\' (\' + variationStatusText + \')\'">\n        </div>\n    </div>\n    <div class="form-group perso-cc-modal__content-layout">\n        <label for="commerce-customization-type-1"\n            class="personalization-modal__label"\n            data-translate="personalization.modal.commercecustomization.action.type"></label>\n        <ui-select id="commerce-customization-type-1"\n            class="form-control"\n            ng-model="select.type"\n            theme="select2"\n            search-enabled="false">\n            <ui-select-match>\n                <span data-ng-bind="$select.selected.text | translate"></span>\n            </ui-select-match>\n            <ui-select-choices repeat="item in availableTypes"\n                position="down">\n                <span data-ng-bind="item.text | translate"></span>\n            </ui-select-choices>\n        </ui-select>\n    </div>\n    <div class="form-group perso-cc-modal__content-layout">\n        <ng-include src="select.type.template" />\n    </div>\n    <div class="select2-choices">\n        <div class="ui-select-match-item select2-search-choice perso-cc-modal__ui-select--small"\n            data-ng-repeat="action in getActionsToDisplay()">\n            <span data-ng-bind="displayAction(action)"></span>\n            <span class="ui-select-match-close select2-search-choice-close"\n                data-ng-click="removeSelectedAction(action)"></span>\n        </div>\n    </div>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/managerView/personalizationsmarteditManagerViewGridHeaderTemplate.html",'<div class="tree-head hidden-sm hidden-xs">\n    <div class="tree-head__col--lg perso-wrap-ellipsis"\n        data-translate="personalization.modal.manager.grid.header.customization"\n        title="{{\'personalization.modal.manager.grid.header.customization\' | translate}}"></div>\n    <div class="tree-head__col--xs"\n        data-translate="personalization.modal.manager.grid.header.variations"\n        title="{{\'personalization.modal.manager.grid.header.variations\' | translate}}"></div>\n    <div class="tree-head__col--xs perso-wrap-ellipsis"\n        data-translate="personalization.modal.manager.grid.header.components"\n        title="{{\'personalization.modal.manager.grid.header.components\' | translate}}"></div>\n    <div class="tree-head__col--md"\n        data-translate="personalization.modal.manager.grid.header.status"\n        title="{{\'personalization.modal.manager.grid.header.status\' | translate}}"></div>\n    <div class="tree-head__col--sm perso-wrap-ellipsis"\n        data-translate="personalization.modal.manager.grid.header.startdate"\n        title="{{\'personalization.modal.manager.grid.header.startdate\' | translate}}"></div>\n    <div class="tree-head__col--sm perso-wrap-ellipsis"\n        data-translate="personalization.modal.manager.grid.header.enddate"\n        title="{{\'personalization.modal.manager.grid.header.enddate\' | translate}}"></div>\n</div>\n<div class="row tree-head visible-sm visible-xs">\n    <div class="col-xs-10 text-left"\n        data-translate="personalization.modal.manager.grid.header.customization"></div>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/managerView/personalizationsmarteditManagerViewNodeTemplate.html",'<div class="y-tree-row"\n    data-ng-init="customization.isCollapsed=true"\n    data-ng-class="allCustomizationsCollapsed()? \'active-level\' : \'inactive-level\'">\n    <div class="desktop-layout hidden-sm hidden-xs customization-rank-{{customization.rank}}-row">\n        <div data-ng-click="customization.isCollapsed =! customization.isCollapsed">\n            <a class="btn btn-link category-toggle"\n                title="{{customization.isCollapsed ? \'personalization.commons.icon.title.expand\' : \'personalization.commons.icon.title.collapse\' | translate}}">\n                <span data-ng-class="customization.isCollapsed ? \'glyphicon-chevron-right\' : \'glyphicon-chevron-down\'"\n                    class="glyphicon"></span>\n            </a>\n        </div>\n        <div ui-tree-handle\n            class="y-tree-row__angular-ui-tree-handle">\n            <div class="y-tree__col--lg">\n                <div class="perso-wrap-ellipsis perso-library__primary-data"\n                    title={{customization.name}}>\n                    <span class="personalizationsmartedit-customization-code"\n                        data-ng-bind="customization.name"></span>\n                </div>\n            </div>\n            <div class="y-tree__col--xs"\n                data-ng-bind="(customization.variations | statusNotDeleted).length || 0">\n            </div>\n            <div class="y-tree__col--xs"></div>\n            <div class="y-tree__col--md perso-library__status-value"\n                data-ng-class="getActivityStateForCustomization(customization)">\n                <span data-ng-bind="getEnablementTextForCustomization(customization)"\n                    class="perso-library__status-layout"></span>\n            </div>\n            <div class="y-tree__col--sm">\n                <div data-ng-show="customization.status === PERSONALIZATION_MODEL_STATUS_CODES.ENABLED"\n                    class="perso-library__dates-value">\n                    <span data-ng-bind="getFormattedDate(customization.enabledStartDate)"></span>\n                </div>\n            </div>\n            <div class="y-tree__col--sm">\n                <div data-ng-show="customization.status === PERSONALIZATION_MODEL_STATUS_CODES.ENABLED"\n                    class="perso-library__dates-value">\n                    <span data-ng-bind="getFormattedDate(customization.enabledEndDate)"></span>\n                </div>\n            </div>\n        </div>\n        <div>\n            <div data-uib-dropdown>\n                <button type="button"\n                    data-uib-dropdown-toggle\n                    class="btn btn-link">\n                    <span class="hyicon hyicon-more"></span>\n                </button>\n                <ul data-uib-dropdown-menu\n                    class="pull-right text-left"\n                    role="menu">\n                    <li>\n                        <a data-ng-click="editCustomizationAction(customization)"\n                            data-translate="personalization.modal.manager.customization.options.edit"></a>\n                    </li>\n                    <li data-ng-class="isFilterEnabled() || $first ? \'disabled\' : \'\' ">\n                        <a data-ng-click="(isFilterEnabled() || $first) ? $event.stopPropagation() : setCustomizationRank(customization, -1)"\n                            data-translate="personalization.modal.manager.customization.options.moveup"></a>\n                    </li>\n                    <li data-ng-class="isFilterEnabled() || $last ? \'disabled\' : \'\' ">\n                        <a data-ng-click="(isFilterEnabled() || $last) ? $event.stopPropagation() : setCustomizationRank(customization, 1)"\n                            data-translate="personalization.modal.manager.customization.options.movedown"></a>\n                    </li>\n                    <li role="separator"\n                        class="divider"></li>\n                    <li>\n                        <a data-ng-click="deleteCustomizationAction(customization)"\n                            data-translate="personalization.modal.manager.customization.options.delete"></a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n\n        \x3c!--end contextual menu dropdown--\x3e\n    </div>\n    \x3c!--end desktop-layout for customization row--\x3e\n\n    <div class="mobile-layout hidden-xl hidden-lg hidden-md customization-rank-{{customization.rank}}-row">\n        <div data-ng-click="customization.isCollapsed =! customization.isCollapsed">\n            <a class="btn btn-link category-toggle"\n                title="{{customization.isCollapsed ? \'personalization.commons.icon.title.expand\' : \'personalization.commons.icon.title.collapse\' | translate}}">\n                <span data-ng-class="customization.isCollapsed ? \'glyphicon-chevron-right\' : \'glyphicon-chevron-down\'"\n                    class="glyphicon customization__glyphicon-chevron"></span>\n            </a>\n        </div>\n        <div ui-tree-handle\n            class="y-tree-row__angular-ui-tree-handle--mobile">\n            <p class="y-tree__col-xl--mobile perso-library__primary-data perso-wrap-ellipsis"\n                title={{customization.name}}>\n                <span class="personalizationsmartedit-customization-code"\n                    data-ng-bind="customization.name"></span>\n            </p>\n            <div class="mobile-data">\n                <span class="perso-library__tree-head--mobile"\n                    data-translate="personalization.modal.manager.grid.header.variations"></span>\n                <div class="perso-library__number-data--mobile"\n                    data-ng-bind="(customization.variations | statusNotDeleted).length || 0"></div>\n            </div>\n            <div class="mobile-data perso-library__status-value"\n                data-ng-class="getActivityStateForCustomization(customization)">\n                <span data-ng-bind="getEnablementTextForCustomization(customization)"></span>\n            </div>\n            <div data-ng-show="customization.status === PERSONALIZATION_MODEL_STATUS_CODES.ENABLED">\n                <div class="mobile-data"\n                    data-ng-if=\'customization.enabledStartDate || customization.enabledEndDate\'>\n                    <span data-ng-if=\'customization.enabledStartDate\'\n                        class="perso-library__tree-head--mobile"\n                        data-translate="personalization.modal.manager.grid.header.startdate"></span>\n                    <p data-ng-bind="getFormattedDate(customization.enabledStartDate)"></p>\n                    <span data-ng-if=\'customization.enabledEndDate\'\n                        class="perso-library__tree-head--mobile"\n                        data-translate="personalization.modal.manager.grid.header.enddate"></span>\n                    <p data-ng-bind="getFormattedDate(customization.enabledEndDate)"></p>\n                </div>\n            </div>\n        </div>\n        <div>\n            <div data-uib-dropdown\n                class="mobile-more-menu">\n                <button type="button"\n                    data-uib-dropdown-toggle\n                    class="btn btn-link">\n                    <span class="hyicon hyicon-more"></span>\n                </button>\n                <ul data-uib-dropdown-menu\n                    class="pull-right text-left"\n                    role="menu">\n                    <li>\n                        <a data-ng-click="editCustomizationAction(customization)"\n                            data-translate="personalization.modal.manager.customization.options.edit"></a>\n                    </li>\n                    <li data-ng-class="isFilterEnabled() || $first ? \'disabled\' : \'\' ">\n                        <a data-ng-click="(isFilterEnabled() || $first) ? $event.stopPropagation() : setCustomizationRank(customization, -1)"\n                            data-translate="personalization.modal.manager.customization.options.moveup"></a>\n                    </li>\n                    <li data-ng-class="isFilterEnabled() || $last ? \'disabled\' : \'\' ">\n                        <a data-ng-click="(isFilterEnabled() || $last) ? $event.stopPropagation() : setCustomizationRank(customization, 1)"\n                            data-translate="personalization.modal.manager.customization.options.movedown"></a>\n                    </li>\n                    <li role="separator"\n                        class="divider"></li>\n                    <li>\n                        <a data-ng-click="deleteCustomizationAction(customization)"\n                            data-translate="personalization.modal.manager.customization.options.delete"></a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n        \x3c!--end contextual menu dropdown--\x3e\n    </div>\n    \x3c!--end mobile-layout for customization row--\x3e\n</div>\n\x3c!--end angular-ui-tree-handle--\x3e\n<div data-uib-collapse="customization.isCollapsed"\n    data-expanding="customizationClickAction(customization)">\n    <div ui-tree-nodes\n        data-ng-model="customization.variations">\n        <div class="y-tree-row child-row active-level"\n            data-ng-class="{\'perso-library__angular-ui-tree-drag\': variation.isDragging}"\n            ui-tree-node\n            data-ng-repeat="variation in customization.variations | orderBy:\'rank\'"\n            data-ng-if="statusNotDeleted(variation)"\n            data-ng-init="variation.isCommerceCustomizationEnabled=isCommerceCustomizationEnabled()">\n            <div class="desktop-layout variation-rank-{{variation.rank}}-row hidden-sm hidden-xs"\n                data-ng-class="$last ? \'active-level--last\':\'\'">\n                <div>\n                    <span class="perso__cc-icon hyicon hyicon-commerce"\n                        data-ng-class="{\'perso__cc-icon--hidden\': !hasCommerceActions(variation)}"\n                        data-uib-tooltip-html="getCommerceCustomizationTooltip(variation)"\n                        data-tooltip-placement="top-left"></span>\n                </div>\n                <div ui-tree-handle\n                    class="y-tree-row__angular-ui-tree-handle">\n                    <div class="y-tree__col--xl perso-wrap-ellipsis"\n                        title={{variation.name}}>\n                        <span data-ng-bind="variation.name"></span>\n                    </div>\n                    <div class="y-tree__col--xs"\n                        data-ng-bind="variation.numberOfComponents">\n                    </div>\n                    <div class="y-tree__col--md perso-library__status-value"\n                        data-ng-class="getActivityStateForVariation(customization,variation)">\n                        <span data-ng-bind="getEnablementTextForVariation(variation)"\n                            class="perso-library__status-layout"></span>\n                    </div>\n                    <div class="y-tree__col--lg"></div>\n                </div>\n                <div>\n                    <div data-uib-dropdown>\n                        <button type="button"\n                            data-uib-dropdown-toggle\n                            class="btn btn-link">\n                            <span class="hyicon hyicon-more"></span>\n                        </button>\n                        <ul data-uib-dropdown-menu\n                            class="pull-right text-left"\n                            role="menu">\n                            <li>\n                                <a data-ng-click="editVariationAction(customization, variation)"\n                                    data-translate="personalization.modal.manager.variation.options.edit"></a>\n                            </li>\n                            <li>\n                                <a data-ng-click="toogleVariationActive(customization,variation)"\n                                    data-ng-bind="getEnablementActionTextForVariation(variation)"></a>\n                            </li>\n                            <li data-ng-show="variation.isCommerceCustomizationEnabled">\n                                <a data-ng-click="manageCommerceCustomization(customization, variation)"\n                                    data-translate="personalization.modal.manager.variation.options.commercecustomization"></a>\n                            </li>\n                            <li data-ng-class="$first ? \'disabled\' : \'\' ">\n                                <a data-ng-click="$first ? $event.stopPropagation() : setVariationRank(customization, variation, -1)"\n                                    data-translate="personalization.modal.manager.variation.options.moveup"></a>\n                            </li>\n                            <li data-ng-class="$last ? \'disabled\' : \'\' ">\n                                <a data-ng-click="$last ? $event.stopPropagation() : setVariationRank(customization, variation, 1)"\n                                    data-translate="personalization.modal.manager.variation.options.movedown"></a>\n                            </li>\n                            <li role="separator"\n                                class="divider"></li>\n                            <li data-ng-class="isDeleteVariationEnabled(customization) ? \'\' : \'disabled\' ">\n                                <a data-ng-click="deleteVariationAction(customization, variation, $event)"\n                                    data-translate="personalization.modal.manager.variation.options.delete"></a>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n                \x3c!--end contextual menu dropdown--\x3e\n            </div>\n            \x3c!--end desktop-layout for variation row--\x3e\n            <div class="mobile-layout hidden-xl hidden-lg hidden-md variation-rank-{{variation.rank}}-row"\n                data-ng-class="$last ? \'active-level--last\':\'\'">\n                <div>\n                    <span class="perso__cc-icon hyicon hyicon-commerce"\n                        data-ng-class="{\'perso__cc-icon--hidden\': !hasCommerceActions(variation)}"\n                        data-uib-tooltip-html="getCommerceCustomizationTooltip(variation)"\n                        data-tooltip-placement="top-left"></span>\n                </div>\n                <div ui-tree-handle\n                    class="y-tree-row__angular-ui-tree-handle--mobile">\n                    <div>\n                        <p class="y-tree__col-xl--mobile perso-wrap-ellipsis"\n                            title="{{variation.name}}">\n                            <span data-ng-bind="variation.name"></span>\n                        </p>\n                        <div class="mobile-data">\n                            <span class="perso-library__tree-head--mobile"\n                                data-translate="personalization.modal.manager.grid.header.components"></span>\n                            <div data-ng-bind="variation.numberOfComponents"></div>\n                        </div>\n                        <div class="mobile-data perso-library__status-value"\n                            data-ng-class="getActivityStateForVariation(customization,variation)">\n                            <span data-ng-bind="getEnablementTextForVariation(variation)"></span>\n                        </div>\n                    </div>\n                </div>\n                <div>\n                    <div class="mobile-more-menu">\n                        <div data-uib-dropdown>\n                            <button type="button"\n                                data-uib-dropdown-toggle\n                                class="btn btn-link">\n                                <span class="hyicon hyicon-more"></span>\n                            </button>\n                            <ul data-uib-dropdown-menu\n                                class="pull-right text-left"\n                                role="menu">\n                                <li>\n                                    <a data-ng-click="editVariationAction(customization, variation)"\n                                        data-translate="personalization.modal.manager.variation.options.edit"></a>\n                                </li>\n                                <li>\n                                    <a data-ng-click="toogleVariationActive(customization,variation)"\n                                        data-ng-bind="getEnablementActionTextForVariation(variation)"></a>\n                                </li>\n                                <li data-ng-show="variation.isCommerceCustomizationEnabled">\n                                    <a data-ng-click="manageCommerceCustomization(customization, variation)"\n                                        data-translate="personalization.modal.manager.variation.options.commercecustomization"></a>\n                                </li>\n                                <li data-ng-class="$first ? \'disabled\' : \'\' ">\n                                    <a data-ng-click="$first ? $event.stopPropagation() : setVariationRank(customization, variation, -1)"\n                                        data-translate="personalization.modal.manager.variation.options.moveup"></a>\n                                </li>\n                                <li data-ng-class="$last ? \'disabled\' : \'\' ">\n                                    <a data-ng-click="$last ? $event.stopPropagation() : setVariationRank(customization, variation, 1)"\n                                        data-translate="personalization.modal.manager.variation.options.movedown"></a>\n                                </li>\n                                <li role="separator"\n                                    class="divider"></li>\n                                <li data-ng-class="isDeleteVariationEnabled(customization) ? \'\' : \'disabled\' ">\n                                    <a data-ng-click="deleteVariationAction(customization, variation, $event)"\n                                        data-translate="personalization.modal.manager.variation.options.delete"></a>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                    \x3c!--end contextual menu dropdown--\x3e\n                </div>\n            </div>\n            \x3c!--end mobile-layout for variation row--\x3e\n        </div>\n        \x3c!--end variation-repeat--\x3e\n    </div>\n</div>\n\x3c!--end collapse--\x3e'),e.put("web/features/personalizationsmarteditcontainer/management/managerView/personalizationsmarteditManagerViewTemplate.html",'<div id="editConfigurationsBody-001"\n    class="perso-library">\n\n    <personalizationsmartedit-scroll-zone data-ng-if="scrollZoneElement != null"\n        data-is-transparent="true"\n        data-scroll-zone-visible="scrollZoneVisible"\n        data-get-element-to-scroll="getElementToScroll()"></personalizationsmartedit-scroll-zone>\n\n    <div class="perso-library__scroll-zone perso__scrollbar--hidden"\n        personalization-current-element="setScrollZoneElement"\n        personalization-infinite-scroll="addMoreItems()"\n        personalization-infinite-scroll-distance="2">\n        <div>\n            <h2 class="perso-library__header"\n                data-ng-bind="catalogName"></h2>\n            <div class="row perso-library__search">\n                <div class="col-sm-4 col-sm-offset-3">\n                    <div class="input-group">\n                        <span class="input-group-addon hyicon hyicon-search perso-library__search-icon"></span>\n                        <input type="text"\n                            class="form-control perso-library__search-input ng-pristine ng-untouched ng-valid"\n                            placeholder="{{ \'personalization.modal.manager.search.placeholder\' | translate}}"\n                            ng-model="search.name"\n                            ng-keyup="searchInputKeypress($event)"></input>\n                        <span data-ng-show="search.name"\n                            class="input-group-addon glyphicon glyphicon-remove-sign ySESearchIcon"\n                            ng-click="search.name=\'\'; searchInputKeypress($event)"></span>\n                    </div>\n                </div>\n                <div class="col-sm-2 pull-left perso__filter-layout">\n                    <ui-select ng-model="search.status"\n                        theme="select2"\n                        title=""\n                        search-enabled="false">\n                        <ui-select-match>\n                            <span ng-bind="$select.selected.text | translate"></span>\n                        </ui-select-match>\n                        <ui-select-choices repeat="item in statuses"\n                            position="down">\n                            <span ng-bind="item.text | translate"></span>\n                        </ui-select-choices>\n                    </ui-select>\n                </div>\n            </div>\n\n            <div data-ng-show="isSearchResultHidden()"\n                class="perso-library__search-results--fixed">\n                <span data-ng-bind="filteredCustomizationsCount"></span>\n                <span data-translate="personalization.modal.manager.search.result.label"></span>\n            </div>\n            <div class="perso-library__search-results">\n                <span data-ng-bind="filteredCustomizationsCount"></span>\n                <span data-translate="personalization.modal.manager.search.result.label"></span>\n            </div>\n\n            <button class="y-add y-add-btn perso-library__add-button"\n                type="button"\n                data-ng-click="openNewModal();">\n                <span class="hyicon hyicon-add"\n                    data-translate="personalization.modal.manager.add.button"></span>\n            </button>\n\n            <div class="y-tree perso-library__y-tree">\n                \x3c!-- headers --\x3e\n                <div data-ng-show="isSearchGridHeaderHidden()"\n                    class="y-tree-header y-tree-header--fixed">\n                    <data-ng-include src="\'personalizationsmarteditManagerViewGridHeaderTemplate.html\'"></data-ng-include>\n                </div>\n                <div class="y-tree-header">\n                    <data-ng-include src="\'personalizationsmarteditManagerViewGridHeaderTemplate.html\'"></data-ng-include>\n                </div>\n                \x3c!--end y-tree-header--\x3e\n\n                <div ui-tree="treeOptions"\n                    id="tree-root">\n                    <div ui-tree-nodes\n                        data-ng-model="customizations">\n                        <div data-ng-repeat="customization in customizations"\n                            data-ng-class="{\'perso-library__angular-ui-tree-drag\': customization.isDragging}"\n                            ui-tree-node\n                            data-ng-include="\'personalizationsmarteditManagerViewNodeTemplate.html\'"></div>\n                    </div>\n                </div>\n\n                <div data-ng-show="moreCustomizationsRequestProcessing">\n                    <div data-ng-include="\'waitDialog.html\'"></div>\n                </div>\n                \x3c!--end customization-repeat--\x3e\n            </div>\n            \x3c!--end y-tree--\x3e\n        </div>\n    </div>\n    \x3c!--end scroll zone--\x3e\n\n    <a class="perso-library__back-to-top-button"\n        title="{{\'personalization.commons.button.title.backtotop\' | translate}}"\n        data-ng-show="isReturnToTopButtonVisible()"\n        data-ng-click="scrollZoneReturnToTop()">\n        <span class="hyicon hyicon-top back-to-top"></span>\n    </a>\n\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagMenuTemplate.html",'<div data-ng-controller="topToolbarMenuController"\n    data-uib-dropdown\n    data-is-open="item.isOpen"\n    class="btn-group pe-toolbar-action pe-combined-view-menu"\n    data-auto-close="outsideClick">\n    <button type="button"\n        class="btn btn-default pe-toolbar-action--button"\n        data-uib-dropdown-toggle\n        data-ng-disabled="disabled"\n        aria-pressed="false">\n        <span class="hyicon hyicon-library se-toolbar-menu-ddlb--button__icon"></span>\n        <span class="pe-toolbar-action--button--txt"\n            data-translate="personalization.toolbar.library.name"></span>\n    </button>\n\n    <div data-uib-dropdown-menu\n        class="btn-block pe-toolbar-action--include">\n        <div class="se-toolbar-menu-content se-toolbar-menu-content--pe-customized"\n            role="menu">\n            <div class="se-toolbar-menu-content--pe-customized__headers">\n                <h2 class="se-toolbar-menu-content--pe-customized__headers--h2"\n                    data-translate="personalization.toolbar.library.header.title"></h2>\n                <y-help class="se-toolbar-menu-content__y-help"\n                    data-template="\'<span data-translate=personalization.toolbar.library.header.description></span>\'"></y-help>\n            </div>\n            <div class="se-toolbar-menu-content--pe-customized__item">\n                <a class="se-toolbar-menu-content--pe-customized__item__link"\n                    id="personalizationsmartedit-pagecustomizations-toolbar-customization-anchor"\n                    data-translate="personalization.toolbar.library.manager.name"\n                    data-ng-click="managerViewClick();item.isOpen=false"></a>\n            </div>\n            <div class="se-toolbar-menu-content--pe-customized__item se-toolbar-menu-content--pe-customized__item--last">\n                <a class="se-toolbar-menu-content--pe-customized__item__link"\n                    id="personalizationsmartedit-pagecustomizations-toolbar-customization-anchor"\n                    data-translate="personalization.toolbar.library.customizationvariationmanagement.name"\n                    data-ng-click="createCustomizationClick();item.isOpen=false"></a>\n            </div>\n        </div>\n    </div>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagTemplate.html",'<div>\n    <uib-tabset active="activeTabNumber">\n        <uib-tab ng-repeat="tab in tabsArr"\n            select="selectTab(tab)"\n            disable="tab.disabled"\n            heading="{{tab.heading}}">\n            <form name="{{tab.formName}}"\n                novalidate>\n                <div>\n                    <data-ng-include src="tab.template"></data-ng-include>\n                </div>\n            </form>\n        </uib-tab>\n    </uib-tabset>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/tabs/personalizationsmarteditCustVarManagBasicInfoTemplate.html",'<div class="customization-form">\n    <form>\n        <div class="form-group">\n            <label for="customization-name"\n                data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.name"\n                class="control-label required"></label>\n            <input type="text"\n                class="form-control"\n                placeholder="{{\'personalization.modal.customizationvariationmanagement.basicinformationtab.name.placeholder\' | translate}}"\n                name="{{customization.name}}_key"\n                data-ng-model="customization.name"\n                data-ng-required="true"\n                id="customization-name">\n        </div>\n        <div class="form-group">\n            <label for="customization-description"\n                data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details"\n                class="personalization-modal__label"></label>\n            <textarea rows="2"\n                class="form-control description-area"\n                placeholder="{{\'personalization.modal.customizationvariationmanagement.basicinformationtab.details.placeholder\' | translate}}"\n                name="{{customization.description}}_key"\n                data-ng-model="customization.description"\n                id="customization-description"></textarea>\n        </div>\n        <div class="form-group">\n            <label for="customization-status"\n                data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.status"\n                class="personalization-modal__label"></label>\n            <div class="status-toggle">\n                <span class="y-toggle y-toggle-lg"\n                    id="customization-status"\n                    ng-init="customization.status = PERSONALIZATION_MODEL_STATUS_CODES.ENABLED">\n                    <input type="checkbox"\n                        id="test-checkbox"\n                        data-ng-model="customization.statusBoolean" />\n                    <label for="test-checkbox"></label>\n                </span>\n            </div>\n        </div>\n        <div class="form-group">\n            <div>\n                <a ng-show="!edit.datetimeConfigurationEnabled"\n                    data-ng-click="edit.datetimeConfigurationEnabled = !edit.datetimeConfigurationEnabled"\n                    data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.showdateconfigdata"></a>\n                <a ng-show="edit.datetimeConfigurationEnabled"\n                    data-ng-click="edit.datetimeConfigurationEnabled = !edit.datetimeConfigurationEnabled; resetDateTimeConfiguration();"\n                    data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.hidedateconfigdata"></a>\n            </div>\n            <div data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.statusfortimeframe.description"></div>\n        </div>\n        <div class="form-group">\n            <div ng-show="edit.datetimeConfigurationEnabled">\n                <div class="row form-group-dates">\n                    <date-time-picker-range name="data-date-time-from-to-key"\n                        data-date-from="customization.enabledStartDate"\n                        data-date-to="customization.enabledEndDate"\n                        data-is-editable="true"\n                        date-format="edit.viewDateFormat"></date-time-picker-range>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/tabs/personalizationsmarteditCustVarManagTargetGrpTemplate.html",'<div ng-controller="personalizationsmarteditManagerTargetGrpController as $ctrl"\n    class="customization-form">\n    <div class="customization-form__title">\n        <div class="customization-form__title-header">\n            <div class="customization-form__title-header-name perso-wrap-ellipsis"\n                data-ng-bind="customization.name"\n                title={{customization.name}}></div>\n            <div>\n                <span class="customization-form__title-header-badge badge"\n                    ng-class="{\'status-active\':\'badge-success\', \'status-inactive\':\'\', \'status-ignore\':\'\'}[getActivityStateForCustomization(customization)]">\n                    {{\'personalization.modal.customizationvariationmanagement.targetgrouptab.customization.\' + customization.status | lowercase | translate}}\n                </span>\n            </div>\n        </div>\n        <div class="customization-form__title-subarea">\n            <div ng-if="customization.status === PERSONALIZATION_MODEL_STATUS_CODES.ENABLED"\n                class="customization-form__title-dates">\n                <span ng-if=\'!customization.enabledStartDate && customization.enabledEndDate\'>...</span>\n                <span ng-bind="customization.enabledStartDate"></span>\n                <span ng-if=\'customization.enabledStartDate || customization.enabledEndDate\'> - </span>\n                <span ng-bind="customization.enabledEndDate"></span>\n                <span ng-if="isEndDateInThePast"\n                    class="section-help help-inline help-inline--section help-inline--tooltip">\n                    <span class="hyicon hyicon-msgwarning hyicon-msgwarning--dates help-icon-inline"></span>\n                    <span class="pe-help-block--inline help-block-inline help-block-inline--text"\n                        data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.datetooltip"></span>\n                </span>\n                <span ng-if=\'customization.enabledStartDate && !customization.enabledEndDate\'>...</span>\n            </div>\n        </div>\n    </div>\n    <div class="customization-form__navtab-forms">\n        <div class="customization-form__navtab-forms--add-btn">\n            <button class="y-add-btn"\n                type="button"\n                data-ng-click="$ctrl.showSliderPanel()">\n                <span class="hyicon hyicon-add"></span>\n                <span data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.addtargetgroup.button"></span>\n            </button>\n        </div>\n        <ul ng-show=\'filteredVariations.length > 0\'\n            class="customization-form__list-group">\n            <li class="customization-form__list-group__item"\n                data-ng-repeat="variation in customization.variations | statusNotDeleted as filteredVariations">\n                <div class="customization-form__variation-data">\n                    <a class="navtab-row__item__variation"\n                        ng-bind="variation.name"\n                        ng-click="editVariationAction(variation)"></a>\n                    <span ng-class="getActivityStateForVariation(customization, variation)"\n                        ng-bind="getEnablementTextForVariation(variation)"></span>\n                    <div data-ng-show="isDefaultVariation(variation)">\n                        <span class="targetgroup-list__title"\n                            data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.colon"></span>\n                        <span data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.default"></span>\n                    </div>\n                    <div data-ng-show="!isDefaultVariation(variation)">\n                        <div>\n                            <span class="targetgroup-list__title"\n                                data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.colon"></span>\n                            <personalizationsmartedit-segment-expression-as-html data-segment-expression="variation.triggers"></personalizationsmartedit-segment-expression-as-html>\n                        </div>\n                    </div>\n                </div>\n                <div data-uib-dropdown\n                    class="customization-form__variation-menu">\n                    <button type="button"\n                        data-uib-dropdown-toggle\n                        class="dropdown-toggle btn btn-link segment-contextual-menu__button"\n                        id="dropdownMenu1"\n                        aria-haspopup="true"\n                        aria-expanded="true">\n                        <span class="hyicon hyicon-more"></span>\n                    </button>\n                    <ul data-uib-dropdown-menu\n                        aria-labelledby="dropdownMenu1"\n                        role="menu">\n                        <li>\n                            <a ng-click="editVariationAction(variation)"\n                                data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.edit" />\n                        </li>\n                        <li>\n                            <a ng-click="toogleVariationActive(variation)"\n                                ng-bind="getActivityActionTextForVariation(variation)" />\n                        </li>\n                        <li ng-class="$first ? \'disabled\' : \'\' ">\n                            <a ng-click="setVariationRank(variation, -1, $event, $first)"\n                                data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.moveup" />\n                        </li>\n                        <li ng-class="$last ? \'disabled\' : \'\' ">\n                            <a ng-click="setVariationRank(variation, 1, $event, $last)"\n                                data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.movedown" />\n                        </li>\n                        <li role="separator"\n                            class="divider"></li>\n                        <li>\n                            <a ng-click="removeVariationClick(variation)"\n                                data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.options.remove" />\n                        </li>\n                    </ul>\n                </div>\n            </li>\n        </ul>\n    </div>\n\n    <y-slider-panel data-slider-panel-show="$ctrl.showSliderPanel"\n        data-slider-panel-hide="$ctrl.hideSliderPanel"\n        data-slider-panel-configuration="$ctrl.sliderPanelConfiguration"\n        class="customization-form__sliderpanel">\n        <content>\n            <div class="row">\n                <div class="pull-right">\n                    <button class="btn btn-link perso-sliderpanel__btn-link"\n                        data-ng-init="isFullscreen=false"\n                        data-ng-click="toggleSliderFullscreen(); isFullscreen=!isFullscreen">\n                        <div>\n                            <div data-ng-if="!isFullscreen">\n                                <span class="hyicon hyicon-maximize perso-sliderpanel__icon"></span>\n                                <span data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.fullscreen.open"></span>\n                            </div>\n                            <div data-ng-if="isFullscreen">\n                                <span class="hyicon hyicon-minimize perso-sliderpanel__icon"></span>\n                                <span data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.fullscreen.close"></span>\n                            </div>\n                        </div>\n                    </button>\n                </div>\n            </div>\n            <form>\n                <div class="form-group">\n                    <label for="targetgroup-name"\n                        class="control-label required"\n                        data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname"></label>\n                    <input uniquetargetgroupname\n                        type="text"\n                        class="form-control"\n                        placeholder="{{\'personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname.placeholder\' | translate}}"\n                        name="variationname_key"\n                        data-ng-model="edit.name"\n                        id="targetgroup-name">\n                </div>\n                <div class="form-group">\n                    <div class="checkbox">\n                        <input type="checkbox"\n                            id="targetgroup-isDefault-001"\n                            ng-model="edit.isDefault"\n                            ng-change="confirmDefaultTrigger(edit.isDefault);" />\n                        <label for="targetgroup-isDefault-001"\n                            data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.variation.default"></label>\n                    </div>\n                </div>\n                <span ng-show="{{tab.formName}}.variationname_key.$error.uniquetargetgroupname"\n                    data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroup.uniquename.validation.message"></span>\n\n                <div ng-show="edit.showExpression">\n                    <label class="personalization-modal__label"\n                        data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupexpression"></label>\n                    <multi-segment-view data-triggers=\'edit.selectedVariation.triggers\'\n                        data-expression=\'edit.expression\'></multi-segment-view>\n                </div>\n            </form>\n        </content>\n    </y-slider-panel>\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/tabs/segmentView/personalizationsmarteditSegmentNodeTemplate.html",'<div data-ng-class="{\'perso-tree__segments-layout\': ctrl.isContainer(node), \'perso-tree__empty-container\': ctrl.isContainerWithDropzone(node), \'perso-tree__collapsed-container\': collapsed }">\n    <div class="perso-tree"\n        data-ng-class="{\'perso-tree__node\': ctrl.isItem(node), \'perso-tree__container\': ctrl.isContainer(node)}">\n        <div data-ng-if="ctrl.isContainer(node)">\n            <div class="perso-tree__toggle"\n                data-ng-click="ctrl.toggle(this)"\n                title="{{collapsed ? \'personalization.commons.icon.title.expand\' : \'personalization.commons.icon.title.collapse\' | translate}}">\n                <span class="glyphicon perso-tree__glyphicon"\n                    ng-class="{\'glyphicon-chevron-right\': collapsed, \'glyphicon-chevron-down\': !collapsed}"></span>\n            </div>\n            <div class="perso-tree__dropdown">\n                <ui-select ng-model="node.operation"\n                    theme="select2"\n                    title=""\n                    search-enabled="false">\n                    <ui-select-match>\n                        <span ng-bind="$select.selected.name | translate"></span>\n                    </ui-select-match>\n                    <ui-select-choices repeat="item in ctrl.actions"\n                        position="down">\n                        <span ng-bind="item.name | translate"></span>\n                    </ui-select-choices>\n                </ui-select>\n            </div>\n        </div>\n        <div data-ng-if="ctrl.isItem(node)"\n            ui-tree-handle\n            class="perso-tree__node--content">{{node.selectedSegment.code}}</div>\n\n        <div data-ng-if="ctrl.isDropzone(node)"\n            class="perso-tree__empty-container-node">\n            <div class="perso-tree__empty-container-node--text"\n                data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.dropzone"></div>\n        </div>\n\n        <div data-ng-if="ctrl.isContainer(node)"\n            ui-tree-handle\n            class="perso-tree__angular-ui-tree-handle--empty"></div>\n        <div data-nodrag>\n            <span class="pull-right">\n                <a data-ng-if="ctrl.isItem(node)"\n                    class="perso-tree__actions perso-tree__node--icon"\n                    data-ng-click="ctrl.duplicateItem(node)"\n                    title="{{\'personalization.commons.icon.title.duplicate\' | translate}}">\n                    <span class="hyicon hyicon-duplicate"></span>\n                </a>\n                <a data-ng-if="!ctrl.isTopContainer(this)"\n                    class="perso-tree__actions"\n                    data-ng-click="ctrl.removeItem(this)">\n                    <div data-ng-if="ctrl.isContainer(node)"\n                        class="btn btn-link perso-tree__container--btn-icon"\n                        title="{{\'personalization.commons.icon.title.remove\' | translate}}">\n                        <span class="hyicon hyicon-removelg"></span>\n                    </div>\n                    <div data-ng-if="ctrl.isItem(node)"\n                        class="perso-tree__node--icon"\n                        title="{{\'personalization.commons.icon.title.remove\' | translate}}">\n                        <span class="hyicon hyicon-removelg"></span>\n                    </div>\n                </a>\n            </span>\n            <a data-ng-if="ctrl.isContainer(node)"\n                class="btn btn-link perso-tree__btn"\n                data-ng-click="ctrl.newSubItem(this, \'container\')">\n                <span class="perso-sliderpanel__btn-link"\n                    data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments.group.button"></span>\n            </a>\n        </div>\n    </div>\n\n    <ol data-ng-if="ctrl.isItem(node)"\n        ui-tree-nodes\n        data-nodrop-enabled="true"\n        data-ng-model="node.nodes"\n        data-ng-class="{hidden: collapsed}">\n        <li data-ng-repeat="node in node.nodes"\n            ui-tree-node\n            data-collapsed="true"\n            data-expand-on-hover="500"\n            data-ng-include="\'personalizationsmarteditSegmentNodeTemplate.html\'">\n        </li>\n    </ol>\n    <ol data-ng-if="ctrl.isContainer(node)"\n        ui-tree-nodes\n        data-ng-model="node.nodes"\n        data-ng-class="{hidden: collapsed}">\n        <li data-ng-repeat="node in node.nodes"\n            ui-tree-node\n            data-collapsed="true"\n            data-expand-on-hover="500"\n            data-ng-include="\'personalizationsmarteditSegmentNodeTemplate.html\'">\n        </li>\n    </ol>\n\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/tabs/segmentView/personalizationsmarteditSegmentViewTemplate.html",'<div>\n    <personalizationsmartedit-scroll-zone data-scroll-zone-visible="ctrl.scrollZoneVisible"\n        data-get-element-to-scroll="ctrl.getElementToScroll()"></personalizationsmartedit-scroll-zone>\n    <div class="form-group">\n        <personalizationsmartedit-segment-expression-as-html data-segment-expression="ctrl.expression[0]"></personalizationsmartedit-segment-expression-as-html>\n    </div>\n    <div class="form-group">\n        <label class="personalization-modal__label"\n            data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments"></label>\n        <ui-select class="form-control"\n            ng-model="ctrl.singleSegment"\n            theme="select2"\n            ng-keyup="ctrl.segmentSearchInputKeypress($event, $select.search)"\n            on-select="ctrl.segmentSelectedEvent($item, $select.items)"\n            reset-search-input="false">\n            <ui-select-match placeholder="{{ \'personalization.modal.customizationvariationmanagement.targetgrouptab.segments.placeholder\' | translate}}">\n                <span>{{\'personalization.modal.customizationvariationmanagement.targetgrouptab.segments.placeholder\' | translate}}</span>\n            </ui-select-match>\n            <ui-select-choices repeat="item in ctrl.segments"\n                position="down"\n                personalization-infinite-scroll="ctrl.addMoreSegmentItems()"\n                personalization-infinite-scroll-distance="2">\n                <span ng-bind="item.code"></span>\n            </ui-select-choices>\n        </ui-select>\n    </div>\n\n    <div ui-tree="ctrl.treeOptions"\n        id="tree-root">\n        <div ui-tree-nodes\n            ng-model="ctrl.expression"\n            data-nodrop-enabled="true">\n            <div ng-repeat="node in ctrl.expression"\n                data-collapsed="false"\n                ui-tree-node\n                ng-include="\'personalizationsmarteditSegmentNodeTemplate.html\'"></div>\n        </div>\n    </div>\n\n</div>'),e.put("web/features/personalizationsmarteditcontainer/management/tabs/segmentView/segmentExpressionAsHtml/personalizationsmarteditSegmentExpressionAsHtmlTemplate.html",'<span ng-repeat="word in ctrl.getExpressionAsArray() track by $index">\n    <span ng-if="ctrl.operators.indexOf(word) > -1"\n        class="perso-sliderpanel__expression-text"> {{ ctrl.getLocalizationKeyForOperator(word) | translate }} </span>\n    <span ng-if="ctrl.emptyGroup === word"\n        class="text-primary hyicon hyicon-caution"\n        data-uib-tooltip="{{\'personalization.modal.customizationvariationmanagement.targetgrouptab.segments.group.tooltip\' | translate}}"\n        data-tooltip-placement="auto top"></span>\n    <span ng-if="ctrl.emptyGroupAndOperators.indexOf(word) === -1">{{word}}</span>\n</span>'),e.put("web/features/personalizationsmarteditcontainer/toolbarContext/personalizationsmarteditToolbarContextTemplate.html",'<div data-ng-show="ctrl.visible"\n    class="pe-toolbar-item-context">\n    <span class="btn btn-default pe-toolbar-item-context__btn">\n        <div class="pe-toolbar-item-context__btn--txt">\n            <div title="{{ctrl.title}}"\n                class="perso-wrap-ellipsis pe-toolbar-item-context__btn--title">{{ctrl.title}}</div>\n            <div title="{{ctrl.subtitle}}"\n                class="perso-wrap-ellipsis pe-toolbar-item-context__btn--subtitle">{{ctrl.subtitle}}</div>\n        </div>\n    </span>\n    <span class="btn btn-default pe-toolbar-item-context__btn--hyicon"\n        data-ng-click="ctrl.clear()">\n        <div class="pe-toolbar-item-context__btn--txt hyicon hyicon-remove">\n        </div>\n    </span>\n</div>')}])},function(e,t){angular.module("personalizationsmarteditToolbarContextModule",[]).controller("personalizationsmarteditCustomizeToolbarContextController",["$scope","$timeout","personalizationsmarteditContextService","personalizationsmarteditIFrameUtils","personalizationsmarteditContextUtils",function(e,t,n,a,i){var o=this;e.$watch(function(){return n.getCustomize().selectedCustomization},function(e,t){e&&e!==t?(o.title=e.name,o.visible=!0):e||(o.visible=!1)}),e.$watch(function(){return n.getCustomize().selectedVariations},function(e,t){e&&e!==t&&(o.subtitle=e.name)}),o.clear=function(){i.clearCustomizeContextAndReloadPreview(a,n),t(function(){angular.element(".personalizationsmarteditTopToolbarCustomizeButton[aria-expanded='true']").click()},0)},o.$onInit=function(){o.visible=!1,n.getCustomize().selectedCustomization&&(o.title=n.getCustomize().selectedCustomization.name,o.visible=!0,angular.isArray(n.getCustomize().selectedVariations)||(o.subtitle=n.getCustomize().selectedVariations.name))}}]).controller("personalizationsmarteditCombinedViewToolbarContextController",["$scope","personalizationsmarteditCombinedViewCommons","$timeout","personalizationsmarteditContextService","personalizationsmarteditIFrameUtils","personalizationsmarteditContextUtils",function(e,t,n,a,i,o){var r=this;e.$watch(function(){return a.getCombinedView().customize.selectedCustomization},function(e,t){e&&e!==t?(r.title=e.name,r.subtitle=a.getCombinedView().customize.selectedVariations.name,r.visible=!0):e||(r.visible=!1)}),e.$watch(function(){return a.getCombinedView().enabled},function(e,t){!1===e&&e!==t&&o.clearCombinedViewCustomizeContext(a)}),r.clear=function(){o.clearCombinedViewCustomizeContext(a);var e=[];(a.getCombinedView().selectedItems||[]).forEach(function(t){e.push({customizationCode:t.customization.code,variationCode:t.variation.code,catalog:t.variation.catalog,catalogVersion:t.variation.catalogVersion})}),t.updatePreview(e)},r.$onInit=function(){r.visible=!1,a.getCombinedView().customize.selectedCustomization&&(r.title=a.getCombinedView().customize.selectedCustomization.name,r.subtitle=a.getCombinedView().customize.selectedVariations.name,r.visible=!0)}}]).component("personalizationsmarteditCustomizeToolbarContext",{templateUrl:"personalizationsmarteditToolbarContextTemplate.html",controller:"personalizationsmarteditCustomizeToolbarContextController",controllerAs:"ctrl",transclude:!0}).component("personalizationsmarteditCombinedViewToolbarContext",{templateUrl:"personalizationsmarteditToolbarContextTemplate.html",controller:"personalizationsmarteditCombinedViewToolbarContextController",controllerAs:"ctrl",transclude:!0})},function(e,t,n){function a(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./personalizationsmarteditCommons.js":27,"./personalizationsmarteditContextUtils.js":28,"./personalizationsmarteditDataUtils.js":29,"./personalizationsmarteditDateUtils.js":30,"./personalizationsmarteditInfiniteScroll.js":31,"./personalizationsmarteditPagination/personalizationsmarteditPagination.js":32,"./personalizationsmarteditScrollZone/personalizationsmarteditScrollZone.js":33,"./templates.js":34};a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=26},function(e,t){angular.module("personalizationsmarteditCommons",["personalizationcommonsTemplates","yjqueryModule","alertServiceModule","languageServiceModule","seConstantsModule","l10nModule","catalogServiceModule"]).constant("PERSONALIZATION_MODEL_STATUS_CODES",{ENABLED:"ENABLED",DISABLED:"DISABLED"}).constant("PERSONALIZATION_VIEW_STATUS_MAPPING_CODES",{ALL:"ALL",ENABLED:"ENABLED",DISABLED:"DISABLED"}).constant("PERSONALIZATION_COMBINED_VIEW_CSS_MAPPING",{0:{borderClass:"personalizationsmarteditComponentSelected0",listClass:"personalizationsmarteditComponentSelectedList0"},1:{borderClass:"personalizationsmarteditComponentSelected1",listClass:"personalizationsmarteditComponentSelectedList1"},2:{borderClass:"personalizationsmarteditComponentSelected2",listClass:"personalizationsmarteditComponentSelectedList2"},3:{borderClass:"personalizationsmarteditComponentSelected3",listClass:"personalizationsmarteditComponentSelectedList3"},4:{borderClass:"personalizationsmarteditComponentSelected4",listClass:"personalizationsmarteditComponentSelectedList4"},5:{borderClass:"personalizationsmarteditComponentSelected5",listClass:"personalizationsmarteditComponentSelectedList5"},6:{borderClass:"personalizationsmarteditComponentSelected6",listClass:"personalizationsmarteditComponentSelectedList6"},7:{borderClass:"personalizationsmarteditComponentSelected7",listClass:"personalizationsmarteditComponentSelectedList7"},8:{borderClass:"personalizationsmarteditComponentSelected8",listClass:"personalizationsmarteditComponentSelectedList8"},9:{borderClass:"personalizationsmarteditComponentSelected9",listClass:"personalizationsmarteditComponentSelectedList9"},10:{borderClass:"personalizationsmarteditComponentSelected10",listClass:"personalizationsmarteditComponentSelectedList10"},11:{borderClass:"personalizationsmarteditComponentSelected11",listClass:"personalizationsmarteditComponentSelectedList11"},12:{borderClass:"personalizationsmarteditComponentSelected12",listClass:"personalizationsmarteditComponentSelectedList12"},13:{borderClass:"personalizationsmarteditComponentSelected13",listClass:"personalizationsmarteditComponentSelectedList13"},14:{borderClass:"personalizationsmarteditComponentSelected14",listClass:"personalizationsmarteditComponentSelectedList14"}}).run(["$rootScope","PERSONALIZATION_MODEL_STATUS_CODES",function(e,t){e.PERSONALIZATION_MODEL_STATUS_CODES=t}]).filter("statusNotDeleted",["personalizationsmarteditUtils",function(e){return function(t){return angular.isArray(t)?e.getVisibleItems(t):t}}]).factory("personalizationsmarteditUtils",["$q","$filter","PERSONALIZATION_MODEL_STATUS_CODES","PERSONALIZATION_VIEW_STATUS_MAPPING_CODES","PERSONALIZATION_COMBINED_VIEW_CSS_MAPPING","l10nFilter","catalogService",function(e,t,n,a,i,o,r){var s={};return s.pushToArrayIfValueExists=function(e,t,n){n&&e.push({key:t,value:n})},s.getVariationCodes=function(e){return void 0===e||null===e?[]:e.map(function(e){return e.code}).filter(function(e){return void 0!==e})},s.getVariationKey=function(e,t){return void 0===e||void 0===t?[]:t.map(function(t){return{variationCode:t.code,customizationCode:e,catalog:t.catalog,catalogVersion:t.catalogVersion}})},s.getSegmentTriggerForVariation=function(e){var t=(e.triggers||[]).filter(function(e){return"segmentTriggerData"===e.type});return 0===t.length?{}:t[0]},s.isPersonalizationItemEnabled=function(e){return e.status===n.ENABLED},s.getEnablementTextForCustomization=function(e,n){return n=n||"personalization",s.isPersonalizationItemEnabled(e)?t("translate")(n+".customization.enabled"):t("translate")(n+".customization.disabled")},s.getEnablementTextForVariation=function(e,n){return n=n||"personalization",s.isPersonalizationItemEnabled(e)?t("translate")(n+".variation.enabled"):t("translate")(n+".variation.disabled")},s.getEnablementActionTextForVariation=function(e,n){return n=n||"personalization",s.isPersonalizationItemEnabled(e)?t("translate")(n+".variation.options.disable"):t("translate")(n+".variation.options.enable")},s.getActivityStateForCustomization=function(e){return e.status===n.ENABLED?moment().isBetween(new Date(e.enabledStartDate),new Date(e.enabledEndDate),"minute","[]")?"status-active":"status-ignore":"status-inactive"},s.getActivityStateForVariation=function(e,t){return t.enabled?s.getActivityStateForCustomization(e):"status-inactive"},s.isItemVisible=function(e){return"DELETED"!==e.status},s.getVisibleItems=function(e){return e.filter(function(e){return s.isItemVisible(e)})},s.getValidRank=function(e,t,n){for(var a=e.indexOf(t),i=n<0?-1:1,o=a+n;o>=0&&o<e.length&&!s.isItemVisible(e[o]);)o+=i;return o=o>=e.length?e.length-1:o,o=o<0?0:o,e[o].rank},s.getStatusesMapping=function(){var e=[];return e.push({code:a.ALL,text:"personalization.context.status.all",modelStatuses:[n.ENABLED,n.DISABLED]}),e.push({code:a.ENABLED,text:"personalization.context.status.enabled",modelStatuses:[n.ENABLED]}),e.push({code:a.DISABLED,text:"personalization.context.status.disabled",modelStatuses:[n.DISABLED]}),e},s.getClassForElement=function(e){var t=e%Object.keys(i).length;return i[t].listClass},s.getLetterForElement=function(e){var t=e%Object.keys(i).length;return String.fromCharCode("a".charCodeAt()+t).toUpperCase()},s.getCommerceCustomizationTooltip=function(e,n,a){n=n||"",a=a||"\n";var i="";return angular.forEach(e.commerceCustomizations,function(e,o){i+=n+t("translate")("personalization.modal.manager.commercecustomization."+o)+": "+e+a}),i},s.getCommerceCustomizationTooltipHTML=function(e){return s.getCommerceCustomizationTooltip(e,"<div>","</div>")},s.isItemFromCurrentCatalog=function(e,t){var n=t.seExperienceData.catalogDescriptor;return e.catalog===n.catalogId&&e.catalogVersion===n.catalogVersion},s.hasCommerceActions=function(e){return e.numberOfCommerceActions>0},s.getCatalogVersionNameByUuid=function(t){var n=e.defer();return r.getCatalogVersionByUuid(t).then(function(e){n.resolve(o(e.catalogName)+" ("+e.version+")")}),n.promise},s.getAndSetCatalogVersionNameL10N=function(e){s.getCatalogVersionNameByUuid(e.catalog+"/"+e.catalogVersion).then(function(t){e.catalogVersionNameL10N=t})},s}]).factory("personalizationsmarteditMessageHandler",["alertService",function(e){var t={};return t.sendInformation=function(t){e.showInfo(t)},t.sendError=function(t){e.showDanger(t)},t.sendWarning=function(t){e.showWarning(t)},t.sendSuccess=function(t){e.showSuccess(t)},t}]).factory("personalizationsmarteditCommerceCustomizationService",function(){var e=["cxCmsActionData"],t={},n=[],a=function(t){return e.some(function(e){return e===t.type})},i=function(e){return!a(e)},o=function(e,t){return void 0!==t&&null!==t&&!0===t[e.confProperty]};return t.registerType=function(e){var t=e.type,a=!1;n.forEach(function(e){e.type===t&&(a=!0)}),a||n.push(e)},t.getAvailableTypes=function(e){return n.filter(function(t){return o(t,e)})},t.isCommerceCustomizationEnabled=function(e){return t.getAvailableTypes(e).length>0},t.getNonCommerceActionsCount=function(e){return(e.actions||[]).filter(a).length},t.getCommerceActionsCountMap=function(e){var t={};return(e.actions||[]).filter(i).forEach(function(e){var n=e.type.toLowerCase(),a=t[n];void 0===a?a=1:a+=1,t[n]=a}),t},t.getCommerceActionsCount=function(e){return(e.actions||[]).filter(i).length},t}).directive("uisOpenClose",["$parse","$timeout",function(e,t){return{restrict:"A",require:"uiSelect",link:function(n,a,i,o){o.onOpenCloseCallback=e(i.uisOpenClose),n.$watch("$select.open",function(e,a){e!==a&&t(function(){o.onOpenCloseCallback(n,{isOpen:e})})})}}}]).directive("negate",[function(){return{require:"ngModel",link:function(e,t,n,a){a.$isEmpty=function(e){return!!e},a.$formatters.unshift(function(e){return!e}),a.$parsers.unshift(function(e){return!e})}}}]).directive("personalizationCurrentElement",[function(){return{restrict:"A",link:function(e,t,n){n.personalizationCurrentElement&&e.$eval(n.personalizationCurrentElement)(t)}}}])},function(e,t){angular.module("personalizationsmarteditContextUtilsModule",[]).factory("personalizationsmarteditContextUtils",function(){var e=this,t=function(){this.enabled=!1},n=function(){this.enabled=!1,this.selectedCustomization=null,this.selectedVariations=null,this.selectedComponents=null},a=function(){this.enabled=!1,this.selectedItems=null,this.customize=new n},i=function(){this.pageId=null,this.seExperienceData=null,this.seConfigurationData=null,this.sePreviewData=null};return e.getContextObject=function(){return{personalization:new t,customize:new n,combinedView:new a,seData:new i}},e.clearCustomizeContext=function(e){var t=e.getCustomize();t.enabled=!1,t.selectedCustomization=null,t.selectedVariations=null,t.selectedComponents=null,e.setCustomize(t)},e.clearCustomizeContextAndReloadPreview=function(t,n){var a=angular.copy(n.getCustomize().selectedVariations);e.clearCustomizeContext(n),angular.isObject(a)&&!angular.isArray(a)&&t.clearAndReloadPreview()},e.clearCombinedViewCustomizeContext=function(e){var t=e.getCombinedView();t.customize.enabled=!1,t.customize.selectedCustomization=null,t.customize.selectedVariations=null,t.customize.selectedComponents=null,(t.selectedItems||[]).forEach(function(e){delete e.highlighted}),e.setCombinedView(t)},e.clearCombinedViewContext=function(e){var t=e.getCombinedView();t.enabled=!1,t.selectedItems=null,e.setCombinedView(t)},e.clearCombinedViewContextAndReloadPreview=function(t,n){var a=angular.copy(n.getCombinedView().enabled),i=angular.copy(n.getCombinedView().selectedItems);e.clearCombinedViewContext(n),a&&i&&t.clearAndReloadPreview()},e})},function(e,t){angular.module("personalizationsmarteditDataUtils",[]).factory("PaginationHelper",function(){return function(e){e=e||{},this.count=e.count||0,this.page=e.page||0,this.totalCount=e.totalCount||0,this.totalPages=e.totalPages||0,this.reset=function(){this.count=50,this.page=-1,this.totalPages=1,this.totalCount=0}}})},function(e,t){angular.module("personalizationsmarteditCommons").constant("PERSONALIZATION_DATE_FORMATS",{SHORT_DATE_FORMAT:"M/D/YY",MODEL_DATE_FORMAT:"YYYY-MM-DDTHH:mm:SSZ"}).factory("personalizationsmarteditDateUtils",["$filter","DATE_CONSTANTS","isBlank","PERSONALIZATION_DATE_FORMATS",function(e,t,n,a){var i={};return i.formatDate=function(e,n){return n=n||t.MOMENT_FORMAT,e?(e.match&&e.match(/^(\d{4})\-(\d{2})\-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\+|\-)(\d{4})$/)&&(e=e.slice(0,-2)+":"+e.slice(-2)),moment(new Date(e)).format(n)):""},i.formatDateWithMessage=function(t,n){return n=n||a.SHORT_DATE_FORMAT,t?i.formatDate(t,n):e("translate")("personalization.toolbar.pagecustomizations.nodatespecified")},i.isDateInThePast=function(e){return!n(e)&&moment(e,t.MOMENT_FORMAT).isBefore()},i.isDateValidOrEmpty=function(e){return n(e)||moment(e,t.MOMENT_FORMAT).isValid()},i.isDateRangeValid=function(e,t){return!(!n(e)&&!n(t))||moment(new Date(e)).isSameOrBefore(moment(new Date(t)))},i.isDateStrFormatValid=function(e,a){return a=a||t.MOMENT_FORMAT,!n(e)&&moment(e,a,!0).isValid()},i}]).directive("dateTimePickerRange",["$timeout","languageService","personalizationsmarteditDateUtils","DATE_CONSTANTS",function(e,t,n,a){return{templateUrl:"dateTimePickerRangeTemplate.html",restrict:"E",transclude:!0,replace:!1,scope:{name:"=",dateFrom:"=",dateTo:"=",isEditable:"=",dateFormat:"="},link:function(e,i){function o(){return i.querySelectorAll("#date-picker-range-from")}function r(){return o().datetimepicker().data("DateTimePicker")}function s(){return i.querySelectorAll("#date-picker-range-to")}function l(){return s().datetimepicker().data("DateTimePicker")}e.placeholderText="personalization.commons.datetimepicker.placeholder",e.isFromDateValid=!1,e.isToDateValid=!1,e.isEndDateInThePast=!1,e.isEditable&&(e.getDateOrDefault=function(e){try{return moment(new Date(e))}catch(e){return!1}},e.getMinToDate=function(t){return n.isDateInThePast(t)?new moment:e.getDateOrDefault(t)},o().datetimepicker({format:a.MOMENT_FORMAT,showClear:!0,showClose:!0,useCurrent:!1,keepInvalid:!0,locale:t.getBrowserLocale().split("-")[0]}).on("dp.change",function(t){var a=n.formatDate(t.date);n.isDateValidOrEmpty(a)&&n.isDateValidOrEmpty(e.dateTo)&&!n.isDateRangeValid(a,e.dateTo)&&(a=angular.copy(e.dateTo)),e.dateFrom=a}),s().datetimepicker({format:a.MOMENT_FORMAT,showClear:!0,showClose:!0,useCurrent:!1,keepInvalid:!0,locale:t.getBrowserLocale().split("-")[0]}).on("dp.change",function(t){var a=n.formatDate(t.date);n.isDateValidOrEmpty(a)&&n.isDateValidOrEmpty(e.dateFrom)&&!n.isDateRangeValid(e.dateFrom,a)&&(a=angular.copy(e.dateFrom)),e.dateTo=a}),e.$watch("dateFrom",function(){e.isFromDateValid=n.isDateValidOrEmpty(e.dateFrom),n.isDateStrFormatValid(e.dateFrom,a.MOMENT_FORMAT)?l().minDate(e.getMinToDate(e.dateFrom)):l().minDate(new moment)},!0),e.$watch("dateTo",function(){n.isDateValidOrEmpty(e.dateTo)?(e.isToDateValid=!0,e.isEndDateInThePast=n.isDateInThePast(e.dateTo)):(e.isToDateValid=!1,e.isEndDateInThePast=!1),n.isDateStrFormatValid(e.dateTo,a.MOMENT_FORMAT)&&r().maxDate(e.getDateOrDefault(e.dateTo))},!0))}}}]).directive("isdatevalidorempty",["isBlank","personalizationsmarteditDateUtils",function(e,t){return{restrict:"A",require:"ngModel",scope:!1,link:function(e,n,a,i){i.$validators.isdatevalidorempty=function(e){return t.isDateValidOrEmpty(e)}}}}])},function(e,t){angular.module("personalizationsmarteditCommons").directive("personalizationInfiniteScroll",["$rootScope","yjQuery","$window","$timeout",function(e,t,n,a){return{link:function(i,o,r){var s,l,c,d;return n=angular.element(n),c=0,null!==r.personalizationInfiniteScrollDistance&&i.$watch(r.personalizationInfiniteScrollDistance,function(e){return c=parseInt(e,10)}),d=!0,s=!1,null!==r.personalizationInfiniteScrollDisabled&&i.$watch(r.personalizationInfiniteScrollDisabled,function(e){if((d=!e)&&s)return s=!1,l()}),e.$on("refreshStart",function(){o.animate({scrollTop:"0"})}),l=function(){var n,a,l,m,u;if(!(o.children().length<=0))return n=t(o.children()[0]),a=o.offset().top+o.height(),u=n.offset().top+n.height(),l=u-a,(m=l<=o.height()*c)&&d?e.$$phase?i.$eval(r.personalizationInfiniteScroll):i.$apply(r.personalizationInfiniteScroll):m?s=!0:void 0},o.on("scroll",l),i.$on("$destroy",function(){return n.off("scroll",l)}),a(function(){return r.personalizationInfiniteScrollImmediateCheck?i.$eval(r.personalizationInfiniteScrollImmediateCheck)?l():void 0:l()},0)}}}])},function(e,t){angular.module("personalizationsmarteditCommons").directive("personalizationsmarteditPagination",function(){return{templateUrl:"personalizationsmarteditPaginationTemplate.html",restrict:"E",scope:{callback:"=",pages:"=?",currentPage:"=?",pageSizes:"=?",currentSize:"=?",pagesOffset:"=?",fixedPageSize:"=?",incrementByOne:"=?"},link:function(e){e.callback||console.error("callback is undefined!"),e.pages=e.pages||[0,1,2],e.currentPage=e.currentPage||0,e.pageSizes=e.pageSizes||[5,10,25,50,100],e.currentSize=e.currentSize||10,e.pagesOffset=e.pagesOffset||1,e.fixedPageSize=e.fixedPageSize||!1,e.incrementByOne=e.incrementByOne||!1,e.pageClick=function(t){e.currentPage!==t&&(e.currentPage=t,e.callback(e))},e.pageSizeClick=function(t){e.currentSize!==t&&(e.currentSize=t,e.currentPage=0,e.callback(e))},e.hasPrevious=function(){return e.currentPage>0},e.hasNext=function(){return e.currentPage<e.pages.length-1},e.isActive=function(t){return e.currentPage===t},e.rightClick=function(){e.hasNext()&&(e.currentPage=e.incrementByOne?e.currentPage+1:e.pages.length-1,e.callback(e))},e.leftClick=function(){e.hasPrevious()&&(e.currentPage=e.incrementByOne?e.currentPage-1:0,e.callback(e))},e.pagesToDisplay=function(){var t=2*e.pagesOffset+1;if(e.pages.length<=t)return e.pages;var n=Math.max(e.currentPage-e.pagesOffset,0);return n+t>e.pages.length&&(n=e.pages.length-t),e.pages.slice(n,n+t)},e.availablePageSizes=function(){return e.pageSizes},e.getCurrentPageSize=function(){return e.currentSize},e.isFixedPageSize=function(){return e.fixedPageSize},e.showArrows=function(){return e.pages.length>2*e.pagesOffset+1}}}})},function(e,t){angular.module("personalizationsmarteditScrollZone",["yjqueryModule"]).controller("personalizationsmarteditScrollZoneController",["$scope","$timeout","$compile","yjQuery",function(e,t,n,a){var i=this,o=!0;Object.defineProperty(this,"scrollZoneTop",{get:function(){return o},set:function(e){o=e}});var r=!0;Object.defineProperty(this,"scrollZoneBottom",{get:function(){return r},set:function(e){r=e}});var s=!1;Object.defineProperty(this,"start",{get:function(){return s},set:function(e){s=e}});var l={};Object.defineProperty(this,"elementToScroll",{get:function(){return l},set:function(e){l=e}});var c=!1;Object.defineProperty(this,"scrollZoneVisible",{get:function(){return c},set:function(e){c=e}}),this.stopScroll=function(){i.start=!1},this.scrollTop=function(){i.start&&(i.scrollZoneTop=!(i.elementToScroll.scrollTop()<=2),i.scrollZoneBottom=!0,i.elementToScroll.scrollTop(i.elementToScroll.scrollTop()-15),t(function(){i.scrollTop()},100))},this.scrollBottom=function(){if(i.start){i.scrollZoneTop=!0;var e=i.elementToScroll.get(0).scrollHeight-i.elementToScroll.scrollTop();i.scrollZoneBottom=!(Math.abs(e-i.elementToScroll.outerHeight())<2),i.elementToScroll.scrollTop(i.elementToScroll.scrollTop()+15),t(function(){i.scrollBottom()},100)}},this.$onChanges=function(e){e.scrollZoneVisible&&(i.start=e.scrollZoneVisible.currentValue,i.scrollZoneTop=!0,i.scrollZoneBottom=!0)},this.$onInit=function(){var t=n('<div id="sliderTopScrollZone" data-ng-include="\'personalizationsmarteditScrollZoneTopTemplate.html\'"></div>')(e);angular.element("body").append(t);var a=n('<div id="sliderBottomScrollZone" data-ng-include="\'personalizationsmarteditScrollZoneBottomTemplate.html\'"></div>')(e);angular.element("body").append(a),i.elementToScroll=i.getElementToScroll()},this.$onDestroy=function(){angular.element("#sliderTopScrollZone").scope().$destroy(),angular.element("#sliderTopScrollZone").remove(),angular.element("#sliderBottomScrollZone").scope().$destroy(),angular.element("#sliderBottomScrollZone").remove(),angular.element("body").contents().each(function(){this.nodeType===Node.COMMENT_NODE&&this.data.indexOf("personalizationsmarteditScrollZone")>-1&&a(this).remove()})}}]).component("personalizationsmarteditScrollZone",{controller:"personalizationsmarteditScrollZoneController",controllerAs:"ctrl",transclude:!0,bindings:{scrollZoneVisible:"<",getElementToScroll:"&",isTransparent:"<?"}})},function(e,t){angular.module("personalizationcommonsTemplates",[]).run(["$templateCache",function(e){"use strict";e.put("web/features/personalizationcommons/dateTimePickerRange/dateTimePickerRangeTemplate.html",'<div class="pe-datetime-range">\n    <div class="col-md-6 pe-datetime-range__from"\n        data-ng-class="{\'has-error\': !isFromDateValid}">\n        <label for="customization-start-date"\n            data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.startdate"\n            class="personalization-modal__label"></label>\n        <y-help data-template="\'<span data-translate=personalization.modal.customizationvariationmanagement.basicinformationtab.details.startdate.help></span>\'">\n        </y-help>\n        <div class="input-group date pe-date-field"\n            id="date-picker-range-from"\n            data-ng-show="isEditable">\n            <input type=\'text\'\n                name="date_from_key"\n                class="form-control pe-date-field__input"\n                placeholder="{{ placeholderText | translate}}"\n                data-ng-disabled="!isEditable"\n                name="{{name}}"\n                isdatevalidorempty\n                data-ng-model="dateFrom"\n                id="customization-start-date" />\n            <span class="input-group-addon pe-datetime-range__picker"\n                data-ng-show="isEditable">\n                <span class="glyphicon glyphicon-calendar pe-datetime-range__picker__icon"></span>\n            </span>\n        </div>\n        <div class="input-group date pe-date-field"\n            id="date-picker-range-from"\n            data-ng-show="!isEditable">\n            <input type=\'text\'\n                name="date_from_key"\n                class="form-control pe-date-field__input "\n                data-ng-class="{\'pe-input--is-disabled\': !isEditable}"\n                data-ng-model="dateFrom"\n                data-date-formatter\n                id="customization-start-date"\n                isdatevalidorempty\n                data-ng-disabled="true"\n                data-format-type="short">\n        </div>\n        <span data-ng-if="!isFromDateValid"\n            class="help-block pe-datetime__error-msg pe-datetime__msg"\n            data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.wrongdateformatfrom.description">\n        </span>\n    </div>\n    <div class="col-md-6 pe-datetime-range__to"\n        data-ng-class="{\'has-error\':!isToDateValid, \'has-warning\':isEndDateInThePast}">\n        <label for="customization-end-date"\n            data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddate"\n            class="personalization-modal__label"></label>\n        <y-help data-template="\'<span data-translate=personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddate.help></span>\'">\n        </y-help>\n        <div class="input-group date pe-date-field"\n            id="date-picker-range-to">\n            <input type=\'text\'\n                name="date_to_key"\n                class="form-control pe-date-field__input"\n                placeholder="{{ placeholderText | translate}}"\n                data-ng-disabled="!isEditable"\n                name="{{name}}"\n                isdatevalidorempty\n                data-ng-model="dateTo"\n                id="customization-end-date" />\n            <span class="input-group-addon pe-datetime-range__picker"\n                data-ng-show="isEditable">\n                <span class="glyphicon glyphicon-calendar pe-datetime-range__picker__icon"></span>\n            </span>\n        </div>\n        <div class="input-group date pe-date-field"\n            id="date-picker-range-to"\n            data-ng-show="!isEditable">\n            <input type=\'text\'\n                name="date_to_key"\n                class="form-control pe-date-field__input "\n                data-ng-class="{\'pe-input--is-disabled\': !isEditable}"\n                data-ng-model="dateTo"\n                data-date-formatter\n                id="customization-end-date"\n                isdatevalidorempty\n                data-ng-disabled="true"\n                data-format-type="short">\n        </div>\n        <span class="help-block pe-datetime__error-msg pe-datetime__msg"\n            data-ng-if="!isToDateValid"\n            data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.wrongdateformat.description">\n        </span>\n        <span data-ng-if="isEndDateInThePast"\n            class="help-block pe-datetime__warning-msg pe-datetime__msg">\n            <span class="hyicon hyicon-msgwarning"></span>\n            <span data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details.enddateinthepast.description"></span>\n        </span>\n    </div>\n</div>'),e.put("web/features/personalizationcommons/personalizationsmarteditPagination/personalizationsmarteditPaginationTemplate.html",'<div class="row">\n    <div class="col-xs-4"></div>\n    <div class="col-xs-4">\n        <ul class="pagination pagination-lg">\n            <li class="no-underline"\n                data-ng-if="showArrows()"\n                data-ng-click="leftClick()"\n                data-ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li class="no-underline"\n                data-ng-repeat="i in pagesToDisplay()"\n                data-ng-class="isActive({{i}})?\'active\':\'\'"><a data-ng-click="pageClick(i)">{{i+1}}</a></li>\n            <li class="no-underline"\n                data-ng-if="showArrows()"\n                data-ng-click="rightClick()"\n                data-ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n    <div class="col-xs-2"></div>\n    <div data-uib-dropdown\n        class="col-xs-2"\n        data-ng-if="!isFixedPageSize()">\n        <button type="button"\n            data-uib-dropdown-toggle\n            class="btn btn-link pull-right">\n            <span data-ng-bind="getCurrentPageSize()"></span>\n            <span data-translate="personalization.commons.pagination.rowsperpage"></span>\n            <span class="list-arrow hyicon hyicon-arrow"></span>\n        </button>\n        <ul data-uib-dropdown-menu\n            class="pull-right text-left"\n            role="menu">\n            <li data-ng-repeat="i in availablePageSizes() track by $index"><a data-ng-click="pageSizeClick(i)">{{i}}</a></li>\n        </ul>\n    </div>\n</div>'),e.put("web/features/personalizationcommons/personalizationsmarteditScrollZone/personalizationsmarteditScrollZoneBottomTemplate.html",'<div class="perso__scrollzone perso__scrollzone--bottom"\n    data-ng-class="ctrl.isTransparent?\'perso__scrollzone--transparent\':\'perso__scrollzone--normal\'"\n    data-ng-show="ctrl.scrollZoneVisible && ctrl.scrollZoneBottom"\n    data-ng-mouseenter="ctrl.start=true;ctrl.scrollBottom()"\n    data-ng-mouseleave="ctrl.stopScroll()">\n</div>'),e.put("web/features/personalizationcommons/personalizationsmarteditScrollZone/personalizationsmarteditScrollZoneTopTemplate.html",'<div class="perso__scrollzone perso__scrollzone--top"\n    data-ng-class="ctrl.isTransparent?\'perso__scrollzone--transparent\':\'perso__scrollzone--normal\'"\n    data-ng-show="ctrl.scrollZoneVisible && ctrl.scrollZoneTop"\n    data-ng-mouseenter="ctrl.start=true;ctrl.scrollTop()"\n    data-ng-mouseleave="ctrl.stopScroll()">\n</div>')}])}]);