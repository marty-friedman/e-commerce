!function(e){function a(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}var r={};a.m=e,a.c=r,a.d=function(e,r,t){a.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},a.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},a.p="",a(a.s=0)}([function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=r(1),i=(r.n(t),r(2));r.n(i);t.module("personalizationsearchsmarteditContainer",["featureServiceModule","personalizationsearchsmarteditContainerTemplates","personalizationsearchSearchProfilesModule"]).run(["yjQuery","domain",function(e,a){"ngInject";!function(a){var r=e("<link rel='stylesheet' type='text/css' href='"+a+"'>");e("head").append(r)}(a+"/personalizationsearchsmartedit/css/style.css")}])},function(e,a){e.exports=angular},function(e,a){angular.module("personalizationsearchSearchProfilesModule",["personalizationsmarteditCommons","personalizationsmarteditCommerceCustomizationModule","personalizationsmarteditDataFactory","personalizationsearchRestServiceModule","waitDialogServiceModule","personalizationsearchSearchProfilesContextServiceModule"]).constant("SEARCH_PROFILE_ACTION_TYPE","cxSearchProfileActionData").run(["$q","$filter","personalizationsearchRestService","personalizationsmarteditCommerceCustomizationService","personalizationsearchSearchProfilesContextService","personalizationsmarteditMessageHandler","SEARCH_PROFILE_ACTION_TYPE",function(e,a,r,t,i,o,n){t.registerType({type:n,text:"personalizationsearchsmartedit.commercecustomization.action.type.search",template:"personalizationsearchSearchProfilesTemplate.html",confProperty:"personalizationsearch.commercecustomization.search.profile.enabled",getName:function(e){return a("translate")("personalizationsearchsmartedit.commercecustomization.search.display.name")+" - "+e.searchProfileCode},updateActions:function(t,n,s,c){var l=e.defer();angular.isDefined(c)&&i.updateSearchActionContext(c.data.actions);var d=i.searchProfileContext,u=d.searchProfilesOrder.splice(0,1)[0],p=d.searchProfilesOrder.map(function(e){return e.code}).join(","),f={customizationCode:d.customizationCode,variationCode:d.variationCode,rankAfterAction:u.code,actions:p};return r.updateSearchProfileActionRank(f).then(function(){l.resolve()},function(){o.sendError(a("translate")("personalization.error.updatingcustomization")),l.reject()}),l.promise}})}]).controller("personalizationsearchSearchProfilesController",["$q","$scope","$filter","personalizationsearchRestService","personalizationsmarteditMessageHandler","waitDialogService","personalizationsearchSearchProfilesContextService","personalizationsmarteditContextService","PaginationHelper","SEARCH_PROFILE_ACTION_TYPE","PERSONALIZATION_COMMERCE_CUSTOMIZATION_ACTION_STATUSES",function(e,a,r,t,i,o,n,s,c,l,d){a.selectedSearchProfile=null,a.availableSearchProfiles=[],a.searchProfileActions=[],a.helpTemplate="<span>"+r("translate")("personalizationsearchsmartedit.commercecustomization.search.helpmsg")+"</span>",a.searchProfileContext=n.searchProfileContext,a.searchProfilePagination=new c,a.searchProfilePagination.reset(),a.searchProfileFilter={code:""};var u=function(){var a=e.defer(),r=s.getSeData().seExperienceData,i=[];return angular.forEach(r.productCatalogVersions||[],function(e){i.push(t.getIndexTypesForCatalogVersion(e))}),e.all(i).then(function(e){var r={indexTypeIds:[]};angular.forEach(e,function(e){r.indexTypeIds=r.indexTypeIds.concat(e.indexTypeIds.filter(function(e){return r.indexTypeIds.indexOf(e)<0}))}),a.resolve(r)},function(e){a.reject(e)}),a.promise},p=function(){return{code:a.searchProfileFilter.code,pageSize:a.searchProfilePagination.count,currentPage:a.searchProfilePagination.page+1}},f=function(e){return{type:l,searchProfileCode:e.code,searchProfileCatalog:e.catalogVersion.split(":")[0]}},h=function(e){return a.actions.filter(function(a){return n.searchProfileActionComparer(e,a.action)})[0]};a.searchProfileSelected=function(e,r){var t=f(e);a.addAction(t,n.searchProfileActionComparer),r.selected=null},a.isItemInSelectDisabled=function(e){var r=f(e);return a.isItemInSelectedActions(r,n.searchProfileActionComparer)},a.initUiSelect=function(e){e.isActive=function(){return!1},a.availableSearchProfiles=JSON.parse(JSON.stringify(a.availableSearchProfiles))},a.removeSelectedSearchAction=function(e){var r=h(e);a.removeSelectedAction(r)};var m=function(e){e.forEach(function(e){e.status!==d.NEW&&(e.status=d.UPDATE)})};a.setSearchActionRank=function(e,r){var t=h(e),i=h(a.searchProfileActions[a.searchProfileActions.indexOf(e)+r]),o=a.actions.indexOf(t),n=a.actions.indexOf(i);a.actions.splice(n,0,a.actions.splice(o,1)[0]),m([t,i])},a.isDirty=function(){return!0},a.moreSearchProfilestRequestProcessing=!1,a.addMoreSearchProfilesItems=function(){a.searchProfilePagination.page<a.searchProfilePagination.totalPages-1&&!a.moreSearchProfilestRequestProcessing&&(a.moreSearchProfilestRequestProcessing=!0,u().then(function(e){var o=p(),n={indexTypes:e.indexTypeIds||[]};o=angular.extend(o,n),t.getSearchProfiles(o).then(function(e){Array.prototype.push.apply(a.availableSearchProfiles,e.searchProfiles),a.searchProfilePagination=new c(e.pagination),a.moreSearchProfilestRequestProcessing=!1},function(){i.sendError(r("translate")("personalizationsearchsmartedit.commercecustomization.search.error.gettingsearchprofiles")),a.moreSearchProfilestRequestProcessing=!1})},function(){i.sendError(r("translate")("personalizationsearchsmartedit.commercecustomization.search.error.gettingindextypes"))}))},a.segmentSearchInputKeypress=function(e,r){e&&[37,38,39,40].indexOf(e.which)>-1||(a.searchProfilePagination.reset(),a.searchProfileFilter.code=r,a.availableSearchProfiles.length=0,a.addMoreSearchProfilesItems())},a.treeOptions={dragStart:function(){a.destEl=void 0},beforeDrop:function(e){a.destEl=a.searchProfileActions[e.dest.index]},dropped:function(e){if(e.source.index!==e.dest.index){var r=e.source.nodeScope.$modelValue;a.actions.splice(a.destEl.baseIndex,0,a.actions.splice(r.baseIndex,1)[0]);var t=e.source.index<e.dest.index?e.source.index:e.dest.index,i=Math.abs(e.dest.index-e.source.index)+1,o=a.searchProfileActions.slice(t,i).map(function(e){return h(e)});m(o)}}},a.$watch("actions",function(e){var r=e||[];a.searchProfileActions=r.filter(function(e){return e.action.type===l}).map(function(e){return angular.extend(e.action,{baseIndex:r.indexOf(e)})}),a.searchProfileContext.searchProfilesOrder=a.searchProfileActions},!0),a.$watch("customization",function(e){angular.isDefined(e)?a.searchProfileContext.customizationCode=e.code:a.searchProfileContext.customizationCode=void 0},!0),a.$watch("variation",function(e){angular.isDefined(e)?a.searchProfileContext.variationCode=e.code:a.searchProfileContext.variationCode=void 0},!0)}]),angular.module("personalizationsearchSearchProfilesContextServiceModule",[]).factory("personalizationsearchSearchProfilesContextService",function(){var e=this,a=function(){this.customizationCode=void 0,this.variationCode=void 0,this.initialOrder=[],this.searchProfilesOrder=[]};return this.searchProfileActionComparer=function(e,a){return e.type===a.type&&e.searchProfileCode===a.searchProfileCode&&e.searchProfileCatalog===a.searchProfileCatalog},this.getSearchProfileActionContext=function(){return new a},this.searchProfileContext=this.getSearchProfileActionContext(),this.updateSearchActionContext=function(a){a.forEach(function(a){e.searchProfileContext.searchProfilesOrder.filter(function(r){return e.searchProfileActionComparer(a,r)})[0].code=a.code})},e.isDirty=function(){return!1},e}),angular.module("personalizationsearchRestServiceModule",["smarteditServicesModule","personalizationsmarteditCommons","personalizationsmarteditContextServiceModule"]).factory("personalizationsearchRestService",["restServiceFactory","personalizationsmarteditContextService","personalizationsmarteditUtils",function(e,a,r){var t={};return t.getSearchProfiles=function(r){var t=(a.getSeData().seExperienceData.productCatalogVersions||[]).map(function(e){return e.catalog+":"+e.catalogVersion}).join(","),i=e.get("/adaptivesearchwebservices/v1/searchprofiles"),o={catalogVersions:t};return r=angular.extend(r,o),i.get(r)},t.updateSearchProfileActionRank=function(t){var i=a.getSeData().seExperienceData,o=e.get("/personalizationwebservices/v1/query/cxUpdateSearchProfileActionRank"),n=[];r.pushToArrayIfValueExists(n,"customization",t.customizationCode),r.pushToArrayIfValueExists(n,"variation",t.variationCode),r.pushToArrayIfValueExists(n,"rankBeforeAction",t.rankBeforeAction),r.pushToArrayIfValueExists(n,"rankAfterAction",t.rankAfterAction),r.pushToArrayIfValueExists(n,"actions",t.actions),r.pushToArrayIfValueExists(n,"catalog",i.catalogDescriptor.catalogId),r.pushToArrayIfValueExists(n,"catalogVersion",i.catalogDescriptor.catalogVersion);var s={params:{entry:n}};return o.save(s)},t.getIndexTypesForCatalogVersion=function(t){var i=a.getSeData().seExperienceData,o=e.get("/personalizationwebservices/v1/query/cxGetIndexTypesForSite"),n=[];r.pushToArrayIfValueExists(n,"baseSiteId",i.catalogDescriptor.siteId),r.pushToArrayIfValueExists(n,"catalog",t.catalog),r.pushToArrayIfValueExists(n,"catalogVersion",t.catalogVersion);var s={params:{entry:n}};return o.save(s)},t}]),angular.module("personalizationsearchsmarteditContainerTemplates",[]).run(["$templateCache",function(e){"use strict";e.put("web/features/personalizationsearchsmarteditContainer/personalization/management/commerceCustomizationView/searchProfiles/personalizationsearchSearchProfilesTemplate.html",'<div ng-controller="personalizationsearchSearchProfilesController" class="ps-search-profile">\n    <div class="form-group">\n        <label for="search-profile-selector-1" class="control-label ps-control-label" data-translate="personalizationsearchsmartedit.commercecustomization.search.label"></label>\n        <ui-select uis-open-close="initUiSelect($select)" id="search-profile-selector-1" class="form-control" ng-model="selectedSearchProfile" ng-keyup="segmentSearchInputKeypress($event, $select.search)" on-select="searchProfileSelected($item, $select)" theme="select2" search-enabled="true" reset-search-input="false">\n            <ui-select-match placeholder="{{\'personalizationsearchsmartedit.commercecustomization.search.placeholder\' | translate}}">\n                <span>{{\'personalizationsearchsmartedit.commercecustomization.search.placeholder\' | translate}}</span>\n            </ui-select-match>\n            <ui-select-choices repeat="item in availableSearchProfiles" ui-disable-choice="isItemInSelectDisabled(item)" position="down" personalization-infinite-scroll="addMoreSearchProfilesItems()" personalization-infinite-scroll-distance="2">\n                <div class="row ng-scope">\n                    <span class="col-md-8 ng-binding" ng-bind="item.name"></span>\n                    <span class="col-md-4 ng-binding" ng-bind="item.catalog"></span>\n                </div>\n            </ui-select-choices>\n        </ui-select>\n\n        <div class="ps-search-profile__selection" data-ng-if="searchProfileActions">\n\n            <label data-ng-if="searchProfileActions.length" class="control-label ps-control-label">\n                <span>{{\'personalizationsearchsmartedit.commercecustomization.search.selection.label\' | translate}}</span>\n                <y-help data-ng-if="searchProfileActions.length" data-template="helpTemplate"></y-help>\n            </label>\n\n            <div ui-tree="treeOptions" id="tree-root" class="ps-search-profile__sel-tree">\n                <div ui-tree-nodes ng-model="searchProfileActions" class="ps-search-profile__sel-tbody">\n                    <div ng-repeat="action in searchProfileActions" ui-tree-node data-nodrop-enabled="true" class="ps-search-profile__sel-tree-row">\n                        <div class="ps-search-profile__sel-tree-row-wrapper">\n                            <div ui-tree-handle class="ps-search-profile__sel-profile">\n                                <span class="ps-search-profile__sel-profile-code" data-ng-bind="action.searchProfileCode"></span>\n                            </div>\n                            <div class="ps-search-profile__sel-menu" data-uib-dropdown>\n                                <button type="button" data-uib-dropdown-toggle class="btn btn-link dropdown-toggle pull-right">\n                                    <span class="hyicon hyicon-more"></span>\n                                </button>\n                                <ul class="dropdown-menu pull-right text-left" role="menu">\n                                    <li ng-class="$first ? \'disabled\' : \'\' ">\n                                        <a data-ng-click="($first) ? $event.stopPropagation() : setSearchActionRank(action, -1)" data-translate="personalizationsearchsmartedit.commercecustomization.search.actions.grid.options.moveup"></a>\n                                    </li>\n                                    <li ng-class="$last ? \'disabled\' : \'\' ">\n                                        <a data-ng-click="($last) ? $event.stopPropagation() : setSearchActionRank(action, 1)" data-translate="personalizationsearchsmartedit.commercecustomization.search.actions.grid.options.movedown"></a>\n                                    </li>\n                                    <li role="separator" class="divider"></li>\n                                    <li>\n                                        <a data-ng-click="removeSelectedSearchAction(action)" data-translate="personalizationsearchsmartedit.commercecustomization.search.actions.grid.options.delete"></a>\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <label data-ng-if="searchProfileActions.length" class="control-label ps-control-label__cust" data-translate="personalizationsearchsmartedit.commercecustomization.search.label.cust"></label>\n</div>')}])}]);